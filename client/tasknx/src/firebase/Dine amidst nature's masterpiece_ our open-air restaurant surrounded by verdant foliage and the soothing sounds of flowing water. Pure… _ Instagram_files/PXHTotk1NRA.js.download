;/*FB_PKG_DELIM*/

__d("registerExecutionContext",["BroadcastChannelClientServerHandshake","FBLogger","asyncToGeneratorRuntime","getBroadcastChannelForExecutionContext","loadTaskHandlerResource","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var d=a.context,e=a.name;a=a.payload;try{var f=(yield c("loadTaskHandlerResource")(e));if(f==null)throw c("FBLogger")("mpf_web_foundations").mustfixThrow("No task handler found for %s",e);e=(yield f.handleTask(a,d));f={context:d,result:e,type:"task_success"};b.postMessage(f)}catch(c){a={context:d,type:"task_failure"};b.postMessage(a)}return});return i.apply(this,arguments)}function a(a){var b=c("getBroadcastChannelForExecutionContext")(a);d("BroadcastChannelClientServerHandshake").listen(b);var e=new Set();b.addEventListener("message",function(a){switch(a.data.type){case"execute_task":a=a.data;var d=a.context.taskID;if(e.has(d))return;e.add(d);c("promiseDone")(h(a,b)["finally"](function(){e["delete"](d)}));break;default:}});return function(){return b.close()}}g["default"]=a}),98);
__d("registerMAWExecutionContext",["CometTaskFrameworkTypes","registerExecutionContext"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("registerExecutionContext")(d("CometTaskFrameworkTypes").ExecutionContext.MAW_WORKER)}g["default"]=a}),98);
__d("ReStoreIDBFactory",["invariant","Deferred","I64","IndexedDbPolyfills","ReStoreKeyComparer","err","isPromise","nullthrows","promiseDone","unrecoverableViolation"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k,l="e2ee_",m=new MessageChannel(),n=[];m.port1.onmessage=function(){var a=n.pop();a()};function o(a){n.push(a),m.port2.postMessage({})}function p(a){var b=new Map();function c(a){if(typeof a!=="object"||a===null)return a;if(b.has(a))return b.get(a);var d;if(Array.isArray(a)){d=[];b.set(a,d);for(var e of a)d.push(c(e))}else if(a instanceof Set){d=new Set();b.set(a,d);for(e of a)d.add(c(e))}else if(a instanceof Map){d=new Map();b.set(a,d);for(e of a){var f=e[0],g=e[1];d.set(c(f),c(g))}}else if(a instanceof ArrayBuffer)d=new ArrayBuffer(a.byteLength),new Uint8Array(d).set(new Uint8Array(a));else if(a instanceof Uint8Array){f=c(a.buffer);d=new Uint8Array(f,a.byteOffset,a.length)}else d={};b.set(a,d);for(g of Object.keys(a))d[g]=c(a[g]);return d}return c(a)}function q(a,b){function d(b){if(b.done)return b.value;if(!(k||(k=c("isPromise")))(b.value))throw c("unrecoverableViolation")("expected promise","messenger_web_product");return b.value.then(function(b){return d(a.next(b))})}return d(a.next(b))}function* r(a){return(k||(k=c("isPromise")))(a)?yield a:a}function s(a,b){a=[].concat(a);b!==-1&&(a[b]=(i||(i=d("I64"))).to_float(c("nullthrows")(i.cast(a[b]),"Expected autoincrementing field to be an I64")));return a.length===1?a[0]:a}function t(a,b){a=Array.isArray(a)?a:[a];return a.map(function(a,c){if(a===-Infinity)return void 0;if(Array.isArray(a)&&a.length===0)return(j||(j=d("ReStoreKeyComparer"))).MAX_KEY;if(Array.isArray(a)&&a.length===1&&Array.isArray(a[0])&&a[0].length===0)return(j||(j=d("ReStoreKeyComparer"))).MAX_KEY;return c===b&&typeof a==="number"?(i||(i=d("I64"))).of_float(a):a})}function u(a,b,e){var f=a.indexes,g=a.primaryKeyIds;g=e==null?g:f[e];f=g.map(function(f){if(b[f]!==void 0||e!=null){var g=b[f];if(a.autoIncrement&&f===a.primaryKeyIds[0]){g=(i||(i=d("I64"))).cast(g);if(g==null)throw c("unrecoverableViolation")("expected auto-incrementing field to be an i64","messenger_web_product");g=i.to_float(g)}return g}throw c("unrecoverableViolation")("primary key must be defined on object","messenger_web_product")});return f.length===1?f[0]:f}var v=function(){function a(a){this.$1=a}var b=a.prototype;b.continue=function(a){this.$1(a)};b.advance=function(a){for(var b=0;b<a;b++)this.continue()};return a}(),w=function(){function a(a,b,c,d){this.$1=a,this.$2=b,this.$3=c,this.$4=d}var b=a.prototype;b.openCursor=function(a,b){var c=this;return A(a,b,function(a){return a[c.$3].index(c.$1)},this.$4,this.$2,this.$1)};b.count=function(a){var b=this.$2.autoIncrement?this.$2.indexes[this.$1].indexOf(this.$2.primaryKeyIds[0]):-1,c=this;return this.$4(new(d("IndexedDbPolyfills").IDBRequest)(),function(d){return q(function*(){var e=new WeakMap();e=(yield* r(d[c.$3].index(c.$1).keys(e,"asc",z(a,b))));var f=0,g=(yield* r(e.next()));while(!g.done)f++,g=(yield* r(e.next()));return f}())})};babelHelpers.createClass(a,[{key:"keyPath",get:function(){return this.$2.indexes[this.$1].length===1?this.$2.indexes[this.$1][0]:this.$2.indexes[this.$1]}},{key:"name",get:function(){return this.$1}}]);return a}();function x(a,b){if(b==null)return a;var e=c("nullthrows")((i||(i=d("I64"))).cast(a[b]),"expected auto-increment field to be an I64");a[b]=i.to_float(e);return a}function y(a,b){if(b==null||a[b]==null)return babelHelpers.extends({},a);typeof a[b]==="number"||h(0,72542);a[b]=(i||(i=d("I64"))).of_float(a[b]);return a}function z(a,b){var c;a!=null&&(c={},a.lower!==void 0&&(a.lowerOpen?c.gt=t(a.lower,b):c.gte=t(a.lower,b)),a.upper!==void 0&&(a.upperOpen?c.lt=t(a.upper,b):c.lte=t(a.upper,b)));return c}function A(a,b,e,f,g,h){var i=g.autoIncrement?h==null?0:g.indexes[h].indexOf(g.primaryKeyIds[0]):-1,k=g.autoIncrement?g.primaryKeyIds[0]:null,l="asc";if(b==="prev")l="desc";else if(b!==void 0&&b!=="next")throw c("err")("Unsupported direction:"+b);var m=new WeakMap(),n=new(d("IndexedDbPolyfills").IDBRequest)(),o,w=new v(y);n.result=w;function y(b){var c;b!=null&&(c=t(b,i));f(n,function(b){return q(function*(){var f;o=(f=o)!=null?f:e(b).entries(m,l,z(a,i));var h=o,n=(yield* r(h.next(c)));f=function*(){var a=n.value[0];for(var b=0;b<a.length;b++){var c=a.slice(0,b);if(l==="asc"){if(a[b]==null){if(b===a.length-1)n=(yield* r(h.next()));else{var e=[].concat(c,[void 0,(j||(j=d("ReStoreKeyComparer"))).MAX_KEY]);n=(yield* r(h.next(e)))}if(n.done)return"break|outer";a=n.value[0];if(!c.every(function(b,c){return(j||(j=d("ReStoreKeyComparer"))).compareValue(b,a[c])===0}))return"continue|outer"}}else if(a[b]==null){n=(yield* r(h.next(c)));return"continue|outer"}}return"break"};outer:while(!n.done){var q=(yield* f());switch(q){case"break|outer":break outer;case"continue|outer":continue outer;case"break":break outer}}if(!n.done){q=s(n.value[0],i);w.primaryKey=u(g,n.value[1]);w.key=q;w.value=x(p(n.value[1]),k);return w}}())})}y();return n}var B=function(){function a(a,b,c){this.$1=a,this.$2=b,this.$3=this.$1.getTableData().tableNames[this.$2],this.$4=c}var b=a.prototype;b.index=function(a){return new w(a,this.$3,this.$2,this.$4)};b.get=function(a){var b=this;return this.$4(new(d("IndexedDbPolyfills").IDBRequest)(),function(c){return q(function*(){var d;d=(yield* r((d=c[b.$2]).get.apply(d,t(a,b.$3.autoIncrement?0:-1))));return d==null?d:x(p(d),b.$3.autoIncrement?b.$3.primaryKeyIds[0]:null)}())})};b.clear=function(){var a=this;return this.$4(new(d("IndexedDbPolyfills").IDBRequest)(),async function(b){var c=b[a.$2].entries(new WeakMap()),d=await c.next();while(!d.done){var e;await (e=b[a.$2]).delete.apply(e,d.value[0]);d=await c.next()}})};b.put=function(a,b){var c=this,e=y(p(a),this.$3.autoIncrement?this.$3.primaryKeyIds[0]:null);b==null||h(0,72438);return this.$4(new(d("IndexedDbPolyfills").IDBRequest)(),async function(a){var b=c.$3.autoIncrement?0:-1;return s(await a[c.$2].put(e),b)})};b.add=function(a,b){var c=this,e=y(p(a),this.$3.autoIncrement?this.$3.primaryKeyIds[0]:null);b==null||h(0,72437);return this.$4(new(d("IndexedDbPolyfills").IDBRequest)(),async function(a){var b=c.$3.autoIncrement?0:-1;return s(await a[c.$2].add(e),b)})};b.delete=function(a){var b=this;return this.$4(new(d("IndexedDbPolyfills").IDBRequest)(),async function(c){if(a instanceof IDBKeyRange){var d=new WeakMap(),e=b.$3.autoIncrement?0:-1;d=await c[b.$2].entries(d,"asc",z(a,e));e=await d.next();while(!e.done){var f;await (f=c[b.$2]).delete.apply(f,e.value[0]);e=await d.next()}}else{await (f=c[b.$2]).delete.apply(f,t(a,b.$3.autoIncrement?0:-1))}return void 0})};b.openCursor=function(a,b){var c=this;return A(a,b,function(a){return a[c.$2]},this.$4,this.$3)};b.count=function(a){var b=this.$3.autoIncrement?0:-1,c=this;return this.$4(new(d("IndexedDbPolyfills").IDBRequest)(),function(d){return q(function*(){var e=new WeakMap();e=(yield* r(d[c.$2].keys(e,"asc",z(a,b))));var f=0,g=(yield* r(e.next()));while(!g.done)f++,g=(yield* r(e.next()));return f}())})};b.createIndex=function(a,b){};b.deleteIndex=function(a){};babelHelpers.createClass(a,[{key:"indexNames",get:function(){return Object.keys(this.$3.indexes)}},{key:"name",get:function(){return this.$2.substr(l.length)}},{key:"autoIncrement",get:function(){return this.$3.autoIncrement}},{key:"keyPath",get:function(){return this.$3.primaryKeyIds.length===1?this.$3.primaryKeyIds[0]:this.$3.primaryKeyIds}}]);return a}(),C=function(b){babelHelpers.inheritsLoose(a,b);function a(a,d,e,f){var g;g=b.call(this)||this;g.$ReStoreIDBTransaction5=[];g.$ReStoreIDBTransaction6=new(c("Deferred"))();g.state="active";g.oncomplete=null;g.onerror=null;g.$ReStoreIDBTransaction1=a;g.$ReStoreIDBTransaction4=d;g.$ReStoreIDBTransaction3=e;g.$ReStoreIDBTransaction2=f;c("promiseDone")(g.$ReStoreIDBTransaction1.runInTransaction(function(a){g.$ReStoreIDBTransaction6.resolve(a);return new Promise(function(b,d){var e=async function e(){var f=[].concat(g.$ReStoreIDBTransaction5);if(g.state==="finished"){d();throw c("err")("Transaction aborted")}if(!f.length){g.state="committing";return b()}try{g.state="inactive";var h=[];for(var i of f){i[0];var j=i[1];try{j=j(a);j={status:"fulfilled",value:(k||(k=c("isPromise")))(j)?await j:j}}catch(a){j={reason:a,status:"rejected"}}h.push(j)}g.state="active";g.$ReStoreIDBTransaction5=[];for(j=0;j<h.length;j++){i=h[j];var l=f[j];l=l[0];i.status==="fulfilled"?(l.result=i.value,l.emit("success",{target:l})):(l.error=i.reason,l.emit("error",{target:l}))}}catch(a){return d(a)}o(function(){return void e()})};o(function(){return void e()})})},f==="versionchange"?"readwrite":f),function(){g.state="finished",g.emit("complete"),g.$ReStoreIDBTransaction6=new(c("Deferred"))()},function(){g.state="finished",g.emit("error"),g.$ReStoreIDBTransaction6=new(c("Deferred"))()});return g}var e=a.prototype;e.objectStore=function(a){var b=this;if(!this.$ReStoreIDBTransaction3.has(a))throw c("err")("Invalid object store name "+a);return new B(this.$ReStoreIDBTransaction1,l+a,function(a,d){if(b.state!=="active")throw c("err")("Cannot make request against inactive transaction.");b.$ReStoreIDBTransaction5.push([a,d]);return a})};e.abort=function(){this.state="finished"};e.enqueueAdditionalWork=function(a){this.$ReStoreIDBTransaction5.push([new(d("IndexedDbPolyfills").IDBRequest)(),a])};babelHelpers.createClass(a,[{key:"db",get:function(){return this.$ReStoreIDBTransaction4}},{key:"transaction",get:function(){return this.$ReStoreIDBTransaction6.getPromise()}}]);return a}(d("IndexedDbPolyfills").IDBRequest),D=function(){function a(a,b){this.$1=a,this.$2=b}var b=a.prototype;b.transaction=function(a,b,c){return new C(this.$1,this,new Set(Array.isArray(a)?a:[a]),b)};b.createObjectStore=function(a){return{createIndex:function(a,b,c){}}};b.deleteObjectStore=function(a){};b.close=function(){this.$1.closeDb==null?void 0:this.$1.closeDb()};babelHelpers.createClass(a,[{key:"objectStoreNames",get:function(){var a=Object.keys(this.$1.getTableData().tableNames).filter(function(a){return a.startsWith(l)}).map(function(a){return a.substr(l.length)});a.contains=function(b){return a.find(function(a){return a===b})!=null};return a}},{key:"name",get:function(){return this.$2}}]);return a}();b=function(){function a(a){this.$1=a}var b=a.prototype;b.open=function(a,b){var c=new(d("IndexedDbPolyfills").IDBRequest)();c.result=new D(this.$1,a);o(function(){return c.emit("success")});return c};b.cmp=function(a,b){return indexedDB.cmp(a,b)};return a}();e=function(){function b(){}b.bound=function(c,d,e,f){if(Array.isArray(c)&&c[0]===void 0)return b.upperBound(d,f);return Array.isArray(d)&&d[0]===void 0?b.lowerBound(c,e):a.IDBKeyRange.bound(c,d,e,f)};b.lowerBound=function(b,c){if(Array.isArray(b)&&b[0]===null)return null;return Array.isArray(b)&&b[0]===void 0?null:a.IDBKeyRange.lowerBound(b,c)};b.upperBound=function(b,c){if(Array.isArray(b)&&b[0]===null)return null;return Array.isArray(b)&&b[0]===void 0?null:a.IDBKeyRange.upperBound(b,c)};return b}();self.setImmediate2=o;g.structuredClone=p;g.ReStoreIDBTransaction=C;g.ReStoreIDBDatabase=D;g.ReStoreIDBFactory=b;g.ReStoreIDBKeyRange=e}),98);
__d("createReStoreIndexedDbPersistenceWithoutLocks",["ClientConsistency","CurrentMessengerUser","Deferred","ExecutionEnvironment","FBLogger","LSPlatformErrorChannel","MAWCryptoConsts","MAWExceededStorageQuota","MAWKeychainNaClCrypto","MWEARKeychainV3","MessengerLogHistory","ReStoreBinaryEncoding","ReStoreDbClosedError","ReStoreDbConfigStore","ReStoreDbVersionChange","ReStoreDecryptionFailure","ReStoreErrorAction","ReStorePersistence","err","gkx","pageID","promiseDone","promiseFromRequest","tweetnacl","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h,i=4096,j=d("CurrentMessengerUser").getIDorEIMU(),k=d("MessengerLogHistory").getInstance("db_init"),l=new Set([d("ReStoreDbConfigStore").CONFIG_STORE_NAME]),m=new(d("ReStoreBinaryEncoding").Encoder)(),n=new(d("ReStoreBinaryEncoding").Decoder)();function o(a,b){if(a==null)return null;var e=new Uint8Array(a);try{e=e[1];var f=d("MWEARKeychainV3").getDbEncryptionKey(e);f=f.key;var g=3;a=d("tweetnacl").secretbox.open(new Uint8Array(a,g+d("tweetnacl").secretbox.nonceLength),new Uint8Array(a,g,d("tweetnacl").secretbox.nonceLength),new Uint8Array(f));if(a==null){throw new(d("MAWKeychainNaClCrypto").EARDecryptionError)("Encrypted ReStore-no-locks was unable to decrypt an entity. Attempting to use key version : "+((g=e)!=null?g:"non-provided")+".")}return n.decode(a)}catch(a){c("LSPlatformErrorChannel").emit(new(d("ReStoreDecryptionFailure").ReStoreDecryptionFailure)(a.message,b));throw new(d("ReStoreDecryptionFailure").ReStoreDecryptionFailure)(a.message,b)}}function p(a,b){if(a==null)return a;try{var e=d("MWEARKeychainV3").getDbEncryptionKey(),f=e.key;e=e.version;e=new Uint8Array([0,e,d("MAWCryptoConsts").CIPHER_ID]);var g=d("tweetnacl").randomBytes(d("tweetnacl").secretbox.nonceLength);a=d("tweetnacl").secretbox(m.encode(a),g,new Uint8Array(f));f=new Uint8Array(e.length+g.length+a.length);f.set(e);f.set(g,e.length);f.set(a,e.length+g.length);return f.buffer}catch(a){throw c("err")(a.message+" - Encrypted LSDB was unable to encrypt an entity for table "+b)}}function q(a){for(a of a.values())if(a.size!==0)return!1;return!0}function r(a,b){var c=[];a=new Set(a);for(var d of a)b.objectStoreNames.contains(d)||c.push(d);d=[];for(var e=0;e<b.objectStoreNames.length;e++){var f=b.objectStoreNames[e];!a.has(f)&&!l.has(f)&&d.push(f)}if(c.length!==0||d.length!==0)return[c,d]}function s(a,b){if(b==null){k.debug("Schema doesn't have changes to apply");return}k.debug("Schema has changes to apply");var c=b[0];b=b[1];c.forEach(function(b){a.objectStoreNames.contains(b)||a.createObjectStore(b,{autoIncrement:!0})});b.forEach(function(b){a.objectStoreNames.contains(b)&&a.deleteObjectStore(b)})}function t(a,b,e,f,g){function i(a){e(a.target),k.debug("DB onversionchange TABID="+c("pageID")),c("FBLogger")("mpf_web_foundations").info("[pdb] onversionchange inWorker=%s",String((h||(h=c("ExecutionEnvironment"))).isInWorker)),f.endFail("version_change"),c("LSPlatformErrorChannel").emit(new(d("ReStoreDbVersionChange").ReStoreDbVersionChange)())}return new Promise(function(d,e){var h=indexedDB.open(a,g);h.onupgradeneeded=function(a){a=a.target;var c=a.result;a=a.transaction;b(c,a)};h.onerror=function(a){f.endFail("failed_to_open_pdb"),e(c("unrecoverableViolation")("Failed to open db","messenger_web_product",{error:a.target.error}))};h.onsuccess=function(a){a=a.target.result;a.addEventListener("versionchange",i);d(a)}})}async function u(a,b,e,f,g){function i(a){g.addAnnotations({bool:{dbEmpty:!0}});d("ReStoreDbConfigStore").createDbConfig(a,f.defaultConfig);for(var c of b)a.createObjectStore(c,{autoIncrement:!0})}g.addPoint("idb_open_start");var j=await t(a,i,e,g);g.addPoint("idb_open_end");var l=j.transaction(d("ReStoreDbConfigStore").CONFIG_STORE_NAME,"readonly");l=await Promise.all([d("ReStoreDbConfigStore").detectConfigMismatch(l,f),d("ReStoreDbConfigStore").readCorruptionFailuresFromConfig(l).then(function(a){return(a=a==null?void 0:a.value)!=null?a:0})]);var m=l[0];l=l[1];var n=l>0;n&&(c("FBLogger")("mpf_web_foundations").info("[pdb] opening corrupted db failures=%s inWorker=%s",String(l),String((h||(h=c("ExecutionEnvironment"))).isInWorker)),k.debug("DB corrupted, deleting db"));m&&k.debug("DB config mismatch, deleting db");g.addAnnotations({bool:{configMismatch:m,dbCorruptionOccured:n}});if(m||n)j.close(),g.addPoint("delete_db_start"),await c("promiseFromRequest")(indexedDB.deleteDatabase(a)),g.addPoint("delete_db_end"),g.addPoint("reopen_db_start"),j=await t(a,i,e,g),g.addPoint("reopen_db_end");else{var o=r(b,j);o!=null&&(k.debug("Schema mismatch, bumping db version"),j.close(),g.addPoint("mismatch_start"),j=await t(a,function(a){return s(a,o)},e,g,j.version+1),g.addPoint("mismatch_end"))}return j}function a(a,b,e,f){var g=j+"-"+a,h=!0,l,m=[],n=null,r=Promise.resolve();k.debug("shim DB is ON");f.addPoint("init_idb_start");var s=new Map(),v=new Promise(function(d,g){c("promiseDone")(r=r.then(async function(){try{var c=await u(a,b,w,e,f);d(c)}catch(a){g(a)}}),function(a){},function(a){return c("FBLogger")("mpf_web_foundations").catching(a).warn("[pdb] dbLock idbPromise issue")})});c("promiseDone")(v.then(function(){f.addPoint("init_idb_end")}));function w(a){a.close(),h=!1}function x(a,b,c){c=a.transaction(c!=null&&c.length>0?c:a.objectStoreNames,b,{durability:"relaxed"});d("MAWExceededStorageQuota").listenToQuotaExceededError(c);return c}function y(a){var b=s.get(a);b==null&&(b=new Map(),s.set(a,b));return b}function z(){if(n)return;n=new Promise(async function(a){var b;try{var d=async function(){if(l==null){var a;b=(a=b)!=null?a:await v;var d=x(b,m.some(function(a){return a.writemode==="readwrite"||a.expectingWrite})?"readwrite":"readonly");d.onabort=function(){l===d&&(l=null)};l=d}var e=l;a=[];for(var f of m){if(f.writemode==="readwrite"){e.mode==="readwrite"&&a.push(f);l=null;break}a.push(f)}m.splice(0,a.length);a.length&&await Promise.all(a.map(function(a){a=a.thunk;return a(e)}));c("gkx")("116")&&!m.length&&l!=null&&await c("promiseFromRequest")(l.objectStore(l.objectStoreNames[0]).get(""))};while(m.length)await d();(d=l)==null?void 0:d.commit==null?void 0:d.commit()}finally{l=null,a(),n=null}})}function A(a,b,c){c===void 0&&(c=!1);return new Promise(function(d,e){m.push({expectingWrite:c,thunk:async function(b){var c;try{c=await a(b)}catch(a){e(a);return}d(c)},writemode:b}),z()})}function B(){if(!h)return;c("promiseDone")(v,async function(a){var b;a=x(a,"readwrite");b=(b=(b=await d("ReStoreDbConfigStore").readCorruptionFailuresFromConfig(a))==null?void 0:b.value)!=null?b:0;await d("ReStoreDbConfigStore").writeCorruptionFailuresToConfig(a,b)})}function C(){c("promiseDone")(v,function(a){w(a)})}function D(){if(!h)throw new(c("ReStoreDbClosedError"))()}async function E(a){await v;D();var b=c("ClientConsistency").getAdditionalRevisions();b.size>0&&(c("FBLogger")("mpf_web_foundations").info("[pdb] js mismatch detected"),d("ReStoreErrorAction").softRefresh());return new Promise(function(b,d){c("promiseDone")(r=r.then(async function(){try{var c=await a();b(c)}catch(a){d(a)}}),function(a){},function(a){return c("FBLogger")("mpf_web_foundations").catching(a).warn("[pdb] dbLock runExclusively issue")})})}return{clearCache:function(){s.clear()},close:C,flush:async function(b,e){e=e.upgrade;if(!h)return;async function g(a){var c=new Promise(function(b,c){a.oncomplete=function(a){b(a.target.result)},a.onerror=a.onabort=function(a){s.clear(),c(a)}}),e=!1;for(var f of b){var g=f[0],h=f[1],i=a.objectStore(g);for(h of h){var j=h[0],k=h[1],l;if(k===d("ReStorePersistence").sentinelDeleted)l=i.delete(j);else{k=p(k,g);l=i.put(k,j)}l.onerror=function(){return e=!0}}}e?a.abort():a.commit!=null&&a.commit();await c}function i(){Array.from(b).forEach(function(a){var b=a[0];a=a[1];var c=y(b);Array.from(a).forEach(function(a){var b=a[0];a=a[1];a===d("ReStorePersistence").sentinelDeleted?c.delete(b):c.set(b,a)})})}if(q(b))return;var j=await v;if(e===!0){c("FBLogger")("mpf_web_foundations").info("[pdb] Updating IDB version, fromVersion: %s, non-empty tables: %s",j.version,Array.from(b.entries()).filter(function(a){a[0];a=a[1];return a.size>0}).map(function(a){a=a[0];return a}).sort().toString());await n;(e=l)==null?void 0:e.abort();j.close();s.clear();v=async function(){var b=new(c("Deferred"))(),d=await t(a,function(a,d){i(),c("promiseDone")(g(d),function(){b.resolve()},function(){b.reject()})},w,f,j.version+1);await b.getPromise();return d}();await v;return}if(b.size===0)return;i();e=Array.from(b.keys());e.push(d("ReStoreDbConfigStore").CONFIG_STORE_NAME);await g(x(j,"readwrite",e))},get:function(a,b,d){var e=y(b);if(e.has(d))return e.get(d);else{if(!h)return new Promise(function(){});var f=A(function(a){return c("promiseFromRequest")(a.objectStore(b).get(d))},"readonly").then(function(a){var c=e.get(d);if(c!==f)return c;c=o(a,b);e.set(d,c);return c});e.set(d,f);return f}},isClosed:function(){return!h},logError:function(a,b,d,e){if(d==="dbCorruption"){b==="readwrite"&&B();throw c("FBLogger")("mpf_web_foundations").mustfixThrow("Got unexpected undefined in pdb, mode: %s, table: %s, id: %s, deletedInThisTxn: %s",b,a,(d=e==null?void 0:e.id)!=null?d:"",(b=e==null?void 0:e.deletedInThisTxn)!=null?b:"")}},queueCommitWork:function(a){return a()},runExclusively:E,shouldApplySync:function(){return!1},shouldInline:function(a,b){return d("ReStoreBinaryEncoding").estimateSize(b)<i},shouldSync:function(a,b){return!1},types:["indexeddb"],uniqueId:g}}a.schemaDiff=r;a.applyChanges=s;g.default=a}),98);
__d("MAWDataSyncQueue",["MAWQplProxy","Promise","WALogger","asyncToGeneratorRuntime","qex","qpl","throttle"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unhandled exception caught in middleware "," sync: ",""]);i=function(){return a};return a}var j=c("qex")._("853")||1e3;a=c("qex")._("855")||1e3;e=function(){m=!1;return r({isUnloading:!0})};var k=[],l=[],m=!1,n=[],o=function(){var a,b=k.splice(0,k.length);(a=l).push.apply(a,b)},p=function(){return l.splice(0,j)},q=function a(c,e){var f=p();if(f.length===0)return;c.addPoint("processing_batch");return(h||(h=b("Promise"))).all(n.map(function(a,b){return a(f,e)["catch"](function(a){d("WALogger").ERROR(i(),b,a)})})).then(function(){return a(c,e)})},r=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(m)return;m=!0;var b=d("MAWQplProxy").startQplUserFlow(c("qpl")._(1056849784,"272"));b.addPoint("processing_queue",{"int":{queueSize:k.length}});o();try{yield q(b,a),b.endSuccess()}catch(a){b.endFail("handler_failed_execution");throw a}finally{m=!1,k.length>0&&s()}});return function(b){return a.apply(this,arguments)}}(),s=c("throttle")(r,a);f=function(a,b){k.push({type:a,value:b}),s()};a=function(a){n.some(function(b){return b===a})||n.push(a)};var t=function(){n=[]},u=function(){k=[],l=[]},v=function(){return k};g.forceFlushDataSyncQueue=e;g.addSyncItem=f;g.registerDataSyncCallback=a;g.clearDataSyncCallbacks=t;g.clearDataSyncQueue_FOR_TESTING_ONLY=u;g.getDataSyncQueue_FOR_TESTING_ONLY=v}),98);
__d("MAWDataSyncMiddleware",["FBLogger","MAWDataSyncQueue"],(function(a,b,c,d,e,f,g){"use strict";var h=new Set(["contacts","groupInfo","messages","participants","threads","reactions","dyiBatch","xma","pendingStanzas"]);function i(a,b){var c=a.table(b);return!h.has(b)?c:babelHelpers["extends"]({},c,{mutate:function(a){return c.mutate(a).then(function(c){if(a.type==="delete"){a.keys.forEach(function(c){d("MAWDataSyncQueue").addSyncItem(a.type,{key:c,tableName:b})});return c}else c.results!=null?c.results.forEach(function(c){d("MAWDataSyncQueue").addSyncItem(a.type,{key:c,tableName:b,values:a.values})}):c.lastResult!=null&&d("MAWDataSyncQueue").addSyncItem(a.type,{key:c.lastResult,tableName:b,values:a.values});return c})}})}function a(){return{create:function(a){try{return babelHelpers["extends"]({},a,{table:function(b){return i(a,b)}})}catch(b){c("FBLogger")("mpf_web_foundations").catching(b).mustfix("Error applying DataSync Middleware, messages made during this session will not be properly synced to registered consumers");return a}},name:"MAWDataSyncMiddleware",stack:"dbcore"}}g.getDataSyncMiddleware=a}),98);
__d("MAWDbThread",["MAWHexUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWHexUtils").orderPreservingHex(a)+"_"+b}g.craftThreadOrder=a}),98);
__d("MAWDexieTable",["Promise","dexie_maw"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){return(h||(h=b("Promise"))).resolve(a)}function a(a){return a.reduce(function(a,b,c){return a.then(function(a){return b(c).then(function(b){a.push(b);return a})})},n([]))}function e(a){return c("dexie_maw").Promise.all(a)}function f(a){return c("dexie_maw").Promise.allSettled(a)}function j(a){return c("dexie_maw").Promise.PSD[a]}function k(a,b){c("dexie_maw").Promise.PSD[a]=b}function l(a){c("dexie_maw").Promise.PSD[a]=void 0}var m=function(){function a(a,b,d,e){d===void 0&&(d=!0);e=new(c("dexie_maw"))(a,babelHelpers["extends"]({chromeTransactionDurability:"relaxed"},e));b(e);this.name=a;this.stores=e;d&&this.open()}var b=a.prototype;b.open=function(){this.stores.open()};b.close=function(){this.stores.close()};b.transact=function(a,b,c){var d=this;return i(this.stores.transaction(a,b.map(function(a){return d.stores[a]}),function(){return c()}))};babelHelpers.createClass(a,[{key:"tables",get:function(){return this.stores.tables}}]);return a}();function n(a){return c("dexie_maw").Promise.resolve(a)}function o(a){return c("dexie_maw").waitFor(a)}g.DEXIE_MIN_KEY=d("dexie_maw").Dexie.minKey;g.DEXIE_MAX_KEY=d("dexie_maw").Dexie.maxKey;g.undexify=i;g.dexieSequentialAll=a;g.dexieAll=e;g.dexieAllSettled=f;g.getDexiePSDItem=j;g.setDexiePSDItem=k;g.clearDexiePSDItem=l;g.DexieTable=m;g.dexieResolve=n;g.dexieExpensiveAwait=o}),98);
__d("SignalDbTypes",[],(function(a,b,c,d,e,f){"use strict";function a(a,b,c){return a+"_"+b+"_"+c}b={abProps:"abProps",authKeyPair:"authKeyPair",cat:"cat",certificateChain:"certificateChain",clockSkew:"clockSkew",deviceId:"deviceId",deviceUUID:"deviceUUID",edgeInfo:"edgeInfo",fbid:"fbid",identityKeyPair:"identityKeyPair",lastPrekeyGenerationId:"lastPrekeyGenerationId",lastPrekeyId:"lastPrekeyId",lastSessionDeviceWasLinkedTo:"lastSessionDeviceWasLinkedTo",lastSignedPrekeyId:"lastSignedPrekeyId",regId:"regId",registrationVersion:"registrationVersion"};({msgrDeviceId:"msgrDeviceId"});f.buildSenderKeySessionId=a;f.MetaKeysEnum=b}),66);
__d("MAWDbSchema.dexie",["MAWDbMsg","MAWDbThread","MAWDbVersionList","MAWDexieTable","MAWFolderTypes","MAWLocalizationType","MAWODSProxy","MAWTimeUtils","MAWWaitForBackendSetup","SignalDbTypes","WAJids","WALogger","WAMsg","WAMsgType","WAOdsEnums","WAStanzaUtils","WATimeUtils","dexie_maw","gkx","promiseDone","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Duplicate waMsgId found for receipt, number of duplicates: ",""]);i=function(){return a};return a}a=function(a){var b=function(a){var b;b=(b=a.quote)==null?void 0:b.content;return a.quoteExternalId!=null&&(b==null?void 0:b.media)!=null};return a.messages.where("quoteExternalId").between(d("WAStanzaUtils").toStanzaId("0"),d("WAStanzaUtils").toStanzaId("["),!0,!0).filter(b).toArray()["catch"](function(){return a.messages.filter(b).toArray()}).then(function(b){var c=new Set(b.map(function(a){a=(a=a.quote)==null?void 0:a.content;return a==null?void 0:(a=a.media)==null?void 0:a.plaintextHash}).filter(Boolean)),d=b.map(function(a){a=a.msgId;return a});return a.media.filter(function(a){a=a.plaintextHash;return c.has(a)}).toArray().then(function(b){var c=new Map(b.map(function(a){var b=a.mediaId;a=a.plaintextHash;return[a,b]}));return a.messages.where("msgId").anyOf(d).modify(function(a){var b;b=(b=a.quote)==null?void 0:b.content;a.quote.content.mediaId=c.get(b.media.plaintextHash);delete a.quote.content.media})})})};b=function(a){return a.groupInfo.toCollection().modify(function(a){typeof a.inviter==="number"&&delete a.inviter})};e=function(a){return a.meta.get(d("SignalDbTypes").MetaKeysEnum.deviceId).then(function(b){var c;if((b==null?void 0:(c=b.value)==null?void 0:c.deviceId)!=null&&typeof b.value.deviceId!=="number")return a.meta.clear()})};f=function(a){return a.threads.filter(function(a){return d("WAJids").switchOnMsgrChatJidType(a.jid,{group:function(){return!1},user:function(){return a.oldestMsg!=null}})}).toArray().then(function(b){var c=[];b.forEach(function(a){c.push(a.oldestMsg),c.push(a.newestMsg)});return a.messages.where("msgId").anyOf(c.filter(Boolean)).toArray().then(function(c){var e=new Map(),f=[],g=[];c.forEach(function(a){e.set(a.msgId,a)});b.forEach(function(b){var c=e.get(b.oldestMsg),h=e.get(b.newestMsg);(c==null?void 0:c.type)==="Admin"&&(h==null?void 0:h.type)==="Admin"&&(c.msgId===h.msgId?g.push(b.chatId):f.push(b));return d("MAWDexieTable").dexieAll(f.map(function(b){return a.messages.where("thread").equals(b.chatId).toArray()})).then(function(b){b.forEach(function(a){if(a.length===0)return;var b=a[0].thread;a=a.filter(function(a){return a.type!=="Admin"});if(a.length>0)return;g.push(b)});return d("MAWDexieTable").dexieAll([a.threads.bulkDelete(g),a.messages.where("thread").anyOf(g)["delete"]()])})})})})};var j=function(a){return a.unrenderedMessages.toCollection().modify(function(a){if(a.type===d("WAMsgType").MSG_TYPE.DELETE_FOR_ME){var b=a.messageDeleteForMeTs;a.messageDeleteForMeTs=b}})},k=function(a){var b=0,e=0,f=c("dexie_maw").currentTransaction;if(f==null)throw c("unrecoverableViolation")("transaction does not exist","messenger_e2ee_web");f.on("complete",function(){c("promiseDone")(d("MAWWaitForBackendSetup").waitForBackendSetup("DB upgrade to V31").then(function(){b>0&&d("MAWODSProxy").odsBumpEntityKey({amount:b,entity:d("WAOdsEnums").Entity.MESSAGE_MISSING_THREAD_JID,key:"fail"}),e>0&&d("MAWODSProxy").odsBumpEntityKey({amount:e,entity:d("WAOdsEnums").Entity.MESSAGE_MISSING,key:"fail"})}))});f.on("complete",function(){b>0&&d("MAWODSProxy").odsBumpEntityKey({amount:b,entity:d("WAOdsEnums").Entity.MESSAGE_MISSING_THREAD_JID,key:"fail"}),e>0&&d("MAWODSProxy").odsBumpEntityKey({amount:e,entity:d("WAOdsEnums").Entity.MESSAGE_MISSING,key:"fail"})});return a.threads.toArray().then(function(c){var f=c.reduce(function(a,b){b!=null&&a.set(b.chatId,b);return a},new Map());return d("MAWDexieTable").dexieAll([a.messages.toCollection().modify(function(a){if(a!=null){var c=f.get(a.thread);c!=null?a.threadJid=c.jid:b+=1}else e+=1}),a.unrenderedMessages.toCollection().modify(function(a){if(a!=null){var c=f.get(a.thread);c!=null?a.threadJid=c.jid:b+=1}else e+=1})])})},l=function(a){return a.isDualSend.toCollection().modify(function(a){a.version==null&&(a.version=1)})},m=function(a){return a.messages.toCollection().modify(function(a){a.type===d("WAMsgType").MSG_TYPE.ADMIN&&a.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION&&(a.altIndex=d("MAWDbMsg").craftE2eeAdminMsgAltIndex(a.thread))})},n=function(a){return a.messages.toCollection().modify(function(a){a.sortOrderMs=d("MAWDbMsg").getSortOrderWithFallback(a)})},o=function(a){return a.threads.toCollection().modify(function(a){a.folder==null&&(a.folder=d("MAWFolderTypes").FOLDER_ID.INBOX)})},p=function(a){return a.messages.toCollection().modify(function(a){a.sortOrderMs=d("MAWDbMsg").getSortOrderWithFallback(a)})},q=function(a){return a.personalSenderKeyStatuses.toCollection().modify(function(a){a.rotateSenderKey=!0,a.hasSenderKey=new Set()})},r=function(a){return a.messages.toCollection().modify(function(a){a.type===d("WAMsgType").MSG_TYPE.ADMIN&&a.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE&&a.sortOrderMs!=null&&a.sortOrderMs>0&&(a.sortOrderMs=0)})},s=function(a){return a.messages.toCollection().modify(function(a){!(a.type===d("WAMsgType").MSG_TYPE.ADMIN&&(a.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE||a.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION))&&a.sortOrderMs!=null&&a.sortOrderMs<1661204086&&(a.sortOrderMs=d("MAWDbMsg").getCanonicalTsFromMsg(a)*1e3)})},t=function(a){return a.threads.filter(function(a){return a.isMigratedLocally===!0&&a.newestMsg!=null}).toArray().then(function(b){var c=b.map(function(a){return a.chatId}),e=new Map();return d("MAWDexieTable").dexieAll(b.map(function(b){return a.messages.where(["thread","sortOrderMs"]).between([b.chatId,0],[b.chatId,Number.MAX_VALUE]).last().then(function(a){a!=null&&e.set(a.thread,a.msgId)})})).then(function(){return a.threads.where("chatId").anyOf(c).modify(function(a){var b=e.get(a.chatId);b!=null&&(a.newestMsg=b)})})})},u=function(a){return a.identity.toCollection().modify(function(a){a.userJid=d("WAJids").extractUserJid(a.deviceJid)})},v=function(a){return a.threads.toCollection().modify(function(a){a.lastReadMsgTs!=null&&a.lastReadMsgTs<d("WATimeUtils").MAX_INT&&(a.lastReadMsgTs=d("MAWTimeUtils").ensureValidMillisTime(a.lastReadMsgTs));if(a.newestMsgTs!=null&&a.newestMsgTs<d("WATimeUtils").MAX_INT){var b=d("MAWTimeUtils").ensureValidMillisTime(a.newestMsgTs);a.newestMsgTs=b;b!=null&&(a.threadOrder=d("MAWDbThread").craftThreadOrder(b,a.jid))}})},w=function(a){return a.messages.toCollection().modify(function(a){a.type===d("WAMsgType").MSG_TYPE.ADMIN&&a.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE&&(a.altIndex=d("MAWDbMsg").craftCutoverAdminMsgAltIndex(a.thread))})},x=function(a){return a.meta.get(d("SignalDbTypes").MetaKeysEnum.fbid).then(function(b){var c;if((b==null?void 0:(c=b.value)==null?void 0:c.fbid)!=null&&b.value.fbid==="0")return a.meta.clear()})},y=function(a){return a.prekey.filter(function(a){return a.isDeleted===!0})["delete"]()},z=function(a){return c("gkx")("23905")?a.meta.clear():d("MAWDexieTable").dexieResolve()},A=function(a){return a.participants.toCollection().modify(function(a){var b;if(a==null||((b=a.userJid)==null?void 0:b.indexOf("@msgr@msgr"))===!1)return;a.id=a.id.replace("@msgr@msgr","@msgr");a.userJid=a.userJid.replace("@msgr@msgr","@msgr")}).then(function(){})},B=function(a){var b=a.threads.filter(function(a){return a.snippetMsg!=null&&a.snippetMsgTs==null});return b.toArray().then(function(c){var e=c.reduce(function(a,b){b!=null&&b.snippetMsg!=null&&a.set(b.jid,b.snippetMsg);return a},new Map());c=Array.from(e.values());return a.messages.where("msgId").anyOf(c).toArray().then(function(a){var c=a.reduce(function(a,b){b!=null&&b.serverTs!=null&&a.set(b.msgId,b.serverTs);return a},new Map());b.modify(function(a){var b=e.get(a.jid);if(b!=null){b=c.get(b);b!=null&&(a.snippetMsgTs=d("WATimeUtils").castUnixTimeToMillisTime(b))}})})})},C=function(a){return a.threads.toArray().then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){return a.participants.where("threadId").equals(b.chatId).modify(function(a){a.threadJid=(a=a.threadJid)!=null?a:b.jid})}))})},D=C,E=function(a){var b=[];return a.groupInvites.toArray().then(function(c){var d=c.map(function(a){return a.invitedParticipantId});return a.participants.bulkGet(d).then(function(d){d.forEach(function(a,d){if(a==null){a=c[d];b.push(a)}});var e=d.filter(Boolean);return a.groupInvites.bulkPut(c.map(function(a){var c=e.find(function(b){return b.id===a.invitedParticipantId});if(c!=null){a.inviteeJid=c.userJid;a.threadJid=c.threadJid;return babelHelpers["extends"]({},a,{inviteeJid:c.userJid,threadJid:c.threadJid})}else{b.push(a);return a}}))})}).then(function(){return a.groupInvites.bulkDelete(b.map(function(a){return[a.invitedParticipantId,a.inviterJid]}))})},F=function(a){var b=new Map();return a.receipts.toArray().then(function(c){return d("MAWDexieTable").dexieAll(c.map(function(c){return a.messages.get({msgId:c.msgId}).then(function(e){if(e==null)return a.receipts["delete"](c.msgId).then(function(){});else{var f=d("WAMsg").craftWAMsgIdString({author:e.author,chat:e.threadJid,externalId:e.externalId});if(b.has(f)){var g;g=(g=b.get(f))!=null?g:1;b.set(f,g);d("WALogger").ERROR(i(),g);return a.receipts["delete"](c.msgId).then(function(){})}else{b.set(f,1);return a.receipts.where("msgId").equals(e.msgId).modify(function(a){a.waMsgId=f}).then(function(){})}}})}))})},G=function(a){var b=[];return a.contacts.toArray().then(function(c){for(var c=c,d=Array.isArray(c),e=0,c=d?c:c[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(d){if(e>=c.length)break;f=c[e++]}else{e=c.next();if(e.done)break;f=e.value}f=f;b.push({ephemeralSetting:f.ephemeralSetting,ephemeralSyncResponseBackoffInfo:f.ephemeralSyncResponseBackoffInfo,userJid:f.contactJid})}return a.ephemeralSettings.bulkPut(b)})};a=new Map([[(h=d("MAWDbVersionList")).VERSION.V26,a],[h.VERSION.V27,b],[h.VERSION.V28,e],[h.VERSION.V29,f],[h.VERSION.V30,j],[h.VERSION.V31,k],[h.VERSION.V43,l],[h.VERSION.V44,m],[h.VERSION.V45,n],[h.VERSION.V46,o],[h.VERSION.V47,p],[h.VERSION.V53,q],[h.VERSION.V54,r],[h.VERSION.V55,s],[h.VERSION.V56,t],[h.VERSION.V57,u],[h.VERSION.V58,v],[h.VERSION.V60,w],[h.VERSION.V66,x],[h.VERSION.V68,y],[h.VERSION.V71,z],[h.VERSION.V72,A],[h.VERSION.V82,B],[h.VERSION.V85,C],[h.VERSION.V87,D],[h.VERSION.V90,E],[h.VERSION.V91,F],[h.VERSION.V101,G]]);g.dbUpgrades=a}),98);
__d("MAWDbSchemaReStoreDexieUtils",["MAWDbSchema","MAWDbSchema.dexie","err","sortBy"],(function(a,b,c,d,e,f,g){"use strict";var h=c("sortBy")(Array.from(new Set([].concat(Array.from(d("MAWDbSchema").dbSchema.keys()),Array.from(d("MAWDbSchema.dexie").dbUpgrades.keys())))).map(function(a){return{schema:d("MAWDbSchema").dbSchema.get(a),upgrade:d("MAWDbSchema.dexie").dbUpgrades.get(a),version:a}}),function(a){a=a.version;return a}),i=function(a,b){return Array.from(a.filter(function(a){return a.version<=b&&a.schema!=null}).reduce(function(a,b){(b=b.schema)==null?void 0:b.forEach(function(b){a.set(b.name,b)});return a},new Map()).values())},j=function(a,b){return i(a,b).reduce(function(a,b){var d=b.autoIncrement,e=b.dexieOnly_primaryKeyUnique,f=b.name,g=b.primaryKey,h=b.removed;f=f.replace(/^e2ee_/,"");if(h===!0){a[f]=null;return a}if(d&&e===!0)throw c("err")("Invalid schema, cannot have both autoincremnet and unique constraints "+JSON.stringify(b));h=d?"++":"";d=e===!0?"&":"";e=""+(g.length>1?"[":"")+g.join("+")+(g.length>1?"]":"");g=Object.values(b.indexes).map(function(a){var b=a.columns,c=!(a.unique===!1),d=b.length>1;a=a.multiEntry_DO_NOT_USE===!0;c=c&&!a?"&":"";a=a?"*":"";c=""+c+a;return""+c+(d?"[":"")+b.join("+")+(d?"]":"")}).join(",");a[f]=[""+h+d+e,g].filter(Boolean).join(",");return a},{})};a=function(a){return j(h,a)};g.MAW_DB_VERSION_CHANGES=h;g.getDexieSchemaForVersion=j;g.getCompleteDexieSchemaForVersion=a}),98);
__d("MAWDbVersion",["MAWCurrentUser","MAWDbSchemaReStoreDexieUtils","MAWGetDbVersion","MAWIndexedDbMetadata","MAWReStoreDbSetup","MAWRestoreRewriteUtils","Promise","WATagsLogger","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Applying "," updates between "," and ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Skipping db upgrade and just applying latest schema"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["current db version is greater than target db version"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["version is not set in QE"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["current db version: ",", target db version: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Using OneDB/shim, cannot read DB version"]);n=function(){return a};return a}var o=d("WATagsLogger").TAGS(["DB","VERSION"]);f=d("MAWGetDbVersion").getArmadilloDbVersion();f=d("MAWDbSchemaReStoreDexieUtils").getCompleteDexieSchemaForVersion(Math.min(d("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES[d("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES.length-1].version,f>0?f:Infinity));function p(a,b){var c=b.schema,d=b.upgrade;b=b.version;c!=null&&d!=null?a.version(b).stores(c).upgrade(d):c!=null?a.version(b).stores(c):d!=null?a.version(b).upgrade(d):a.version(b);return b}function q(a,c){if(d("MAWRestoreRewriteUtils").isOneDBEnabled()||c){o.LOG(n());return(h||(h=b("Promise"))).resolve(null)}return new(h||(h=b("Promise")))(function(b){if(!indexedDB){b();return}var c=indexedDB.open(a);c.onsuccess=function(a){a=a.target.result;var c=a==null?void 0:a.version;a==null?void 0:a.close();c!=null?b(c/10):b()};c.onerror=function(){b()}})}function r(a){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(d("MAWRestoreRewriteUtils").isOneDBEnabled()||a){a=(yield d("MAWReStoreDbSetup").getDB());return a.getCustomMigrationVersion()}else return(h||(h=b("Promise"))).resolve(null)});return s.apply(this,arguments)}function a(){var a=d("MAWCurrentUser").getID(),b=c("gkx")("23906");if(d("MAWRestoreRewriteUtils").isOneDBEnabled()||b)return r(b);else return q(d("MAWIndexedDbMetadata").dbName(a),!1)}function t(a,b){if(a.upgrade!=null||b.upgrade!=null)return!0;a=Object.keys((a==null?void 0:a.schema)||{});b=Object.keys((b==null?void 0:b.schema)||{});a=[].concat(a,b);b=new Set(a);return b.size!==a.length}function u(a){return a.reduce(function(a,b,c){if(c===0)return[babelHelpers["extends"]({},b,{schema:d("MAWDbSchemaReStoreDexieUtils").getCompleteDexieSchemaForVersion(b.version)})];c=a[a.length-1];b=babelHelpers["extends"]({},b,{schema:b.schema!=null?d("MAWDbSchemaReStoreDexieUtils").getDexieSchemaForVersion([b],b.version):null});if(t(c,b)){a.push(b);return a}a.splice(a.length-1,1,babelHelpers["extends"]({},c,b,{schema:babelHelpers["extends"]({},c==null?void 0:c.schema,b==null?void 0:b.schema)}));return a},[])}function e(a,b,c){var e=c!=null?c:d("MAWGetDbVersion").getArmadilloDbVersion==null?void 0:d("MAWGetDbVersion").getArmadilloDbVersion();o.LOG(m(),b,e);e==null&&o.WARN(l());if(b!=null&&b>e){o.WARN(k());a.version(b);return b}c=d("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES.filter(function(a){a=a.version;return b==null||a>b}).filter(function(a){a=a.version;return e==null||e>=a});var f=d("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES.filter(function(a){a=a.version;return e==null||e>=a});if(c.length===0||c.length===f.length){o.LOG(j());f=d("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES[d("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES.length-1].version;f=Math.min(e!=null&&e>0?e:f,f);a.version(f).stores(d("MAWDbSchemaReStoreDexieUtils").getCompleteDexieSchemaForVersion(f));return f}f=u(c);o.LOG(i(),f.length,c[0].version,c[c.length-1].version);var g=0;f.forEach(function(b){g=Math.max((b=p(a,b))!=null?b:0,(b=g)!=null?b:0)});return g}g.CURRENT_MAW_STORES=f;g.getDexieDbVersion=q;g.getRestoreDbVersion=r;g.getDBVersion=a;g.updateDB=e}),98);
__d("MAWDBRestoreConfig",["ReStoreDbConfigStore"],(function(a,b,c,d,e,f,g){"use strict";var h={lockVersion:9,name:d("ReStoreDbConfigStore").DB_CONFIG_KEY};function a(){return{defaultConfig:h,isEqual:function(a){return(a==null?void 0:a.lockVersion)==null?!1:(a==null?void 0:a.lockVersion)===h.lockVersion}}}g.createConfig=a}),98);
__d("MAWRestoreSchemaIndexedDB",["IndexedDbPolyfills","LSPlatformLsInitLog","MAWCurrentUser","MAWDBRestoreConfig","MAWDbSchema.restore","MAWDbVersion","MAWGetDbVersion","MAWIndexedDbMetadata","MAWQplProxy","Promise","ReStore","ReStoreIDBFactory","ReStoreMetadata","WATagsLogger","asyncToGeneratorRuntime","createReStoreIndexedDbPersistenceWithoutLocks","dexie_maw","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Updating shimmed DB from "," to ",""]);i=function(){return a};return a}var j,k=d("WATagsLogger").TAGS(["DBInit","DBSetup","ReStore"]),l={};function a(){if(j==null){var a=d("ReStoreMetadata").getBuildTableData(l)([d("MAWDbSchema.restore").clientSchema.map(function(a,b){return babelHelpers["extends"]({},a,{id:(b+1).toString()})})]),e=d("MAWGetDbVersion").getArmadilloDbVersion();j=c("ReStore")(c("createReStoreIndexedDbPersistenceWithoutLocks")(d("MAWIndexedDbMetadata").restoreDbName2(d("MAWCurrentUser").getID()),Object.keys(a.tableNames),d("MAWDBRestoreConfig").createConfig(),d("LSPlatformLsInitLog").lsInitLogger),a,void 0,{migration:function(a,f){var g;d("MAWQplProxy").sendQPLIntAnnotationThroughBridge(c("qpl")._(1056839232,"112"),"dbVersion",(g=a)!=null?g:0);return new(h||(h=b("Promise")))(function(g,l){var m={open:function(){var c=new(d("IndexedDbPolyfills").IDBRequest)(),i=new(d("ReStoreIDBFactory").ReStoreIDBDatabase)(j,""),k=new(d("ReStoreIDBFactory").ReStoreIDBTransaction)(babelHelpers["extends"]({},j,{runInTransaction:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;try{b=(yield a(f))}catch(a){l(a);throw a}g();return b});function c(b){return a.apply(this,arguments)}return c}()}),i,new Set(i.objectStoreNames),"versionchange");c.result=i;c.transaction=k;void b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield (h||(h=b("Promise"))).resolve(),c.emit("upgradeneeded",{newVersion:e,oldVersion:a,target:{result:i,transaction:k}})})();return c}};m=new(c("dexie_maw"))("",{IDBKeyRange:d("ReStoreIDBFactory").ReStoreIDBKeyRange,chromeTransactionDurability:"relaxed",enableDataSyncMiddleware:!0,indexedDB:m,shimEnabled:!0});k.LOG(i(),a,e);var n=d("MAWDbVersion").updateDB(m,a,e);d("MAWQplProxy").sendQPLBoolAnnotationThroughBridge(c("qpl")._(1056839232,"112"),"dbUpgradeNeeded",a!==n);m.open()})},targetVersion:e})}return j}function e(){var a;(a=j)==null?void 0:a.closeDb==null?void 0:a.closeDb();j=null}g.createDB=a;g.closeDB=e}),98);
__d("MAWReStoreDbSetup",["MAWRestoreDbState","MAWRestoreSchemaIndexedDB","asyncToGeneratorRuntime","cr:5951","cr:7254","err","gkx"],(function(a,b,c,d,e,f,g){"use strict";f=(f=b("cr:5951"))!=null?f:b("cr:7254");d=d("MAWRestoreDbState").getTargetDbState()==="restore"||c("gkx")("23906")?d("MAWRestoreSchemaIndexedDB").createDB:null;var h=(d=d)!=null?d:f==null?void 0:f.createDB,i;function a(){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield i);a==null?void 0:a.closeDb==null?void 0:a.closeDb();i=null});return j.apply(this,arguments)}function e(){if(h==null)throw c("err")("Unexpected invocation of OneDB");i==null&&(i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield h());yield a.runInTransaction(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){}),"readwrite");return a})());return i}g.closeDB=a;g.getDB=e}),98);
__d("MAWIDbSetupQpl",["MAWQplProxy","qpl"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWQplProxy").startQplUserFlow(c("qpl")._(1056836116,"905"));b=a;g["default"]=b}),98);
__d("MAWDexieError",[],(function(a,b,c,d,e,f){"use strict";a="ModifyError";b="BulkError";c="OpenFailedError";d="VersionChangeError";e="SchemaError";var g="UpgradeError",h="InvalidTableError",i="MissingAPIError",j="NoSuchDatabaseError",k="InvalidArgumentError",l="SubTransactionError",m="UnsupportedError",n="InternalError",o="DatabaseClosedError",p="PrematureCommitError",q="ForeignAwaitError",r="UnknownError",s="ConstraintError",t="DataError",u="TransactionInactiveError",v="ReadOnlyError",w="VersionError",x="NotFoundError",y="InvalidStateError",z="InvalidAccessError",A="AbortError",B="TimeoutError",C="QuotaExceededError",D="SyntaxError",E="DataCloneError";A={AbortError:A,BulkError:b,ConstraintError:s,DatabaseClosedError:o,DataCloneError:E,DataError:t,ForeignAwaitError:q,InternalError:n,InvalidAccessError:z,InvalidArgumentError:k,InvalidStateError:y,InvalidTableError:h,MissingAPIError:i,ModifyError:a,NoSuchDatabaseError:j,NotFoundError:x,OpenFailedError:c,PrematureCommitError:p,QuotaExceededError:C,ReadOnlyError:v,SchemaError:e,SubTransactionError:l,SyntaxError:D,TimeoutError:B,TransactionInactiveError:u,UnknownError:r,UnsupportedError:m,UpgradeError:g,VersionChangeError:d,VersionError:w};f.DEXIE_ERROR=A}),66);
__d("MAWIDbSetupQplEventListener",["MAWDexieError"],(function(a,b,c,d,e,f,g){"use strict";var h,i=null;function j(a){var b=new Set(Object.keys(d("MAWDexieError").DEXIE_ERROR));b.has(a.reason)&&h!=null&&(h.endFail(a.reason),i!=null&&(i(),i=null))}b=function(b,c){h=b,i=c,a.addEventListener("unhandledrejection",j)};g.trackDbSetupFailure=b}),98);
__d("MAWIndexedDb",["Deferred","FBLogger","MAWBridge","MAWCurrentUser","MAWDataSyncMiddleware","MAWDbMutationMiddleware","MAWDbMutationValidator","MAWDbSchema","MAWDbVersion","MAWDexieTable","MAWGetWorkerStatusApi","MAWIDbSetupQpl","MAWIDbSetupQplEventListener","MAWIndexedDBDeletion","MAWIndexedDbMetadata","MAWLowLevelApiTypes","MAWQplProxy","MAWRestoreRewriteUtils","MAWTransactor","Promise","WATagsLogger","WAWorkerGlobalScope","asyncToGeneratorRuntime","cr:4773","dexie_maw","err","gkx","promiseDone","qpl","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["DB is null"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["DB setup complete, marking as ready"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["DB Open blocked"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["actual version: ",", current: ",", requested: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Current version: ",". Shim: ",". 1DB: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Starting DB Setup"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[afterTransaction] afterTransactionForThreadEvent called outside of dexie transaction"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[afterTransaction] called outside of dexie transaction"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[afterTransactionEffect] called outside of dexie transaction"]);q=function(){return a};return a}var r=null,s=new(c("Deferred"))(),t=!1,u=!1,v=d("WATagsLogger").TAGS(["DB"]);function w(){s=null,t=!1}function a(){return u}function e(a,b,c){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){b=b===void 0?{enableDataSyncMiddleware:!0}:b;var f=b.enableDataSyncMiddleware,g=b.enableMutationValidator,h=b.shimEnabled,o=h===void 0?!1:h;h=babelHelpers.objectWithoutPropertiesLoose(b,["enableDataSyncMiddleware","enableMutationValidator","shimEnabled"]);u=!0;b=d("MAWCurrentUser").getID();if(r!=null)return;if(t){var p;return(p=s)==null?void 0:p.getPromise()}v.LOG(n());t=!0;s=(p=s)!=null?p:new(c("Deferred"))();d("MAWIDbSetupQplEventListener").trackDbSetupFailure(c("MAWIDbSetupQpl"),function(){var a;(a=s)==null?void 0:a.reject();w()});var q=d("MAWIndexedDbMetadata").dbName(b);d("MAWGetWorkerStatusApi").setDatabaseStatus(q,d("MAWLowLevelApiTypes").DatabaseState.Initializing);var x=(yield d("MAWDbVersion").getDexieDbVersion(q,o));if(!o){v.LOG(m(),x,o,d("MAWRestoreRewriteUtils").isOneDBEnabled());d("MAWQplProxy").sendQPLIntAnnotationThroughBridge(c("qpl")._(1056839232,"112"),"dbVersion",(p=x)!=null?p:0);d("MAWQplProxy").sendQPLIntAnnotationThroughBridge(c("qpl")._(1056839232,"112"),"useSentBytesCache",c("gkx")("33008")?1:0)}r=new(d("MAWDexieTable").DexieTable)(q,function(b){f&&b.use(d("MAWDataSyncMiddleware").getDataSyncMiddleware());!o&&a!=null&&b.use(d("MAWDbMutationMiddleware").getMAWDbMutationMiddleware(a));o&&b.use(d("MAWDbMutationMiddleware").getMAWVaultMiddleware());g===!0&&b.use(d("MAWDbMutationValidator").getMutationValidatorMiddleware());var h=d("MAWDbVersion").updateDB(b,x,e);o||(d("MAWQplProxy").sendQPLBoolAnnotationThroughBridge(c("qpl")._(1056839232,"112"),"dbUpgradeNeeded",x!==h),v.LOG(l(),h,x,e),c("MAWIDbSetupQpl").addPoint("database_version_upgraded ",{"int":{dbVersion:h}}));b.on("blocked",function(){v.ERROR(k()),d("MAWGetWorkerStatusApi").setDatabaseStatus(q,d("MAWLowLevelApiTypes").DatabaseState.Error)});b.on("ready",function(a){var b;v.LOG(j());d("MAWGetWorkerStatusApi").setDatabaseStatus(q,d("MAWLowLevelApiTypes").DatabaseState.Open);(b=s)==null?void 0:b.resolve();w();if(a==null){v.ERROR(i());return}c("MAWIDbSetupQpl").endSuccess({"int":{dbVersion:h}})});b.on("versionchange",function(){d("MAWGetWorkerStatusApi").setDatabaseStatus(q,d("MAWLowLevelApiTypes").DatabaseState.Upgrading);var a=h!=null?h-1:0;c("MAWIDbSetupQpl").addPoint("database_version_upgraded ",{"int":{prev_db_version:a}});(a=d("WAWorkerGlobalScope").workerGlobalScope.location)==null?void 0:a.reload==null?void 0:a.reload()})},void 0,h);return(b=s)==null?void 0:b.getPromise()});return x.apply(this,arguments)}function y(a){if(r==null){throw c("err")('IndexDB has not been initialized before executing "'+((a=a)!=null?a:"unnamed")+'"')}return r}function z(a){if(r!=null&&!t)return(h||(h=b("Promise"))).resolve(r);s=s||new(c("Deferred"))();return s.getPromise().then(function(){return y(a)})}function f(){return A.apply(this,arguments)}function A(){A=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield z());a!=null&&(a.close(),r=null);w()});return A.apply(this,arguments)}function B(a){r=a,w()}var C=new WeakMap(),D=new WeakMap();function E(a){var b=c("dexie_maw").currentTransaction;if(b==null){v.ERROR(q());throw c("unrecoverableViolation")("afterTransactionEffect called outside of dexie transaction","messenger_e2ee_web")}if(typeof a!=="function")return;var d=C.get(b)||[];d.push(a);C.set(b,d);d.length===1&&b.on("complete",function(){var a=C.get(b)||[];a.forEach(function(a){a()});C["delete"](b)})}function F(a){if(c("dexie_maw").currentTransaction==null)throw c("FBLogger")("messenger_e2ee_web").mustfixThrow("Cannot use afterTransactionRestore outside of a MAW transaction");b("cr:4773")!=null&&b("cr:4773").handleEventWithRestore(c("dexie_maw").currentTransaction.idbtrans,a)}function G(a){var b=c("dexie_maw").currentTransaction;if(b==null){v.ERROR(p());throw c("unrecoverableViolation")("afterTransaction called outside of dexie transaction","messenger_e2ee_web")}var e=D.get(b);if(e!=null)e.push(a);else{var f=[a];D.set(b,f);b.on("complete",function(){D["delete"](b),d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:f})})}}function H(a){b("cr:4773")!=null?F(a):G(a)}function I(a,b){var e=c("dexie_maw").currentTransaction;if(e==null){v.ERROR(o());throw c("unrecoverableViolation")("afterTransactionForThreadEvent called outside of dexie transaction","messenger_e2ee_web")}e.on("complete",function(){d("MAWBridge").getBridge().fireAndForget("threadEvent",b,a)})}function J(){r!=null&&(r.close(),r=null)}function K(a){J();a=d("MAWIndexedDbMetadata").dbName((a=a)!=null?a:d("MAWCurrentUser").getID());c("promiseDone")(d("MAWIndexedDBDeletion").deleteDB(a,"maw"))}g.TABLES_TO_ENCRYPT=d("MAWDbSchema").TABLES_TO_ENCRYPT;g.makeMsgrTransactor=d("MAWTransactor").makeMsgrTransactor;g.makeSignalTransactor=d("MAWTransactor").makeSignalTransactor;g.makeMsgrAndSignalTransactor=d("MAWTransactor").makeMsgrAndSignalTransactor;g.willSetupDB=a;g.makeDB=e;g.getDBExn=y;g.getDB=z;g.closeDB=f;g.setDB_INTERNAL_USE_ONLY=B;g.afterTransactionEffect=E;g.afterTransaction=H;g.afterTransactionThreadEvent=I;g.closeDb=J;g.deleteDb=K}),98);
__d("MAWDexieCastToPromise",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;function a(a){return(g||(g=b("Promise"))).resolve(a)}function c(a){return a}f.dexieCastToPromise=a;f.promiseCastToDexiePromise_I_KNOW_WHAT_I_AM_DOING=c}),66);
__d("MAWLLAMigrationUtils",["MAWRestoreDbState","gkx","justknobx","qpl"],(function(a,b,c,d,e,f,g){"use strict";b=c("justknobx")._("652");var h=1/Math.max(b,10);e=1/(b/10);f=1/(5*b);b=1/(10*b);var i=new Map([["setClockSkew",b],["getRoutingInfo",f],["unknown",b],["writeOutgoingMsg",e],["processFutureProofMsgs",e],["markThreadAsReadUpTo",e],["handleMediaDownload",e],["getMsgForREquestReuploadMedia",e],["createGroup",e],["createGroups",e],["BulkProcessFutureProofMsgs",e],["getAllMessageIdsAndRangesForThread",e]]),j=new Set(["uploadMsgBackupGetMsgs","updateBackupEntFbid","saveXMAMediaAndMetadata","saveRTCXMAMediaAndMetadata","writeRetroactiveBackupsState","getBackupThreads","uploadMessagesForThread","constructEchoMessage","updateBackupEntFbidInMediaBackup","restoreUpdateThread","restoreUpdateMessages","restoreUpdateNextInChatMsgId","handleEncryptedBackupsSecret","restoreInsertMsgsToDb","getMsgsByProtocolMsgIds","restoreGetMsg","restoreMaybeGetOldestNonAdminMessage","restoreGetMediaForXMAByObjectIds","restoreWriteXMAsToDb","restoreWriteReactionsToDb","restoreGetThread","restoreDeleteMessages","getChunkOfTheDownloadedFile","updateMediaWithDownloadedChunkBlob","invokeRestoreAccessCheckSprocToDownloadAttachment","restoreLinkMedias","getChunksByHash","bulkGetRetroactiveMedia","updateRetroactiveBackupsStore","getRetryItems","housekeepUploadRetryTable","getMsgsEB"]);function a(a,b,e){b===void 0&&(b=!1);e===void 0&&(e={});var f=i.get(a)||h;return a==="debug"||a==="test"?[]:c("gkx")("23956")&&Math.random()<f?[j.has(a)?c("qpl")._(521475322,"1350"):c("qpl")._(1056839327,"560"),babelHelpers["extends"]({bool:{isUsingShim:d("MAWRestoreDbState").isUsingShim(),newLLA:b},string:{transactor:a}},e)]:[]}g.getTransactorQPLParam=a}),98);
__d("WAPromiseQueue",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;a=function(){function a(a){a===void 0&&(a=-1),this.$1=(g||(g=b("Promise"))).resolve(),this.$3=0,this.$2=a}var c=a.prototype;c.wait=function(){return this.$1};c.enqueueHandlers=function(a,b,c){var d=this;this.$3++;b=this.$1.then(function(){return a}).then(b,c);c=b.then();this.$1=h(b,this.$2)["finally"](function(){d.$3--});return c};c.enqueue=function(a){var b=this;this.$3++;a=this.$1.then(a);var c=a.then();this.$1=h(a,this.$2)["finally"](function(){b.$3--});return c};c.size=function(){return this.$3};return a}();c=function(){function a(a){a===void 0&&(a=-1),this.$1=new Map(),this.$2=a}var c=a.prototype;c.waitIfPending=function(a){return this.$1.get(a)};c.wait=function(a){return this.$1.get(a)||(g||(g=b("Promise"))).resolve()};c.enqueueHandlers=function(a,b,c,d){c=this.wait(a).then(function(){return b}).then(c,d);return this.$3(a,c)};c.enqueue=function(a,b){b=this.wait(a).then(b);return this.$3(a,b)};c.$3=function(a,b){var c=this,d=b.then(),e,f=function(){c.$1.get(a)===e&&c.$1["delete"](a)};e=h(b,this.$2).then(f,f);this.$1.set(a,e);return d};return a}();function h(a,c){if(c>=0)return new(g||(g=b("Promise")))(function(b){var d=function(){return void b()};a.then(d,d);setTimeout(d,c)});else return a.then(i,i)}function i(){}f.PromiseQueue=a;f.PromiseQueueMap=c}),66);
__d("MAWTransactor",["Deferred","FBLogger","MAWDexieCastToPromise","MAWDexieTable","MAWErrorObject","MAWExceededStorageQuota","MAWIndexedDb","MAWLLAMigrationUtils","MAWQplProxy","MAWTransactionMode","WAPromiseQueue","asyncToGeneratorRuntime","dexie_maw"],(function(a,b,c,d,e,f,g){"use strict";var h=["MWPTransactor"],i=c("FBLogger")("messenger_e2ee_web"),j=1,k=new(d("WAPromiseQueue").PromiseQueue)(),l=new Map();function m(a,b,e,f,g){e!=null&&c("dexie_maw").currentTransaction!=null&&e.endFail("invoked_in_nested_transaction");if(c("dexie_maw").currentTransaction!=null)throw i.mustfixThrow("makeMsgrTransactor %s cannot be called within another transaction",f);return d("MAWIndexedDb").getDB().then(function(c){return c.transact(a,b,g)})}function n(a,b,e,f,g){e=d("MAWDexieTable").getDexiePSDItem("transactionId");if(e==null)throw i.mustfixThrow("BulkTransactor cannot be called without a transaction id with transaction: %s",f);var h=l.get(e)||[],j=new(c("Deferred"))();h.push({fn:g,mode:a,promise:j,stores:b,transactorName:f});l.set(e,h);return j.getPromise()}function o(a,b,c,e,f){var g=d("MAWDexieTable").getDexiePSDItem("transactor");return g==="bulk"?n(a,b,c,e,f):m(a,b,c,e,f)}function p(a){var b=[].concat(l.get(a)||[]);l["delete"](a);if(b.length===0)return d("MAWDexieTable").dexieResolve();i.debug("Bulking %s db operations together",b.length);a=b.some(function(a){a=a.mode;return a===d("MAWTransactionMode").READWRITE})?d("MAWTransactionMode").READWRITE:d("MAWTransactionMode").READONLY;var c=Array.from(new Set(b.flatMap(function(a){a=a.stores;return a}))),e=d("MAWIndexedDb").getDBExn("BulkTransaction");return d("MAWDexieCastToPromise").promiseCastToDexiePromise_I_KNOW_WHAT_I_AM_DOING(e.transact(a,c,function(){return b.reduce(function(a,b){var c=b.fn,e=b.promise,f=b.transactorName;return a.then(function(){return c()}).then(function(a){e.resolve(a)})["catch"](function(a){e.reject(a);d("MAWExceededStorageQuota").checkQuotaExceededError(a);throw v(d("MAWErrorObject").getErrorObject(a)).mustfixThrow("Error completing bulk operation %s",f)})},d("MAWDexieTable").dexieResolve())}).then(function(){d("MAWDexieTable").clearDexiePSDItem("transactionId"),i.debug("Finished bulk transaction")}))}function a(a){return k.enqueue(function(){if(c("dexie_maw").currentTransaction!=null)throw i.mustfixThrow("runInBulkTransaction cannot be called within another transaction");if(d("MAWDexieTable").getDexiePSDItem("transactionId")!=null)throw i.mustfixThrow("Several transactions are trying to be executed at the same time: %s",d("MAWDexieTable").getDexiePSDItem("transactionId"));i.debug("Running in bulk transaction");return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWDexieTable").dexieResolve().then(function(){var b=j++;d("MAWDexieTable").setDexiePSDItem("transactor","bulk");d("MAWDexieTable").setDexiePSDItem("transactionId",b);var c=a();d("MAWDexieTable").clearDexiePSDItem("transactor");return p(b).then(function(){return d("MAWDexieCastToPromise").promiseCastToDexiePromise_I_KNOW_WHAT_I_AM_DOING(c)})["finally"](function(){d("MAWDexieTable").clearDexiePSDItem("transactionId")})}))})["catch"](function(a){throw v(d("MAWErrorObject").getErrorObject(a)).mustfixThrow("Uncaught exception in runInBulkTransactor")})}function q(a){a=d("MAWLLAMigrationUtils").getTransactorQPLParam(a);a=a.length===2?a:[null,void 0];var b=a[0];a=a[1];return b!=null?d("MAWQplProxy").startQplUserFlow(b,a):null}function e(a,b,c){return s(a,b,c)}function f(a,b,c){return s(a,b,c)}function r(a,b,c){return s(a,b,c)}function s(a,b,c){var e=Object.keys(a),f=e.some(function(b){return a[b]===d("MAWTransactionMode").READWRITE})?d("MAWTransactionMode").READWRITE:d("MAWTransactionMode").READONLY;return function(){for(var a=arguments.length,g=new Array(a),i=0;i<a;i++)g[i]=arguments[i];var j=q(b);return d("MAWIndexedDb").getDB(b).then(function(a){return o(f,e,j,b,function(){d("MAWDexieTable").setDexiePSDItem("transactorQPLEvent",j);var f=j!=null?a.stores[e[0]].get("").then(function(){var a=d("MAWDexieTable").getDexiePSDItem("transactor");j==null?void 0:j.addPoint("transaction_opened",{bool:{isBulkTransaction:a==="bulk"}});j==null?void 0:j.addPoint("transactor_execution_start")}):d("MAWDexieTable").dexieResolve();return f.then(function(){return c(a.stores).apply(void 0,g)}).then(function(a){j==null?void 0:j.addPoint("transactor_execution_end");j==null?void 0:j.endSuccess();return a})["catch"](function(a){d("MAWExceededStorageQuota").checkQuotaExceededError(a);j==null?void 0:j.endFail("transaction_fail");a=d("MAWErrorObject").getErrorObject(a);throw v(a).mustfixThrow("[%s] Error performing %s transaction",h.join("|"),(a=b)!=null?a:"")})})})["catch"](function(a){d("MAWExceededStorageQuota").checkQuotaExceededError(a);j==null?void 0:j.endFail("transaction_fail");a=d("MAWErrorObject").getErrorObject(a);throw v(a).mustfixThrow("[%s] Error performing %s transaction",h.join("|"),(a=b)!=null?a:"")})}}function t(a,b,c,d){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){var f=a+"_"+e,g=q(f),i=(yield d("MAWIndexedDb").getDB(f));return i.transact(b,[a],function(){var b=g!=null?i.stores[a].get("").then(function(){g==null?void 0:g.addPoint("transaction_opened",{bool:{isBulkTransaction:!1}}),g==null?void 0:g.addPoint("transactor_execution_start")}):d("MAWDexieTable").dexieResolve();return b.then(function(){return c(i.stores[a])})}).then(function(a){g==null?void 0:g.addPoint("transactor_execution_end");g==null?void 0:g.endSuccess();return a})["catch"](function(a){d("MAWExceededStorageQuota").checkQuotaExceededError(a);g==null?void 0:g.endFail("transaction_fail");a=d("MAWErrorObject").getErrorObject(a);throw v(a).mustfixThrow("[%s] Error performing %s transaction",h.join("|"),f)})});return u.apply(this,arguments)}function v(a){if(a)return i.catching(a);else return i}function w(a){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(c("dexie_maw").currentTransaction==null)throw c("FBLogger")("messenger_e2ee_web").mustfixThrow("Cannot use runInLSDB outside of a MAW transaction");var b=c("dexie_maw").currentTransaction.idbtrans;b=(yield b.transaction);return a(b)});return x.apply(this,arguments)}g.runInBulkTransaction=a;g.makeMsgrTransactor=e;g.makeSignalTransactor=f;g.makeMsgrAndSignalTransactor=r;g.persistedQueueTransactor=t;g.runInLSDB=w}),98);
__d("MAWVaultDb",["ExecutionEnvironment","MAWQplProxy","MAWVault","cr:3657","err","gkx","isObject","isPlainObject","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;b=(f=b("cr:3657"))!=null?f:{};var i=b.addToMessageContentCache,j=1/1e3,k=new WeakMap();function l(a,b){return b[a]!=null}function a(a,b,e){if(!c("isPlainObject")(a)||!c("gkx")("23909")||!l(b,e)||a==null)return a;var f=k.get(a);if(f!=null)return f;c("gkx")("23968")&&!(h||(h=c("ExecutionEnvironment"))).isInWorker&&(i==null?void 0:i(a,b));f=Math.random()<j?d("MAWQplProxy").startQplUserFlow(c("qpl")._(25301509,"119")):null;try{e=e[b];e=m(a,e,d("MAWVault").vault);f==null?void 0:f.endSuccess();k.set(a,e);return e}catch(a){f==null?void 0:f.endFail("vault_fail");throw c("err")(a.message+" - Failed to vault an entity in the table: "+b)}}function e(a,b,e){if(!c("isPlainObject")(a)||!c("gkx")("23909")||!l(b,e)||a==null)return a;var f=Math.random()<j?d("MAWQplProxy").startQplUserFlow(c("qpl")._(741087294,"2028")):null;try{a=m(a,e[b],d("MAWVault").unvault);f==null?void 0:f.endSuccess();return a}catch(a){f==null?void 0:f.endFail("unvault_fail");throw c("err")(a.message+" - Unvaulting failed for an entity in the table: "+b)}}function m(a,b,d){if(a==null)return a;b=Object.entries(b).filter(function(b){b=b[0];return a[b]!=null});return b.length===0?a:b.reduce(function(a,b){var e=b[0];b=b[1];typeof b!=="boolean"&&c("isObject")(b)?a[e]=m(a[e],b,d):b===!0&&(a[e]=d(a[e]));return a},babelHelpers["extends"]({},a))}g.vaultDbRow=a;g.unvaultDbRow=e;g.setInPath=m}),98);
__d("MAWVaultDefinitions",[],(function(a,b,c,d,e,f){"use strict";a={editMsgHistory:{msgContent:{content:!0}},messages:{msgContent:{content:!0},quote:{content:{msgContent:{content:!0}}}},unrenderedMessages:{msgContent:!0}};b={edit_message_history:{messageContent:!0},messages:{replyMessageText:!0,text:!0},threads:{snippet:!0}};f.ARMADILLO_IDB_VAULT_DEFINITIONS=a;f.PERSISTED_DB_VAULT_DEFINITIONS=b}),66);
__d("isEncryptionAtRestEnabled",["isInstamadillo","qex"],(function(a,b,c,d,e,f,g){"use strict";function a(){if(c("qex")._("507")===!0)return!0;else return c("isInstamadillo")()}g["default"]=a}),98);
__d("MAWDbMiddlewareMutations",["MAWDbObjEncryption","MAWVaultDb","MAWVaultDefinitions","gkx","isEncryptionAtRestEnabled"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e){if(!c("gkx")("23909")&&!(c("isEncryptionAtRestEnabled")()||c("gkx")("23910")))return a;a=babelHelpers["extends"]({},a);a=d("MAWVaultDb").unvaultDbRow(a,b,d("MAWVaultDefinitions").ARMADILLO_IDB_VAULT_DEFINITIONS);a=d("MAWDbObjEncryption").encryptDbObj(a,b,e);return a}function b(a,b){return!c("gkx")("23909")?a:d("MAWVaultDb").unvaultDbRow(babelHelpers["extends"]({},a),b,d("MAWVaultDefinitions").ARMADILLO_IDB_VAULT_DEFINITIONS)}function e(a,b,e){a=d("MAWDbObjEncryption").decryptDbObj(babelHelpers["extends"]({},a),b,e);return!c("gkx")("23909")?a:d("MAWVaultDb").vaultDbRow(a,b,d("MAWVaultDefinitions").ARMADILLO_IDB_VAULT_DEFINITIONS)}function f(a,b){if(a==null)return void 0;return!c("gkx")("23909")?a:d("MAWVaultDb").vaultDbRow(a,b,d("MAWVaultDefinitions").ARMADILLO_IDB_VAULT_DEFINITIONS)}g.mutateValue=a;g.mutateVaultedValue=b;g.getValue=e;g.getVaultedValue=f}),98);
__d("MAWDbMutationValidator",["FBLogger","MAWIndexedDb","MAWMessageHasUniqueExternalIdValidator","MAWODSProxy","Promise","Random","WAOdsEnums","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i=[c("MAWMessageHasUniqueExternalIdValidator")],j=1e3;function k(a,e){var f=a.table(e),g=i.filter(function(a){return a.table===e});return g.length===0?f:babelHelpers["extends"]({},f,{mutate:function(a){return f.mutate(a).then(function(e){if(d("Random").coinflip(j)){var f=g.filter(function(b){b=b.type;return b===a.type});d("MAWIndexedDb").afterTransactionEffect(function(){var a=f.flatMap(function(a){var b=a.description,c=a.isValid;return((a=e.results)!=null?a:[]).map(function(a){return c(a).then(function(a){return babelHelpers["extends"]({validatorName:b},a)})})});c("promiseDone")((h||(h=b("Promise"))).all(a).then(function(a){a.forEach(function(a){switch(a.result){case"valid":d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_MUTATION_VALIDATOR,key:a.validatorName+".valid"});break;case"invalid":d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_MUTATION_VALIDATOR,key:a.validatorName+".invalid"});c("FBLogger")("maw_mutation_validator").mustfix("Validator %s failed with description: %s",a.validatorName,a.description);break;case"skipped":break}})}))})}return e})}})}function a(){return{create:function(a){try{return babelHelpers["extends"]({},a,{table:function(b){return k(a,b)}})}catch(b){c("FBLogger")("mpf_web_foundations").catching(b).mustfix("Error applying Mutation Validator Middleware");return a}},name:"MAWMutationValidatorMiddleware",stack:"dbcore"}}g.getMutationValidatorMiddleware=a}),98);
__d("MAWMessageHasUniqueExternalIdValidator",["MAWDexieTable","MAWTransactionMode","MAWTransactor","WAStanzaUtils"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWTransactor").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY},"isMessageWithUniqueExternalIdValidator",function(a){return function(b){return a.messages.get(b).then(function(c){var e=c==null?void 0:c.externalId;return e==null?d("MAWDexieTable").dexieResolve({key:b,result:"skipped"}):a.messages.where("externalId").equals(d("WAStanzaUtils").toStanzaId(e)).filter(function(a){return a.author===(c==null?void 0:c.author)&&a.threadJid===(c==null?void 0:c.threadJid)}).toArray().then(function(a){if(a.length===1)return{key:b,result:"valid"};else return{description:"Message has duplicate externalId",key:b,result:"invalid"}})})}});b={description:"MAWMessageHasUniqueExternalIdValidator",isValid:a,table:"messages",type:"add"};c=b;g["default"]=c}),98);
__d("MAWDbMutationMiddleware",["FBLogger","MAWDbMiddlewareMutations"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return{create:function(b){return babelHelpers["extends"]({},b,{table:function(e){var f=b.table(e);try{return babelHelpers["extends"]({},f,{get:function(b){return f.get(b).then(function(b){return b==null?void 0:d("MAWDbMiddlewareMutations").getValue(b,e,a)})},getMany:function(b){return f.getMany(b).then(function(b){return b.map(function(b){return b==null?void 0:d("MAWDbMiddlewareMutations").getValue(b,e,a)})})},mutate:function(b){var c=null;switch(b.type){case"add":case"put":c=b.values.map(function(b){return d("MAWDbMiddlewareMutations").mutateValue(b,e,a)});break;case"delete":break;case"deleteRange":break}if(b.type==="delete"||b.type==="deleteRange"||c==null)return f.mutate(b);b.values=c;return f.mutate(b).then(function(a){return a})},openCursor:function(b){return f.openCursor(b).then(function(b){return b==null||b.value==null?b:h(b,e,a)})},query:function(b){return f.query(b).then(function(b){if(b.result.length===0||typeof b.result[0]!=="object")return b;var c=b.result.map(function(b){return d("MAWDbMiddlewareMutations").getValue(b,e,a)});b.result=c;return b})}})}catch(a){c("FBLogger")("mpf_web_foundations").catching(a).mustfix("Error applying MAWDbMiddleware");return f}}})},name:"MAWDbMutationMiddleware",stack:"dbcore"}}function b(){return{create:function(a){return babelHelpers["extends"]({},a,{table:function(b){var e=a.table(b);try{return babelHelpers["extends"]({},e,{get:function(a){return e.get(a).then(function(a){return d("MAWDbMiddlewareMutations").getVaultedValue(a,b)})},getMany:function(a){return e.getMany(a).then(function(a){return a.map(function(a){return d("MAWDbMiddlewareMutations").getVaultedValue(a,b)})})},mutate:function(a){if(a.type==="delete"||a.type==="deleteRange")return e.mutate(a);a.values=a.values.map(function(a){return d("MAWDbMiddlewareMutations").mutateVaultedValue(a,b)});return e.mutate(a)},openCursor:function(a){return e.openCursor(a).then(function(a){return a==null||a.value==null?a:i(a,b)})},query:function(a){return e.query(a).then(function(a){return a.result.length===0||typeof a.result[0]!=="object"?a:babelHelpers["extends"]({},a,{result:a.result.map(function(a){return d("MAWDbMiddlewareMutations").getVaultedValue(a,b)})})})}})}catch(a){c("FBLogger")("mpf_web_foundations").catching(a).mustfix("Error applying MAWDbMiddleware");return e}}})},name:"getMAWVaultMiddleware",stack:"dbcore"}}function h(a,b,c){var e;return Object.create(a,{"continue":{get:function(){return a["continue"]}},continuePrimaryKey:{get:function(){return a.continuePrimaryKey}},key:{get:function(){return a.key}},primaryKey:{get:function(){return a.primaryKey}},start:{value:function(f){return a.start(function(){e=d("MAWDbMiddlewareMutations").getValue(a.value,b,c);try{a.value=e}catch(a){}f()})}},value:{get:function(){return e}}})}function i(a,b){var c;return Object.create(a,{"continue":{get:function(){return a["continue"]}},continuePrimaryKey:{get:function(){return a.continuePrimaryKey}},key:{get:function(){return a.key}},primaryKey:{get:function(){return a.primaryKey}},start:{value:function(e){return a.start(function(){c=d("MAWDbMiddlewareMutations").getVaultedValue(a.value,b);try{a.value=c}catch(a){}e()})}},value:{get:function(){return c}}})}g.getMAWDbMutationMiddleware=a;g.getMAWVaultMiddleware=b}),98);
__d("MAWArmadilloAppDataTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};e={};f={};var h={},i={},j={},k={},l={},m={},n={},o={},p={},q={},r={},s={};a.internalSpec={externalId:[1,(d=d("WAProtoConst")).TYPES.STRING],author:[2,d.TYPES.STRING],chat:[3,d.TYPES.STRING]};b.internalSpec={fromMe:[1,d.TYPES.BOOL],id:[2,d.TYPES.STRING]};c.internalSpec={key:[1,d.TYPES.MESSAGE,b],ts:[2,d.TYPES.INT64]};e.internalSpec={lastMessageTimestamp:[1,d.TYPES.INT64],lastSystemMessageTimestamp:[2,d.TYPES.INT64],messages:[3,d.FLAGS.REPEATED|d.TYPES.MESSAGE,c]};f.internalSpec={type:[1,d.TYPES.STRING],chatJid:[2,d.TYPES.STRING],archived:[3,d.TYPES.BOOL],ts:[4,d.TYPES.INT64],messageRange:[5,d.TYPES.MESSAGE,e],read:[6,d.TYPES.BOOL]};h.internalSpec={type:[1,d.TYPES.STRING],protocolMsgId:[2,d.TYPES.MESSAGE,a]};i.internalSpec={chatAction:[1,d.TYPES.MESSAGE,f],messageAction:[2,d.TYPES.MESSAGE,h],__oneofs__:{action:["chatAction","messageAction"]}};j.internalSpec={actions:[1,d.FLAGS.REPEATED|d.TYPES.MESSAGE,i]};k.internalSpec={id:[1,d.TYPES.UINT64],anonId:[2,d.TYPES.BYTES],rootKey:[3,d.TYPES.BYTES],status:[4,d.TYPES.INT32]};l.internalSpec={backupId:[1,d.TYPES.UINT64],serverDataId:[2,d.TYPES.UINT64],epoch:[3,d.FLAGS.REPEATED|d.TYPES.MESSAGE,k],tempOcmfClientState:[4,d.TYPES.BYTES],mailboxRootKey:[5,d.TYPES.BYTES],obliviousValidationToken:[6,d.TYPES.BYTES]};m.internalSpec={currentIndex:[1,d.TYPES.UINT32],deviceIndexes:[2,d.FLAGS.REPEATED|d.TYPES.UINT32],rawId:[3,d.TYPES.UINT32]};n.internalSpec={keyId:[1,d.TYPES.BYTES],keyData:[2,d.TYPES.BYTES],keyEpoch:[3,d.TYPES.UINT32],timestamp:[4,d.TYPES.INT64],fingerprint:[5,d.TYPES.MESSAGE,m]};o.internalSpec={keys:[1,d.FLAGS.REPEATED|d.TYPES.MESSAGE,n],orphanKeys:[2,d.FLAGS.REPEATED|d.TYPES.BYTES]};p.internalSpec={keyIds:[1,d.FLAGS.REPEATED|d.TYPES.BYTES]};q.internalSpec={type:[1,d.TYPES.STRING],actions:[2,d.FLAGS.REPEATED|d.TYPES.MESSAGE,i],encryptedBackupsSecrets:[3,d.TYPES.MESSAGE,l],syncKeyShare:[4,d.TYPES.MESSAGE,o],syncKeyRequest:[5,d.TYPES.MESSAGE,p]};r.internalSpec={deviceJid:[1,d.TYPES.STRING],serializedPubKey:[2,d.TYPES.BYTES],baseKey:[3,d.TYPES.BYTES]};s.internalSpec={externalId:[1,d.TYPES.STRING],ts:[2,d.TYPES.INT64],contents:[3,d.TYPES.MESSAGE,q],permittedIdentitiesPerDevice:[4,d.FLAGS.REPEATED|d.TYPES.MESSAGE,r],ack:[5,d.TYPES.INT32],appDataId:[6,d.TYPES.INT32],recipientDevices:[7,d.FLAGS.REPEATED|d.TYPES.STRING],sendPartial:[8,d.TYPES.BOOL]};g.ProtocolMsgIdSpec=a;g.MetaSyncMessageKeyProtoSpec=b;g.MetaSyncMessageProtoSpec=c;g.MetaSyncMessageRangeProtoSpec=e;g.MetaSyncChatActionProtoSpec=f;g.MetaSyncMessageActionProtoSpec=h;g.MetaSyncActionProtoSpec=i;g.MetaSyncAppDataProtoSpec=j;g.EncryptedBackupsSecretsEpochProtoSpec=k;g.EncryptedBackupsSecretsProtoSpec=l;g.FingerprintProtoSpec=m;g.SyncKeyDataProtoSpec=n;g.SyncKeyShareProtoSpec=o;g.SyncKeyRequestProtoSpec=p;g.AppDataProtoSpec=q;g.IdentitiesPerDeviceProtoSpec=r;g.AppDataTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloAppMetaTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};a.internalSpec={msgTypeVersion:[1,(c=d("WAProtoConst")).TYPES.INT32],hmacKey:[2,c.TYPES.BYTES],allowSecurityAlert:[3,c.TYPES.BOOL],hotlikeSticker:[4,c.TYPES.BYTES],isBackfilledForOccamadillo:[5,c.TYPES.BOOL],allowSecurityAlertForSelf:[11,c.TYPES.BOOL],hasMigratedFromDexie:[12,c.TYPES.BOOL],restoreMigrationAttempts:[13,c.TYPES.INT32],deviceJid:[14,c.TYPES.STRING],restoreToDexieMigrationComplete:[15,c.TYPES.BOOL]};b.internalSpec={key:[1,c.TYPES.STRING],value:[2,c.TYPES.MESSAGE,a]};g.DbAppMetaValuesProtoSpec=a;g.AppMetaTableSchemaProtoSpec=b}),98);
__d("MAWArmadilloCollectionVersionsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.internalSpec={collection:[1,(b=d("WAProtoConst")).TYPES.STRING],version:[2,b.TYPES.INT32],state:[3,b.TYPES.STRING],finiteFailureStartTime:[4,b.TYPES.INT64],ltHash:[5,b.TYPES.BYTES],isCollectionInMacMismatchFatal:[6,b.TYPES.BOOL],isCollectionLthashInconsistent:[7,b.TYPES.BOOL]};g.CollectionVersionsTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloContactsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};e={};f={};a.internalSpec={ephemeralExpirationInSec:[1,(d=d("WAProtoConst")).TYPES.UINT32],ephemeralLastUpdatedOrSetTimestamp:[2,d.TYPES.INT64]};b.internalSpec={syncResponseRetries:[1,d.TYPES.INT32],syncResponseSentTs:[2,d.TYPES.INT64]};c.internalSpec={sequence:[1,d.TYPES.INT64],timestamp:[2,d.TYPES.INT64],devices:[3,d.FLAGS.REPEATED|d.TYPES.BYTES],signingDeviceIndex:[4,d.TYPES.INT64],dirty:[5,d.TYPES.BOOL]};e.internalSpec={timeBucket:[1,d.TYPES.INT64],alert:[2,d.TYPES.BOOL]};f.internalSpec={contactJid:[1,d.TYPES.STRING],dhash:[3,d.TYPES.STRING],nameForSearch:[4,d.TYPES.STRING],ephemeralSetting:[5,d.TYPES.MESSAGE,a],isBlocked:[6,d.TYPES.BOOL],lastSyncTs:[7,d.TYPES.INT64],icdcInfo:[8,d.TYPES.MESSAGE,c],ephemeralSyncResponseBackoffInfo:[9,d.TYPES.MESSAGE,b],icdcFails:[10,d.FLAGS.REPEATED|d.TYPES.MESSAGE,e],relationship:[11,d.TYPES.INT32],isRestricted:[12,d.TYPES.BOOL]};g.EphemeralSettingProtoSpec=a;g.EphemeralSyncResponseBackoffInfoSpec=b;g.ICDCInfoProtoSpec=c;g.ICDCCheckFailSpec=e;g.ContactsTableSchemaProtoSpec=f}),98);
__d("MAWArmadilloDeletedMessagesTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.internalSpec={author:[1,(b=d("WAProtoConst")).TYPES.STRING],chat:[2,b.TYPES.STRING],externalId:[3,b.TYPES.STRING],reason:[4,b.TYPES.STRING]};g.DeletedMessagesTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloDeviceChangeAlertsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.internalSpec={action:[1,(b=d("WAProtoConst")).TYPES.STRING],isArchived:[2,b.TYPES.BOOL],deviceChangeAlertsId:[3,b.TYPES.INT64],location:[4,b.TYPES.STRING],model:[5,b.TYPES.STRING],ts:[6,b.TYPES.INT64],loggedOut:[7,b.TYPES.BOOL],deviceJid:[8,b.TYPES.STRING],identity:[9,b.TYPES.BYTES],platform:[10,b.TYPES.STRING],latitude:[11,b.TYPES.STRING],longitude:[12,b.TYPES.STRING],isConfirmed:[13,b.TYPES.BOOL],isNotified:[14,b.TYPES.BOOL]};g.DeviceChangeAlertsTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloDyiBatchTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={BACKUP_RESTORE:0,E2E_DYI:1};b={};b.internalSpec={batchId:[1,(c=d("WAProtoConst")).TYPES.INT32],numMessages:[2,c.TYPES.INT32],oldestTs:[3,c.TYPES.INT64],threadId:[4,c.TYPES.STRING],isThread:[5,c.TYPES.BOOL],numMessagesRestored:[6,c.TYPES.INT32],qplInstanceKeyForThread:[7,c.TYPES.INT64],qplFlowDescriptor:[8,c.TYPES.ENUM,a],qplInstanceKeyE2E:[9,c.TYPES.INT64],numThreadsRestored:[10,c.TYPES.INT64]};g.DYI_BATCH_TABLE_SCHEMA_PROTO_QPL_FLOW_DESCRIPTOR=a;g.DyiBatchTableSchemaProtoSpec=b}),98);
__d("MAWArmadilloEBMsgRangesTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.internalSpec={rangeId:[1,(b=d("WAProtoConst")).TYPES.UINT32],threadJid:[2,b.TYPES.STRING],minMsgExternalId:[3,b.TYPES.STRING],maxMsgExternalId:[4,b.TYPES.STRING],minMsgSortOrderMs:[5,b.TYPES.UINT64],maxMsgSortOrderMs:[6,b.TYPES.UINT64]};g.EBMsgRangesTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloMessagesTableSchema.pb",["MAWArmadilloContactsTableSchema.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){var h;a={};b={};c={};e={};f={};var i={},j={},k={},l={},m={};a.internalSpec={content:[1,(h=d("WAProtoConst")).TYPES.STRING],adminMsgContent:[2,h.FLAGS.REPEATED|h.TYPES.STRING],adminType:[3,h.TYPES.STRING],obsoleteExpiration:[4,h.TYPES.INT32],obsoleteTs:[5,h.TYPES.INT64],subtype:[6,h.TYPES.STRING],protobuf:[7,h.TYPES.BYTES],screenshotActionType:[8,h.TYPES.INT32],authorName:[9,h.TYPES.STRING],version:[10,h.TYPES.INT32],mentionedJids:[11,h.FLAGS.REPEATED|h.TYPES.STRING]};b.internalSpec={frankingTag:[1,h.TYPES.BYTES],frankingVersion:[2,h.TYPES.INT32],reportingContent:[3,h.TYPES.BYTES],reportingTag:[4,h.TYPES.BYTES],frankingKey:[5,h.TYPES.BYTES]};c.internalSpec={remoteJid:[1,h.TYPES.STRING],content:[2,h.TYPES.MESSAGE,l]};e.internalSpec={duration:[1,h.TYPES.INT32],width:[2,h.TYPES.INT32],height:[3,h.TYPES.INT32],mimetype:[4,h.TYPES.STRING],jpegThumbnail:[5,h.TYPES.BYTES],jpegThumbnailHeight:[6,h.TYPES.INT32],jpegThumbnailWidth:[7,h.TYPES.INT32]};f.internalSpec={width:[1,h.TYPES.UINT32],height:[2,h.TYPES.UINT32],jpegThumbnail:[3,h.TYPES.BYTES],jpegThumbnailHeight:[4,h.TYPES.INT32],jpegThumbnailWidth:[5,h.TYPES.INT32]};i.internalSpec={duration:[1,h.TYPES.INT32],mimetype:[2,h.TYPES.STRING],played:[3,h.TYPES.BOOL]};j.internalSpec={filename:[1,h.TYPES.STRING],mimetype:[2,h.TYPES.STRING]};k.internalSpec={mediaType:[1,h.TYPES.STRING],plaintextHash:[2,h.TYPES.STRING],size:[3,h.TYPES.INT32],ts:[4,h.TYPES.INT64],mediaEntry:[5,h.TYPES.BYTES],validatedVideoInfo:[6,h.TYPES.MESSAGE,e],validatedImageInfo:[7,h.TYPES.MESSAGE,f],validatedAudioInfo:[8,h.TYPES.MESSAGE,i],validatedDocumentFileInfo:[9,h.TYPES.MESSAGE,j]};l.internalSpec={type:[1,h.TYPES.STRING],ts:[2,h.TYPES.INT64],externalId:[3,h.TYPES.STRING],author:[4,h.TYPES.STRING],msgContent:[5,h.TYPES.MESSAGE,a],obsoleteMedia:[6,h.TYPES.MESSAGE,k],msgId:[7,h.TYPES.STRING],mediaId:[8,h.TYPES.INT32],sourceId:[9,h.TYPES.STRING],xmaMessageType:[10,h.TYPES.INT32],specialTextSize:[11,h.TYPES.INT32]};m.internalSpec={type:[1,h.TYPES.STRING],ts:[2,h.TYPES.INT64],externalId:[3,h.TYPES.STRING],msgId:[4,h.TYPES.STRING],author:[5,h.TYPES.STRING],ack:[6,h.TYPES.INT32],resendCount:[7,h.TYPES.INT32],msgContent:[8,h.TYPES.MESSAGE,a],altIndex:[9,h.TYPES.STRING],forwardingScore:[10,h.TYPES.INT32],quote:[11,h.TYPES.MESSAGE,c],messageExpirationTs:[12,h.TYPES.INT64],ephemeralSetting:[13,h.TYPES.MESSAGE,d("MAWArmadilloContactsTableSchema.pb").EphemeralSettingProtoSpec],revokedExternalId:[14,h.TYPES.STRING],isForwarded:[15,h.TYPES.BOOL],originalTs:[17,h.TYPES.INT64],sortOrderMs:[18,h.TYPES.INT64],reportingMeta:[19,h.TYPES.MESSAGE,b],messageDeleteTs:[20,h.TYPES.INT64],ephemeralCounterStarted:[21,h.TYPES.BOOL],quoteExternalId:[22,h.TYPES.STRING],unsendMsgContentDeleteTs:[23,h.TYPES.INT64],rowId:[24,h.TYPES.INT32],thread:[25,h.TYPES.INT32],mediaId:[26,h.TYPES.INT32],ephemeralMsgDisappeared:[27,h.TYPES.BOOL],threadJid:[28,h.TYPES.STRING],xmaId:[29,h.TYPES.INT32],specialTextSize:[30,h.TYPES.INT32],xmaMessageType:[31,h.TYPES.INT32],isExpiredXmaMsg:[32,h.TYPES.BOOL],ravenEphemeralType:[33,h.TYPES.INT32],ravenEphemeralMediaState:[34,h.TYPES.INT32],editCount:[35,h.TYPES.INT32]};g.MsgContentProtoSpec=a;g.ReportingMetaProtoSpec=b;g.DbQuotedMsgProtoSpec=c;g.VideoMsgContentProtoSpec=e;g.ImageMsgContentProtoSpec=f;g.AudioMsgContentProtoSpec=i;g.DocumentFileMsgContentProtoSpec=j;g.QuotedDbMediaProtoSpec=k;g.DbQuotedMsgContentProtoSpec=l;g.MessagesTableSchemaProtoSpec=m}),98);
__d("MAWArmadilloEditMsgHistoryTableSchema.pb",["MAWArmadilloMessagesTableSchema.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.internalSpec={author:[1,(b=d("WAProtoConst")).TYPES.STRING],editMsgHistoryId:[2,b.TYPES.INT32],editTs:[3,b.TYPES.INT64],msgContent:[4,b.TYPES.MESSAGE,d("MAWArmadilloMessagesTableSchema.pb").MsgContentProtoSpec],originalMsgExternalId:[5,b.TYPES.STRING],specialTextSize:[6,b.TYPES.INT32],threadJid:[7,b.TYPES.STRING],editExternalId:[8,b.TYPES.STRING],sendStatus:[9,b.TYPES.INT32]};g.EditMsgHistoryTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloGroupInfoTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.internalSpec={groupJid:[1,(b=d("WAProtoConst")).TYPES.STRING],threadId:[2,b.TYPES.INT32],creator:[3,b.TYPES.STRING],creationTs:[4,b.TYPES.INT64],name:[5,b.TYPES.STRING],nameOwner:[6,b.TYPES.STRING],nameTs:[7,b.TYPES.INT64],msgExpiration:[8,b.TYPES.INT32],participantVersion:[9,b.TYPES.STRING],inviter:[10,b.TYPES.STRING],memberAddMode:[11,b.TYPES.STRING]};g.GroupInfoSchemaProtoSpec=a}),98);
__d("MAWArmadilloGroupInvitesTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.internalSpec={inviterJid:[1,(b=d("WAProtoConst")).TYPES.STRING],invitedParticipantId:[2,b.TYPES.STRING],inviteCode:[3,b.TYPES.STRING],inviteExpirationTs:[4,b.TYPES.INT64],caption:[5,b.TYPES.STRING]};g.GroupInvitesTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloMediaTablesSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};e={};f={};var h={},i={},j={};a.internalSpec={plaintextHash:[1,(d=d("WAProtoConst")).TYPES.STRING],blobData:[2,d.TYPES.BYTES],mimetype:[3,d.TYPES.STRING],hashedPlaintextHash:[4,d.TYPES.STRING],chunkId:[5,d.TYPES.INT32]};b.internalSpec={mediaBackupId:[1,d.TYPES.INT32],mediaId:[2,d.TYPES.INT32],objectId:[3,d.TYPES.STRING],msgId:[4,d.TYPES.STRING],fbid:[5,d.TYPES.STRING]};c.internalSpec={msgId:[1,d.TYPES.STRING],mediaEntryData:[2,d.TYPES.BYTES]};e.internalSpec={duration:[1,d.TYPES.UINT32],width:[2,d.TYPES.UINT32],height:[3,d.TYPES.UINT32],mimetype:[4,d.TYPES.STRING],jpegThumbnail:[5,d.TYPES.BYTES],jpegThumbnailHeight:[6,d.TYPES.UINT32],jpegThumbnailWidth:[7,d.TYPES.UINT32],thumbnailPlaintextHash:[8,d.TYPES.STRING]};f.internalSpec={width:[1,d.TYPES.UINT32],height:[2,d.TYPES.UINT32],jpegThumbnail:[3,d.TYPES.BYTES],jpegThumbnailHeight:[4,d.TYPES.UINT32],jpegThumbnailWidth:[5,d.TYPES.UINT32],thumbnailPlaintextHash:[6,d.TYPES.STRING]};h.internalSpec={duration:[1,d.TYPES.UINT32],mimetype:[2,d.TYPES.STRING],played:[3,d.TYPES.BOOL]};i.internalSpec={filename:[1,d.TYPES.STRING],mimetype:[2,d.TYPES.STRING]};j.internalSpec={mediaType:[1,d.TYPES.STRING],plaintextHash:[2,d.TYPES.STRING],size:[3,d.TYPES.UINT64],mediaEntries:[4,d.FLAGS.REPEATED|d.TYPES.MESSAGE,c],ts:[5,d.TYPES.INT64],validatedVideoInfo:[6,d.TYPES.MESSAGE,e],validatedImageInfo:[7,d.TYPES.MESSAGE,f],validatedAudioInfo:[8,d.TYPES.MESSAGE,h],hashedPlaintextHash:[9,d.TYPES.STRING],mediaId:[10,d.TYPES.INT32],msgIds:[11,d.FLAGS.REPEATED|d.TYPES.STRING],objectId:[12,d.TYPES.STRING],fbid:[13,d.TYPES.STRING],validatedDocumentFileInfo:[14,d.TYPES.MESSAGE,i]};g.ChunkTableSchemaProtoSpec=a;g.MediaBackupSchemaProtoSpec=b;g.MediaEntriesProtoSpec=c;g.VideoMsgContentProtoSpec=e;g.ImageMsgContentProtoSpec=f;g.AudioMsgContentProtoSpec=h;g.DocumentFileMsgContentProtoSpec=i;g.MediaTableSchemaProtoSpec=j}),98);
__d("MAWArmadilloMetaRowTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};e={};f={};var h={},i={},j={},k={},l={};a.internalSpec={encryptedSerializedCat:[1,(d=d("WAProtoConst")).TYPES.STRING],expirationTimeInSeconds:[2,d.TYPES.INT32]};b.internalSpec={publicKey:[1,d.TYPES.BYTES],privateKey:[2,d.TYPES.BYTES]};c.internalSpec={intValue:[1,d.TYPES.INT32],strValue:[2,d.TYPES.STRING],boolValue:[3,d.TYPES.BOOL],__oneofs__:{value:["intValue","strValue","boolValue"]}};e.internalSpec={name:[1,d.TYPES.STRING],value:[2,d.TYPES.MESSAGE,c]};f.internalSpec={expoKey:[1,d.TYPES.INT32],value:[2,d.TYPES.STRING]};h.internalSpec={abKey:[1,d.TYPES.STRING],abHash:[2,d.TYPES.STRING],lastSyncTime:[3,d.TYPES.INT64],expoKeyStr:[4,d.TYPES.STRING],refresh:[5,d.TYPES.INT64],internalExpoKeys:[6,d.FLAGS.REPEATED|d.TYPES.STRING],propExpoKeys:[7,d.FLAGS.REPEATED|d.TYPES.MESSAGE,f],propValues:[8,d.FLAGS.REPEATED|d.TYPES.MESSAGE,e]};i.internalSpec={key:[1,d.FLAGS.REQUIRED|d.TYPES.BYTES],notAfter:[2,d.FLAGS.REQUIRED|d.TYPES.INT32],notBefore:[3,d.FLAGS.REQUIRED|d.TYPES.INT32]};j.internalSpec={leaf:[1,d.TYPES.MESSAGE,i],intermediate:[2,d.TYPES.MESSAGE,i]};k.internalSpec={cat:[1,d.TYPES.MESSAGE,a],deviceUUID:[2,d.TYPES.STRING],regId:[3,d.TYPES.INT32],identityKeyPair:[4,d.TYPES.MESSAGE,b],fbid:[5,d.TYPES.STRING],deviceId:[6,d.TYPES.INT32],lastSignedPrekeyId:[7,d.TYPES.INT32],lastPrekeyId:[8,d.TYPES.INT32],lastPrekeyGenerationId:[9,d.TYPES.INT32],edgeInfo:[10,d.TYPES.BYTES],clockSkew:[11,d.TYPES.INT32],msgrDeviceId:[12,d.TYPES.STRING],abProps:[13,d.TYPES.MESSAGE,h],registrationVersion:[14,d.TYPES.INT32],authKeyPair:[15,d.TYPES.MESSAGE,b],certificateChain:[16,d.TYPES.MESSAGE,j],lastSessionDeviceWasLinkedTo:[17,d.TYPES.STRING],restoreMigrationAttempts:[18,d.TYPES.INT32],__oneofs__:{value:["cat","deviceUUID","regId","identityKeyPair","fbid","deviceId","lastSignedPrekeyId","lastPrekeyId","lastPrekeyGenerationId","edgeInfo","clockSkew","msgrDeviceId","abProps","registrationVersion","authKeyPair","certificateChain","lastSessionDeviceWasLinkedTo","restoreMigrationAttempts"]}};l.internalSpec={key:[1,d.TYPES.STRING],value:[2,d.TYPES.MESSAGE,k]};g.ValidCatProtoSpec=a;g.KeyPairProtoSpec=b;g.AbPropTypeSpec=c;g.AbPropValueSpec=e;g.ExpoKeyMapSpec=f;g.AbPropsConfigSpec=h;g.CertificateDetailsSpec=i;g.CertificateChainSpec=j;g.ValueProtoSpec=k;g.MetaRowTableSchemaProtoSpec=l}),98);
__d("MAWArmadilloMissingKeysTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};a.internalSpec={deviceId:[1,(c=d("WAProtoConst")).TYPES.INT32],deviceResponse:[2,c.TYPES.BOOL]};b.internalSpec={keyHex:[1,c.TYPES.STRING],keyId:[2,c.TYPES.BYTES],timestamp:[3,c.TYPES.INT64],deviceResponses:[4,c.FLAGS.REPEATED|c.TYPES.MESSAGE,a]};g.DeviceResponseSpec=a;g.MissingKeysTableSchemaProtoSpec=b}),98);
__d("MAWArmadilloParticipantsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.internalSpec={id:[1,(b=d("WAProtoConst")).TYPES.STRING],userJid:[2,b.TYPES.STRING],deliveredWatermarkTs:[3,b.TYPES.INT64],lastReadWatermarkTs:[4,b.TYPES.INT64],type:[5,b.TYPES.STRING],addressable:[6,b.TYPES.BOOL],lastReadActionTs:[7,b.TYPES.INT64],threadId:[9,b.TYPES.INT32],threadJid:[10,b.TYPES.STRING]};g.ParticipantsTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloPendingMutationsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={SET:0,REMOVE:1};b={};b.internalSpec={id:[1,(c=d("WAProtoConst")).TYPES.INT32],collection:[2,c.TYPES.STRING],index:[3,c.TYPES.STRING],binarySyncAction:[4,c.TYPES.BYTES],version:[5,c.TYPES.INT32],operation:[6,c.TYPES.ENUM,a],timestamp:[7,c.TYPES.INT64],action:[8,c.TYPES.STRING]};g.SYNCD_MUTATION_SYNCD_OPERATION=a;g.PendingMutationsTableSchemaProtoSpec=b}),98);
__d("MAWArmadilloPersonalSenderKeyStatusTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.internalSpec={groupJid:[1,(b=d("WAProtoConst")).TYPES.STRING],senderKeyId:[2,b.TYPES.INT32],rotateSenderKey:[4,b.TYPES.BOOL],senderKeyTs:[5,b.TYPES.INT64],hasSenderKey:[6,b.FLAGS.REPEATED|b.TYPES.STRING]};g.PersonalSenderKeyStatusTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloReactionsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.internalSpec={ack:[1,(b=d("WAProtoConst")).TYPES.INT32],author:[2,b.TYPES.STRING],externalId:[3,b.TYPES.STRING],reactionId:[4,b.TYPES.STRING],reactToExternalId:[5,b.TYPES.STRING],reactToAuthor:[6,b.TYPES.STRING],reactToMsgId:[7,b.TYPES.STRING],threadJid:[8,b.TYPES.STRING],reaction:[9,b.TYPES.STRING],groupingKey:[10,b.TYPES.STRING],ts:[11,b.TYPES.INT64],rowId:[12,b.TYPES.INT32]};g.ReactionsTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloReceiptTablesSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};e={};f={};var h={},i={};a.internalSpec={deliveredTs:[1,(d=d("WAProtoConst")).TYPES.INT64],readTs:[2,d.TYPES.INT64]};b.internalSpec={userJid:[1,d.TYPES.STRING],dbUserStatusTs:[2,d.TYPES.MESSAGE,a]};c.internalSpec={deviceJid:[1,d.TYPES.STRING],serializedPubKey:[2,d.TYPES.BYTES],baseKey:[3,d.TYPES.BYTES]};e.internalSpec={deviceJid:[1,d.TYPES.STRING],count:[2,d.TYPES.INT32]};f.internalSpec={msgId:[1,d.TYPES.STRING],statusTsPerUser:[2,d.FLAGS.REPEATED|d.TYPES.MESSAGE,b],permittedIdentitiesPerDevice:[3,d.FLAGS.REPEATED|d.TYPES.MESSAGE,c],recipientDevices:[4,d.FLAGS.REPEATED|d.TYPES.STRING],retryCountsPerDevice:[5,d.FLAGS.REPEATED|d.TYPES.MESSAGE,e],waMsgId:[6,d.TYPES.STRING]};h.internalSpec={device:[1,d.TYPES.STRING],ts:[2,d.TYPES.INT64]};i.internalSpec={pendingReceiptId:[1,d.TYPES.STRING],thread:[2,d.TYPES.STRING],externalId:[3,d.TYPES.STRING],author:[4,d.TYPES.STRING],deliveryReceipts:[5,d.FLAGS.REPEATED|d.TYPES.MESSAGE,h],readReceipts:[6,d.FLAGS.REPEATED|d.TYPES.MESSAGE,h]};g.DbUserStatusTsProtoSpec=a;g.StatusTsPerUserProtoSpec=b;g.IdentitiesPerDeviceProtoSpec=c;g.RetryCountPerDeviceProtoSpec=e;g.ReceiptsTableSchemaProtoSpec=f;g.ReceiptsSpec=h;g.PendingReceiptsTableSchemaProtoSpec=i}),98);
__d("MAWArmadilloRetroactiveBackupsStateTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.internalSpec={threadId:[1,d("WAProtoConst").TYPES.INT64],msgId:[2,d("WAProtoConst").TYPES.STRING]};g.RetroactiveBackupsStateTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloSignalTablesSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};e={};f={};var h={};a.internalSpec={deviceJid:[1,(d=d("WAProtoConst")).TYPES.STRING],identity:[2,d.TYPES.BYTES],firstSeenTs:[3,d.TYPES.INT64],deviceName:[4,d.TYPES.STRING],platform:[5,d.TYPES.STRING],userJid:[6,d.TYPES.STRING]};b.internalSpec={keyId:[1,d.TYPES.INT32],encoded:[2,d.TYPES.BYTES],isDeleted:[3,d.TYPES.BOOL]};c.internalSpec={generationId:[1,d.TYPES.INT32],startingId:[2,d.TYPES.INT32],endingId:[3,d.TYPES.INT32],createdTs:[4,d.TYPES.INT64]};e.internalSpec={id:[1,d.TYPES.STRING],session:[2,d.TYPES.BYTES]};f.internalSpec={keyId:[1,d.TYPES.INT32],encoded:[2,d.TYPES.BYTES]};h.internalSpec={id:[1,d.TYPES.STRING],groupJid:[2,d.TYPES.STRING],userJid:[3,d.TYPES.STRING],deviceId:[4,d.TYPES.INT32],record:[5,d.TYPES.BYTES]};g.IdentityTableSchemaProtoSpec=a;g.PrekeyTableSchemaProtoSpec=b;g.PrekeyGenerationTableSchemaProtoSpec=c;g.SessionTableSchemaProtoSpec=e;g.SignedPrekeyTableSchemaProtoSpec=f;g.SenderKeySessionsTableSchemaProtoSpec=h}),98);
__d("MAWArmadilloSyncActionsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.internalSpec={index:[1,(b=d("WAProtoConst")).TYPES.STRING],binarySyncData:[2,b.TYPES.BYTES],actionState:[3,b.TYPES.STRING],version:[4,b.TYPES.INT32],keyId:[5,b.TYPES.BYTES],modelId:[6,b.TYPES.STRING],modelType:[7,b.TYPES.STRING],indexMac:[8,b.TYPES.BYTES],valueMac:[9,b.TYPES.BYTES],collection:[10,b.TYPES.STRING],timestamp:[11,b.TYPES.INT64],action:[12,b.TYPES.STRING]};g.SyncActionsTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloSyncKeysTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};a.internalSpec={currentIndex:[1,(c=d("WAProtoConst")).TYPES.INT32],deviceIndexes:[2,c.FLAGS.REPEATED|c.TYPES.INT32],rawId:[3,c.TYPES.INT64]};b.internalSpec={id:[1,c.TYPES.BYTES],keyId:[2,c.TYPES.BYTES],keyData:[3,c.TYPES.BYTES],keyEpoch:[4,c.TYPES.INT64],timestamp:[5,c.TYPES.INT64],fingerprint:[6,c.TYPES.MESSAGE,a]};g.SyncKeyFingerprintSpec=a;g.SyncKeysTableSchemaProtoSpec=b}),98);
__d("MAWArmadilloTasksTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.internalSpec={taskName:[1,d("WAProtoConst").TYPES.STRING],scheduledTime:[2,d("WAProtoConst").TYPES.INT64]};g.TasksTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloThreadsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.internalSpec={jid:[1,(b=d("WAProtoConst")).TYPES.STRING],threadOrder:[2,b.TYPES.STRING],folder:[4,b.TYPES.INT32],newestMsg:[5,b.TYPES.STRING],oldestMsg:[6,b.TYPES.STRING],lastReadMsg:[7,b.TYPES.STRING],lastReadMsgReceiptSent:[8,b.TYPES.STRING],lastReadMsgTs:[9,b.TYPES.INT64],newestMsgTs:[10,b.TYPES.INT64],muteExpireTimeMs:[11,b.TYPES.INT64],muteCallsExpireTimeMs:[12,b.TYPES.INT64],archived:[13,b.TYPES.BOOL],cannotReplyReason:[14,b.TYPES.STRING],chatId:[15,b.TYPES.INT32],optimisticThreadKey:[16,b.TYPES.STRING],isMigratedLocally:[17,b.TYPES.BOOL],snippetMsg:[18,b.TYPES.STRING],deduplicationKey:[19,b.TYPES.STRING],authoritativeThreadKey:[20,b.TYPES.STRING],snippetMsgTs:[21,b.TYPES.INT64],didInsertDualThreadCutoverAdminMsg:[22,b.TYPES.BOOL]};g.ThreadsTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloUnrenderedMessagesTableSchema.pb",["MAWArmadilloContactsTableSchema.pb","MAWArmadilloMessagesTableSchema.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.internalSpec={type:[1,(b=d("WAProtoConst")).TYPES.STRING],ts:[2,b.TYPES.INT64],externalId:[3,b.TYPES.STRING],msgId:[4,b.TYPES.STRING],author:[5,b.TYPES.STRING],ack:[6,b.TYPES.INT32],resendCount:[7,b.TYPES.INT32],ephemeralSetting:[8,b.TYPES.MESSAGE,d("MAWArmadilloContactsTableSchema.pb").EphemeralSettingProtoSpec],messageDeleteForMeTs:[9,b.TYPES.INT64],rowId:[10,b.TYPES.INT32],thread:[11,b.TYPES.INT32],mediaId:[12,b.TYPES.INT32],msgContent:[13,b.TYPES.STRING],threadJid:[14,b.TYPES.STRING],reportingMeta:[15,b.TYPES.MESSAGE,d("MAWArmadilloMessagesTableSchema.pb").ReportingMetaProtoSpec],invitedParticipantUserJid:[16,b.TYPES.STRING],groupName:[17,b.TYPES.STRING],quote:[18,b.TYPES.MESSAGE,d("MAWArmadilloMessagesTableSchema.pb").DbQuotedMsgProtoSpec],xmaMessageType:[19,b.TYPES.INT32],sortOrderMs:[20,b.TYPES.INT64]};g.UnrenderedMessagesTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloXMATableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};a.internalSpec={associatedMessageId:[1,(c=d("WAProtoConst")).TYPES.STRING],author:[2,c.TYPES.STRING],ctas:[3,c.FLAGS.REPEATED|c.TYPES.MESSAGE,b],defaultCTA:[4,c.TYPES.MESSAGE,b],defaultPreviewMediaId:[5,c.TYPES.INT32],externalId:[6,c.TYPES.STRING],faviconMediaId:[7,c.TYPES.INT32],headerMediaId:[8,c.TYPES.INT32],headerTitle:[9,c.TYPES.STRING],isTombstoned:[10,c.TYPES.BOOL],maxSubtitleNumOfLines:[11,c.TYPES.INT32],maxTitleNumOfLines:[12,c.TYPES.INT32],msgId:[13,c.TYPES.STRING],overlayDescription:[14,c.TYPES.STRING],overlayIconGlyph:[15,c.TYPES.INT32],overlayTitle:[16,c.TYPES.STRING],previewMediaIds:[17,c.FLAGS.REPEATED|c.TYPES.INT32],subtitleText:[18,c.TYPES.STRING],targetExpiringAtSec:[19,c.TYPES.INT64],targetId:[20,c.TYPES.STRING],targetType:[21,c.TYPES.INT32],targetUsername:[22,c.TYPES.STRING],threadJid:[23,c.TYPES.STRING],titleText:[24,c.TYPES.STRING],xmaId:[25,c.TYPES.INT32],xmaLayoutType:[26,c.TYPES.INT32]};b.internalSpec={buttonType:[1,c.TYPES.INT32],title:[2,c.TYPES.STRING],actionUrl:[3,c.TYPES.STRING],nativeUrl:[4,c.TYPES.STRING],ctaType:[5,c.TYPES.STRING]};g.XMATableSchemaProtoSpec=a;g.CTAProtoSpec=b}),98);
__d("MAWXMACTAUtil",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b=a.actionUrl,c=a.buttonType,d=a.nativeUrl;a=a.title;return{actionUrl:b,buttonType:c,nativeUrl:d,title:a}}function b(a){var b=a.actionUrl,c=a.buttonType,d=a.nativeUrl;a=a.title;return{actionUrl:b,buttonType:c,nativeUrl:d,title:a}}f.toMAWCTAEncode=a;f.fromMAWCTAEncode=b}),66);
__d("WAServerSync.pb",["$InternalEnum","WAProtoConst"],(function(a,b,c,d,e,f,g){a=b("$InternalEnum")({SET:0,REMOVE:1});c={};e={};f={};b={};var h={},i={},j={},k={},l={},m={},n={};c.internalSpec={version:[1,(d=d("WAProtoConst")).TYPES.UINT64]};e.internalSpec={code:[1,d.TYPES.UINT64],text:[2,d.TYPES.STRING]};f.internalSpec={blob:[1,d.TYPES.BYTES]};b.internalSpec={blob:[1,d.TYPES.BYTES]};h.internalSpec={id:[1,d.TYPES.BYTES]};i.internalSpec={index:[1,d.TYPES.MESSAGE,f],value:[2,d.TYPES.MESSAGE,b],keyId:[3,d.TYPES.MESSAGE,h]};j.internalSpec={mediaKey:[1,d.TYPES.BYTES],directPath:[2,d.TYPES.STRING],handle:[3,d.TYPES.STRING],fileSizeBytes:[4,d.TYPES.UINT64],fileSha256:[5,d.TYPES.BYTES],fileEncSha256:[6,d.TYPES.BYTES]};k.internalSpec={version:[1,d.TYPES.MESSAGE,c],records:[2,d.FLAGS.REPEATED|d.TYPES.MESSAGE,i],mac:[3,d.TYPES.BYTES],keyId:[4,d.TYPES.MESSAGE,h]};l.internalSpec={mutations:[1,d.FLAGS.REPEATED|d.TYPES.MESSAGE,m]};m.internalSpec={operation:[1,d.TYPES.ENUM,a],record:[2,d.TYPES.MESSAGE,i]};n.internalSpec={version:[1,d.TYPES.MESSAGE,c],mutations:[2,d.FLAGS.REPEATED|d.TYPES.MESSAGE,m],externalMutations:[3,d.TYPES.MESSAGE,j],snapshotMac:[4,d.TYPES.BYTES],patchMac:[5,d.TYPES.BYTES],keyId:[6,d.TYPES.MESSAGE,h],exitCode:[7,d.TYPES.MESSAGE,e],deviceIndex:[8,d.TYPES.UINT32],clientDebugData:[9,d.TYPES.BYTES]};g.SyncdMutation$SyncdOperation=a;g.SyncdVersionSpec=c;g.ExitCodeSpec=e;g.SyncdIndexSpec=f;g.SyncdValueSpec=b;g.KeyIdSpec=h;g.SyncdRecordSpec=i;g.ExternalBlobReferenceSpec=j;g.SyncdSnapshotSpec=k;g.SyncdMutationsSpec=l;g.SyncdMutationSpec=m;g.SyncdPatchSpec=n}),98);
__d("decodeProtobuf",["WABinary","WAHasProperty","WAHex","WAProtoCompile","WAProtoConst","WAProtoUtils","WAProtoValidate"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){b=new(d("WABinary").Binary)(b);b=n(a,b,void 0,!1);d("WAProtoValidate").checkRequirements(a,b);return b}function b(a,b){b=new(d("WABinary").Binary)(b);b=n(a,b,void 0,!0);d("WAProtoValidate").checkRequirements(a,b);return b}function e(a){return c("WAHasProperty")(a,"$$unsafeUnknownFields")?a.$$unsafeUnknownFields:null}function h(a,b,c){if(a!==d("WAProtoUtils").typeToEncType(b))throw new Error("FormatError: "+c+" encoded with wire type "+a)}function i(a,b,c){switch(b){case d("WAProtoConst").TYPES.INT32:return j(c,-2147483648,2147483648,a,d("WABinary").parseInt64OrThrow);case d("WAProtoConst").TYPES.INT64:return c.readVarInt(k);case d("WAProtoConst").TYPES.UINT32:return j(c,0,4294967296,a,d("WABinary").parseUint64OrThrow);case d("WAProtoConst").TYPES.UINT64:return c.readVarInt(l);case d("WAProtoConst").TYPES.SINT32:b=j(c,0,4294967296,a,d("WABinary").parseInt64OrThrow);return b&1?~(b>>>1):b>>>1;case d("WAProtoConst").TYPES.SINT64:return c.readVarInt(m);case d("WAProtoConst").TYPES.BOOL:return!!j(c,0,2,a,d("WABinary").parseUint64OrThrow);case d("WAProtoConst").TYPES.ENUM:return c.readVarInt(d("WABinary").parseInt64OrThrow);case d("WAProtoConst").TYPES.FIXED64:return c.readLong(l,!0);case d("WAProtoConst").TYPES.SFIXED64:return c.readLong(k,!0);case d("WAProtoConst").TYPES.DOUBLE:return c.readFloat64(!0);case d("WAProtoConst").TYPES.STRING:return c.readString(c.readVarInt(d("WABinary").parseUint64OrThrow));case d("WAProtoConst").TYPES.BYTES:return c.readBuffer(c.readVarInt(d("WABinary").parseUint64OrThrow));case d("WAProtoConst").TYPES.FIXED32:return c.readUint32(!0);case d("WAProtoConst").TYPES.SFIXED32:return c.readInt32(!0);case d("WAProtoConst").TYPES.FLOAT:return c.readFloat32(!0)}}function j(a,b,c,d,e){a=a.readVarInt(e);if(a<b||a>=c)throw new Error("FormatError: "+d+" encoded with out-of-range value "+a);return a}function k(a,b){var c=d("WABinary").longFitsInDouble(!0,a,b);if(c){c=o(b);return a*4294967296+c}else{c=a<0;var e;c?e=b===0?-a:~a:e=a;a=c?-b:b;return d("WAHex").createHexLongFrom32Bits(e,a,c)}}function l(a,b){var c=d("WABinary").longFitsInDouble(!1,a,b);if(c){c=o(a);var e=o(b);return c*4294967296+e}else return d("WAHex").createHexLongFrom32Bits(a,b)}function m(a,b){var c=a>>>1;a=a<<31|b>>>1;b&1&&(c=~c,a=~a);return k(c,a)}function n(a,b,c,e){var f=d("WAProtoCompile").compileSpec(a),g=f.names,k=f.fields,l=f.types,m=f.meta,o=f.oneofToFields,p=f.fieldToOneof,q=f.reservedTags,r=f.reservedFields;f=a.internalDefaults;var s=c||babelHelpers["extends"]({},f)||{};s.$$unknownFieldCount=(a=c==null?void 0:c.$$unknownFieldCount)!=null?a:0;for(f=0;f<g.length;f++)l[f]&d("WAProtoConst").FLAGS.REPEATED&&(s[g[f]]=[]);var t=0;c=k.length>0;a=k[0];while(b.size()){f=j(b,0,4294967296,"field and enc type",d("WABinary").parseInt64OrThrow);var u=f&7,v=f>>>3;if(c&&v!==a){f=t;do++t===k.length&&(t=0),a=k[t];while(v!==a&&t!==f)}if(c&&v===a)(function(){var a=g[t],c=l[t];h(u,c,a);var f=c&d("WAProtoConst").TYPE_MASK,j=m[t];if(c&d("WAProtoConst").FLAGS.PACKED){var k=b.readVarInt(d("WABinary").parseUint64OrThrow);k=b.readBinary(k);while(k.size()){var w=i(a,f,k);(f!==d("WAProtoConst").TYPES.ENUM||j[w]||(j.cast==null?void 0:j.cast(w))!==void 0)&&s[a].push(w)}}else if(f===d("WAProtoConst").TYPES.MESSAGE){w=b.readVarInt(d("WABinary").parseUint64OrThrow);k=b.readBinary(w);if(c&d("WAProtoConst").FLAGS.REPEATED)s[a].push(n(j,k,void 0,e));else{w=s[a];s[a]=n(j,k,w,e)}}else{k=i(a,f,b);(f!==d("WAProtoConst").TYPES.ENUM||j[k]||(j.cast==null?void 0:j.cast(k))!==void 0)&&(c&d("WAProtoConst").FLAGS.REPEATED?s[a].push(k):s[a]=k)}w=p[a];w&&typeof s[a]!=="undefined"&&w.forEach(function(b){b=o[b].filter(function(b){return b!==a});b.forEach(function(a){delete s[a]})});(q[v]||r[a])&&delete s[a]})();else{s.$$unknownFieldCount++;if(e){s.$$unsafeUnknownFields||(s.$$unsafeUnknownFields={});f=void 0;switch(u){case d("WAProtoConst").ENC.VARINT:f=b.readVarInt(d("WABinary").parseInt64OrThrow);break;case d("WAProtoConst").ENC.BIT64:f=b.readBinary(8);break;case d("WAProtoConst").ENC.BINARY:f=b.readBinary(b.readVarInt(d("WABinary").parseUint64OrThrow));break;case d("WAProtoConst").ENC.BIT32:f=b.readBinary(4);break}s.$$unsafeUnknownFields[v]=f}else u===d("WAProtoConst").ENC.VARINT?b.readVarInt(d("WABinary").parseInt64OrThrow):u===d("WAProtoConst").ENC.BIT64?b.advance(8):u===d("WAProtoConst").ENC.BINARY?b.advance(b.readVarInt(d("WABinary").parseUint64OrThrow)):u===d("WAProtoConst").ENC.BIT32&&b.advance(4)}}return s}function o(a){return a>=0?a:4294967296+a}g.decodeProtobuf=a;g.decodeProtobufWithUnknowns=b;g.getUnknownFields=e}),98);
__d("MAWDbObjDecode",["MAWArmadilloAppDataTableSchema.pb","MAWArmadilloAppMetaTableSchema.pb","MAWArmadilloCollectionVersionsTableSchema.pb","MAWArmadilloContactsTableSchema.pb","MAWArmadilloDeletedMessagesTableSchema.pb","MAWArmadilloDeviceChangeAlertsTableSchema.pb","MAWArmadilloDyiBatchTableSchema.pb","MAWArmadilloEBMsgRangesTableSchema.pb","MAWArmadilloEditMsgHistoryTableSchema.pb","MAWArmadilloGroupInfoTableSchema.pb","MAWArmadilloGroupInvitesTableSchema.pb","MAWArmadilloMediaTablesSchema.pb","MAWArmadilloMessagesTableSchema.pb","MAWArmadilloMetaRowTableSchema.pb","MAWArmadilloMissingKeysTableSchema.pb","MAWArmadilloParticipantsTableSchema.pb","MAWArmadilloPendingMutationsTableSchema.pb","MAWArmadilloPersonalSenderKeyStatusTableSchema.pb","MAWArmadilloReactionsTableSchema.pb","MAWArmadilloReceiptTablesSchema.pb","MAWArmadilloRetroactiveBackupsStateTableSchema.pb","MAWArmadilloSignalTablesSchema.pb","MAWArmadilloSyncActionsTableSchema.pb","MAWArmadilloSyncKeysTableSchema.pb","MAWArmadilloTasksTableSchema.pb","MAWArmadilloThreadsTableSchema.pb","MAWArmadilloUnrenderedMessagesTableSchema.pb","MAWArmadilloXMATableSchema.pb","MAWMsgType","MAWXMACTAUtil","WAServerSync.pb","decodeProtobuf","err"],(function(a,b,c,d,e,f,g){var h={appData:function(a){return J(a)},appMeta:function(a){return K(a)},browserEncryptionMeta:function(a){throw c("err")("unexpected table for decryption")},chunk:function(a){return L(a)},collectionVersions:function(a){return V(a)},contacts:function(a){return E(a)},danglingQueue:function(a){throw c("err")("unexpected table for decryption")},deletedMessages:function(a){return n(a)},deviceChangeAlerts:function(a){return i(a)},dualSendMedia:function(a){throw c("err")("unexpected table for decryption")},dyiBatch:function(a){return P(a)},ebMessageRestoreTasks:function(a){throw c("err")("unexpected table for decryption")},ebMsgRanges:function(a){return Q(a)},ebRestoreQueue:function(a){throw c("err")("unexpected table for decryption")},ebUploadQueue:function(a){throw c("err")("unexpected table for decryption")},editMsgHistory:function(a){return Y(a)},ephemeralSettings:function(a){throw c("err")("unexpected table for decryption")},existingUsers:function(a){throw c("err")("unexpected table for decryption")},ftsBackloggedMessages:function(a){throw c("err")("unexpected table for decryption")},ftsEncryptionMeta:function(a){throw c("err")("unexpected table for decryption")},ftsIndexV3:function(a){throw c("err")("unexpected table for decryption")},groupInfo:function(a){return q(a)},groupInvites:function(a){return G(a)},historySyncQRCodeData:function(a){throw c("err")("unexpected table for decryption")},historySyncQRCodeSecretKey:function(a){throw c("err")("unexpected table for decryption")},identity:function(a){return t(a)},igMessageAuxiliaryInfo:function(a){throw c("err")("unexpected table for decryption")},isDualSend:function(a){throw c("err")("unexpected table for decryption")},jobs:function(a){throw c("err")("unexpected table for decryption")},media:function(a){return N(a)},mediaBackup:function(a){return M(a)},messages:function(a){return m(a)},meta:function(a){return s(a)},missingKeys:function(a){return T(a)},participants:function(a){return F(a)},pendingMessageStanzaQueue:function(a){throw c("err")("unexpected table for decryption")},pendingMutations:function(a){return U(a)},pendingReceipts:function(a){return C(a)},pendingStanzas:function(a){throw c("err")("unexpected table for decryption")},personalSenderKeyStatuses:function(a){return I(a)},prekey:function(a){return u(a)},prekeyGeneration:function(a){return v(a)},reactions:function(a){return O(a)},receipts:function(a){return B(a)},retroactiveBackupsState:function(a){return R(a)},senderKeySessions:function(a){return y(a)},sentBytesCache:function(a){throw c("err")("unexpected table for decryption")},session:function(a){return w(a)},signedPrekey:function(a){return x(a)},staleQueue:function(a){throw c("err")("unexpected table for decryption")},stanzaQueue:function(a){throw c("err")("unexpected table for decryption")},syncActions:function(a){return S(a)},syncKeys:function(a){return W(a)},tasks:function(a){return H(a)},threads:function(a){return D(a)},unrenderedMessages:function(a){return o(a)},uploadRetryStatus:function(a){throw c("err")("unexpected table for decryption")},xma:function(a){return X(a)}};function a(a,b){if(Object.prototype.hasOwnProperty.call(h,b))b=h[b](a);else throw c("err")("not a valid table name");return b}function i(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloDeviceChangeAlertsTableSchema.pb").DeviceChangeAlertsTableSchemaProtoSpec,a);return{action:a.action,deviceJid:a.deviceJid,identity:a.identity,isArchived:a.isArchived,latitude:a.latitude,location:a.location,loggedOut:a.loggedOut,longitude:a.longitude,model:a.model,platform:a.platform,ts:a.ts}}function j(a){a=a.quote;var b;if(a!=null){if(a.content==null)throw c("err")("QuotedMsgContent missing upon decoding");var d=a.content,e=d.author,f=d.externalId,g=d.mediaId,h=d.msgContent,i=d.msgId,j=d.sourceId,k=d.specialTextSize,l=d.ts,m=d.type;d=d.xmaMessageType;b={content:babelHelpers["extends"]({},a.content,{author:e,externalId:f,mediaId:g,msgContent:h,msgId:i,sourceId:j,specialTextSize:k,ts:l,type:m,xmaMessageType:d}),remoteJid:a.remoteJid}}return b}function k(a){if(a==null)return a;else return new Uint8Array(a)}function l(a){if(a==null||a.length===0)return new Set();else return new Set(a)}function m(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloMessagesTableSchema.pb").MessagesTableSchemaProtoSpec,a);var b=a.msgContent;if(a.type===d("MAWMsgType").MSG_TYPE.FUTUREPROOF){if(b==null)throw c("err")("MsgContent missing upon decoding futureproof message");b.subtype=b.subtype}var e=j(a),f=p(a.reportingMeta);return babelHelpers["extends"]({},a,{msgContent:b,quote:e,reportingMeta:f})}function n(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloDeletedMessagesTableSchema.pb").DeletedMessagesTableSchemaProtoSpec,a);return babelHelpers["extends"]({},a)}function o(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloUnrenderedMessagesTableSchema.pb").UnrenderedMessagesTableSchemaProtoSpec,a);var b=j(a),c=p(a.reportingMeta);return babelHelpers["extends"]({},a,{quote:b,reportingMeta:c})}function p(a){if(a==null)return;return{frankingKey:a.frankingKey!=null?new Uint8Array(a.frankingKey):a.frankingKey,frankingTag:a.frankingTag!=null?new Uint8Array(a.frankingTag):a.frankingTag,frankingVersion:a.frankingVersion,reportingContent:a.reportingContent,reportingTag:a.reportingTag!=null?new Uint8Array(a.reportingTag):a.reportingTag}}function q(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloGroupInfoTableSchema.pb").GroupInfoSchemaProtoSpec,a);return{creationTs:a.creationTs,creator:a.creator,inviter:a.inviter,memberAddMode:a.memberAddMode,msgExpiration:a.msgExpiration,name:a.name,nameOwner:a.nameOwner,nameTs:a.nameTs,participantVersion:a.participantVersion}}function r(a,b){var d;a=a;if(a==null)d=a;else{var e=a.privateKey;a=a.publicKey;if(e==null||a==null)throw c("err")("Decoding "+b+" private or public key missing");d={privateKey:new Uint8Array(e),publicKey:new Uint8Array(a)}}return d}function s(a){var b,c,e,f;a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloMetaRowTableSchema.pb").MetaRowTableSchemaProtoSpec,a);b=(b=a.value)==null?void 0:b.cat;if(b==null)b=b;else{var g;b={encrypted_serialized_cat:(g=a.value)==null?void 0:(g=g.cat)==null?void 0:g.encryptedSerializedCat,expiration_time_in_seconds:(g=a.value)==null?void 0:(g=g.cat)==null?void 0:g.expirationTimeInSeconds}}g=(g=a.value)==null?void 0:g.edgeInfo;g=k(g);c=r((c=a.value)==null?void 0:c.identityKeyPair,"identityKeyPair");e=r((e=a.value)==null?void 0:e.authKeyPair,"authKeyPair");return{value:{abProps:(f=a.value)==null?void 0:f.abProps,authKeyPair:e,cat:b,certificateChain:(f=a.value)==null?void 0:f.certificateChain,clockSkew:(e=a.value)==null?void 0:e.clockSkew,deviceId:(b=a.value)==null?void 0:b.deviceId,deviceUUID:(f=a.value)==null?void 0:f.deviceUUID,edgeInfo:g,fbid:(e=a.value)==null?void 0:e.fbid,identityKeyPair:c,lastPrekeyGenerationId:(b=a.value)==null?void 0:b.lastPrekeyGenerationId,lastPrekeyId:(f=a.value)==null?void 0:f.lastPrekeyId,lastSessionDeviceWasLinkedTo:(g=a.value)==null?void 0:g.lastSessionDeviceWasLinkedTo,lastSignedPrekeyId:(e=a.value)==null?void 0:e.lastSignedPrekeyId,regId:(c=a.value)==null?void 0:c.regId,registrationVersion:(b=a.value)==null?void 0:b.registrationVersion,restoreMigrationAttempts:(f=a.value)==null?void 0:f.restoreMigrationAttempts}}}function t(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloSignalTablesSchema.pb").IdentityTableSchemaProtoSpec,a);var b=a.identity,c=a.firstSeenTs;b=k(b);return{deviceName:a.deviceName,firstSeenTs:c,identity:b,platform:a.platform}}function u(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloSignalTablesSchema.pb").PrekeyTableSchemaProtoSpec,a);var b=a.encoded;b=k(b);return{encoded:b,isDeleted:a.isDeleted}}function v(a){return d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloSignalTablesSchema.pb").PrekeyGenerationTableSchemaProtoSpec,a)}function w(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloSignalTablesSchema.pb").SessionTableSchemaProtoSpec,a);a=a.session;a=k(a);return{session:a}}function x(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloSignalTablesSchema.pb").SignedPrekeyTableSchemaProtoSpec,a);a=a.encoded;a=k(a);return{encoded:a}}function y(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloSignalTablesSchema.pb").SenderKeySessionsTableSchemaProtoSpec,a);var b=a.record;b=k(b);return{deviceId:a.deviceId,record:b}}function z(a){if(a.length===0)return null;else return new Map(a.map(function(a){var b=a.deviceJid;if(b==null||a.serializedPubKey==null)throw c("err")("Expected deviceJid or serializedPubKey are missing ");var d=new Uint8Array(a.serializedPubKey);a=k(a.baseKey);a={baseKey:a,pubKey:d};return[b,a]}))}function A(a){if(a==null)return null;else return new Map(a.map(function(a){if(a.deviceJid==null)throw c("err")("Expected deviceJID is missing ");return[a.deviceJid,(a=a.count)!=null?a:0]}))}function B(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloReceiptTablesSchema.pb").ReceiptsTableSchemaProtoSpec,a);var b,e=a.statusTsPerUser;e==null?b=new Map():b=new Map(e.map(function(a){if(a.userJid==null||a.dbUserStatusTs==null)throw c("err")("Expected userJid or dbUserStatus are missing ");return[a.userJid,a.dbUserStatusTs]}));e=a.recipientDevices;e=l(e);return{permittedIdentitiesPerDevice:z(a.permittedIdentitiesPerDevice),recipientDevices:e,retryCountsPerDevice:A(a.retryCountsPerDevice),statusTsPerUser:b}}function C(a){return d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloReceiptTablesSchema.pb").PendingReceiptsTableSchemaProtoSpec,a)}function D(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloThreadsTableSchema.pb").ThreadsTableSchemaProtoSpec,a);return{archived:a.archived,cannotReplyReason:a.cannotReplyReason,didInsertDualThreadCutoverAdminMsg:a.didInsertDualThreadCutoverAdminMsg,folder:a.folder,isMigratedLocally:a.isMigratedLocally,lastReadMsg:a.lastReadMsg,lastReadMsgReceiptSent:a.lastReadMsgReceiptSent,lastReadMsgTs:a.lastReadMsgTs,muteCallsExpireTimeMs:a.muteCallsExpireTimeMs,muteExpireTimeMs:a.muteExpireTimeMs,newestMsg:a.newestMsg,newestMsgTs:a.newestMsgTs,oldestMsg:a.oldestMsg,optimisticThreadKey:a.optimisticThreadKey,snippetMsg:a.snippetMsg,snippetMsgTs:a.snippetMsgTs}}function E(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloContactsTableSchema.pb").ContactsTableSchemaProtoSpec,a);var b=a.icdcInfo,c;b!=null&&(c={devices:b.devices.map(function(a){return new Uint8Array(a)}),dirty:b.dirty,sequence:b.sequence,signingDeviceIndex:b.signingDeviceIndex,timestamp:b.timestamp});return{dhash:a.dhash,ephemeralSetting:a.ephemeralSetting,ephemeralSyncResponseBackoffInfo:a.ephemeralSyncResponseBackoffInfo,icdcFails:a.icdcFails,icdcInfo:c,isBlocked:a.isBlocked,isRestricted:a.isRestricted,lastSyncTs:a.lastSyncTs,nameForSearch:a.nameForSearch,relationship:a.relationship}}function F(a){return d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloParticipantsTableSchema.pb").ParticipantsTableSchemaProtoSpec,a)}function G(a){return d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloGroupInvitesTableSchema.pb").GroupInvitesTableSchemaProtoSpec,a)}function H(a){return d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloTasksTableSchema.pb").TasksTableSchemaProtoSpec,a)}function I(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloPersonalSenderKeyStatusTableSchema.pb").PersonalSenderKeyStatusTableSchemaProtoSpec,a);var b=a.hasSenderKey;b=l(b);return{hasSenderKey:b,rotateSenderKey:a.rotateSenderKey,senderKeyId:a.senderKeyId,senderKeyTs:a.senderKeyTs}}function J(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloAppDataTableSchema.pb").AppDataTableSchemaProtoSpec,a);return{ack:a.ack,contents:a.contents,permittedIdentitiesPerDevice:z(a.permittedIdentitiesPerDevice),recipientDevices:new Set(a.recipientDevices),sendPartial:a.sendPartial,ts:a.ts}}function K(a){return d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloAppMetaTableSchema.pb").AppMetaTableSchemaProtoSpec,a)}function L(a){return d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloMediaTablesSchema.pb").ChunkTableSchemaProtoSpec,a)}function M(a){return d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloMediaTablesSchema.pb").MediaBackupSchemaProtoSpec,a)}function N(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloMediaTablesSchema.pb").MediaTableSchemaProtoSpec,a);var b,e=a.mediaEntries;e==null?b=new Map():b=new Map(e.map(function(a){if(a.msgId==null||a.mediaEntryData==null)throw c("err")("Expected msgId or mediaEntryData are missing ");return[a.msgId,new Uint8Array(a.mediaEntryData)]}));return{mediaEntries:b,mediaType:a.mediaType,plaintextHash:a.plaintextHash,size:a.size,ts:a.ts,validatedAudioInfo:a.validatedAudioInfo,validatedDocumentFileInfo:a.validatedDocumentFileInfo,validatedImageInfo:a.validatedImageInfo,validatedVideoInfo:a.validatedVideoInfo}}function O(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloReactionsTableSchema.pb").ReactionsTableSchemaProtoSpec,a);return{ack:a.ack,author:a.author,groupingKey:a.groupingKey,reaction:a.reaction,reactToAuthor:a.reactToAuthor,ts:a.ts}}function P(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloDyiBatchTableSchema.pb").DyiBatchTableSchemaProtoSpec,a);return{isThread:a.isThread,numMessages:a.numMessages,numMessagesRestored:a.numMessagesRestored,numThreadsRestored:a.numThreadsRestored,oldestTs:a.oldestTs,qplFlowDescriptor:a.qplFlowDescriptor,qplInstanceKeyE2E:a.qplInstanceKeyE2E,qplInstanceKeyForThread:a.qplInstanceKeyForThread,threadId:a.threadId}}function Q(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloEBMsgRangesTableSchema.pb").EBMsgRangesTableSchemaProtoSpec,a);return{maxMsgExternalId:a.maxMsgExternalId,maxMsgSortOrderMs:a.maxMsgSortOrderMs,minMsgExternalId:a.minMsgExternalId,minMsgSortOrderMs:a.minMsgSortOrderMs}}function R(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloRetroactiveBackupsStateTableSchema.pb").RetroactiveBackupsStateTableSchemaProtoSpec,a);return{msgId:a.msgId}}function S(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloSyncActionsTableSchema.pb").SyncActionsTableSchemaProtoSpec,a);return{binarySyncData:a.binarySyncData,keyId:a.keyId,timestamp:a.timestamp,valueMac:a.valueMac,version:a.version}}function T(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloMissingKeysTableSchema.pb").MissingKeysTableSchemaProtoSpec,a);var b;a.deviceResponses==null?b=new Map():b=new Map(a.deviceResponses.map(function(a){if(a.deviceId==null)throw c("err")("Expected deviceId is missing");else return[a.deviceId,a.deviceResponse]}));return{deviceResponses:b,keyId:a.keyId,timestamp:a.timestamp}}function U(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloPendingMutationsTableSchema.pb").PendingMutationsTableSchemaProtoSpec,a);var b;switch(a.operation){case d("MAWArmadilloPendingMutationsTableSchema.pb").SYNCD_MUTATION_SYNCD_OPERATION.SET:b=d("WAServerSync.pb").SyncdMutation$SyncdOperation.SET;break;case d("MAWArmadilloPendingMutationsTableSchema.pb").SYNCD_MUTATION_SYNCD_OPERATION.REMOVE:b=d("WAServerSync.pb").SyncdMutation$SyncdOperation.REMOVE;break;default:throw c("err")("operation missing when decoding PendingMutation")}return{binarySyncAction:a.binarySyncAction,operation:b,timestamp:a.timestamp,version:a.version}}function V(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloCollectionVersionsTableSchema.pb").CollectionVersionsTableSchemaProtoSpec,a);return{finiteFailureStartTime:a.finiteFailureStartTime,isCollectionInMacMismatchFatal:a.isCollectionInMacMismatchFatal,isCollectionLthashInconsistent:a.isCollectionLthashInconsistent,ltHash:a.ltHash,state:a.state,version:a.version}}function W(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloSyncKeysTableSchema.pb").SyncKeysTableSchemaProtoSpec,a);return{fingerprint:a.fingerprint,keyData:a.keyData,timestamp:a.timestamp}}function X(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloXMATableSchema.pb").XMATableSchemaProtoSpec,a);return{author:a.author,ctas:a.ctas.map(function(a){return d("MAWXMACTAUtil").fromMAWCTAEncode(a)}),defaultCTA:a.defaultCTA==null?a.defaultCTA:d("MAWXMACTAUtil").fromMAWCTAEncode(a.defaultCTA),headerTitle:a.headerTitle,isTombstoned:a.isTombstoned,maxSubtitleNumOfLines:a.maxSubtitleNumOfLines,maxTitleNumOfLines:a.maxTitleNumOfLines,msgId:a.msgId,overlayDescription:a.overlayDescription,overlayIconGlyph:a.overlayIconGlyph,overlayTitle:a.overlayTitle,previewMediaIds:a.previewMediaIds,subtitleText:a.subtitleText,targetId:a.targetId,targetType:a.targetType,targetUsername:a.targetUsername,threadJid:a.threadJid,titleText:a.titleText,xmaLayoutType:a.xmaLayoutType}}function Y(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloEditMsgHistoryTableSchema.pb").EditMsgHistoryTableSchemaProtoSpec,a);return{author:a.author,editExternalId:a.editExternalId,editTs:a.editTs,msgContent:a.msgContent,sendStatus:a.sendStatus,specialTextSize:a.specialTextSize}}g.decodeDbObj=a}),98);
__d("WASyncdKeyTypes",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}function b(a){return a}function c(a){return a}function d(a){return a}f.toSyncKeyId=a;f.fromSyncKeyId=b;f.toSyncKeyData=c;f.fromSyncKeyData=d}),66);
__d("MAWDbObjEncode",["MAWArmadilloAppDataTableSchema.pb","MAWArmadilloAppMetaTableSchema.pb","MAWArmadilloContactsTableSchema.pb","MAWArmadilloDeletedMessagesTableSchema.pb","MAWArmadilloDeviceChangeAlertsTableSchema.pb","MAWArmadilloDyiBatchTableSchema.pb","MAWArmadilloEBMsgRangesTableSchema.pb","MAWArmadilloEditMsgHistoryTableSchema.pb","MAWArmadilloGroupInfoTableSchema.pb","MAWArmadilloGroupInvitesTableSchema.pb","MAWArmadilloMediaTablesSchema.pb","MAWArmadilloMessagesTableSchema.pb","MAWArmadilloMetaRowTableSchema.pb","MAWArmadilloParticipantsTableSchema.pb","MAWArmadilloPersonalSenderKeyStatusTableSchema.pb","MAWArmadilloReactionsTableSchema.pb","MAWArmadilloReceiptTablesSchema.pb","MAWArmadilloRetroactiveBackupsStateTableSchema.pb","MAWArmadilloSignalTablesSchema.pb","MAWArmadilloTasksTableSchema.pb","MAWArmadilloThreadsTableSchema.pb","MAWArmadilloUnrenderedMessagesTableSchema.pb","MAWArmadilloXMATableSchema.pb","MAWMsgType","MAWXMACTAUtil","WASyncdKeyTypes","encodeProtobuf","err"],(function(a,b,c,d,e,f,g){"use strict";var h={appData:C,appMeta:D,browserEncryptionMeta:b,chunk:E,contacts:x,danglingQueue:b,deletedMessages:i,deviceChangeAlerts:a,dualSendMedia:b,dyiBatch:I,ebMessageRestoreTasks:b,ebMsgRanges:J,ebRestoreQueue:b,ebUploadQueue:b,editMsgHistory:M,ephemeralSettings:b,existingUsers:b,ftsBackloggedMessages:b,ftsEncryptionMeta:b,ftsIndexV3:b,groupInfo:k,groupInvites:z,historySyncQRCodeData:b,historySyncQRCodeSecretKey:b,identity:m,igMessageAuxiliaryInfo:b,isDualSend:b,jobs:b,media:G,mediaBackup:F,messages:f,meta:l,participants:y,pendingMessageStanzaQueue:b,pendingReceipts:v,pendingStanzas:b,personalSenderKeyStatuses:B,prekey:n,prekeyGeneration:o,reactions:H,receipts:u,retroactiveBackupsState:K,senderKeySessions:r,sentBytesCache:b,session:p,signedPrekey:q,staleQueue:b,stanzaQueue:b,tasks:A,threads:w,unrenderedMessages:j,uploadRetryStatus:b,xma:L};function a(a){a={action:a.action,deviceJid:a.deviceJid,identity:a.identity,isArchived:a.isArchived,latitude:a.latitude,location:a.location,loggedOut:a.loggedOut,longitude:a.longitude,model:a.model,platform:a.platform,ts:a.ts};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloDeviceChangeAlertsTableSchema.pb").DeviceChangeAlertsTableSchemaProtoSpec,a).readByteArray()}}function b(a){throw c("err")("unexpected table for encryption")}function e(a,b){if(Object.prototype.hasOwnProperty.call(h,b))b=h[b](a);else throw c("err")("not a valid table name");return b}function f(a){a.altIndex;a.externalId;a.messageDeleteTs;a.messageExpirationTs;a.msgId;a.quoteExternalId;a.revokedExternalId;a.rowId;a.serverTs;a.sortOrderMs;a.threadJid;a.unsendMsgContentDeleteTs;a=babelHelpers.objectWithoutPropertiesLoose(a,["altIndex","externalId","messageDeleteTs","messageExpirationTs","msgId","quoteExternalId","revokedExternalId","rowId","serverTs","sortOrderMs","threadJid","unsendMsgContentDeleteTs"]);a=a;var b;if(a.quote==null)b=a.quote;else{var c;c={author:a.quote.content.author,externalId:(c=a.quote)==null?void 0:c.content.externalId,mediaId:a.quote.content.mediaId,msgContent:a.quote.content.msgContent,msgId:a.quote.content.msgId,sourceId:a.quote.content.sourceId,specialTextSize:a.quote.content.specialTextSize,ts:a.quote.content.ts,type:a.quote.content.type,xmaMessageType:a.quote.content.xmaMessageType};c={content:c,remoteJid:a.quote.remoteJid};b=c}c=a.msgContent;a.type===d("MAWMsgType").MSG_TYPE.FUTUREPROOF&&(c={protobuf:a.msgContent.protobuf,subtype:a.msgContent.subtype});var e=a.ravenEphemeralType,f=a.ravenEphemeralMediaState;e=e!=null?e:null;f=f!=null?f:null;c={ack:a.ack,author:a.author,editCount:a.editCount,ephemeralCounterStarted:a.ephemeralCounterStarted,ephemeralMsgDisappeared:a.ephemeralMsgDisappeared,ephemeralSetting:a.ephemeralSetting,forwardingScore:a.forwardingScore,isExpiredXmaMsg:a.isExpiredXmaMsg,isForwarded:a.isForwarded,mediaId:a.mediaId,msgContent:c,originalTs:a.originalTs,quote:b,ravenEphemeralMediaState:f,ravenEphemeralType:e,reportingMeta:a.reportingMeta,resendCount:a.resendCount,specialTextSize:a.specialTextSize,ts:a.ts,type:a.type,xmaMessageType:a.xmaMessageType};return{encodedFields:c,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloMessagesTableSchema.pb").MessagesTableSchemaProtoSpec,c).readByteArray()}}function i(a){a.author;a.chat;a.externalId;a.rowId;a=babelHelpers.objectWithoutPropertiesLoose(a,["author","chat","externalId","rowId"]);a={reason:String(a.reason)};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloDeletedMessagesTableSchema.pb").DeletedMessagesTableSchemaProtoSpec,a).readByteArray()}}function j(a){var b;if(a.quote==null)b=a.quote;else{var c;c={author:a.quote.content.author,externalId:(c=a.quote)==null?void 0:c.content.externalId,mediaId:a.quote.content.mediaId,msgContent:a.quote.content.msgContent,msgId:a.quote.content.msgId,sourceId:a.quote.content.sourceId,ts:a.quote.content.ts,type:a.quote.content.type,xmaMessageType:a.quote.content.xmaMessageType};c={content:c,remoteJid:a.quote.remoteJid};b=c}c={ack:a.ack,author:a.author,ephemeralSetting:a.ephemeralSetting,groupName:a.groupName,invitedParticipantUserJid:a.invitedParticipantUserJid,mediaId:a.mediaId,msgContent:a.msgContent,quote:b,reportingMeta:a.reportingMeta,resendCount:a.resendCount,ts:a.ts,type:a.type,xmaMessageType:a.xmaMessageType};return{encodedFields:c,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloUnrenderedMessagesTableSchema.pb").UnrenderedMessagesTableSchemaProtoSpec,c).readByteArray()}}function k(a){a={creationTs:a.creationTs,creator:a.creator,inviter:a.inviter,memberAddMode:a.memberAddMode,msgExpiration:a.msgExpiration,name:a.name,nameOwner:a.nameOwner,nameTs:a.nameTs,participantVersion:a.participantVersion};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloGroupInfoTableSchema.pb").GroupInfoSchemaProtoSpec,a).readByteArray()}}function l(a){var b=a.value.cat==null?a.value.cat:{encryptedSerializedCat:a.value.cat.encrypted_serialized_cat,expirationTimeInSeconds:a.value.cat.expiration_time_in_seconds};b={value:{abProps:a.value.abProps,authKeyPair:a.value.authKeyPair,cat:b,certificateChain:a.value.certificateChain,clockSkew:a.value.clockSkew,deviceId:a.value.deviceId,deviceUUID:a.value.deviceUUID,edgeInfo:a.value.edgeInfo,fbid:a.value.fbid,identityKeyPair:a.value.identityKeyPair,lastPrekeyGenerationId:a.value.lastPrekeyGenerationId,lastPrekeyId:a.value.lastPrekeyId,lastSessionDeviceWasLinkedTo:a.value.lastSessionDeviceWasLinkedTo,lastSignedPrekeyId:a.value.lastSignedPrekeyId,regId:a.value.regId,registrationVersion:a.value.registrationVersion}};return{encodedFields:b,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloMetaRowTableSchema.pb").MetaRowTableSchemaProtoSpec,b).readByteArray()}}function m(a){a={deviceName:a.deviceName,firstSeenTs:a.firstSeenTs,identity:a.identity,platform:a.platform};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloSignalTablesSchema.pb").IdentityTableSchemaProtoSpec,a).readByteArray()}}function n(a){a={encoded:a.encoded,isDeleted:a.isDeleted};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloSignalTablesSchema.pb").PrekeyTableSchemaProtoSpec,a).readByteArray()}}function o(a){a={createdTs:a.createdTs,endingId:a.endingId,startingId:a.startingId};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloSignalTablesSchema.pb").PrekeyGenerationTableSchemaProtoSpec,a).readByteArray()}}function p(a){a={session:a.session};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloSignalTablesSchema.pb").SessionTableSchemaProtoSpec,a).readByteArray()}}function q(a){a={encoded:a.encoded};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloSignalTablesSchema.pb").SignedPrekeyTableSchemaProtoSpec,a).readByteArray()}}function r(a){a={deviceId:a.deviceId,record:a.record};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloSignalTablesSchema.pb").SenderKeySessionsTableSchemaProtoSpec,a).readByteArray()}}function s(a){if(a==null)return a;else return Array.from(a,function(a){var b=a[0];a=a[1];return{baseKey:a.baseKey,deviceJid:b,serializedPubKey:a.pubKey}})}function t(a){if(a==null)return null;else return Array.from(a,function(a){var b=a[0];a=a[1];return{count:a,deviceJid:b}})}function u(a){var b=Array.from(a.statusTsPerUser,function(a){var b=a[0];a=a[1];return{dbUserStatusTs:a,userJid:b}}),c=Array.from(a.recipientDevices);c={permittedIdentitiesPerDevice:s(a.permittedIdentitiesPerDevice),recipientDevices:c,retryCountsPerDevice:t(a.retryCountsPerDevice),statusTsPerUser:b};return{encodedFields:c,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloReceiptTablesSchema.pb").ReceiptsTableSchemaProtoSpec,c).readByteArray()}}function v(a){a={author:a.author,deliveryReceipts:a.deliveryReceipts,externalId:a.externalId,readReceipts:a.readReceipts,thread:a.thread};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloReceiptTablesSchema.pb").PendingReceiptsTableSchemaProtoSpec,a).readByteArray()}}function w(a){a={archived:a.archived,cannotReplyReason:a.cannotReplyReason,didInsertDualThreadCutoverAdminMsg:a.didInsertDualThreadCutoverAdminMsg,folder:a.folder,isMigratedLocally:a.isMigratedLocally,lastReadMsg:a.lastReadMsg,lastReadMsgReceiptSent:a.lastReadMsgReceiptSent,lastReadMsgTs:a.lastReadMsgTs,muteExpireTimeMs:a.muteExpireTimeMs,newestMsg:a.newestMsg,newestMsgTs:a.newestMsgTs,oldestMsg:a.oldestMsg,optimisticThreadKey:a.optimisticThreadKey,snippetMsg:a.snippetMsg,snippetMsgTs:a.snippetMsgTs};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloThreadsTableSchema.pb").ThreadsTableSchemaProtoSpec,a).readByteArray()}}function x(a){a={dhash:a.dhash,icdcFails:a.icdcFails,icdcInfo:a.icdcInfo,lastSyncTs:a.lastSyncTs};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloContactsTableSchema.pb").ContactsTableSchemaProtoSpec,a).readByteArray()}}function y(a){a={addressable:a.addressable,deliveredWatermarkTs:a.deliveredWatermarkTs,lastReadActionTs:a.lastReadActionTs,lastReadWatermarkTs:a.lastReadWatermarkTs,type:a.type};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloParticipantsTableSchema.pb").ParticipantsTableSchemaProtoSpec,a).readByteArray()}}function z(a){a={caption:a.caption,inviteCode:a.inviteCode,inviteExpirationTs:a.inviteExpirationTs};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloGroupInvitesTableSchema.pb").GroupInvitesTableSchemaProtoSpec,a).readByteArray()}}function A(a){a={scheduledTime:a.scheduledTime};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloTasksTableSchema.pb").TasksTableSchemaProtoSpec,a).readByteArray()}}function B(a){var b=Array.from(a.hasSenderKey);b={hasSenderKey:b,rotateSenderKey:a.rotateSenderKey,senderKeyId:a.senderKeyId,senderKeyTs:a.senderKeyTs};return{encodedFields:b,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloPersonalSenderKeyStatusTableSchema.pb").PersonalSenderKeyStatusTableSchemaProtoSpec,b).readByteArray()}}function C(a){var b;switch(a.contents.type){case"meta_sync":var e=[];for(var f=a.contents.actions,g=Array.isArray(f),h=0,f=g?f:f[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var i;if(g){if(h>=f.length)break;i=f[h++]}else{h=f.next();if(h.done)break;i=h.value}i=i;i.chatAction?e.push({chatAction:i.chatAction}):i.messageAction&&e.push({messageAction:i.messageAction})}b={actions:e,type:"meta_sync"};break;case"backups_secrets":b={encryptedBackupsSecrets:a.contents.encryptedBackupsSecrets,type:"backups_secrets"};break;case"sync_key_share":b={syncKeyShare:{keys:a.contents.syncKeyShare.keys,orphanKeys:(i=a.contents.syncKeyShare)==null?void 0:(h=i.orphanKeys)==null?void 0:h.map(d("WASyncdKeyTypes").fromSyncKeyId)},type:"sync_key_share"};break;case"sync_key_request":b={syncKeyRequest:{keyIds:a.contents.syncKeyRequest.keyIds.map(d("WASyncdKeyTypes").fromSyncKeyId)},type:"sync_key_request"};break;default:a.contents.type;throw c("err")("Unknown appdata type: "+a.contents.type)}g={ack:a.ack,contents:b,permittedIdentitiesPerDevice:s(a.permittedIdentitiesPerDevice),recipientDevices:Array.from(a.recipientDevices),sendPartial:a.sendPartial,ts:a.ts};return{encodedFields:g,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloAppDataTableSchema.pb").AppDataTableSchemaProtoSpec,g).readByteArray()}}function D(a){a={value:a.value};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloAppMetaTableSchema.pb").AppMetaTableSchemaProtoSpec,a).readByteArray()}}function E(a){a={blobData:a.blobData,mimetype:a.mimetype,plaintextHash:a.plaintextHash};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloMediaTablesSchema.pb").ChunkTableSchemaProtoSpec,a).readByteArray()}}function F(a){a={fbid:a.fbid};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloMediaTablesSchema.pb").MediaBackupSchemaProtoSpec,a).readByteArray()}}function G(a){var b=Array.from(a.mediaEntries,function(a){var b=a[0];a=a[1];return{mediaEntryData:a,msgId:b}});b={mediaEntries:b,mediaType:a.mediaType,plaintextHash:a.plaintextHash,size:a.size,ts:a.ts,validatedAudioInfo:a.validatedAudioInfo,validatedDocumentFileInfo:a.validatedDocumentFileInfo,validatedImageInfo:a.validatedImageInfo,validatedVideoInfo:a.validatedVideoInfo};return{encodedFields:b,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloMediaTablesSchema.pb").MediaTableSchemaProtoSpec,b).readByteArray()}}function H(a){a={ack:a.ack,author:a.author,groupingKey:a.groupingKey,reaction:a.reaction,reactToAuthor:a.reactToAuthor,ts:a.ts};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloReactionsTableSchema.pb").ReactionsTableSchemaProtoSpec,a).readByteArray()}}function I(a){a={isThread:a.isThread,numMessages:a.numMessages,numMessagesRestored:a.numMessagesRestored,numThreadsRestored:a.numThreadsRestored,oldestTs:a.oldestTs,qplFlowDescriptor:a.qplFlowDescriptor,qplInstanceKeyE2E:a.qplInstanceKeyE2E,qplInstanceKeyForThread:a.qplInstanceKeyForThread,threadId:a.threadId};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloDyiBatchTableSchema.pb").DyiBatchTableSchemaProtoSpec,a).readByteArray()}}function J(a){a={maxMsgExternalId:a.maxMsgExternalId,maxMsgSortOrderMs:a.maxMsgSortOrderMs,minMsgExternalId:a.minMsgExternalId,minMsgSortOrderMs:a.minMsgSortOrderMs};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloEBMsgRangesTableSchema.pb").EBMsgRangesTableSchemaProtoSpec,a).readByteArray()}}function K(a){a={msgId:a.msgId};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloRetroactiveBackupsStateTableSchema.pb").RetroactiveBackupsStateTableSchemaProtoSpec,a).readByteArray()}}function L(a){var b=a.ctas==null?[]:a.ctas.map(function(a){return d("MAWXMACTAUtil").toMAWCTAEncode(a)});b={author:a.author,ctas:b,defaultCTA:a.defaultCTA==null?a.defaultCTA:d("MAWXMACTAUtil").toMAWCTAEncode(a.defaultCTA),headerTitle:a.headerTitle,isTombstoned:a.isTombstoned,maxSubtitleNumOfLines:a.maxSubtitleNumOfLines,maxTitleNumOfLines:a.maxTitleNumOfLines,msgId:a.msgId,overlayDescription:a.overlayDescription,overlayIconGlyph:a.overlayIconGlyph,overlayTitle:a.overlayTitle,previewMediaIds:a.previewMediaIds,subtitleText:a.subtitleText,targetId:a.targetId,targetType:a.targetType,targetUsername:a.targetUsername,threadJid:a.threadJid,titleText:a.titleText,xmaLayoutType:a.xmaLayoutType};return{encodedFields:b,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloXMATableSchema.pb").XMATableSchemaProtoSpec,b).readByteArray()}}function M(a){a={author:a.author,editExternalId:a.editExternalId,editTs:a.editTs,msgContent:a.msgContent,sendStatus:a.sendStatus,specialTextSize:a.specialTextSize};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloEditMsgHistoryTableSchema.pb").EditMsgHistoryTableSchemaProtoSpec,a).readByteArray()}}g.encodeDbObj=e}),98);
__d("MAWDbObjEncryption",["MAWBridge","MAWCryptoConsts","MAWDbObjDecode","MAWDbObjEncode","MAWIndexedDb","MAWKeychainCrypto","MAWKeychainNaClCrypto","MAWKeychainUtil","MAWQplProxy","MWEARKeychainV3Errors","err","gkx","isEncryptionAtRestEnabled","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h=1/1e3,i="_encryptedContent";function a(a,b,e){if(!(c("isEncryptionAtRestEnabled")()||c("gkx")("23910")===!0)||!d("MAWIndexedDb").TABLES_TO_ENCRYPT.includes(b))return a;var f=Math.random()<h;f=f?d("MAWQplProxy").startQplUserFlow(c("qpl")._(25300256,"115")):null;try{var g=babelHelpers["extends"]({},a);e=e();var j=e.key;e=e.version;e=d("MAWKeychainUtil").makeAAD(e,d("MAWCryptoConsts").CIPHER_ID);var k=d("MAWDbObjEncode").encodeDbObj(a,b),l=k.encodedFields;k=k.proto;Object.keys(l).forEach(function(b){Object.prototype.hasOwnProperty.call(a,b)&&delete g[b]});l=d("MAWKeychainNaClCrypto").encrypt(j,k,e);g[i]=l;f==null?void 0:f.endSuccess();return g}catch(a){f==null?void 0:f.endFail("ear_encrypt_fail");throw c("err")(a.message+" - Encrypted dexie was unable to encrypt an entity for table "+b)}}function b(a,b,e){if(!d("MAWIndexedDb").TABLES_TO_ENCRYPT.includes(b)||!Object.prototype.hasOwnProperty.call(a,i))return a;var f=Math.random()<h;f=f?d("MAWQplProxy").startQplUserFlow(c("qpl")._(25313004,"118")):null;try{var g=a[i];a=babelHelpers["extends"]({},a);var j=d("MAWKeychainCrypto").getKeyVersionFromCipherDataString(g);e=e(j);e=e.key;var k={};e=d("MAWKeychainNaClCrypto").decrypt(e,g,j);var l=d("MAWDbObjDecode").decodeDbObj(e,b);Object.keys(l).forEach(function(a){k[a]=l[a]});delete a[i];g=babelHelpers["extends"]({},a,k);f==null?void 0:f.endSuccess();return g}catch(a){f==null?void 0:f.endFail("ear_decrypt_fail");(a instanceof d("MAWKeychainNaClCrypto").EARDecryptionError||a instanceof d("MWEARKeychainV3Errors").EARKeychainNotFoundError)&&(d("MAWIndexedDb").deleteDb(),c("gkx")("23931")&&d("MAWBridge").getBridge().fireAndForget("event","earDecryptionFailure",{tableName:b}));throw c("err")(a.message+" - Encrypted dexie was unable to decrypt an entity for table "+b)}}g.ENCRYPTED_COLUMN_NAME=i;g.encryptDbObj=a;g.decryptDbObj=b}),98);
__d("MAWDbInitIndexedDb",["MAWIndexedDb","MWEARKeychainV3","WALogger","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[DB INIT] REGULAR DB INIT"]);h=function(){return a};return a}function a(){d("WALogger").LOG(h());return d("MAWIndexedDb").makeDB(d("MWEARKeychainV3").getDbEncryptionKey,{enableDataSyncMiddleware:!0,enableMutationValidator:c("gkx")("1627")})}g.dbInit=a}),98);
__d("MAWReStoreMigrationUtils",["Deferred","MAWDbObjEncryption","MAWDbSchema.restore","MWEARKeychainV3","Promise","WATagsLogger","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error fetching batch: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["REQUESTING ",""]);j=function(){return a};return a}var k=d("WATagsLogger").TAGS(["DBInit","Migration"]),l=new Map(d("MAWDbSchema.restore").clientSchema.map(function(a){return[a.name,a]}));function a(a){return new(h||(h=b("Promise")))(function(b,c){var d=indexedDB.open(a);d.onupgradeneeded=function(a){a.target.transaction.abort(),b(null)};d.onerror=function(a){c("Error opening database: "+a.target.error)};d.onsuccess=function(a){a=a.target.result;b(a)}})}function e(a){var b=new(c("Deferred"))();a=indexedDB.deleteDatabase(a);a.onsuccess=function(){return b.resolve()};a.onerror=function(a){return b.reject(a)};return b.getPromise()}function f(a,c){var e=a.transaction("appMeta").objectStore("appMeta");return new(h||(h=b("Promise")))(function(a,b){var f=e.get(c);f.onsuccess=function(b){b=b.target.result;if(b==null){a();return}a(d("MAWDbObjEncryption").decryptDbObj(b,"appMeta",d("MWEARKeychainV3").getDbEncryptionKey))};f.onerror=function(a){k.LOG(j(),a),b(a)}})}function m(a,c,e){if(a==null)return(h||(h=b("Promise"))).resolve();var f=a.transaction("appMeta","readwrite").objectStore("appMeta");return new(h||(h=b("Promise")))(function(a,b){var g;g=f.put(d("MAWDbObjEncryption").encryptDbObj({key:c,value:(g={},g[c]=e,g)},"appMeta",d("MWEARKeychainV3").getDbEncryptionKey));g.onsuccess=function(){a()};g.onerror=function(a){b(a)}})}function n(a,c){return new(h||(h=b("Promise")))(function(b,d){var e=a.transaction(c).objectStore(c);e=e.count();e.onsuccess=function(a){b(a.target.result)};e.onerror=function(a){d(a)}})}function o(a,c){var d="e2ee_"+c;c=l.get(d);return c==null?(h||(h=b("Promise"))).resolve(-1):a.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=new WeakMap();a=(yield a[d].keys(b,"asc",void 0));b=0;var c=(yield a.next());while(!c.done)b++,c=(yield a.next());return b});return function(b){return a.apply(this,arguments)}}(),"readonly")}function p(a,d){var e=100,f=[];return new(h||(h=b("Promise")))(function(b){if(d==null){b([]);return}var g=a==null?d.openCursor():d.openCursor(IDBKeyRange.lowerBound(a,!0));g.onsuccess=function(a){a=a.target.result;a&&f.length<e?(f.push([a.key,a.value]),a["continue"]()):b(f)};g.onerror=function(a){k.ERROR(i(),a.target.error);throw c("err")("Error opening cursor: "+a.target.error)}})}function q(a,c){return new(h||(h=b("Promise")))(function(b){var d=a.transaction([c],"readwrite"),e=d.objectStore(c);e.add({}).onsuccess=function(a){b(a.target.result);try{d.abort()}catch(a){}}})}g.getDBForMigration=a;g.deleteDB=e;g.fetchAppMetaKey=f;g.putAppMetaKey=m;g.indexedDBCount=n;g.restoreCount=o;g.fetchIDBBatch=p;g.getNextKey=q}),98);
__d("LSQueryBulkUtils",["ReQL"],(function(a,b,c,d,e,f,g){"use strict";async function a(a,b){b=await Promise.all(b.map(function(b){return d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a).getKeyRange(b))}));return b.flat()}async function b(a,b){await Promise.all(b.map(function(b){return a.put(b)}));return b}g.bulkGetByIndex=a;g.bulkPut=b}),98);
__d("MAWRestoreDbMigration",["I64","LSQueryBulkUtils","MAWDbAppMeta","MAWDbObjEncryption","MAWDbSchema.restore","MAWReStoreDbSetup","MAWReStoreMigrationUtils","MAWRestoreDbState","MWEARKeychainV3","WATagsLogger","err","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Incrementing failed migration counter: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Incrementing failure count as executeMigration returned false"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Marking DB as not needing migration in the future."]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Migration completed with status: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Starting DB migration"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Previous migration attempt purged"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Purging previous migration attempt"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Skipping due to previous failures"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Migration is currently disabled, skipping the attempt"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["Already migrated db, no need to migrate"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["Skipping due to source db not existing"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["Checking if we need to migrate the database"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["Completing migration"]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["Data counts match.... completing migration"]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["Data moved, checking for consistency"]);w=function(){return a};return a}function x(){var a=babelHelpers.taggedTemplateLiteralLoose(["Moving data"]);x=function(){return a};return a}var y=d("WATagsLogger").TAGS(["DBInit","Migration"]),z=c("justknobx")._("1864"),A=c("justknobx")._("1871"),B=new Map(d("MAWDbSchema.restore").clientSchema.map(function(a){return[a.name,a]})),C=function(a){return new Promise(function(b){return setTimeout(b,a)})};function D(){return d("MAWRestoreDbState").getTargetDbState()==="restore"?!0:c("gkx")("23908")}async function E(a,b,c){if(b==null)return;var e="e2ee_"+c,f=await d("MAWReStoreMigrationUtils").fetchIDBBatch(null,b.transaction(c).objectStore(c)),g=B.get(e)||{},i=g.auto_increment;g=g.primary_key;g=(g=g)!=null?g:[];var j=g[0];g=async function(){var g=f.map(function(a){a[0];a=a[1];a=babelHelpers.extends({},d("MAWDbObjEncryption").decryptDbObj(a,c,d("MWEARKeychainV3").getDbEncryptionKey));j!=null&&i===!0&&(a[j]=(h||(h=d("I64"))).of_int32(a[j]));return a});await a.runInTransaction(async function(a){await d("LSQueryBulkUtils").bulkPut(a[e],g)},"readwrite");a.clearCacheIfSupported==null?void 0:a.clearCacheIfSupported();f=await d("MAWReStoreMigrationUtils").fetchIDBBatch(f[f.length-1][0],b.transaction(c).objectStore(c))};while(f.length)await g();if(i===!0){g=await d("MAWReStoreMigrationUtils").getNextKey(b,c);var k=(h||(h=d("I64"))).of_int32(g);await a.runInTransaction(async function(a){var b;await a[e].add((b={},b[j]=k,b));await a[e].delete(k)},"readwrite")}}async function F(a,b,e){var f=Array.from(a.objectStoreNames).filter(function(a){return B.has("e2ee_"+a)});y.LOG(x());e==null?void 0:e.addPoint("table-migration-start");await f.reduce(function(c,d){return c.then(function(){return E(b,a,d)})},Promise.resolve());e==null?void 0:e.addPoint("table-migration-end");y.LOG(w());e==null?void 0:e.addPoint("data-verification-start");f=await f.reduce(function(c,e){return c.then(async function(c){var f=await Promise.all([d("MAWReStoreMigrationUtils").indexedDBCount(a,e),d("MAWReStoreMigrationUtils").restoreCount(b,e)]),g=f[0];f=f[1];b.clearCacheIfSupported==null?void 0:b.clearCacheIfSupported();return[].concat(c,[[e,g===f]])})},Promise.resolve([]));if(!f.every(function(a){a=a[1];return a})){f=f.filter(function(a){a=a[1];return!a}).map(function(a){a=a[0];return a});throw c("err")("count mismatch: "+f.join(",")+" ")}y.LOG(v());e==null?void 0:e.addPoint("data-verification-end");y.LOG(u());return!0}async function G(){var a;a=await ((a=navigator.storage)==null?void 0:a.estimate==null?void 0:a.estimate());return(a=a==null?void 0:a.usage)!=null?a:0}async function a(a,b,e){y.LOG(t());e==null?void 0:e.addPoint("open-source-db-start");a=await d("MAWReStoreMigrationUtils").getDBForMigration(a);e==null?void 0:e.addPoint("open-source-db-end");e==null?void 0:e.addAnnotations({bool:{shouldRunMigration:a!=null},int:{storageSize:await G()}});if(a==null){y.LOG(s());e==null?void 0:e.addAnnotations({string:{migrationSkipReason:"new-indexeddb"}});return!0}var f=await Promise.all([d("MAWReStoreMigrationUtils").fetchAppMetaKey(a,d("MAWDbAppMeta").AppMetaKeysEnum.restoreMigrationAttempts),d("MAWReStoreMigrationUtils").fetchAppMetaKey(a,d("MAWDbAppMeta").AppMetaKeysEnum.hasMigratedFromDexie)]),g=f[0];f=f[1];g=(g=g==null?void 0:(g=g.value)==null?void 0:g.restoreMigrationAttempts)!=null?g:0;f=(f=f==null?void 0:(f=f.value)==null?void 0:f.hasMigratedFromDexie)!=null?f:!1;if(f===!0){y.LOG(r());e==null?void 0:e.addAnnotations({string:{migrationSkipReason:"previously-migrated"}});a.close();return!0}if(!D()){y.LOG(q());e==null?void 0:e.addAnnotations({string:{migrationSkipReason:"migration-disabled"}});a.close();return!1}if(g>A){e==null?void 0:e.addAnnotations({string:{migrationSkipReason:"exceeded-max-attempts"}});y.LOG(p());a.close();return!1}e==null?void 0:e.addPoint("checking-target-db-start");f=await d("MAWReStoreMigrationUtils").getDBForMigration(b);f!=null&&(y.LOG(o()),e==null?void 0:e.addAnnotations({bool:{purgedPreviousAttempt:!0}}),f.close(),await d("MAWReStoreDbSetup").closeDB(),await d("MAWReStoreMigrationUtils").deleteDB(b),y.LOG(n()));e==null?void 0:e.addPoint("checking-target-db-end");try{y.LOG(m());f=await d("MAWReStoreDbSetup").getDB();b=await Promise.race([C(z).then(function(){throw c("err")("timeout")}),F(a,f,e)]).then(function(a){return typeof a==="boolean"?a:!1});y.LOG(l(),b);b?(y.LOG(k()),await d("MAWReStoreMigrationUtils").putAppMetaKey(a,d("MAWDbAppMeta").AppMetaKeysEnum.hasMigratedFromDexie,!0)):(y.LOG(j()),await d("MAWReStoreMigrationUtils").putAppMetaKey(a,d("MAWDbAppMeta").AppMetaKeysEnum.restoreMigrationAttempts,g+1));return b}catch(b){a!=null&&(y.LOG(i(),b),await d("MAWReStoreMigrationUtils").putAppMetaKey(a,d("MAWDbAppMeta").AppMetaKeysEnum.restoreMigrationAttempts,g+1));throw b}finally{a==null?void 0:a.close()}}g.migrateToRestoreFromDexie=a}),98);
__d("MAWDbInitReStore",["MAWCurrentUser","MAWIndexedDb","MAWIndexedDbMetadata","MAWReStoreDbSetup","MAWReStoreMigrationUtils","MAWRestoreDbMigration","MAWRestoreDbState","MAWSendQplToServer","MWEARKeychainV3","ReStoreIDBFactory","WATagsLogger","asyncToGeneratorRuntime","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Running shimmed db init"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Running original db init"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to clean up restored db: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cleaned up restored db"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to migrate to restore from dexie: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["ReStore DB initializing"]);m=function(){return a};return a}var n=d("WATagsLogger").TAGS(["DBInit","ReStore"]);function a(){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){n.LOG(m());var a=d("MAWCurrentUser").getID();a=d("MAWIndexedDbMetadata").dbName(a);var e=d("MAWIndexedDbMetadata").restoreDbName2(d("MAWCurrentUser").getID()),f=d("MAWSendQplToServer").startQplUserFlow(c("qpl")._(1056845565,"194"),{string:{version:"encrypted_dexie"}}),g=!1;try{f.addPoint("migrate-db"),g=(yield d("MAWRestoreDbMigration").migrateToRestoreFromDexie(a,e,f)),f.endSuccess()}catch(a){f.endFail(""+a),n.ERROR(l(),a)}d("MAWRestoreDbState").setIsUsingShim(g);if(!g){c("promiseDone")(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("MAWReStoreDbSetup").closeDB(),yield d("MAWReStoreMigrationUtils").deleteDB(e)})(),function(){n.LOG(k())},function(a){n.ERROR(j(),a)});n.LOG(i());return d("MAWIndexedDb").makeDB(d("MWEARKeychainV3").getDbEncryptionKey,{enableDataSyncMiddleware:!0,shimEnabled:!1})}a=new(d("ReStoreIDBFactory").ReStoreIDBFactory)(yield d("MAWReStoreDbSetup").getDB());n.LOG(h());return d("MAWIndexedDb").makeDB(void 0,{IDBKeyRange:d("ReStoreIDBFactory").ReStoreIDBKeyRange,enableDataSyncMiddleware:!0,indexedDB:a,shimEnabled:!0})});return o.apply(this,arguments)}g.dbInit=a}),98);
__d("MAWDbEditMsgHistory",["I64"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return a}function b(a){return(h||(h=d("I64"))).of_float(a)}function c(a){return(h||(h=d("I64"))).to_float(a)}g.unsafeCoerceToEditMsgHistoryId=a;g.convertToEditMsgHistoryId64=b;g.convertToEditMsgHistoryId=c}),98);
__d("MAWDbParticipant",["MAWODSProxy","WAOdsEnums"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_THREADID_DEPRECATION_DETAILS,key:"craftParticipantId"});return a+"_"+b}function b(a,b){return a+"_"+b}g.craftParticipantId__DEPRECATED=a;g.craftParticipantId=b}),98);
__d("MAWDbMsgTypeVersionTxns",["MAWDbAppMeta","MAWDexieTable"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return a.appMeta.get({key:d("MAWDbAppMeta").AppMetaKeysEnum.msgTypeVersion}).then(function(a){return a==null?void 0:a.value.msgTypeVersion})}function b(a,b){return a.appMeta.add({key:d("MAWDbAppMeta").AppMetaKeysEnum.msgTypeVersion,value:{msgTypeVersion:b}})}function c(a,b){return a.appMeta.put({key:d("MAWDbAppMeta").AppMetaKeysEnum.msgTypeVersion,value:{msgTypeVersion:b}})}function e(a,b){return a.appMeta.add({key:d("MAWDbAppMeta").AppMetaKeysEnum.hmacKey,value:{hmacKey:b}})}function f(a){return a.appMeta.get({key:d("MAWDbAppMeta").AppMetaKeysEnum.hmacKey}).then(function(a){return a==null?void 0:a.value.hmacKey})}function i(a,b){return a.appMeta.get({key:b})}function j(a,b){return a.appMeta.put({key:d("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlert,value:{allowSecurityAlert:b}}).then(function(){})}function k(a,b){return a.appMeta.put({key:d("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlertForSelf,value:{allowSecurityAlertForSelf:b}}).then(function(){})}function l(a){return i(a,d("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlert).then(function(a){return(a=a==null?void 0:a.value.allowSecurityAlert)!=null?a:!1})}function m(a){return i(a,d("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlertForSelf).then(function(a){return(a=a==null?void 0:a.value.allowSecurityAlertForSelf)!=null?a:!0})}function n(a,b){return a.appMeta.add({key:d("MAWDbAppMeta").AppMetaKeysEnum.hotlikeSticker,value:{hotlikeSticker:b}})}function o(a){return d("MAWDexieTable").dexieAll([m(a),l(a)]).then(function(a){var b=a[0];a=a[1];return{allowSecurityAlertForContact:a,allowSecurityAlertForSelf:b}})}g.MSG_TYPE_VERSION=(h=d("MAWDbAppMeta")).AppMetaKeysEnum.msgTypeVersion;g.ALLOW_SECURITY_ALERT_FOR_CONTACT=h.AppMetaKeysEnum.allowSecurityAlert;g.ALLOW_SECURITY_ALERT_FOR_SELF=h.AppMetaKeysEnum.allowSecurityAlertForSelf;g.HOT_LIKE=h.AppMetaKeysEnum.hotlikeSticker;g.getMsgTypeVersion=a;g.addMsgTypeVersion=b;g.updateMsgTypeVersion=c;g.addHMACKey=e;g.getHMACKey=f;g.getAppMetaValue=i;g.updateSecurityAlertValueForContact=j;g.updateSecurityAlertValueForSelf=k;g.getSecuritySettingForContact=l;g.getSecuritySettingForSelf=m;g.addHotLike=n;g.maybeBulkGetSecuritySetting=o}),98);
__d("MAWHMACKey",["MAWCryptoConsts","MAWDbMsgTypeVersionTxns","MAWIndexedDb","MAWKeychainUtil","MAWSubtleCrypto","MAWTransactionMode","WABase64","tweetnacl-auth"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=d("MAWKeychainUtil").getBufferWithRandomValuesFromLength(d("MAWCryptoConsts").HKDF_SEED_LENGTH_IN_BYTES);return i(a).then(function(a){return d("MAWSubtleCrypto").MAWSubtleCrypto.exportKey("raw",a)})}function a(a,b){a=new TextEncoder().encode(a);b=new Uint8Array(b);a=c("tweetnacl-auth")(a,b);return d("WABase64").encodeB64UrlSafe(a)}function b(){return h().then(function(a){return d("MAWIndexedDb").makeMsgrTransactor({appMeta:d("MAWTransactionMode").READWRITE},"generateAndInsertHMACKey",function(b){return function(){return d("MAWDbMsgTypeVersionTxns").getHMACKey(b).then(function(c){return c!=null?c:d("MAWDbMsgTypeVersionTxns").addHMACKey(b,a).then(function(){return a})})}})()})}function i(a){return d("MAWSubtleCrypto").MAWSubtleCrypto.importKey("raw",a,{hash:"SHA-256",name:"HMAC"},!0,["sign"])}g.genHMACKey=h;g.hmacTweetNaCl=a;g.generateAndInsertHMACKey=b}),98);
__d("WAConcurrentIterate",["Promise","regeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";var g;function a(a,c,d){var e=[],f=[],h=0,i=function(){var d;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:if(!(h<a)){e.next=8;break}d=h;h++;e.next=5;return b("regeneratorRuntime").awrap(c(d));case 5:f[d]=e.sent;e.next=0;break;case 8:case"end":return e.stop()}},null,this)};d=Math.min(a,d);for(var j=0;j<d;j++)e.push(i());return(g||(g=b("Promise"))).all(e).then(function(){return f})}f.concurrentIterate=a}),66);
__d("WATypedArraysCast",["WABase64"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(b instanceof a)return b;return typeof b==="string"?new a(d("WABase64").decodeB64(b)):new a(b)}g.castTypedArrays=a}),98);
__d("WACryptoHmac",["WACryptoDependencies","WATypedArraysCast"],(function(a,b,c,d,e,f,g){"use strict";var h=32,i=new Uint8Array(h),j={name:"HMAC",hash:"SHA-256"},k={name:"HMAC",hash:"SHA-512"},l={name:"HMAC",hash:"SHA-1"};function m(a,b){b=d("WATypedArraysCast").castTypedArrays(Uint8Array,b);return d("WACryptoDependencies").getCrypto().subtle.importKey("raw",b,a,!1,["sign"]).then(function(b){return{key:b,algo:a}})}function a(a){return m(j,a)}function n(a,b,c){var e=a.key;a=a.algo;return d("WACryptoDependencies").getCrypto().subtle.sign(a,e,b).then(function(a){return c!=null&&c!==0?a.slice(0,c):a})}function b(a,b){return m(j,a!=null?a:i).then(function(a){return n(a,b)})}function c(a,b,c){return m(j,a).then(function(a){return n(a,b,c)})}function e(a,b,c){return m(k,a).then(function(a){return n(a,b,c)})}function f(a,b,c){return m(l,a).then(function(a){return n(a,b,c)})}g.SHA256_BYTE_LENGTH=h;g.DEFAULT_SALT=i;g.encodeKeySha256=a;g.sign=n;g.extractSha256=b;g.hmacSha256=c;g.hmacSha512=e;g.hmacSha1=f}),98);
__d("WAMediaCryptoSidecar",["WAConcurrentIterate","WACryptoHmac"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return a==="video"}function b(a){return a}var h=16,i=10,j=64*1024;function c(a,b,c){c===void 0&&(c=1);var e=b.buffer.byteLength;e=Math.ceil((e-h)/j);var f=new Uint8Array(i*e);return d("WAConcurrentIterate").concurrentIterate(e,function(c){var e=c*j,g=e+h+j;e=b.subarray(e,g);return d("WACryptoHmac").sign(a,e).then(function(a){a=new Uint8Array(a,0,i);f.set(a,c*i)})},c).then(function(){return f.buffer})}g.shouldHaveStreamingSidecar=a;g.castToStreamingSidecar=b;g.calculateStreamingSidecar=c}),98);
__d("WAMediaEntryData.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};a.internalSpec={fileSha256:[1,(e=d("WAProtoConst")).TYPES.BYTES],mediaKey:[2,e.TYPES.BYTES],fileEncSha256:[3,e.TYPES.BYTES],directPath:[4,e.TYPES.STRING],mediaKeyTimestamp:[5,e.TYPES.INT64],serverMediaType:[6,e.TYPES.STRING],uploadToken:[7,e.TYPES.BYTES],validatedTimestamp:[8,e.TYPES.BYTES],sidecar:[9,e.TYPES.BYTES],objectId:[10,e.TYPES.STRING],fbid:[11,e.TYPES.STRING],downloadableThumbnail:[12,e.TYPES.MESSAGE,c],handle:[13,e.TYPES.STRING],filename:[14,e.TYPES.STRING],progressiveJpegDetails:[15,e.TYPES.MESSAGE,b]};b.internalSpec={scanLengths:[1,e.FLAGS.REPEATED|e.TYPES.UINT32],sidecar:[2,e.TYPES.BYTES]};c.internalSpec={fileSha256:[1,e.TYPES.BYTES],fileEncSha256:[2,e.TYPES.BYTES],directPath:[3,e.TYPES.STRING],mediaKey:[4,e.TYPES.BYTES],mediaKeyTimestamp:[5,e.TYPES.INT64],objectId:[6,e.TYPES.STRING]};g.MediaEntrySpec=a;g.MediaEntry$ProgressiveJpegDetailsSpec=b;g.MediaEntry$DownloadableThumbnailSpec=c}),98);
__d("WAProgressiveJpegMarkers",[],(function(a,b,c,d,e,f){"use strict";a=255;b=0;c={SOF0:192,SOF1:193,SOF2:194,SOF3:195,DHT:196,SOF5:197,SOF6:198,SOF7:199,JPG:200,SOF9:201,SOF10:202,SOF11:203,SOF13:205,SOF14:206,SOF15:207,RST0:208,RST1:209,RST2:210,RST3:211,RST4:212,RST5:213,RST6:214,RST7:215,SOI:216,EOI:217,SOS:218,DQT:219,DRI:221,APP0:224,APP1:225,APP2:226,APP3:227,APP4:228,APP5:229,APP6:230,APP7:231,APP8:232,APP9:233,APP10:234,APP11:235,APP12:236,APP13:237,APP14:238,APP15:239,COM:254,TEM:1};d=[b,c.RST0,c.RST1,c.RST2,c.RST3,c.RST4,c.RST5,c.RST6,c.RST7];f.MARKER_PREFIX=a;f.MARKER_ESCAPE_BYTE=b;f.MARKERS=c;f.SOS_STREAM=d}),66);
__d("WAProgressiveJpegGetScanOffsets",["WAProgressiveJpegMarkers","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Non-progressive JPEG marker found"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Ending marker found before end of image"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Scan found at offset ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Not a JPEG image"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["starting"]);l=function(){return a};return a}var m=d("WATagsLogger").TAGS(["media","progressiveJpegUtils"]);function a(a){m.DEV(l());if(!n(a)){m.DEV(k());return[]}var b=[],c=2,e="READ_MARKER_FIRST_BYTE_OR_ENTROPY_DATA",f=null,g=0,r=!1,s=!1,t=!1;function u(){t=!1,m.DEV(j(),c-1),b.push(c-1)}while(c<a.byteLength){f=a[c];if(r){m.ERROR(i());return[]}switch(e){case"READ_MARKER_FIRST_BYTE_OR_ENTROPY_DATA":f===d("WAProgressiveJpegMarkers").MARKER_PREFIX&&(e="READ_MARKER_SECOND_BYTE");break;case"READ_MARKER_SECOND_BYTE":if(f===d("WAProgressiveJpegMarkers").MARKER_PREFIX)e="READ_MARKER_SECOND_BYTE";else if(f===d("WAProgressiveJpegMarkers").MARKER_ESCAPE_BYTE)e="READ_MARKER_FIRST_BYTE_OR_ENTROPY_DATA";else if(f===d("WAProgressiveJpegMarkers").MARKERS.EOI)r=!0,t&&u();else if(!s&&p(f)){m.LOG(h());return[]}else o(f)?(s=!0,e="READ_MARKER_FIRST_BYTE_OR_ENTROPY_DATA"):(t&&u(),f===d("WAProgressiveJpegMarkers").MARKERS.SOS&&(t=!0),q(f)?e="READ_SIZE_FIRST_BYTE":e="READ_MARKER_FIRST_BYTE_OR_ENTROPY_DATA");break;case"READ_SIZE_FIRST_BYTE":e="READ_SIZE_SECOND_BYTE";break;case"READ_SIZE_SECOND_BYTE":c+=g*256;c+=f;c-=2;e="READ_MARKER_FIRST_BYTE_OR_ENTROPY_DATA";break}c+=1;g=f}return b}function n(a){if(a.byteLength<=2)return!1;if(a[0]!==d("WAProgressiveJpegMarkers").MARKER_PREFIX)return!1;return a[1]!==d("WAProgressiveJpegMarkers").MARKERS.SOF2&&a[1]!==d("WAProgressiveJpegMarkers").MARKERS.SOI?!1:!0}function o(a){return a===d("WAProgressiveJpegMarkers").MARKERS.SOF2||a===d("WAProgressiveJpegMarkers").MARKERS.SOF6||a===d("WAProgressiveJpegMarkers").MARKERS.SOF10||a===d("WAProgressiveJpegMarkers").MARKERS.SOF14}function p(a){return a===d("WAProgressiveJpegMarkers").MARKERS.SOF0||a===d("WAProgressiveJpegMarkers").MARKERS.SOF1||a===d("WAProgressiveJpegMarkers").MARKERS.SOF3||a===d("WAProgressiveJpegMarkers").MARKERS.SOF5||a===d("WAProgressiveJpegMarkers").MARKERS.SOF7||a===d("WAProgressiveJpegMarkers").MARKERS.JPG||a===d("WAProgressiveJpegMarkers").MARKERS.SOF9||a===d("WAProgressiveJpegMarkers").MARKERS.SOF11||a===d("WAProgressiveJpegMarkers").MARKERS.SOF13||a===d("WAProgressiveJpegMarkers").MARKERS.SOF15}function q(a){if(a===d("WAProgressiveJpegMarkers").MARKERS.TEM)return!1;return a>=d("WAProgressiveJpegMarkers").MARKERS.RST0&&a<=d("WAProgressiveJpegMarkers").MARKERS.RST7?!1:a!==d("WAProgressiveJpegMarkers").MARKERS.EOI&&a!==d("WAProgressiveJpegMarkers").MARKERS.SOI}g.getProgressiveJpegScanOffsets=a}),98);
__d("WAProgressiveJpegGetScanLengths",["WAProgressiveJpegGetScanOffsets"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=d("WAProgressiveJpegGetScanOffsets").getProgressiveJpegScanOffsets(a);return h(a)}function b(a){return a}function h(a){var b=[],c=0;for(var d=0;d<a.length;d++){var e=a[d];b.push(e-c);c=e}return b}g.getProgressiveJpegScanLengths=a;g.asProgressiveJpegScanLength=b}),98);
__d("WAServerMediaType",["WAAssertUnreachable"],(function(a,b,c,d,e,f,g){"use strict";d=["image","sticker","ptt","audio","document","video","gif","ppic","md-app-state","md-msg-hist","kyc-id","template","thumbnail-image","thumbnail-video","thumbnail-gif","thumbnail-document","thumbnail-link","payment-bg-image","novi-video","novi-image","product","product-catalog-image","xma-image","biz-cover-photo","preview","newsletter-audio","newsletter-document","newsletter-image","newsletter-gif","newsletter-ptt","newsletter-sticker","newsletter-thumbnail-link","newsletter-video"];function a(a){switch(a){case"image":case"sticker":case"ptt":case"audio":case"document":case"video":case"gif":case"ppic":case"md-app-state":case"md-msg-hist":case"kyc-id":case"thumbnail-image":case"thumbnail-video":case"thumbnail-gif":case"thumbnail-document":case"thumbnail-link":case"payment-bg-image":case"novi-video":case"novi-image":case"template":case"product":case"product-catalog-image":case"xma-image":case"biz-cover-photo":case"preview":case"newsletter-audio":case"newsletter-document":case"newsletter-image":case"newsletter-gif":case"newsletter-ptt":case"newsletter-sticker":case"newsletter-thumbnail-link":case"newsletter-video":return a;default:return null}}function b(a){switch(a){case"Image":return"image";case"Video":return"video";case"Ptt":return"ptt";case"Gif":return"gif";case"Sticker":return"sticker";case"DocumentFile":return"document";case"Text":case"Futureproof":case"Ciphertext":case"Unavailable":case"ExpiredEphemeral":case"Admin":case"Revoked":case"DeleteForMe":case"EphemeralSettingAdmin":case"EphemeralSyncResponse":case"EphemeralSettingChangeFromCurrentDevice":case"AlertICDC":case"GroupInvite":case"SenderKeyDistribution":case"Reaction":case"EditAction":return null;default:return c("WAAssertUnreachable")(a)}}g.SERVER_MEDIA=d;g.castToServerMediaType=a;g.getMediaType=b}),98);
__d("WAMediaUtils",["Promise","WABase64","WACryptoDependencies","WAErr","WALongInt","WAMediaCryptoSidecar","WAMediaEntryData.pb","WAProgressiveJpegGetScanLengths","WAServerMediaType","WATimeUtils","decodeProtobuf","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=new Uint8Array(32);d("WACryptoDependencies").getCrypto().getRandomValues(a);return a.buffer}function j(a){return a}function a(){return i()}function k(a){return a}function e(a,b){return d("WABase64").encodeB64UrlSafe(a,b)}function f(a){return a}function l(a){return a}function m(a){return a}function n(a){return a}function o(a,b){a=d("decodeProtobuf").decodeProtobuf(d("WAMediaEntryData.pb").MediaEntrySpec,b);b=a.fileSha256;var c=a.mediaKey,e=a.fileEncSha256,f=a.directPath,g=a.mediaKeyTimestamp,h=a.sidecar,i=a.objectId,j=a.fbid,k=a.serverMediaType,l=a.downloadableThumbnail,m=a.filename;a=a.progressiveJpegDetails;return{fileSha256:b,mediaKey:c,fileEncSha256:e,directPath:f,mediaKeyTimestamp:g==null?null:d("WATimeUtils").castToUnixTime(d("WALongInt").numberOrThrowIfTooLarge(g)),sidecar:h&&d("WAMediaCryptoSidecar").castToStreamingSidecar(h),objectId:i,fbid:j,downloadableThumbnail:l&&w(l),serverMediaType:k,filename:m,progressiveJpegDetails:a&&x(a)}}function p(a,b,c,e,f,g,h,i,j,k,l){a=d("encodeProtobuf").encodeProtobuf(d("WAMediaEntryData.pb").MediaEntrySpec,{fileSha256:a,fileEncSha256:b,mediaKey:c,directPath:e,mediaKeyTimestamp:f,serverMediaType:g,objectId:h,fbid:i,downloadableThumbnail:j,filename:k,progressiveJpegDetails:l});return a.readByteArray()}function q(a){return d("encodeProtobuf").encodeProtobuf(d("WAMediaEntryData.pb").MediaEntrySpec,a).readByteArray()}function r(a){return d("encodeProtobuf").encodeProtobuf(d("WAMediaEntryData.pb").MediaEntrySpec,a).readByteArray()}function s(a,b){return d("encodeProtobuf").encodeProtobuf(d("WAMediaEntryData.pb").MediaEntrySpec,babelHelpers["extends"]({},a,{directPath:b})).readByteArray()}function t(a,b){return d("encodeProtobuf").encodeProtobuf(d("WAMediaEntryData.pb").MediaEntrySpec,babelHelpers["extends"]({},a,{downloadableThumbnail:babelHelpers["extends"]({},a.downloadableThumbnail,{directPath:b})})).readByteArray()}function u(a,b){a=babelHelpers["extends"]({},a,{fbid:b});return d("encodeProtobuf").encodeProtobuf(d("WAMediaEntryData.pb").MediaEntrySpec,a).readByteArray()}function v(a,b){a=babelHelpers["extends"]({},a,{objectId:b});return d("encodeProtobuf").encodeProtobuf(d("WAMediaEntryData.pb").MediaEntrySpec,a).readByteArray()}function w(a){if(a==null)return null;a.$$unknownFieldCount;var b=babelHelpers.objectWithoutPropertiesLoose(a,["$$unknownFieldCount"]);return babelHelpers["extends"]({},b,{mediaKey:a.mediaKey&&j(a.mediaKey),mediaKeyTimestamp:a.mediaKeyTimestamp==null?null:d("WATimeUtils").castToUnixTime(d("WALongInt").numberOrThrowIfTooLarge(a.mediaKeyTimestamp))})}function x(a){if(a==null)return null;return a.scanLengths==null||a.sidecar==null?null:{sidecar:a.sidecar,scanLengths:a.scanLengths.map(function(a){return d("WAProgressiveJpegGetScanLengths").asProgressiveJpegScanLength(d("WALongInt").numberOrThrowIfTooLarge(a))})}}function y(a){a=d("decodeProtobuf").decodeProtobuf(d("WAMediaEntryData.pb").MediaEntrySpec,a);var b=a.serverMediaType,c=a.mediaKey,e=a.mediaKeyTimestamp,f=a.uploadToken,g=a.downloadableThumbnail,h=a.progressiveJpegDetails;a=babelHelpers.objectWithoutPropertiesLoose(a,["serverMediaType","mediaKey","mediaKeyTimestamp","uploadToken","downloadableThumbnail","progressiveJpegDetails"]);var i=null;h!=null&&h.scanLengths!=null&&h.sidecar!=null&&(i={sidecar:h.sidecar,scanLengths:h.scanLengths.map(function(a){return d("WAProgressiveJpegGetScanLengths").asProgressiveJpegScanLength(d("WALongInt").numberOrThrowIfTooLarge(a))})});return babelHelpers["extends"]({},a,{serverMediaType:b==null?null:d("WAServerMediaType").castToServerMediaType(b),mediaKey:c&&j(c),mediaKeyTimestamp:e==null?null:d("WATimeUtils").castToUnixTime(d("WALongInt").numberOrThrowIfTooLarge(e)),uploadToken:f&&k(f),progressiveJpegDetails:i,downloadableThumbnail:g&&w(g)})}function z(a){return"arrayBuffer"in a&&typeof a.arrayBuffer==="function"?a.arrayBuffer():new(h||(h=b("Promise")))(function(b,d){var e=new FileReader();e.onload=function(){var a=e.result;a instanceof ArrayBuffer?b(a):d(c("WAErr")("blobToArrayBuffer got error becaues result is not ArrayBuffer"))};e.onerror=function(){var a;a=((a=e.error)==null?void 0:a.name)||"unknown";d(c("WAErr")("blobToArrayBuffer got error got error "+a))};e.readAsArrayBuffer(a)})}function A(a){var b="image/jpeg";switch(a){case"image":b="image/jpeg";break;case"ptt":b="audio/wav";break;case"video":b="video/mp4";break;case"gif":b="image/gif";break;case"sticker":b="image/webp";break;case"preview":b="image/jpeg";break;case"document":b="application/pdf";break;case"xma-image":b="image/jpeg";break;default:throw c("WAErr")("Unsupported server media type: "+a)}return b}var B=function(){return"TransformStream"in self};g.createMediaKey=i;g.castToMediaKey=j;g.createUploadToken=a;g.castToUploadToken=k;g.toPlaintextHash=e;g.stringToPlaintextHash=f;g.toHashedPlaintextHash=l;g.stringToDeliveryObjectId=m;g.stringToBackupEntFbid=n;g.mediaEntryDataToRawData=o;g.rawDataToMediaEntry=p;g.encodeMediaEntryForUpload=q;g.encodeMediaEntryForDownload=r;g.encodeMediaEntryWithUpdatedPath=s;g.encodeMediaEntryDownloadableThumbnailWithUpdatedPath=t;g.encodeMediaEntryWithUpdatedFbid=u;g.encodeMediaEntryWithUpdatedObjectId=v;g.convertMediaDownloadableThumbnailToDownloadableThumbnail=w;g.decodeMediaEntryData=y;g.blobToArrayBuffer=z;g.getMimeTypeFromServerMediaType=A;g.isTransformStreamSupported=B}),98);
__d("MAWMediaUtils",["MAWDbMedia","MAWDexieCastToPromise","MAWGlobals","MAWHMACKey","WAMediaUtils","WAMsgType","WATimeUtils","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){b===void 0&&(b="media");switch(a){case d("MAWDbMedia").MEDIA_TYPE.IMAGE:return b==="xma-media"?"xma-image":"image";case d("MAWDbMedia").MEDIA_TYPE.VIDEO:return"video";case d("MAWDbMedia").MEDIA_TYPE.PTT:return"ptt";case d("MAWDbMedia").MEDIA_TYPE.GIF:return"gif";case d("MAWDbMedia").MEDIA_TYPE.STICKER:return"sticker";case d("MAWDbMedia").MEDIA_TYPE.DOCUMENT_FILE:return"document";default:throw c("err")("get a wrong media file with type "+a)}}function h(a){try{return d("WAMediaUtils").blobToArrayBuffer(a).then(i)}catch(a){throw c("err")("Got "+a+" when convert the blob to Uint8Array")}}function i(a){return self.crypto.subtle.digest("SHA-256",a).then(function(a){return new Uint8Array(a)})}function e(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield h(a));a=d("WAMediaUtils").toPlaintextHash(a);var b=k(a);return[a,b]});return j.apply(this,arguments)}function k(a){var b=d("MAWGlobals").getHMACKey();return d("WAMediaUtils").toHashedPlaintextHash(d("MAWHMACKey").hmacTweetNaCl(a,b))}function f(a){var b="preview-"+d("WATimeUtils").unixTime().toString()+".jpeg";return l(a,b,"image/jpeg")}function l(a,b,c){return new File([new Blob([new Uint8Array(a)],{type:c})],b,{type:c})}function m(a,b){return d("MAWDexieCastToPromise").dexieCastToPromise(a.messages.where("msgId").anyOf(b.msgIds).filter(function(a){return a.type!==d("WAMsgType").REVOKED}).toArray().then(function(a){a=a.map(function(a){return a.msgId});return babelHelpers["extends"]({},b,{msgIds:a})}))}g.getServerMediaTypeFromMediaType=a;g.hashBlob=h;g.hashArrayBuffer=i;g.genBlobHashes=e;g.genHMACPlaintextHash=k;g.convertJpegThumbnailArrayBufferToFile=f;g.getBridgeMediaWithoutUnsentMessageIds=m}),98);
__d("WAErrorMessage",[],(function(a,b,c,d,e,f){"use strict";var g="NoErrorMessageProvided";function a(a){var b;a instanceof Error?b=a.message:typeof a==="string"?b=a:typeof a==="object"?typeof (a==null?void 0:a.description)==="string"?b=a.description:typeof (a==null?void 0:a.message)==="string"?b=a.message:b=g:b=g;return b}f.NO_ERROR_MESSAGE_PROVIDED=g;f.maybeGetMessageFromError=a}),66);
__d("MAWDbChunkTxns",["MAWMediaUtils","WAErrorMessage","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to add chunk. Possible duplicate? Will attempt a retry. Error: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to add chunk. Possible duplicate? Will attempt a retry. For hashedPlaintextHash: ",". Error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to add chunk after retry. Error: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to add chunk for hashedPlaintextHash: ",". Error: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Chunk found after retry for hashedPlaintextHash: ",""]);l=function(){return a};return a}var m=d("WATagsLogger").TAGS(["MAWDbChunkTxns"]);b=function a(b,c,e,f,g){g===void 0&&(g=0);var n=d("MAWMediaUtils").genHMACPlaintextHash(c);return b.chunk.where("hashedPlaintextHash").equals(n).first().then(function(o){if(o){g>0&&m.LOG(l(),n);return o}else{var p={blobData:e,hashedPlaintextHash:n,mimetype:f,plaintextHash:c};return b.chunk.add(p).then(function(a){return babelHelpers["extends"]({},p,{chunkId:a})})["catch"](function(l){var o=d("WAErrorMessage").maybeGetMessageFromError(l);if(g>0){m.WARN(k(),n,o);m.ERROR(j(),o);throw l}else{m.WARN(i(),n,o);m.ERROR(h(),o);return a(b,c,e,f,g+1)}})}})};c=function(a,b){return n(a,b).then(function(a){return a!=null})};var n=function(a,b){return a.chunk.where("hashedPlaintextHash").equals(b).first()};e=function(a,b){return a.chunk.where("hashedPlaintextHash").anyOf(b).toArray().then(function(a){return new Map(a.map(function(a){return[a.hashedPlaintextHash,a]}))})};function a(a,b){return a.chunk.bulkGet(b)}f=function(a,b){b=d("MAWMediaUtils").genHMACPlaintextHash(b);return a.chunk.get({hashedPlaintextHash:b})};g.getOrCreateMediaChunk=b;g.hasMediaChunk=c;g.maybeGetChunkFromHash=n;g.maybeBulkGetChunksFromHash=e;g.bulkGetChunks=a;g.maybeGetChunkByPlaintextHash=f}),98);
__d("MAWJidUtils",["FBLogger","WAGlobals","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,e){if(d("WAJids").isAuthorSystem(a)||b==null||e==null){c("FBLogger")("messenger_e2ee_web").warn("Failed to create protocolMsgId with externalId %s for a msg to edit",e);return}return{author:a,chat:b,externalId:e}}function a(a){var b;return h(a.author,a.threadJid,(b=a.externalId)!=null?b:a.editExternalId)}function b(a){return d("WAJids").isAuthorMe(a)?d("WAGlobals").getMyUserJid():a}g.maybeToProtocolMsgId=h;g.toProtocolMsgId=a;g.getAuthorJid=b}),98);
__d("MAWLoadReplyMediaTxns",["MAWDbChunkTxns","MAWDbMedia","MAWDbMsg","MAWDbXMATxns","MAWDexieTable","MAWGlobals","MAWJidUtils","MAWMsgType","MAWXMAUtils","WAAssertUnreachable","WAJids","WALogger","WAMsgType","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unable to fetch reply media XMA with id ",": ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unable to fetch reply media with id ",": ",""]);i=function(){return a};return a}function j(a,b){return a.media.get(b).then(function(b){return b==null?[void 0,void 0]:d("MAWDbChunkTxns").maybeGetChunkFromHash(a,b.hashedPlaintextHash).then(function(a){return a==null?[void 0,b]:[a,b]})})}var k=new Set([(e=d("MAWDbMedia")).MEDIA_TYPE.IMAGE,e.MEDIA_TYPE.GIF,e.MEDIA_TYPE.PTT,e.MEDIA_TYPE.STICKER,e.MEDIA_TYPE.VIDEO,e.MEDIA_TYPE.DOCUMENT_FILE]);function l(a){var b;switch(a.mediaType){case d("MAWDbMedia").MEDIA_TYPE.IMAGE:case d("MAWDbMedia").MEDIA_TYPE.GIF:case d("MAWDbMedia").MEDIA_TYPE.STICKER:b=a.validatedImageInfo;break;case d("MAWDbMedia").MEDIA_TYPE.VIDEO:b=a.validatedVideoInfo;break}a=b||{};var c=a.jpegThumbnailHeight;a=a.jpegThumbnailWidth;return{replyMediaPreviewHeight:c,replyMediaPreviewWidth:a}}function m(a){switch(a.type){case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return!0;case d("MAWMsgType").MSG_TYPE.XMA:return d("MAWXMAUtils").isXMAShare(a.xmaMessageType);case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:case d("MAWMsgType").MSG_TYPE.REVOKED:case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:case d("WAMsgType").NOTE_REPLY:return!1;default:return c("WAAssertUnreachable")(a.type)}}function n(a,b){return b==null?d("MAWDexieTable").dexieResolve():j(a,b).then(function(a){var c=a[0];a=a[1];if(a==null)return d("WAResultOrError").makeError("reply_media_not_found");if(!k.has(a.mediaType))return d("WAResultOrError").makeError("reply_media_type_unknown");a=l(a);var e=a.replyMediaPreviewHeight;a=a.replyMediaPreviewWidth;var f;c!=null&&(f=c.mimetype);return d("WAResultOrError").makeResult({replyMediaId:b,replyMediaPreviewHeight:e,replyMediaPreviewWidth:a,replyMediaUrlMimeType:f})}).then(function(a){if(a.success!==!0){d("WALogger").ERROR(i(),b,a.error);return}return a.value})}function o(a,b){var c=b.defaultPreviewMediaId;return c==null?d("MAWDexieTable").dexieResolve({replyXMAId:b.xmaId}):j(a,c).then(function(a){var c=a[0];a=a[1];if(c==null||a==null)return d("WAResultOrError").makeError("reply_xma_media_not_found");if(!k.has(a.mediaType))return d("WAResultOrError").makeError("reply_xma_media_type_unknown");a=l(a);var e=a.replyMediaPreviewHeight;a=a.replyMediaPreviewWidth;return d("WAResultOrError").makeResult({replyMediaPreviewHeight:e,replyMediaPreviewWidth:a,replyMediaUrlMimeType:c.mimetype,replyXMAId:b.xmaId})}).then(function(a){if(a.success!==!0){d("WALogger").ERROR(h(),b.xmaId,a.error);return}return a.value})}function a(a,b){var c,e;c=((c=b.quote)==null?void 0:c.content)||{};var f=c.author,g=c.externalId,h=c.mediaId;c=c.xmaMessageType;if(((e=b.quote)==null?void 0:e.content)==null||!m((e=b.quote)==null?void 0:e.content))return d("MAWDexieTable").dexieResolve();e=b.threadJid;b=f===d("MAWGlobals").getMyUserJid();b=b?d("WAJids").AUTHOR_ME:f;return d("MAWXMAUtils").isXMAShare(c)?p(a,d("MAWJidUtils").maybeToProtocolMsgId(b,e,g)):n(a,h)}function p(a,b){return b==null?d("MAWDexieTable").dexieResolve():d("MAWDbXMATxns").maybeGetXMAFromProtocolMsgId(a,b).then(function(b){if(b==null||d("MAWXMAUtils").isXMAExpired(b.isTombstoned,b.targetExpiringAtSec))return;return o(a,b)})}function b(a,b){var c=b.author,e=b.externalId,f=b.mediaId,g=b.threadJid,h=b.xmaMessageType;h=d("MAWXMAUtils").isXMAShare(h);return!d("MAWDbMsg").isMediaMsg(b)&&!h?d("MAWDexieTable").dexieResolve():h?p(a,d("MAWJidUtils").maybeToProtocolMsgId(c,g,e)):n(a,f)}g.isMediaReplyContent=m;g.getReplyMediaForMsgQuote=a;g.getReplyMediaForMsg=b}),98);
__d("WAMsgMap",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a){var b=this;this.$1=new Map();a==null?void 0:a.forEach(function(a){var c=a[0];a=a[1];b.set(c,a)})}var b=a.prototype;b.clear=function(){this.$1.clear()};b["delete"]=function(a){var b;(b=this.$1.get(a.externalId))==null?void 0:(b=b.get(a.author))==null?void 0:b["delete"](a.chat)};b.get=function(a){var b;return(b=this.$1.get(a.externalId))==null?void 0:(b=b.get(a.author))==null?void 0:b.get(a.chat)};b.has=function(a){var b;return(b=(b=this.$1.get(a.externalId))==null?void 0:(b=b.get(a.author))==null?void 0:b.has(a.chat))!=null?b:!1};b.set=function(a,b){var c,d;c=(c=this.$1.get(a.externalId))!=null?c:new Map();this.$1.has(a.externalId)||this.$1.set(a.externalId,c);d=(d=c.get(a.author))!=null?d:new Map();c.has(a.author)||c.set(a.author,d);d.set(a.chat,b);return this};b.keys=function(){var a=[],b=this.$1;for(var c=b.keys(),d=Array.isArray(c),e=0,c=d?c:c[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f,g;if(d){if(e>=c.length)break;g=c[e++]}else{e=c.next();if(e.done)break;g=e.value}g=g;f=(f=b.get(g))!=null?f:new Map();for(var h=f.keys(),i=Array.isArray(h),j=0,h=i?h:h[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var k,l;if(i){if(j>=h.length)break;l=h[j++]}else{j=h.next();if(j.done)break;l=j.value}l=l;k=(k=f.get(l))!=null?k:new Map();for(var k=k.keys(),m=Array.isArray(k),n=0,k=m?k:k[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var o;if(m){if(n>=k.length)break;o=k[n++]}else{n=k.next();if(n.done)break;o=n.value}o=o;a.push({externalId:g,author:l,chat:o})}}}return a};b.entries=function(){var a=[],b=this.$1;for(var c=b.keys(),d=Array.isArray(c),e=0,c=d?c:c[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f,g;if(d){if(e>=c.length)break;g=c[e++]}else{e=c.next();if(e.done)break;g=e.value}g=g;f=(f=b.get(g))!=null?f:new Map();for(var h=f.keys(),i=Array.isArray(h),j=0,h=i?h:h[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var k,l;if(i){if(j>=h.length)break;l=h[j++]}else{j=h.next();if(j.done)break;l=j.value}l=l;k=(k=f.get(l))!=null?k:new Map();for(var m=k.keys(),n=Array.isArray(m),o=0,m=n?m:m[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var p;if(n){if(o>=m.length)break;p=m[o++]}else{o=m.next();if(o.done)break;p=o.value}p=p;var q=k.get(p);q!=null&&a.push([{externalId:g,author:l,chat:p},q])}}}return a};b.values=function(){return this.entries().map(function(a){return a[1]})};return a}();f.MsgMap=a}),66);
__d("MAWDbMsgUtil",["WAJids","WALogger","WAMsgMap"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Invalid author when converting msg array to map"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Missing jid prevents adding message to array map"]);i=function(){return a};return a}function a(a){return a.reduce(function(a,b){var c=b.threadJid;if(c==null){d("WALogger").ERROR(i());return a}if(b.author==="@system"){d("WALogger").ERROR(h());return a}a.set({author:b.author,chat:c,externalId:b.externalId},b);return a},new(d("WAMsgMap").MsgMap)())}function b(a){return d("WAJids").isAuthorSystem(a.author)||a.threadJid==null?null:{author:a.author,chat:a.threadJid,externalId:a.externalId}}g.convertMsgArrayToMap=a;g.getProtocolMsgIdFromDbMsg=b}),98);
__d("MAWDbUnrenderedMsgTxns",["MAWAckLevel","MAWDbMsg","MAWDbMsgUtil","MAWDexieTable","WAJids","WALogger","WAMsgMap","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["bulkUpdateSystemAck on sent message"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["bulkUpdateSystemAck on incoming message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateSystemAckForUnrenderedMsg on non existing message"]);j=function(){return a};return a}function a(a,b){var c=b.author,e=b.chat,f=b.externalId;return a.threads.get({jid:e}).then(function(b){return b==null?d("WAResultOrError").makeError("missing_thread_unrendered_msg"):k(a,f,b.chatId,c).then(function(a){return a==null?d("WAResultOrError").makeError("missing_unrendered_msg"):d("WAResultOrError").makeResult(a)})})}function b(a,b){var c=b.map(function(a){a=a.externalId;return a});return a.unrenderedMessages.where("externalId").anyOf(c).toArray().then(function(a){var c=d("MAWDbMsgUtil").convertMsgArrayToMap(a),e=new(d("WAMsgMap").MsgMap)();b.forEach(function(a){var b=c.get(a);b!=null&&e.set(a,b)});return e})}function k(a,b,c,d){return a.unrenderedMessages.where("externalId").equals(b).filter(function(a){return a.author===d&&a.thread===c}).first()}function l(a,b){return a+"_"+b}function c(a,b){var c=b.map(function(a){a=a.externalId;return a}),e=Array.from(new Set(b.map(function(a){return a.chat})));return d("MAWDexieTable").dexieAll([a.threads.where("jid").anyOf(e).toArray(),a.unrenderedMessages.where("externalId").anyOf(c).toArray()]).then(function(a){var c=a[0];a=a[1];if(a.length===0||c.length===0)return{msgs:[],threadIdToJid:new Map()};var d=new Map();c.forEach(function(a){return d.set(a.chatId,a.jid)});var e=new Map();b.forEach(function(a){var b=a.author,c=a.chat;a=a.externalId;var d=e.get(a)||new Set();d.add(l(b,c));e.set(a,d)});return{msgs:a.filter(function(a){var b=a.author,c=a.externalId;a=a.thread;a=d.get(a);c=e.get(c);return c!=null&&a!=null&&c.has(l(b,a))}),threadIdToJid:d}})}function e(a,b,c){return m(a,[{ack:c,msgId:b}]).then(function(a){a=a[0];if(a==null){d("WALogger").LOG(j());return null}return a})}function m(a,b){var c=b.map(function(a){return a.msgId}),e=new Map();b.forEach(function(a){return e.set(a.msgId,{ack:a.ack})});return a.unrenderedMessages.where("msgId").anyOf(c).toArray().then(function(b){if(b.length===0)return b;var c=[],f=[];b.forEach(function(a){var b;if(a.author!==d("WAJids").AUTHOR_ME){d("WALogger").ERROR(i());c.push(a);return}if(a.ack>d("MAWAckLevel").ACK.clock){d("WALogger").LOG(h());c.push(a);return}b=(b=e.get(a.msgId))==null?void 0:b.ack;if(b==null)return null;a=babelHelpers["extends"]({},a,{ack:b});b===d("MAWAckLevel").ACK.sent&&delete a.resendCount;f.push(a)});return a.unrenderedMessages.bulkPut(f).then(function(){return[].concat(f,c)})})}function f(a,b){b=b.map(function(b){return a.unrenderedMessages.get({msgId:b})});return d("MAWDexieTable").dexieAll(b)}function n(a,b){return a.unrenderedMessages.where("msgId").between(d("MAWDbMsg").msgIdsInChatLowerBound(b.chatId),d("MAWDbMsg").msgIdsInChatUpperBound(b.chatId)).last().then(function(a){a=a==null?0:d("MAWDbMsg").getInChatMsgIdFromMsgId(a.msgId);return a+1})}g.maybeGetUnrenderedMsgByProtocolMsgId=a;g.getUnrenderedMsgMapByProtocolMsgId=b;g.maybeGetUnrenderedMsgByExternalId=k;g.getUnrenderedMsgsByProtocolMsgId=c;g.updateSystemAckForUnrenderedMsg=e;g.bulkUpdateSystemAckForUnrenderedMsgs=m;g.getUnrenderedMsgsByMsgIds=f;g.getNextUnrenderedMsgIdNumberForThread=n}),98);
__d("MAWDbMsgTxns",["MAWAckLevel","MAWBridgeMsg","MAWDbMsg","MAWDbMsgUtil","MAWDbUnrenderedMsgTxns","MAWDbXMATxns","MAWDexieTable","MAWEBUploadTrackingUtils","MAWIndexedDb","MAWJidUtils","MAWLoadReplyMediaTxns","MAWMsgType","MAWSharedMsgIdUtil","MAWUpdateThreadMsgMetadataApi","ODS","Random","WAGlobals","WAJids","WALogger","WAMsgMap","WAResultOrError","WATimeUtils","err","gkx","justknobx","nullthrows","promiseDone","qex"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Successfull deleted "," messages"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateMediaId on message "," that already has this mediaId ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Replacing mediaId for message with pre-existing media. type=",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateMediaId on message "," that already has this mediaId ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["getFutureproofMsg gets a message "," with unsupported type ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Inconsistent getMsgsFromOffset return between legacy and v2. Reason: ",".\n    Thread chatId: ",", jid: ",".\n    Legacy result length: ",", V2 result length: ",".\n    Legacy result first sortOrderMs: ",".\n    Legacy result last sortOrderMs: ",".\n    V2 result first sortOrderMs: ",".\n    V2 result last sortOrderMs: ",".\n    Input params: offsetMsgId: ",", numMsgs: ",", includeOffset: ",", includeExpired: ",", direction: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["getMsgsFromOffsetV2 newest msg thread jid is not equal to thread jid.\n            msg.threadJid: ",",\n            msg.thread: ",",\n            thread.jid: ",",\n            thread.chatId: ",",\n            threadId: ",",\n            offsetMsgId: ","."]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Invalid sortOrder in getMsgsFromOffset. Offset msg sortOrderMs out of bound - oldest: ","(msgType=","), offset: ","(msgType=","), newest: ","(msgType=","). Thread chatId: ","."]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Invalid sortOrder in getMsgsFromOffset. Some msg has null sortOrderMs - oldest: ","(msgType=","), offset: ","(msgType=","), newest: ","(msgType=","). Thread chatId: ","."]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["Invalid sortOrder in getMsgsFromOffset. Some msg is null - oldest: ",", newest: ",", offset: ",". Thread chatId: ","."]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["maybeUpdateThreadMsgsForUndefinedOldestOrNewestMsgs fixes an incorrect newest/oldest values:\n    thread id: ",", thread jid: ",", oldestMsgId: ",", newestMsgId: ",",\n    validOldestMsg: ",", validNewestMsg: ",""]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["bulkUpdateSystemAck on sent message"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["bulkUpdateSystemAck on incoming message"]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateSystemAck on non existing message"]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["[maybeGetMsgByExternalId] Found "," messages with external id ",""]);w=function(){return a};return a}function x(){var a=babelHelpers.taggedTemplateLiteralLoose(["[maybeGetMsgByProtocolMsgId] Suspected multiple instances of same message!"]);x=function(){return a};return a}function y(){var a=babelHelpers.taggedTemplateLiteralLoose(["[maybeGetMsgByProtocolMsgId] Can't have "," messages with the same protocolMsgId!"]);y=function(){return a};return a}var z=c("gkx")("289");function A(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.messages.get({msgId:b})}function a(a,b){return c("qex")._("867")===!0?a.messages.where("threadJid").equals(b.jid).count().then(function(a){return a===0}):d("MAWDexieTable").dexieResolve(b.newestMsgTs==null)}function B(a,b,c,d){return a.messages.where(["threadJid","sortOrderMs"]).between([b,Number.MIN_SAFE_INTEGER],[b,Number.MAX_SAFE_INTEGER],c,d)}function C(a,b){return B(a,b,!1,!1).last()}function b(a,b){return c("qex")._("867")===!0?C(a,b.jid).then(function(a){return a}):A(a,b.newestMsg)}function e(a,b){return c("qex")._("867")===!0?C(a,b.jid).then(function(a){return a==null?void 0:a.msgId}):d("MAWDexieTable").dexieResolve(b.newestMsg)}function f(a,b){return c("qex")._("867")===!0?C(a,b.jid).then(function(a){return(a==null?void 0:a.sortOrderMs)==null?null:d("WATimeUtils").castToMillisTime(a.sortOrderMs)}):d("MAWDexieTable").dexieResolve(b.newestMsgTs==null?b.newestMsgTs:b.newestMsgTs)}function D(a,b,c){return B(a,b,!1,!1).reverse().limit(c).toArray()}function E(a,b){return B(a,b,!1,!1).first()}function F(a,b){return c("qex")._("867")===!0?E(a,b.jid).then(function(a){return a}):A(a,b.oldestMsg)}function G(a,b){return c("qex")._("867")===!0?E(a,b.jid).then(function(a){return a==null?void 0:a.msgId}):d("MAWDexieTable").dexieResolve(b.oldestMsg)}function H(a,b,c,d){return a.messages.where("[thread+serverTs]").between([b,Number.MIN_SAFE_INTEGER],[b,Number.MAX_SAFE_INTEGER],c,d)}function I(a,b){return H(a,b,!1,!1).last()}function J(a,b,c){return H(a,b,!1,!1).reverse().limit(c).toArray()}function K(a,b){return a.messages.where("externalId").equals(b.externalId).filter(function(a){return a.author===b.author&&a.threadJid===b.chat}).toArray().then(function(a){if(a.length>1){var b=a.map(function(a){var b;return a.type+":"+((b=a.serverTs)!=null?b:0).toString()+":"+((b=a.ts)!=null?b:0).toString()});b=new Set(b).size===1;!b?d("WALogger").ERROR(y(),a.length):d("WALogger").ERROR(x())}return a[0]})}function L(a,b){return a.messages.where("msgId").equals(b).toArray()}function M(a,b){return P(a,b).then(function(a){return a.success?a:a})}function N(a,b){var c=b.map(function(a){a=a.externalId;return a});return a.messages.where("externalId").anyOf(c).toArray().then(function(a){var c=d("MAWDbMsgUtil").convertMsgArrayToMap(a),e=new(d("WAMsgMap").MsgMap)();b.forEach(function(a){var b=c.get(a);b!=null&&e.set(a,b)});return e})}function O(a,b){return a.messages.where("msgId").equals(b).first().then(function(a){return a==null?void 0:a.sortOrderMs})}function P(a,b){var c=b.author,e=b.chat,f=b.externalId;return a.threads.get({jid:e}).then(function(b){return b==null?d("WAResultOrError").makeError("missing_thread_msg"):Q(a,f,b.chatId,c).then(function(a){return a==null?d("WAResultOrError").makeError("missing_msg"):d("WAResultOrError").makeResult(a)})})}function aa(a,b){var c=b.author,d=b.chat,e=b.externalId;return a.threads.get({jid:d}).then(function(b){if(b==null)return;return a.messages.where("revokedExternalId").equals(e).filter(function(a){return a.author===c&&a.thread===b.chatId&&a.type==="Revoked"}).first()})}function Q(a,b,c,e){return a.messages.where("externalId").equals(b).filter(function(a){return a.author===e&&a.thread===c}).toArray().then(function(a){a.length>1&&d("WALogger").ERROR(w(),a.length,b);return a[0]})}function ba(a,b,c,e){var f=a.messages.where("revokedExternalId").equals(b).filter(function(a){return a.author===e&&a.thread===c&&a.type===d("MAWMsgType").MSG_TYPE.REVOKED}).first();a=d("MAWDbUnrenderedMsgTxns").maybeGetUnrenderedMsgByExternalId(a,b,c,e).then(function(a){if((a==null?void 0:a.type)===d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME)return a});return d("MAWDexieTable").dexieAll([f,a]).then(function(a){var b=a[0];a=a[1];return b!=null||a!=null})}function ca(a,b){var c=new Array(b.length),e=new Set();b.forEach(function(a){c.push(a.externalId),e.add(d("MAWSharedMsgIdUtil").convertWAMsgIdToStringId(a))});return a.messages.where("externalId").anyOf(c).filter(function(a){return e.has(d("MAWSharedMsgIdUtil").convertWAMsgIdToStringId({author:a.author,chat:a.threadJid,externalId:a.externalId}))}).toArray()}function da(a,b,c,e,f){return R(a,[{ack:c,msgId:b,reportingMeta:f,serverTs:e}]).then(function(a){a=a.find(function(a){return a.msgId===b});if(a==null){d("WALogger").LOG(v());return null}return a})}function R(a,b){var e=b.map(function(a){return a.msgId});return d("MAWDbXMATxns").getXMAMsgIdsFromAssociatedMsgIds(a,e).then(function(f){var g=new Map();b.forEach(function(a){g.set(a.msgId,{ack:a.ack,reportingMeta:a.reportingMeta,serverTs:a.serverTs});var b=f.get(a.msgId);b!=null&&g.set(b,{ack:a.ack,reportingMeta:a.reportingMeta,serverTs:a.serverTs})});var h=Array.from(new Set(e.concat(Array.from(f.values()))));return a.messages.where("msgId").anyOf(h).toArray().then(function(b){if(b.length===0)return b;var e=[],f=[];b.forEach(function(a){var b,c;if(a.author!==d("WAJids").AUTHOR_ME){d("WALogger").ERROR(u());e.push(a);return}if(a.ack>d("MAWAckLevel").ACK.clock){d("WALogger").LOG(t());e.push(a);return}b=(b=g.get(a.msgId))==null?void 0:b.ack;c=(c=g.get(a.msgId))==null?void 0:c.serverTs;if(b==null)return null;var h=babelHelpers["extends"]({},a,{ack:b});c!=null&&(h.serverTs=c);a=(c=g.get(a.msgId))==null?void 0:c.reportingMeta;a!=null&&(h.reportingMeta=a);b===d("MAWAckLevel").ACK.sent&&delete h.resendCount;f.push(h);d("WAGlobals").getConfig().useEbUploadQueue()||d("MAWEBUploadTrackingUtils").maybeStartTrackingForMiddleware(h,"send")});return a.messages.bulkPut(f).then(function(){return d("MAWDexieTable").dexieAll(f.map(function(b){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,b)}))}).then(function(a){c("qex")._("1210")!==!0&&f.forEach(function(b,c){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(b,void 0,a[c])})});return[].concat(f,e)})})})}function ea(a,b,e,f){return a.threads.get(b).then(function(g){if(g==null||f==null||g.oldestMsg!==e&&g.newestMsg!==e)return;var h=c("gkx")("289")?[a.messages.where(["threadJid","sortOrderMs"]).above([g.jid,f]).first(),a.messages.where(["threadJid","sortOrderMs"]).below([g.jid,f]).last()]:[a.messages.where("msgId").above(e).first(),a.messages.where("msgId").below(e).last()];return d("MAWDexieTable").dexieAll(h).then(function(c){var f=c[0];c=c[1];return a.threads.update(b,{newestMsg:g.newestMsg===e?c==null?void 0:c.msgId:g.newestMsg,newestMsgTs:g.newestMsg===e?(c==null?void 0:c.ts)==null?null:d("WATimeUtils").castUnixTimeToMillisTime(c.ts):g.newestMsgTs,oldestMsg:g.oldestMsg===e?f==null?void 0:f.msgId:g.oldestMsg}).then(function(){})})})}function S(a,b,e,f,g){if(b===(e==null?void 0:e.msgId)&&f===(g==null?void 0:g.msgId))return d("MAWDexieTable").dexieResolve();d("WALogger").ERROR(s(),a.chatId,a.jid,b,f,e==null?void 0:e.msgId,g==null?void 0:g.msgId);d("MAWIndexedDb").afterTransactionEffect(function(){c("promiseDone")(c("MAWUpdateThreadMsgMetadataApi")(a,b,e,f,g))})}function fa(a,b,c,e){var f;if(b==null||c==null||e==null){d("WALogger").ERROR(r(),b==null,c==null,e==null,a);return{hasMoreAfter:!1,hasMoreBefore:!1,msgs:[]}}if(c.sortOrderMs==null||e.sortOrderMs==null){d("WALogger").ERROR(q(),b==null?void 0:b.sortOrderMs,b==null?void 0:b.type,e==null?void 0:e.sortOrderMs,e==null?void 0:e.type,c==null?void 0:c.sortOrderMs,c==null?void 0:c.type,a);return{hasMoreAfter:!1,hasMoreBefore:!1,msgs:[]}}if(e.sortOrderMs>c.sortOrderMs||e.sortOrderMs<((f=b.sortOrderMs)!=null?f:0)){d("WALogger").ERROR(p(),b==null?void 0:b.sortOrderMs,b==null?void 0:b.type,e==null?void 0:e.sortOrderMs,e==null?void 0:e.type,c==null?void 0:c.sortOrderMs,c==null?void 0:c.type,a);return{hasMoreAfter:!1,hasMoreBefore:!1,msgs:[]}}}function T(a,b,e,f,g,h,i){g===void 0&&(g=!1);h===void 0&&(h=!1);i===void 0&&(i="before");return f===0?d("MAWDexieTable").dexieResolve({hasMoreAfter:!1,hasMoreBefore:!1,msgs:[],threadJid:null}):d("MAWDexieTable").dexieAll([a.threads.get(b),e==null?d("MAWDexieTable").dexieResolve(null):a.messages.get({msgId:e})]).then(function(j){var k=j[0],l=j[1],m=k==null?void 0:k.oldestMsg,n=k==null?void 0:k.newestMsg;if(k==null||e!=null&&l==null)return{hasMoreAfter:!1,hasMoreBefore:!1,msgs:[],threadJid:null};var p=h?function(a){return!0}:function(a){return a.messageExpirationTs==null||a.messageExpirationTs>d("WATimeUtils").unixTime()};j=d("MAWDexieTable").dexieResolve([]);f===1&&g&&l!=null&&(j=d("MAWDexieTable").dexieResolve([l].filter(p)));return j.then(function(h){h=h.length>0?d("MAWDexieTable").dexieResolve(h):sa(a,k.jid,l,g,f,p,i);var j=c("gkx")("23927");return d("MAWDexieTable").dexieAll([h,C(a,k.jid),E(a,k.jid)]).then(function(a){var c=a[0],g=a[1];a=a[2];S(k,m,a,n,g);if(c.length===0)return{hasMoreAfter:!1,hasMoreBefore:!1,msgs:[],threadJid:k.jid};var h=c[c.length-1],i=c[0];h=j?h.msgId!==(a==null?void 0:a.msgId):h.msgId!==(a==null?void 0:a.msgId)&&c.length===f;a=j?i.msgId!==(g==null?void 0:g.msgId):!1;i.threadJid!==k.jid&&d("WALogger").ERROR(o(),i.threadJid,i.thread,k.jid,k.chatId,b,e);return{hasMoreAfter:a,hasMoreBefore:h,msgs:c,threadJid:k.jid}})})})}function ga(a,b,e,f,g,h,i){g===void 0&&(g=!1);h===void 0&&(h=!1);i===void 0&&(i="before");var j=d("Random").coinflip(c("justknobx")._("1707")),k=j?c("qex")._("794")===!0:c("qex")._("546")===!0,l={hasMoreAfter:!1,hasMoreBefore:!1,msgs:[]};return d("MAWDexieTable").dexieAll([!k||j?U(a,b,e,f,g,h,i):d("MAWDexieTable").dexieResolve(l),k||j?T(a,b,e,f,g,h,i):d("MAWDexieTable").dexieResolve(babelHelpers["extends"]({},l,{threadJid:null}))]).then(function(a){var c=a[0];a=a[1];j&&ha(c,a,b,e,f,g,h,i);a.threadJid;a=babelHelpers.objectWithoutPropertiesLoose(a,["threadJid"]);return k?a:c})}function ha(a,b,c,e,f,g,i,j){g===void 0&&(g=!1);i===void 0&&(i=!1);j===void 0&&(j="before");var k=b.hasMoreAfter===a.hasMoreAfter&&b.hasMoreBefore===a.hasMoreBefore&&b.msgs.length===a.msgs.length&&b.msgs.every(function(b,c){c=a.msgs[c];return b.msgId===c.msgId});(h||(h=d("ODS"))).bumpEntityKey(3185,"armadillo_get_msgs_from_offset_v2",k?"consistent":"inconsistent");if(!k){k=b.hasMoreAfter!==a.hasMoreAfter?"inconsistent_hasMoreAfter":b.hasMoreBefore!==a.hasMoreBefore?"inconsistent_hasMoreBefore":b.msgs.length>a.msgs.length?"inconsistent_v2LengthGreater":b.msgs.length<a.msgs.length?"inconsistent_legacyLengthGreater":"inconsistent_other";(h||(h=d("ODS"))).bumpEntityKey(3185,"armadillo_get_msgs_from_offset_v2",k);d("WALogger").ERROR(n(),k,c,b.threadJid,a.msgs.length,b.msgs.length,(k=a.msgs[0])==null?void 0:k.sortOrderMs,(c=a.msgs[a.msgs.length-1])==null?void 0:c.sortOrderMs,(k=b.msgs[0])==null?void 0:k.sortOrderMs,(c=b.msgs[b.msgs.length-1])==null?void 0:c.sortOrderMs,e,f,g,i,j)}}function U(a,b,e,f,g,h,i){g===void 0&&(g=!1);h===void 0&&(h=!1);i===void 0&&(i="before");if(f===0)return d("MAWDexieTable").dexieResolve({hasMoreAfter:!1,hasMoreBefore:!1,msgs:[]});var j=c("qex")._("863")===!0;return a.threads.get(b).then(function(b){var k=b==null?void 0:b.oldestMsg,l=b==null?void 0:b.newestMsg;return b==null||k==null||l==null?{hasMoreAfter:!1,hasMoreBefore:!1,msgs:[]}:d("MAWDexieTable").dexieAll([j?E(a,b.jid):a.messages.where("msgId").aboveOrEqual(k).first(),j?C(a,b.jid):a.messages.where("msgId").belowOrEqual(l).last(),e==null?d("MAWDexieTable").dexieResolve(null):a.messages.get({msgId:e})]).then(function(e){var j=e[0],m=e[1];e=e[2];var n=(e=e)!=null?e:m,o=j==null?void 0:j.msgId;e=n==null?void 0:n.msgId;var p=m==null?void 0:m.msgId,q=d("WATimeUtils").unixTime();S(b,k,j,l,m);var r=fa(b.chatId,j,m,n);if(r!=null)return r;r=d("MAWDexieTable").dexieResolve([]);var s=h?function(a){return!0}:function(a){return a.messageExpirationTs==null||a.messageExpirationTs>q};f===1&&g&&(r=a.messages.get({msgId:e}).then(function(a){return a!=null?[a].filter(s):[]}));return r.then(function(e){e=e.length>0?d("MAWDexieTable").dexieResolve(e):ta(a,b.jid,c("nullthrows")(j),c("nullthrows")(m),c("nullthrows")(n),g,f,s,i);return e.then(function(a){if(a.length===0)return{hasMoreAfter:!1,hasMoreBefore:!1,msgs:[]};var b=a[a.length-1],d=a[0];b=c("gkx")("23927")?b.msgId!==o:b.msgId!==o&&a.length===f;d=c("gkx")("23927")?d.msgId!==p:!1;return{hasMoreAfter:d,hasMoreBefore:b,msgs:a}})})})})}function ia(a){return a.messages.where("altIndex").equals(d("MAWDbMsg").FUTUREPROOF_ALT_INDEX).toArray().then(function(a){var b=[];a.forEach(function(a){if(a.type!==d("MAWMsgType").MSG_TYPE.FUTUREPROOF){d("WALogger").ERROR(m(),a.msgId,a.type);return}b.push(a)});return b})}function V(a){return a.toString()}function ja(a,b,c){var e=b.mediaId;if(e===c){d("WALogger").LOG(l(),b.msgId,c);return d("MAWDexieTable").dexieResolve()}e=e!=null?a.media.get(e):d("MAWDexieTable").dexieResolve();return e.then(function(e){e&&d("WALogger").ERROR(k(),b.type);e=babelHelpers["extends"]({},b,{mediaId:c});return a.messages.put(e).then(function(){})})}function ka(a,b){var e=Array.from(b.keys());return a.messages.where("msgId").anyOf(e).toArray().then(function(e){var f=[];e.map(function(a){var e=b.get(a.msgId),g=a.mediaId;if(g!=null&&g!==e){if(e!=null)throw c("err")("mediaId "+V(g)+" in message "+a.msgId+" is different with the "+V(e)+" in bulkUpdateMediaId");d("WALogger").LOG(j(),a.msgId,e);return}g=babelHelpers["extends"]({},a,{mediaId:e});f.push(g)});return a.messages.bulkPut(f).then(function(){})})}function la(a,b){return W(a,[b]).then(function(){})}function W(a,b){return a.messages.where("msgId").anyOf(b).toArray().then(function(b){var c=b.map(function(a){return babelHelpers["extends"]({},a,{isExpiredXmaMsg:!0})});return a.messages.bulkPut(c).then(function(){return c})})}function X(a,b,c,e){if(e!=null&&e<=0)return d("MAWDexieTable").dexieResolve([]);a=a.messages.where("altIndex").equals(d("MAWDbMsg").craftToBeReadAltIndex(b)).filter(c);e!=null&&(a=a.limit(e));return a.toArray()}function Y(a,b,c,d){return X(a,b,function(a){return a.msgId<=c},d)}function Z(a,b,c,e){return X(a,b,function(a){return d("MAWDbMsg").getSortOrderWithFallback(a)<=c},e)}function ma(a,b,c){return Y(a,b,c).then(function(b){var c=b.map(function(a){return babelHelpers["extends"]({altIndex:null},a)});return a.messages.bulkPut(c).then(function(){return c})})}function na(a,b,c){return Z(a,b,c).then(function(b){var c=b.map(function(a){return babelHelpers["extends"]({altIndex:null},a)});return a.messages.bulkPut(c).then(function(){return c})})}function oa(a,b){return a.messages["delete"](b)}function pa(a,b,c){var e=b.map(function(a){return a.rowId});b=c!=null?b.map(function(a){a=d("MAWJidUtils").toProtocolMsgId(a);if(!a)return;return babelHelpers["extends"]({},a,{reason:c})}).filter(Boolean):[];return d("MAWDexieTable").dexieAll([a.deletedMessages.bulkAdd(b),a.messages.bulkDelete(e)]).then(function(a){a[0];a=a[1];d("WALogger").LOG(i(),a)})}function qa(a,b){return a.messages.where("msgId").anyOf(b).toArray()}function ra(a){return a.messages.where("altIndex").anyOf([d("MAWDbMsg").SPAM_ALT_INDEX,d("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX]).toArray()}function sa(a,b,c,e,f,g,h){h===void 0&&(h="before");c=c==null?null:d("MAWDbMsg").getSortOrderWithFallback(c);if(h==="before"){return a.messages.where(["threadJid","sortOrderMs"]).between([b,Number.MIN_SAFE_INTEGER],[b,(h=c)!=null?h:Number.MAX_SAFE_INTEGER],!0,e).reverse().filter(g).limit(f).toArray()}else{return a.messages.where(["threadJid","sortOrderMs"]).between([b,(h=c)!=null?h:Number.MIN_SAFE_INTEGER],[b,Number.MAX_SAFE_INTEGER],e,!0).filter(g).limit(f).toArray().then(function(a){return a.sort(function(a,b){return b.ts-a.ts})})}}function ta(a,b,c,e,f,g,h,i,j){j===void 0&&(j="before");c=d("MAWDbMsg").getSortOrderWithFallback(c);f=d("MAWDbMsg").getSortOrderWithFallback(f);e=d("MAWDbMsg").getSortOrderWithFallback(e);if(j==="before")return a.messages.where(["threadJid","sortOrderMs"]).between([b,c],[b,f],!0,g).reverse().filter(i).limit(h).toArray();else return a.messages.where(["threadJid","sortOrderMs"]).between([b,f],[b,e],g,!0).filter(i).limit(h).toArray().then(function(a){return a.sort(function(a,b){return b.ts-a.ts})})}function ua(a,b,c,d){var e=c.msgId;if(a==null&&b==null)return{newestMsg:e,oldestMsg:e};if(d==null){var f;return{newestMsg:e,oldestMsg:(f=a==null?void 0:a.msgId)!=null?f:e}}f=[a,b,c].filter(Boolean);return{newestMsg:f.reduce(function(a,b){return $(b,e,d)>=$(a,e,d)?b:a}).msgId,oldestMsg:f.reduce(function(a,b){return $(a,e,d)<$(b,e,d)?a:b}).msgId}}function $(a,b,c){return a.msgId===b?c:d("MAWDbMsg").getSortOrderWithFallback(a)}function va(a,b){return a.messages.where("msgId").between(d("MAWDbMsg").msgIdsInChatLowerBound(b.chatId),d("MAWDbMsg").msgIdsInChatUpperBound(b.chatId)).last().then(function(a){a=a==null?0:d("MAWDbMsg").getInChatMsgIdFromMsgId(a.msgId);return a+1})}g.IS_SORT_ORDER_COMPARISON_ENABLED=z;g.maybeGetMsg=A;g.getIsThreadEmpty=a;g.getThreadMessagesBySortOrder=B;g.getThreadNewestMessageBySortOrder=C;g.getThreadNewestMessageBySortOrderOrCache=b;g.getThreadNewestMessageIdBySortOrder=e;g.getThreadNewestMessageTsBySortOrder=f;g.getThreadNewestNumMessagesBySortOrder=D;g.getThreadOldestMessageBySortOrderOrCache=F;g.getThreadOldestMessageIdBySortOrder=G;g.getThreadMessagesByServerTs=H;g.getThreadNewestMessageByServerTs=I;g.getThreadNewestNumMessagesByServerTs=J;g.maybeGetMsgByProtocolMsgId=K;g.maybeGetMsgListByMsgId_I_KNOW_WHAT_I_AM_DOING=L;g.maybeGetMsgResultByProtocolMsgId=M;g.getMsgMapByProtocolMsgId=N;g.getSortOrderFromMsgId=O;g.maybeGetRevokedMsgByProtocolMsgId=aa;g.maybeGetMsgByExternalId=Q;g.checkIfMsgIsDeletedForMeOrRevoked=ba;g.getMsgsByProtocolMsgId=ca;g.updateSystemAck=da;g.bulkUpdateSystemAck=R;g.maybeUpdateThreadMsgsForDeleteForMe=ea;g.getMsgsFromOffsetV2=T;g.getMsgsFromOffset=ga;g.getMsgsFromOffsetLegacy=U;g.getFutureProofMsgs=ia;g.updateMediaId=ja;g.bulkUpdateMediaId=ka;g.updateDbMsgXMAExpiration=la;g.bulkUpdateDbMsgXMAExpired=W;g.getMsgsNeedingRetroactiveReadReceiptsUpTo__DONOTUSE=Y;g.getMsgsNeedingRetroactiveReadReceiptsUpTo=Z;g.clearRetroactiveReadReceiptStatusFromMsgsUpTo__DONOTUSE=ma;g.clearRetroactiveReadReceiptStatusFromMsgsUpTo=na;g.deleteDbMsg=oa;g.deleteMessages=pa;g.getMsgsByMsgIds=qa;g.getSpamMsgs=ra;g.calculateOldestAndNewestMsg=ua;g.getNextMsgIdNumberForThread=va}),98);
__d("MAWBridgeTypesCreators",["I64","MAWDbMsg","MAWGlobals","MAWImageUtils","MAWMsgType","WAAssertUnreachable","WAJids","WAMediaUtils","WATimeUtils","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return{threadId:b,threadJid:a}}function i(a){var b,c=a.ts;switch(a.type){case d("MAWMsgType").MSG_TYPE.REVOKED:c=(b=a.originalTs)!=null?b:a.ts;break;default:c=d("MAWDbMsg").getCanonicalTsFromMsg(a)}return{msgId:a.msgId,threadId:a.thread,ts:c}}function b(a,b,c){c=c.map(i);return{messages:c,threadId:a,threadJid:b}}function e(a){return{ravenMsgId:a.msgId,threadId:a.thread,threadJid:a.threadJid}}function f(a,b,e,f,g,h,i){var j,k=e.msgIds.filter(function(b){return d("MAWDbMsg").getThreadIdFromMsgId(b)===a});switch(e.mediaType){case"Image":return{duration:null,ephemeralMediaState:h==null?void 0:h.ephemeralMediaState,ephemeralMediaViewMode:h==null?void 0:h.ephemeralMediaViewMode,filesize:e.size,hasMedia:f,mediaId:e.mediaId,mediaType:e.mediaType,msgIds:k,offlineAttachmentId:i,previewHeight:(j=e.validatedImageInfo)==null?void 0:j.jpegThumbnailHeight,previewHeightLarge:(j=e.validatedImageInfo)==null?void 0:j.height,previewWidth:(j=e.validatedImageInfo)==null?void 0:j.jpegThumbnailWidth,previewWidthLarge:(j=e.validatedImageInfo)==null?void 0:j.width,sortOrderMs:d("WATimeUtils").castToMillisTime(g!=null?g:e.ts*1e3),threadId:a,threadJid:b,ts:d("WATimeUtils").castToUnixTime(g!=null?g/1e3:e.ts)};case"Video":return{duration:((j=e.validatedVideoInfo)==null?void 0:j.duration)!=null?((j=e.validatedVideoInfo)==null?void 0:j.duration)*1e3:0,ephemeralMediaState:h==null?void 0:h.ephemeralMediaState,ephemeralMediaViewMode:h==null?void 0:h.ephemeralMediaViewMode,filesize:e.size,hasMedia:f,mediaId:e.mediaId,mediaType:e.mediaType,msgIds:k,offlineAttachmentId:i,previewHeight:(j=e.validatedVideoInfo)==null?void 0:j.jpegThumbnailHeight,previewHeightLarge:(h=e.validatedVideoInfo)==null?void 0:h.height,previewWidth:(j=e.validatedVideoInfo)==null?void 0:j.jpegThumbnailWidth,previewWidthLarge:(h=e.validatedVideoInfo)==null?void 0:h.width,sortOrderMs:d("WATimeUtils").castToMillisTime(g!=null?g:e.ts*1e3),threadId:a,threadJid:b,ts:d("WATimeUtils").castToUnixTime(g!=null?g/1e3:e.ts)};case"Ptt":return{duration:((j=e.validatedAudioInfo)==null?void 0:j.duration)?e.validatedAudioInfo.duration*1e3:null,filesize:e.size,hasMedia:f,mediaId:e.mediaId,mediaType:e.mediaType,msgIds:k,offlineAttachmentId:i,previewHeight:null,previewHeightLarge:null,previewWidth:null,previewWidthLarge:null,sortOrderMs:d("WATimeUtils").castToMillisTime(g!=null?g:e.ts*1e3),threadId:a,threadJid:b,ts:d("WATimeUtils").castToUnixTime(g!=null?g/1e3:e.ts)};case"Gif":return{duration:null,filesize:e.size,hasMedia:f,mediaId:e.mediaId,mediaType:e.mediaType,msgIds:e.msgIds,offlineAttachmentId:i,previewHeight:(h=e.validatedImageInfo)==null?void 0:h.jpegThumbnailHeight,previewHeightLarge:(j=e.validatedImageInfo)==null?void 0:j.height,previewWidth:(h=e.validatedImageInfo)==null?void 0:h.jpegThumbnailWidth,previewWidthLarge:(j=e.validatedImageInfo)==null?void 0:j.width,sortOrderMs:d("WATimeUtils").castToMillisTime(g!=null?g:e.ts*1e3),threadId:a,threadJid:b,ts:d("WATimeUtils").castToUnixTime(g!=null?g/1e3:e.ts)};case"Sticker":h=d("MAWImageUtils").boundHeightWidth((h=e.validatedImageInfo)==null?void 0:h.jpegThumbnailHeight,(j=e.validatedImageInfo)==null?void 0:j.jpegThumbnailWidth,128);j=h.height;h=h.width;return{duration:null,filesize:e.size,hasMedia:f,mediaId:e.mediaId,mediaType:e.mediaType,msgIds:e.msgIds,offlineAttachmentId:i,previewHeight:j,previewHeightLarge:j,previewWidth:h,previewWidthLarge:h,sortOrderMs:d("WATimeUtils").castToMillisTime(g!=null?g:e.ts*1e3),threadId:a,threadJid:b,ts:d("WATimeUtils").castToUnixTime(g!=null?g/1e3:e.ts)};case"DocumentFile":j={};for(var h=e.mediaEntries,l=Array.isArray(h),m=0,h=l?h:h[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var n;if(l){if(m>=h.length)break;n=h[m++]}else{m=h.next();if(m.done)break;n=m.value}n=n;var o=n[0];n=n[1];n=d("WAMediaUtils").mediaEntryDataToRawData(e.plaintextHash,n);n=n.filename;n!=null&&(j[o]=n)}return{defaultFilename:(o=e.validatedDocumentFileInfo)==null?void 0:o.filename,duration:null,filenames:j,filesize:e.size,hasMedia:f,mediaId:e.mediaId,mediaType:e.mediaType,msgIds:k,offlineAttachmentId:i,previewHeight:null,previewHeightLarge:null,previewWidth:null,previewWidthLarge:null,sortOrderMs:d("WATimeUtils").castToMillisTime(g!=null?g:e.ts*1e3),threadId:a,threadJid:b,ts:d("WATimeUtils").castToUnixTime(g!=null?g/1e3:e.ts)};default:return c("WAAssertUnreachable")(e.mediaType)}}function j(a,b,c,e,f,g){return{chatJid:b,deliveredWatermarkTs:(b=e)!=null?b:d("WATimeUtils").castToUnixTime(0),fbid:c,lastReadActionTs:(e=g)!=null?e:d("WATimeUtils").castToUnixTime(0),lastReadWatermarkTs:(b=f)!=null?b:d("WATimeUtils").castToUnixTime(0),threadId:a}}function k(a){var b=a.cannotReplyReason,c=a.folder,d=a.fromCheckIfParticipant,e=a.muteExpireTimeMs,f=a.snippetParams,g=a.snippetSenderContactId,h=a.snippetType,i=a.threadId;a=a.threadJid;return{cannotReplyReason:b,folder:c,fromCheckIfParticipant:d,muteExpireTimeMs:e,snippetContactIDs:f==null?void 0:f.contactIDs,snippetMentionJIDs:f==null?void 0:f.mentionJIDs,snippetParams:f==null?void 0:f.strings,snippetSenderContactId:g,snippetType:h,threadId:i,threadJid:a}}function l(a){return{chatJid:a.groupJid,memberAddMode:a.memberAddMode,threadName:a.name}}function m(a,b,c,e,f,g,i,j,k){return{description:j,lastActivityTs:c,lastMsgExternalId:k!==void 0?(h||(h=d("I64"))).of_string_opt(k):void 0,lastReadTs:(j=e)!=null?j:d("WATimeUtils").castToMillisTime(0),snippetContactIDs:g.contactIDs,snippetMentionJIDs:(c=g.mentionJIDs)!=null?c:[],snippetParams:g.strings,snippetSenderContactId:i,snippetType:f,threadId:a,threadJid:b}}function n(a){var b=a.bumpTimestampMs,c=a.description,d=a.isMessageAuthorMe,e=a.skipServerThreadBump,f=a.snippetParams,g=a.snippetSenderContactId,h=a.snippetType,i=a.threadId;a=a.threadJid;return{bumpTimestampMs:b,description:c,isMessageAuthorMe:d,skipServerThreadBump:(b=e)!=null?b:!1,snippetContactIDs:f.contactIDs,snippetMentionJIDs:(c=f.mentionJIDs)!=null?c:[],snippetParams:f.strings,snippetSenderContactId:g,snippetType:h,threadId:i,threadJid:a}}function o(a){var b;if(c("gkx")("239"))return 0;return!c("justknobx")._("2319")?d("MAWDbMsg").getOriginalTsFromMsg(a)*1e3:(b=a.sortOrderMs)!=null?b:d("MAWDbMsg").getOriginalTsFromMsg(a)*1e3}function p(a,b,d,e,f,g,h){h===void 0&&(h="before");d=d;if(d.length===0)return{chatJid:b,rangeExtensionType:null,threadId:a};if(e)return{chatJid:b,rangeExtensionType:{hasMoreBefore:f,maxMsgId:d[0].msgId,minMsgId:d[d.length-1].msgId,minMsgTs:o(d[d.length-1]),rangeKind:"initial"},threadId:a};return c("gkx")("23927")?{chatJid:b,rangeExtensionType:{hasMoreAfter:g,hasMoreBefore:f,maxMsgId:d[0].msgId,maxMsgTs:o(d[0]),minMsgId:d[d.length-1].msgId,minMsgTs:o(d[d.length-1]),rangeKind:h==="before"?"before":"after"},threadId:a}:{chatJid:b,rangeExtensionType:{hasMoreBefore:f,minMsgId:d[d.length-1].msgId,minMsgTs:o(d[d.length-1]),rangeKind:"extensionBefore"},threadId:a}}function q(a){var b=d("WAJids").extractDeviceIDParts(d("MAWGlobals").getMyDeviceJid()).userId,c=a.author,e=a.chatId,f=a.chatJid,g=a.reaction,h=a.reactToMsgId;a=a.ts;return{actorId:d("WAJids").authorToUserId(c,b),chatJid:f,messageId:h,reaction:g,threadId:e,ts:a}}function r(a){var b=a.newestMsgId,c=a.newestMsgTs,e=a.oldestMsgId;a=a.thread;return{hasMoreAfter:!1,hasMoreBefore:!1,maxMsgId:b,maxMsgTs:c,minMsgId:e,minMsgTs:d("WATimeUtils").castToMillisTime(0),threadId:a.chatId,threadJid:a.jid}}function s(a){var b=d("WAJids").extractDeviceIDParts(d("MAWGlobals").getMyDeviceJid()).userId,c=a.author,e=a.chatId,f=a.chatJid;a=a.reactToMsgId;return{actorId:d("WAJids").authorToUserId(c,b),chatJid:f,messageId:a,threadId:e}}function t(a){return{creationTs:a.creationTs,creator:a.creator,groupJid:a.groupJid,msgExpiration:a.msgExpiration,name:a.name,nameOwner:a.nameOwner,nameTs:a.nameTs,participantVersion:a.participantVersion}}function u(a){var b=a.threadJid,c=a.inviteeJid;return{caption:a.caption,inviteCode:a.inviteCode,inviteeId:c,inviteExpireTs:a.inviteExpirationTs,inviterId:d("WAJids").extractUserId(a.inviterJid),threadJid:b}}function v(a,b){return{threadId:a,threadJid:b}}function w(a,b,c,e){return{senderId:d("WAJids").extractUserId(c),state:e,threadId:a,threadJid:b}}g.createBridgeUpdateE2EEMetadataParticipants=a;g.createBridgeDeleteMessages=b;g.createBridgeRavenAction=e;g.createBridgeMedia=f;g.createBridgeReceivedReceipt=j;g.createBridgeUpdatedThread=k;g.createBridgeUpdatedGroupInfo=l;g.createBridgeBumpedThread=m;g.createBridgeBumpedThreadV2=n;g.createBridgeMsgsLoadedInfo=p;g.createBridgeUpsertReaction=q;g.createBridgeUpdateMessageRange=r;g.createBridgeDeleteReaction=s;g.createBridgeGroupInfo=t;g.createBridgeGroupInvite=u;g.createBridgeDeleteGroupInvite=v;g.createBridgeReceivedChatState=w}),98);
__d("WAArrayZip",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){var c=Math.min(a.length,b.length);return a.slice(0,c).map(function(a,c){return[a,b[c]]})}f.zip=a}),66);
__d("MAWDbThreadTxns",["MAWBridgeTypesCreators","MAWDbMsgTxns","MAWDexieTable","MAWFolderTypes","MAWIndexedDb","WAArrayZip","WALogger","WAResultOrError","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["markCutoverThreadAsNotMigratedLocally failed because thread is already unmigrated"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["markThreadAsMigratedLocally failed because thread is already migrated"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["markThreadAsMigratedLocally failed to get the thread"]);j=function(){return a};return a}function a(a,b){return a.threads.get(b).then(function(a){return a==null?d("WAResultOrError").makeError("missing"):d("WAResultOrError").makeResult(a)})}function b(a,b){return a.threads.get({deduplicationKey:b}).then(function(a){return a==null?d("WAResultOrError").makeError("missing"):d("WAResultOrError").makeResult(a)})}function k(a,b){return a.threads.get({jid:b}).then(function(a){return a==null?d("WAResultOrError").makeError("missing"):d("WAResultOrError").makeResult(a)})}function c(a,b){return a.threads.where("jid").anyOf(b).toArray()}function e(a,b){return a.threads.where("jid").startsWith(b+"@").first().then(function(a){return a==null?d("WAResultOrError").makeError("missing"):d("WAResultOrError").makeResult(a)})}function f(a,b){return a.threads["delete"](b).then(function(){})}function l(a,b){return a.participants.where("userJid").equals(b).toArray().then(function(b){b=b.map(function(a){return a.threadId});return a.threads.bulkGet(b).then(function(a){return a.filter(Boolean)})})}function m(a,b){return a.participants.where("userJid").anyOf(b).toArray().then(function(b){var c=new Map();b.forEach(function(a){var b;c.has(a.userJid)||c.set(a.userJid,[]);(b=c.get(a.userJid))==null?void 0:b.push(a.threadId)});b=Array.from(c.values()).reduce(function(a,b){return a.concat(b)},[]);b=Array.from(new Set(b));return a.threads.bulkGet(b).then(function(a){return a.reduce(function(a,b){b!=null&&b.chatId!=null&&a.set(b.chatId,b);return a},new Map())}).then(function(a){return new Map(Array.from(c.entries()).map(function(b){var c=b[0];b=b[1];return[c,b.map(function(b){return a.get(b)}).filter(Boolean)]}))})})}function n(a,b,c){return d("MAWDbMsgTxns").IS_SORT_ORDER_COMPARISON_ENABLED?(b==null?void 0:b.lastReadMsgReceiptSent)==null?d("MAWDexieTable").dexieResolve(!1):d("MAWDbMsgTxns").getSortOrderFromMsgId(a,b.lastReadMsgReceiptSent).then(function(a){return c.sortOrderMs==null||a==null?!1:c.sortOrderMs<=a}):d("MAWDexieTable").dexieResolve(b==null||b.lastReadMsgReceiptSent==null?!1:c.msgId<=b.lastReadMsgReceiptSent)}function o(a,b){return a.threads.get(b.thread).then(function(c){return n(a,c,b)})}function p(a,b){var c=b.map(function(a){return a.thread});return a.threads.bulkGet(c).then(function(c){return d("MAWDexieTable").dexieAll(d("WAArrayZip").zip(b,c).map(function(b){var c=b[0];b=b[1];return n(a,b,c)}))})}function q(a,b,c){return a.threads.bulkGet(b).then(function(b){var e=b.filter(Boolean).map(function(a){return babelHelpers["extends"]({},a,{archived:!0,cannotReplyReason:c?"viewer_not_subscribed":a.cannotReplyReason,folder:d("MAWFolderTypes").FOLDER_ID.ARCHIVED})});return a.threads.bulkPut(e).then(function(){e.forEach(function(a){c&&d("WALogger").LOG(["[Occamadillo] Leaving a group thread\n          "+a.jid.toString()+", showing a VIEWER_NOT_SUBSCRIBED composer blocker"]),d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({cannotReplyReason:a.cannotReplyReason,folder:d("MAWFolderTypes").FOLDER_ID.ARCHIVED,threadId:a.chatId,threadJid:a.jid})})})})})}function r(a,b){return a.threads.bulkGet(b).then(function(c){var b=c.filter(Boolean).map(function(a){return babelHelpers["extends"]({},a,{cannotReplyReason:null})});return a.threads.bulkPut(b).then(function(){b.forEach(function(a){a={cannotReplyReason:null,threadId:a.chatId,threadJid:a.jid};d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread(a)})})})})}function s(a,b){return a.threads.bulkGet(b).then(function(b){var c=b.filter(Boolean).map(function(a){return babelHelpers["extends"]({},a,{archived:!1,cannotReplyReason:a.cannotReplyReason==="viewer_not_subscribed"?a.cannotReplyReason:null,folder:d("MAWFolderTypes").FOLDER_ID.INBOX})});return a.threads.bulkPut(c).then(function(){c.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({cannotReplyReason:a.cannotReplyReason,folder:d("MAWFolderTypes").FOLDER_ID.INBOX,threadId:a.chatId,threadJid:a.jid})})})})})}function t(a,b){return a.threads.bulkGet(b)}function u(a,b){return a.threads.bulkGet(b).then(function(b){var c=b.filter(Boolean).map(function(a){return babelHelpers["extends"]({},a,{cannotReplyReason:"viewer_not_subscribed"})});return a.threads.bulkPut(c).then(function(){c.forEach(function(a){var b={cannotReplyReason:"viewer_not_subscribed",threadId:a.chatId,threadJid:a.jid};d("WALogger").LOG(["[Occamadillo] User is unsubscribed from thread\n          "+a.jid.toString()+", showing a VIEWER_NOT_SUBSCRIBED composer blocker"]);d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread(b)})})})})}function v(a,b){return k(a,b).then(function(b){if(!b.success){d("WALogger").WARN(j());return}b=b.value;if(b.isMigratedLocally===!0){d("WALogger").WARN(i());return}b=babelHelpers["extends"]({},b,{isMigratedLocally:!0});return a.threads.put(b).then(function(){})})}function w(a,b){if(b.isMigratedLocally===!1){d("WALogger").WARN(h());return d("MAWDexieTable").dexieResolve(b)}var c=babelHelpers["extends"]({},b,{isMigratedLocally:!1});return a.threads.put(c).then(function(){return c})}function x(a,b){return a.threads.put(b).then(function(){})}function y(a,b,c,e,f,g){c=c===(e==null?void 0:e.msgId);f=f===(g==null?void 0:g.msgId);return c&&f?d("MAWDexieTable").dexieResolve():a.threads.update(b.chatId,{newestMsg:g==null?void 0:g.msgId,newestMsgTs:f?b.newestMsgTs:(g==null?void 0:g.ts)==null?null:d("WATimeUtils").castUnixTimeToMillisTime(g.ts),oldestMsg:e==null?void 0:e.msgId})}g.getThread=a;g.getThreadByDeduplicationKey=b;g.getThreadByJid=k;g.getThreadsByJids=c;g.getThreadByJidPrimaryId=e;g.deleteThreadRow=f;g.getAllThreadsForUser=l;g.getAllThreadsForUsers=m;g.needsRetroactiveReadReceiptInThread=o;g.bulkNeedsRetroactiveReadReceiptInThread=p;g.archiveThreads=q;g.subscribeToThreads=r;g.unarchiveThreads=s;g.getThreads=t;g.unsubscribeFromThreads=u;g.markCutoverThreadAsMigratedLocally=v;g.markCutoverThreadAsNotMigratedLocally=w;g.updateThread=x;g.updateThreadMsgsForUndefinedOldestOrNewestMsgs=y}),98);
__d("MAWDbMediaTxns",["MAWDbMsg","MAWDexieTable","MAWMediaUtils","MAWMsgType","WALogger","WAResultOrError","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["mediaId is null for media msg with msgId: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["mediaId is null for media msg with msgId: ",""]);i=function(){return a};return a}function a(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.media.get({mediaId:b})}function j(a,b){return a.media.where("hashedPlaintextHash").equals(b).first()}function b(a,b){b=d("MAWMediaUtils").genHMACPlaintextHash(b);return j(a,b)}function e(a,b){return a.media.where("hashedPlaintextHash").anyOf(b).toArray()}function f(a,b){return b==null?d("MAWDexieTable").dexieResolve():k(a,b).then(function(c){c=c==null?void 0:c.mediaId;return c!=null?a.media.get({mediaId:c}):a.media.get({objectId:b})})}function k(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.mediaBackup.get({objectId:b})}function l(a,b){a=a.mediaBackup.where("objectId").anyOf(b).toArray();return a.then(function(a){return new Map(a.map(function(a){return[a.objectId,a]}))})}function m(a,b){return l(a,b).then(function(b){b=Array.from(b.values()).map(function(a){return a.mediaId});return a.media.bulkGet(b)})}function n(a,b){if(b==null)return d("MAWDexieTable").dexieResolve();a=a.mediaBackup.where("msgId").equals(b).toArray();return a}function o(a,b){if(b.length===0)return d("MAWDexieTable").dexieResolve([]);b=b.filter(d("MAWDbMsg").isMediaMsg);var e=b.reduce(function(a,b){if(b.mediaId==null){d("WALogger").ERROR(i(),b.msgId);return a}return a.set(b.mediaId,b)},new Map());b=Array.from(e.keys());return r(a,b).then(function(a){var b=[];a.forEach(function(a){if(a==null)throw c("err")("Error missing media");var d=e.get(a.mediaId);if(d==null)throw c("err")("Error missing media");b.push([d,a])});return b})}function p(a,b){if(b.length===0)return d("MAWDexieTable").dexieResolve([]);b=b.filter(d("MAWDbMsg").isMediaMsg).map(function(a){var b=a.mediaId;if(b==null){d("WALogger").ERROR(h(),a.msgId);throw c("err")("mediaId is missing")}else return b});return r(a,b).then(function(a){var b=[];a.forEach(function(a){a!=null&&b.push(a)});return b})}function q(a,b){if(b.type===d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME||d("MAWDbMsg").isMediaMsg(b)){var c=b.mediaId;return c==null?b.type===d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME?d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult()):d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("missing")):a.media.get(c).then(function(a){return a==null?d("WAResultOrError").makeError("missing"):d("WAResultOrError").makeResult(a)})}else return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult())}function r(a,b){return a.media.bulkGet(b)}function s(a,b){var c=b.previewMediaIds!=null?r(a,b.previewMediaIds):d("MAWDexieTable").dexieResolve(),e=b.headerMediaId!=null?a.media.get(b.headerMediaId):d("MAWDexieTable").dexieResolve();a=b.faviconMediaId!=null?a.media.get(b.faviconMediaId):d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([c,e,a]).then(function(a){var c=a[0],e=a[1];a=a[2];if(b.headerMediaId!=null&&e==null)return d("WAResultOrError").makeError("missing");if(b.faviconMediaId!=null&&a==null)return d("WAResultOrError").makeError("missing");if(c==null)return d("WAResultOrError").makeError("missing");var f=[];for(var c=c,g=Array.isArray(c),h=0,c=g?c:c[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var i;if(g){if(h>=c.length)break;i=c[h++]}else{h=c.next();if(h.done)break;i=h.value}i=i;if(i==null)return d("WAResultOrError").makeError("missing");else f.push(i)}return d("WAResultOrError").makeResult({favicon:a,header:e,previews:f})})}function t(a,b,c){b=babelHelpers["extends"]({},b,c);return a.media.put(b)}g.maybeGetMediaFromMediaId=a;g.maybeGetMediaFromHashedPlaintextHash=j;g.maybeGetMediaFromPlaintextHash=b;g.maybeBulkGetMediaFromHashedPlaintextHash=e;g.maybeGetMediaFromObjectId=f;g.maybeGetMediaBackupRowFromObjectId=k;g.maybeGetMediaBackupRowsFromObjectIds=l;g.maybeGetBulkMediaFromObjectIds=m;g.maybeGetMediaBackupRowFromMsgId=n;g.getMsgMediaPairFromMsgs=o;g.getMediaFromMsgs=p;g.getAndCheckMediaFromMsg=q;g.bulkGetMedias=r;g.getMediaForXMA=s;g.updateMedia=t}),98);
__d("MAWDbXMATxns",["MAWDbMediaTxns","MAWDbMsg","MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWJidUtils","MAWXMAUtils","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return a.xma.bulkGet(b)}function b(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.xma.get({xmaId:b})}function h(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.xma.where("associatedMessageId").equals(b).first()}function i(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.xma.where("externalId").equals(b.externalId).filter(function(a){return a.author===b.author&&a.threadJid===b.chat}).first()}function c(a,b){return i(a,b).then(function(b){return b==null?d("WAResultOrError").makeError("missing"):d("MAWDexieTable").dexieAll([d("MAWDbMediaTxns").getMediaForXMA(a,b),d("MAWDbMsgTxns").maybeGetMsg(a,b.associatedMessageId)]).then(function(a){var c=a[0];a=a[1];if(!c.success)return d("WAResultOrError").makeError("missing");c=c.value;var e=c.favicon,f=c.header;c=c.previews;return d("WAResultOrError").makeResult({associatedMessage:a,favicon:e,header:f,previews:c,xma:b})})})}function e(a,b){return h(a,b).then(function(b){if(b==null)return;return d("MAWDbMsgTxns").maybeGetMsg(a,b.msgId)})}function f(a,b){if(b.length===0)return d("MAWDexieTable").dexieResolve([]);b=b.filter(d("MAWDbMsg").isXMAMsg).map(function(a){return d("MAWJidUtils").maybeToProtocolMsgId(a.author,a.threadJid,a.externalId)}).filter(Boolean);b=b.map(function(b){return i(a,b)});return d("MAWDexieTable").dexieAll(b).then(function(a){return a.filter(Boolean)})}function j(a,b){return a.xma.where("associatedMessageId").anyOf(b).toArray().then(function(a){a=a.filter(function(a){return a.msgId!=null&&d("MAWXMAUtils").isXMAShare(a.targetType)});return a.reduce(function(a,b){return b.associatedMessageId!=null&&b.msgId!=null?a.set(b.associatedMessageId,b.msgId):a},new Map())})}function k(a,b){return a.xma.where("associatedMessageId").equals(b).first()}function l(a,b){return a.xma.where("associatedMessageId").equals(b).first().then(function(b){if(b==null)return;b=d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.threadJid,b.externalId);if(b==null)return;return d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b)})}function m(a,b){return k(a,b).then(function(b){return b==null?d("WAResultOrError").makeResult():d("MAWDexieTable").dexieAll([d("MAWDbMediaTxns").getMediaForXMA(a,b),d("MAWDbMsgTxns").maybeGetMsg(a,b.associatedMessageId)]).then(function(a){var c=a[0];a=a[1];if(!c.success)return d("WAResultOrError").makeError("missing");c=c.value;var e=c.favicon,f=c.header;c=c.previews;return d("WAResultOrError").makeResult({associatedMessage:a,favicon:e,header:f,previews:c,xma:b})})})}function n(a,b,c){return d("MAWDbThreadTxns").getThreadByJid(a,c).then(function(c){if(!c.success)return;c=c.value;if(b==null)return d("MAWDexieTable").dexieResolve();c={author:b.author,chat:c.jid,externalId:b.externalId};return d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,c)})}g.bulkGetXMAs=a;g.maybeGetXMAFromXMAId=b;g.maybeGetXMAFromAssociatedMsgId=h;g.maybeGetXMAFromProtocolMsgId=i;g.maybeGetXMAPayloadFromProtocolMsgId=c;g.getDbXMAMsgFromAssociatedMsgId=e;g.getXMAFromMsgs=f;g.getXMAMsgIdsFromAssociatedMsgIds=j;g.maybeGetDbXMAMsgByAssociatedMsgId=l;g.maybeGetXMAPayloadFromAssociatedMsgId=m;g.maybeGetAssociatedXMAMsg=n}),98);
__d("MAWUpdateThreadMsgMetadataApi",["MAWDbThreadTxns","MAWDexieTable","MAWIndexedDb","MAWTransactionMode","WALogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["updated oldestMsg from id "," to id "," when oldestMsg is undefined"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["updated newestMsg from id "," to id ",", and newestMsgTs from "," to "," when newestMsg is undefined"]);i=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({threads:d("MAWTransactionMode").READWRITE},"updateThreadMsgMetadataApiTransactor",function(a){return function(b,c,e,f,g){var j=c===(e==null?void 0:e.msgId),k=f===(g==null?void 0:g.msgId);if(j&&k)return d("MAWDexieTable").dexieResolve();k||d("WALogger").ERROR(i(),f,g==null?void 0:g.msgId,b.newestMsgTs,(g==null?void 0:g.ts)==null?null:d("WATimeUtils").castUnixTimeToMillisTime(g.ts));j||d("WALogger").ERROR(h(),c,e==null?void 0:e.msgId);return d("MAWDbThreadTxns").updateThreadMsgsForUndefinedOldestOrNewestMsgs(a,b,c,e,f,g).then(function(){})}});b=a;g["default"]=b}),98);
__d("MAWGetMsgQuoteTxn",["MAWDbMsgTxns","MAWDexieTable","MAWMsgType","WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a){return a==null||a===d("WAJids").AUTHOR_SYSTEM?null:d("WAJids").authorAsUserJid(a)};function i(a,b,c){var e=b.quote;b=(e==null?void 0:e.content)||{};var f=b.author;b=b.externalId;if(f==null)return d("MAWDexieTable").dexieResolve(null);f=d("WAJids").isAuthorMe(f)?d("WAJids").AUTHOR_ME:h(f);if(e==null||f==null||b==null)return d("MAWDexieTable").dexieResolve(null);f={author:f,chat:c,externalId:b};return d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,f).then(function(b){if(b==null||!d("MAWMsgType").isQuotedMsgType(b.type))return{quote:e,quoteExternalId:e.content.externalId};var a=b.author,c=b.externalId,f=b.mediaId,g=b.msgContent,h=b.msgId,i=b.specialTextSize,j=b.ts,k=b.type,l=b.xmaMessageType;a={author:a,externalId:c,mediaId:f,msgContent:g,msgId:h,specialTextSize:i,ts:j,type:k,xmaMessageType:l};b.messageExpirationTs!=null&&b.messageExpirationTs<d("WATimeUtils").unixTime()&&(a=babelHelpers["extends"]({},a,{mediaId:void 0,msgContent:void 0,type:d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL}));return{quote:babelHelpers["extends"]({},e,{content:a}),quoteExternalId:b.externalId}})}function a(a,b,c){return i(a,b,c).then(function(a){return babelHelpers["extends"]({},b,{quote:a==null?void 0:a.quote,quoteExternalId:a==null?void 0:a.quoteExternalId})})}g.getMsgQuoteInfo=i;g.enhanceMsgWithQuoteInfo=a}),98);
__d("MAWEphemeralGatingUtil",["$InternalEnum","MetaConfig","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h=b("$InternalEnum")({SEEN_BASED:0,SEND_BASED:1}),i="0,60,900,86400";function a(){var a=c("MetaConfig")._("56");(a===null||a==="")&&(a=i);return a.replace('"',"").split(",").map(function(a){return parseInt(a,10)})}function d(){var a=c("MetaConfig")._("57");return c("justknobx")._("1545")&&h.cast(a)===h.SEND_BASED}function e(){var a=c("MetaConfig")._("65");return c("justknobx")._("1546")&&a}g.EphemeralityType=h;g.getExpirationOptions=a;g.isSendBasedDisappearingMessageEnabled=d;g.isResetEphemeralSettingsEnabled=e}),98);
__d("MAWEphemeralUtils",["MAWEphemeralGatingUtil","MAWGlobals","MAWLocalizationType","WAArmadilloApplication.pb","WAJids","err"],(function(a,b,c,d,e,f,g){"use strict";var h=60,i=60*h,j=24*i;function a(a,b,c,e){var f=[],g=b===j&&d("MAWEphemeralGatingUtil").isSendBasedDisappearingMessageEnabled(),l=a===d("MAWGlobals").getMyUserJid();if(e)e=d("MAWLocalizationType").LOCALIZATION_TYPE.EPHEMERAL_SETTINGS_AUTO_RESET;else if(!l||a==null)b===0?e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_OFF:b<h?(e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_SECONDS:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_SECONDS,f.push(b.toString())):b<i?(e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_MINUTES:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_MINUTES,f.push((b/h).toString())):b<j||g?(e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_HOURS:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_HOURS,f.push((b/i).toString())):(e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_DAYS:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_DAYS,f.push((b/j).toString()));else{a=d("WAJids").extractUserId(a).toString();b===0?l?e=d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_OFF:(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_OFF,f.push(a)):b<h?(l?e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_SECONDS:d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_SECONDS:(e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_SECONDS:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_SECONDS,f.push(a)),f.push(b.toString())):b<i?(l?e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_MINUTES:d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_MINUTES:(e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_MINUTES:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_MINUTES,f.push(a)),f.push((b/h).toString())):b<j||g?(l?e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_HOURS:d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_HOURS:(e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_HOURS:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_HOURS,f.push(a)),f.push((b/i).toString())):(l?e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_DAYS:d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_DAYS:(e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_DAYS:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_DAYS,f.push(a)),f.push((b/j).toString()))}return{ephemeralSettingChangeContent:f,ephemeralSettingChangeType:k(e)}}function k(a){return!d("MAWEphemeralGatingUtil").isSendBasedDisappearingMessageEnabled()||!(a in l)?a:l[a.toString()]}function b(a,b,e){var f,g=[];b=d("WAJids").extractUserId(b).toString();switch(a){case d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_SCREENSHOT_ACTION_SCREENSHOT_TYPE.SCREENSHOT_IMAGE:e?f=d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_TAKE_SCREENSHOT:(f=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_TAKE_SCREENSHOT,g.push(b));break;case d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_SCREENSHOT_ACTION_SCREENSHOT_TYPE.SCREEN_RECORDING:e?f=d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_RECORD_SCREEN:(f=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_RECORD_SCREEN,g.push(b));break;default:throw c("err")("Received unexpected screenshot action type")}return{ephemeralScreenshotActionContent:g,ephemeralScreenshotActionType:f}}var l=(e={},e[(f=d("MAWLocalizationType")).LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_SECONDS]=f.LOCALIZATION_TYPE.SEND_BASED_UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_SECONDS,e[f.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_MINUTES]=f.LOCALIZATION_TYPE.SEND_BASED_UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_MINUTES,e[f.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_HOURS]=f.LOCALIZATION_TYPE.SEND_BASED_UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_HOURS,e[f.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_DAYS]=f.LOCALIZATION_TYPE.SEND_BASED_UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_DAYS,e[f.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_SECONDS]=f.LOCALIZATION_TYPE.SEND_BASED_YOU_EPHEMERAL_SETTING_TURNED_ON_SECONDS,e[f.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_MINUTES]=f.LOCALIZATION_TYPE.SEND_BASED_YOU_EPHEMERAL_SETTING_TURNED_ON_MINUTES,e[f.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_HOURS]=f.LOCALIZATION_TYPE.SEND_BASED_YOU_EPHEMERAL_SETTING_TURNED_ON_HOURS,e[f.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_DAYS]=f.LOCALIZATION_TYPE.SEND_BASED_YOU_EPHEMERAL_SETTING_TURNED_ON_DAYS,e[f.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_SECONDS]=f.LOCALIZATION_TYPE.SEND_BASED_PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_SECONDS,e[f.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_MINUTES]=f.LOCALIZATION_TYPE.SEND_BASED_PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_MINUTES,e[f.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_HOURS]=f.LOCALIZATION_TYPE.SEND_BASED_PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_HOURS,e[f.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_DAYS]=f.LOCALIZATION_TYPE.SEND_BASED_PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_DAYS,e[f.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_SECONDS]=f.LOCALIZATION_TYPE.SEND_BASED_UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_SECONDS,e[f.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_MINUTES]=f.LOCALIZATION_TYPE.SEND_BASED_UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_MINUTES,e[f.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_HOURS]=f.LOCALIZATION_TYPE.SEND_BASED_UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_HOURS,e[f.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_DAYS]=f.LOCALIZATION_TYPE.SEND_BASED_UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_DAYS,e[f.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_SECONDS]=f.LOCALIZATION_TYPE.SEND_BASED_YOU_EPHEMERAL_SETTING_CHANGE_SECONDS,e[f.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_MINUTES]=f.LOCALIZATION_TYPE.SEND_BASED_YOU_EPHEMERAL_SETTING_CHANGE_MINUTES,e[f.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_HOURS]=f.LOCALIZATION_TYPE.SEND_BASED_YOU_EPHEMERAL_SETTING_CHANGE_HOURS,e[f.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_DAYS]=f.LOCALIZATION_TYPE.SEND_BASED_YOU_EPHEMERAL_SETTING_CHANGE_DAYS,e[f.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_SECONDS]=f.LOCALIZATION_TYPE.SEND_BASED_PARTICIPANT_EPHEMERAL_SETTING_CHANGE_SECONDS,e[f.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_MINUTES]=f.LOCALIZATION_TYPE.SEND_BASED_PARTICIPANT_EPHEMERAL_SETTING_CHANGE_MINUTES,e[f.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_HOURS]=f.LOCALIZATION_TYPE.SEND_BASED_PARTICIPANT_EPHEMERAL_SETTING_CHANGE_HOURS,e[f.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_DAYS]=f.LOCALIZATION_TYPE.SEND_BASED_PARTICIPANT_EPHEMERAL_SETTING_CHANGE_DAYS,e);g.getEphemeralSettingChangeData=a;g.getEphemeralScreenshotActionData=b}),98);
__d("MAWEphemeralAdminMsgBuildTxns",["MAWAckLevel","MAWBridgeMsg","MAWBridgeTypesCreators","MAWDbMsgTxns","MAWDexieTable","MAWEphemeralUtils","MAWGlobals","MAWIndexedDb","MAWMsgType","MAWThreadSnippetBuildTxns","MAWWriteMsgTxns","WAJids","err","qex"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e,f,g,h,i,j){if(e<0)throw c("err")("Received unexpected ephemeral time setting");e=d("MAWEphemeralUtils").getEphemeralSettingChangeData(b,e,h,i);h=e.ephemeralSettingChangeContent;i=e.ephemeralSettingChangeType;var k={ack:d("MAWAckLevel").ACK.sent,altIndex:void 0,author:(e=b)!=null?e:d("WAJids").AUTHOR_SYSTEM,msgContent:{adminMsgContent:h,adminType:i,version:1},type:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN};e=j!=null&&b!=null?d("MAWDbMsgTxns").maybeGetMsgByExternalId(a,j,g.chatId,b):d("MAWDexieTable").dexieResolve();return e.then(function(b){if(b==null){var e,h=babelHelpers["extends"]({},k,{externalId:(e=j)!=null?e:d("MAWGlobals").getDependencies().generateExternalId(),thread:g.chatId,threadJid:g.jid,ts:f});return d("MAWWriteMsgTxns").writeMsg(a,h,g).then(function(a){return babelHelpers["extends"]({},h,{msgId:a.msgId,rowId:a.rowId})})}else if(b.type===d("MAWMsgType").MSG_TYPE.CIPHERTEXT){var i=babelHelpers["extends"]({},b,k);return a.messages.put(i).then(function(){d("MAWIndexedDb").afterTransaction({tag:"DeleteMessages",value:d("MAWBridgeTypesCreators").createBridgeDeleteMessages(b.thread,b.threadJid,[b])});c("qex")._("1210")!==!0&&d("MAWIndexedDb").afterTransaction({tag:"NewMsg",value:d("MAWBridgeMsg").createBridgeMsg(i)});return i.msgId===g.newestMsg?d("MAWThreadSnippetBuildTxns").buildThreadSnippet(a,i,g).then(function(a){var b=a.snippetParams,c=a.snippetSenderContactId;a=a.snippetType;d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({snippetParams:b,snippetSenderContactId:c,snippetType:a,threadId:g.chatId,threadJid:g.jid})});return i}):i})}else return null})}function b(a,b,e,f,g,h,i){var j=b===d("MAWGlobals").getMyUserJid(),k=d("MAWEphemeralUtils").getEphemeralScreenshotActionData(g,b,j),l=k.ephemeralScreenshotActionContent;k=k.ephemeralScreenshotActionType;if(i==null){var m={ack:d("MAWAckLevel").ACK.received,altIndex:void 0,author:j?d("WAJids").AUTHOR_ME:b,externalId:h,msgContent:{adminMsgContent:l,adminType:k,screenshotActionType:g,version:1},thread:e.chatId,threadJid:e.jid,ts:f,type:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION};return d("MAWWriteMsgTxns").writeMsg(a,m,e).then(function(a){return babelHelpers["extends"]({},m,{msgId:a.msgId,rowId:a.rowId})})}else if(i.type===d("MAWMsgType").MSG_TYPE.CIPHERTEXT){var n=babelHelpers["extends"]({},i,{ack:d("MAWAckLevel").ACK.received,altIndex:void 0,author:j?d("WAJids").AUTHOR_ME:b,msgContent:{adminMsgContent:l,adminType:k,screenshotActionType:g,version:1},type:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION});return a.messages.put(n).then(function(){d("MAWIndexedDb").afterTransaction({tag:"DeleteMessages",value:d("MAWBridgeTypesCreators").createBridgeDeleteMessages(i.thread,i.threadJid,[i])});c("qex")._("1210")!==!0&&d("MAWIndexedDb").afterTransaction({tag:"NewMsg",value:d("MAWBridgeMsg").createBridgeMsg(n)});return n.msgId===e.newestMsg?d("MAWThreadSnippetBuildTxns").buildThreadSnippet(a,n,e).then(function(a){var b=a.snippetParams,c=a.snippetSenderContactId;a=a.snippetType;d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({snippetParams:b,snippetSenderContactId:c,snippetType:a,threadId:e.chatId,threadJid:e.jid})});return n}):n})}else return d("MAWDexieTable").dexieResolve(null)}g.writeEphemeralSettingAdminMsg=a;g.writeEphemeralScreenshotActionMsg=b}),98);
__d("MAWMsgCleaner",["MAWLoggerUtils","Promise","WAAssertUnreachable","WAShiftTimer","WATagsLogger","WATimeUtils","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["","::_purgeNow "," msgs' content cleaned"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["","::_purgeNow"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["","::update ",""]);k=function(){return a};return a}a="Unsend";e="Ephemeral";f="DeleteForMe";var l="PendingStanza",m="Xma",n="IGDDM";f={DELETE_FOR_ME:f,EPHEMERAL:e,IGDDM:n,PENDING_STANZA:l,UNSEND:a,XMA:m};e=function(){function a(a,b){var e=this;this.$1=new(d("WAShiftTimer").ShiftTimer)(function(){c("promiseDone")(e.$2())});this.getNextTs=a.getNextTs;this.removeExpired=a.removeExpired;this.cleanerType=b;this.purgeEnabled=a.purgeEnabled;this.$1.forceRunNow()}var e=a.prototype;e.update=function(a){var b=o(this.cleanerType);d("WATagsLogger").TAGS([b,d("MAWLoggerUtils").Tag.MsgCleaner,d("MAWLoggerUtils").Tag.CleanerUpdate]).LOG(k(),b,a);this.$1.onOrBefore(d("WATimeUtils").cappedMillisecondsUntil(a))};e.$2=function(){var a=this;if(!this.purgeEnabled())return(h||(h=b("Promise"))).resolve();var c=o(this.cleanerType);d("WATagsLogger").TAGS([c,d("MAWLoggerUtils").Tag.MsgCleaner,d("MAWLoggerUtils").Tag.CleanerPurge]).LOG(j(),c);return this.removeExpired().then(function(b){b>0&&d("WATagsLogger").TAGS([c,d("MAWLoggerUtils").Tag.MsgCleaner,d("MAWLoggerUtils").Tag.CleanerPurge]).LOG(i(),c,b);return a.getNextTs()}).then(function(b){b!=null&&a.update(b)})};return a}();function o(a){switch(a){case"Unsend":return"UnsendMsgCleaner";case"Ephemeral":return"EphemeralCleaner";case"DeleteForMe":return"DeleteForMeCleaner";case"PendingStanza":return"PendingStanzaCleaner";case"Xma":return"XmaCleaner";case"IGDDM":return"IGDDisappearingMsgCleaner";default:return c("WAAssertUnreachable")(a)}}n=e;g.CLEANER_TYPE=f;g.MsgCleaner=e;g.MSG_CLEANER_FOR_TESTING_ONLY=n}),98);
__d("MAWEphemeralCleaner",["MAWLoggerUtils","MAWMsgCleaner","WATagsLogger","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["EphemeralCleaner: Adding timestamps for UI(",") and backend(",")"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["startEphemeralCleaner invoked"]);j=function(){return a};return a}var k=null;function a(a){var b=a.backendFns;a=a.uiFns;d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.Ephemeral,d("MAWLoggerUtils").Tag.MsgCleaner,d("MAWLoggerUtils").Tag.CleanerStart]).LOG(j());if(k==null){var c;k={backend:new((c=d("MAWMsgCleaner")).MsgCleaner)(b,c.CLEANER_TYPE.EPHEMERAL),ui:new c.MsgCleaner(a,c.CLEANER_TYPE.EPHEMERAL)}}}function b(a,b){if(k==null){var e="Trying to add new ephemeral timestamp before the cleaner is initialized!";d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.Ephemeral,d("MAWLoggerUtils").Tag.MsgCleaner,d("MAWLoggerUtils").Tag.CleanerTimestamp]).ERROR(i(),e);throw c("err")(e)}else{e=k;var f=e.backend;e=e.ui;d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.Ephemeral,d("MAWLoggerUtils").Tag.MsgCleaner,d("MAWLoggerUtils").Tag.CleanerTimestamp]).DEV(h(),a,b);e.update(a);f.update(b)}}function e(){return k}function f(){k=null}g.startEphemeralCleaner=a;g.addNewEphemeralTimestamp=b;g.getEphemeralCleaner_FOR_TESTING_ONLY=e;g.resetEphemeralCleaner_FOR_TESTING_ONLY=f}),98);
__d("MAWEphemeralMsgTxns",["MAWBridgeMsgCountdown","MAWBridgeTypesCreators","MAWDbMsg","MAWDbMsgTxns","MAWDbThreadTxns","MAWDbXMATxns","MAWDexieTable","MAWEphemeralCleaner","MAWEphemeralConsts","MAWEphemeralMsgUtils","MAWEphemeralSettingsTxns","MAWIndexedDb","MAWLocalizationType","MAWLoggerUtils","MAWThreadSnippetBuildTxns","MAWThreadSnippetUtils","MAWXMAUtils","WAGetHashFromProtocolMsgId","WAJids","WATagsLogger","WATimeUtils","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["incoming msg is not out of sync"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["incoming msg is out of sync: correct duration ",", correct timestamp ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["incoming msg is ephemeral: duration ",", timestamp ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["incoming msg is non-ephemeral"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["maybeUpdateEphemeralSettingOrCheckOutOfSyncAfterWritingIncomingMsg: Message from ",", chat ",", type ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["trying to update ephemeral timestamp to a later ts then previously set - expiration: "," ",", deletion: ","  ",", storedTs: ",", readTs: ",", ephemeralDuration ","  - ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["updating ephemeral timestamp msg ",", existing expiration ",", existing deletion ",", updated expiration ",", updated deletion ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["markEphemeralMessageAsSent EphemeralCounter: Showing UI counter for ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["bulkMarkEphemeralMessageAsRead EphemeralCounter: Showing UI counter for ",""]);q=function(){return a};return a}var r=d("WATagsLogger").TAGS([(h=d("MAWLoggerUtils")).Tag.Ephemeral,h.Tag.SettingSync,h.Tag.Incoming]),s=d("WATagsLogger").TAGS([h.Tag.Ephemeral,h.Tag.OnRead,h.Tag.Countdown]);function t(a,b,c,e,f){f===void 0&&(f=function(){return!0});b=d("MAWDbMsgTxns").IS_SORT_ORDER_COMPARISON_ENABLED?d("MAWDbMsgTxns").getThreadMessagesBySortOrder(a,b,!1,!0):a.messages.where("msgId").between(c,e,!1,!0);return b.filter(f).limit(1).toArray().then(function(a){return{needsUpdate:!0,value:(a=a[0])!=null?a:null}})}function u(a,b,e){return e.size===0?d("MAWDexieTable").dexieResolve():d("MAWDbThreadTxns").getThread(a,b).then(function(f){if(!f.success)return;var g=f.value,h=g.oldestMsg,i=g.newestMsg;if(h==null||i==null)return;f=d("MAWEphemeralMsgUtils").filterNonExpiredMsg(e);var j=e.has(h)?t(a,g.jid,h,i,f):d("MAWDexieTable").dexieResolve({needsUpdate:!1}),k=c("gkx")("289")?d("MAWDbMsgTxns").getThreadMessagesBySortOrder(a,g.jid,!0,!1):a.messages.where("msgId").between(h,i,!0,!1);k=e.has(i)?k.filter(f).reverse().limit(1).toArray().then(function(b){b=b[0];return b!=null&&d("MAWThreadSnippetUtils").isDbMsgDisabledForThreadSnippet(b)?d("MAWThreadSnippetUtils").findMostRecentSnippetMsgFromThread(a,g,e).then(function(a){return{needsUpdate:!0,value:(a=a)!=null?a:null}}):{needsUpdate:!0,value:(b=b)!=null?b:null}}):d("MAWDexieTable").dexieResolve({needsUpdate:!1});return d("MAWDexieTable").dexieAll([j,k]).then(function(c){var e=c[0],f=c[1];if(!e.needsUpdate&&!f.needsUpdate)return;c=f.needsUpdate?(c=(c=f.value)==null?void 0:c.msgId)!=null?c:void 0:i;var j=f.needsUpdate?f.value!=null?d("WATimeUtils").castUnixTimeToMillisTime(d("MAWDbMsg").getCanonicalTsFromMsg(f.value)):void 0:g.snippetMsgTs,k=babelHelpers["extends"]({},g,{newestMsg:c,oldestMsg:e.needsUpdate?(e=(e=e.value)==null?void 0:e.msgId)!=null?e:null:h,snippetMsg:c,snippetMsgTs:j});return a.threads.put(k).then(function(){if(f.needsUpdate){var c=f.value;if(c==null)d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({snippetParams:{contactIDs:[],strings:[]},snippetSenderContactId:"0",snippetType:d("MAWLocalizationType").LOCALIZATION_TYPE.EMPTY_SNIPPET,threadId:b,threadJid:k.jid})});else return d("MAWThreadSnippetBuildTxns").buildThreadSnippet(a,c,k).then(function(a){var c=a.snippetParams,e=a.snippetSenderContactId;a=a.snippetType;d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({snippetParams:c,snippetSenderContactId:e,snippetType:a,threadId:b,threadJid:k.jid})})})}})})})}function a(a,b){var c={};b.map(function(a){var b=a.msgId;a=a.ts;b=d("WAGetHashFromProtocolMsgId").getHashFromProtocolMsgId(b);c[b]=a});return d("MAWDbMsgTxns").getMsgsByProtocolMsgId(a,b.map(function(a){return babelHelpers["extends"]({},a.msgId)})).then(function(b){b=b.map(function(a){var b,e=a.author;if(a.threadJid==null||d("WAJids").isAuthorSystem(e))return null;e=d("WAGetHashFromProtocolMsgId").getHashFromProtocolMsgId({author:e,chat:a.threadJid,externalId:a.externalId});e=c[e];b=(b=a.ephemeralSetting)==null?void 0:b.ephemeralExpirationInSec;if(b==null||b===0)return null;b=d("WATimeUtils").castToUnixTime(e+b);var f=d("WATimeUtils").castToUnixTime(b+d("MAWEphemeralConsts").ephemeralReportingWindowInSeconds);return{messageDeleteTs:f,messageExpirationTs:b,msgId:a.msgId,readTsForLogging:e}}).filter(Boolean);return v(a,b,"bulkMarkEphemeralMessageAsRead")}).then(function(a){var b=a[0],c=a[1];a=a[2];a.length>0&&(s.LOG(q(),a.map(function(a){return a.msgId})),d("MAWIndexedDb").afterTransaction({tag:"MsgsStartCountdown",value:d("MAWBridgeMsgCountdown").createBridgeMsgsStartCountdown(a)}));b!=null&&c!=null&&d("MAWEphemeralCleaner").addNewEphemeralTimestamp(b,c)})}function b(a,b){if(b==null||b.ephemeralSetting==null||b.ephemeralSetting.ephemeralExpirationInSec===0)return d("MAWDexieTable").dexieResolve(b);var c=d("WATimeUtils").castToUnixTime(b.ts+b.ephemeralSetting.ephemeralExpirationInSec),e=d("WATimeUtils").castToUnixTime(c+d("MAWEphemeralConsts").ephemeralReportingWindowInSeconds);return v(a,[{messageDeleteTs:e,messageExpirationTs:c,msgId:b.msgId,readTsForLogging:b.ts}]).then(function(a){var b=a[0],c=a[1];a=a[2];a.length>0&&(s.LOG(p(),a.map(function(a){return a.msgId})),d("MAWIndexedDb").afterTransaction({tag:"MsgsStartCountdown",value:d("MAWBridgeMsgCountdown").createBridgeMsgsStartCountdown(a)}));b!=null&&c!=null&&d("MAWEphemeralCleaner").addNewEphemeralTimestamp(b,c);return a[0]})}function v(a,b,c){var e=b.map(function(a){return a.msgId});return d("MAWDbXMATxns").getXMAMsgIdsFromAssociatedMsgIds(a,e).then(function(d){var f=new Map();b.forEach(function(a){f.set(a.msgId,{messageDeleteTs:a.messageDeleteTs,messageExpirationTs:a.messageExpirationTs,readTsForLogging:a.readTsForLogging});var b=d.get(a.msgId);b!=null&&f.set(b,{messageDeleteTs:a.messageDeleteTs,messageExpirationTs:a.messageExpirationTs,readTsForLogging:a.readTsForLogging})});var g=null,h=null,i=[],j=Array.from(new Set(e.concat(Array.from(d.values()))));return a.messages.where("msgId").anyOf(j).toArray().then(function(b){if(b.length===0)return;b.forEach(function(a){var b=a.messageExpirationTs,d=a.messageDeleteTs,e=f.get(a.msgId),j=e==null?void 0:e.messageExpirationTs,k=e==null?void 0:e.messageDeleteTs;e=e==null?void 0:e.readTsForLogging;s.LOG(o(),a.msgId,b,d,j,k);if(j==null||k==null)return;if(b!=null&&j>b||d!=null&&j>d){s.ERROR(n(),j,b,k,d,a.ts,e,(b=a.ephemeralSetting)==null?void 0:b.ephemeralExpirationInSec,c);return}if(a.ephemeralCounterStarted===!0)return;g==null?g=j:j<g&&(g=j);h==null?h=k:k<h&&(h=k);d=babelHelpers["extends"]({},a,{ephemeralCounterStarted:!0,messageDeleteTs:k,messageExpirationTs:j});i.push(d)});return a.messages.bulkPut(i)}).then(function(){return[g,h,i]})})}function e(a,b){if(b.size===0)return d("MAWDexieTable").dexieResolve();var c=[];b.forEach(function(b,d){c.push(u(a,d,b))});return d("MAWDexieTable").dexieAll(c).then(function(){})}function f(a,b,c){if(b==null||b.ephemeralSetting==null||b.ephemeralSetting.ephemeralExpirationInSec===0)return d("MAWDexieTable").dexieResolve();var e=d("WATimeUtils").castToUnixTime(c+d("MAWEphemeralConsts").ephemeralMaxDelectionWindowForUnseenMessage);return d("MAWDbXMATxns").getDbXMAMsgFromAssociatedMsgId(a,b.msgId).then(function(c){var f=[babelHelpers["extends"]({},b,{messageDeleteTs:e,messageExpirationTs:e})];c!=null&&d("MAWXMAUtils").isXMAShare(c.xmaMessageType)&&f.push(babelHelpers["extends"]({},c,{messageDeleteTs:e,messageExpirationTs:e}));return a.messages.bulkPut(f).then(function(){})})}function w(a,b,c,e,f,g){if(b==null||f==null)return d("MAWDexieTable").dexieResolve();r.LOG(m(),c,e.jid,b.type);var h=d("MAWDexieTable").dexieResolve();if(b.ephemeralSetting==null)d("WAJids").switchOnMsgrChatJidType(e.jid,{group:function(){return d("MAWEphemeralSettingsTxns").maybeResetEphemeralSyncResponseBackoffInfo(a,c).then(function(){})},user:function(){d("MAWDbMsg").isMsgEligibleForTriggeringEphemeralSyncResponse(b)&&(r.LOG(l()),h=d("MAWEphemeralSettingsTxns").getOutOfSyncEphemeralSettingForIncomingNonEphemeralMsg(a,e.jid).then(function(a){return a==null?void 0:(a=a.value)==null?void 0:a.outOfSyncEphemeralSetting}))}});else if(b.messageExpirationTs!=null&&b.messageDeleteTs!=null){var n=b.ephemeralSetting,o=b.messageDeleteTs,p=b.messageExpirationTs;r.LOG(k(),n.ephemeralExpirationInSec,n.ephemeralLastUpdatedOrSetTimestamp);d("MAWEphemeralCleaner").addNewEphemeralTimestamp(p,o);h=d("MAWEphemeralSettingsTxns").handleAndWriteIncomingEphemeralSetting(a,c,f,n.ephemeralExpirationInSec,n.ephemeralLastUpdatedOrSetTimestamp,!1,e,g,null,!0).then(function(a){return a==null?void 0:a.outOfSyncEphemeralSetting})}return h.then(function(b){if(b!=null){r.LOG(j(),b.correctEphemeralExpirationInSec,b.correctEphemeralLastUpdatedOrSetTimestamp);return b}else{r.LOG(i());return d("MAWEphemeralSettingsTxns").maybeResetEphemeralSyncResponseBackoffInfo(a,c).then(function(){})}})}g.bulkMarkEphemeralMessageAsRead=a;g.markEphemeralMessageAsSent=b;g.bulkUpdateEphemeralMessageTimestamps=v;g.updateThreadsOnMessagesExpiredFromUi=e;g.maybeUpdateEphemeralMessageWhenMarkedSent=f;g.syncEphemeralSettingOnIncomingMsg=w}),98);
__d("MAWEphemeralSettingsCache",["MAWBridge","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h=new Map();function i(a,b){h.set(a,b)}function a(a){var b={ephemeralExpirationInSec:0,ephemeralLastUpdatedOrSetTimestamp:d("WATimeUtils").castToUnixTime(0)};return(a=h.get(a))!=null?a:b}function c(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b={ephemeralExpirationInSec:0,ephemeralLastUpdatedOrSetTimestamp:d("WATimeUtils").castToUnixTime(0)};if(!h.has(a)){var c=(yield d("MAWBridge").getBridge().sendAndReceive("event","getLSDBEphemeralSetting",{chatJid:a}));i(a,(a=c)!=null?a:b)}});return j.apply(this,arguments)}g.setEphemeralSettingCache=i;g.getEphemeralSettingCache=a;g.requestLSDBCacheForJid=c}),98);
__d("MAWEphemeralSettingsTxns",["MAWDbThreadTxns","MAWDexieTable","MAWEphemeralAdminMsgBuildTxns","MAWEphemeralSettingsCache","MAWEphemeralUtil","MAWGlobals","MAWIndexedDb","MAWLoggerUtils","WAJids","WALogger","WAResultOrError","WATagsLogger","WATimeUtils","err","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["maybeResetEphemeralSyncResponseBackoffInfo reset for ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["maybeResetEphemeralSyncResponseBackoffInfo no op for ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Contact "," "," and ephemeral setting "," should not be null when receiving the server ack for outgoing ephemeral setting change"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Writing ephemeral duration "," with ts "," , previous duration "," with ts ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleAndWriteIncomingEphemeralSetting - ephemeral setting in sync"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleAndWriteIncomingEphemeralSetting - Sending Sync Response with duration ",", timestamp ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received invalid chat jid for incoming ephemeral settings"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleAndWriteIncomingEphemeralSetting - Handle Incoming Ephemeral Setting duration: ",", lastUpdated: ",""]);p=function(){return a};return a}var q=d("WATagsLogger").TAGS([(h=d("MAWLoggerUtils")).Tag.Ephemeral,h.Tag.SettingChange,h.Tag.Incoming]),r=d("WATagsLogger").TAGS([h.Tag.Ephemeral,h.Tag.SettingChange,h.Tag.Outgoing]);function s(){return c("gkx")("23920")}var t=null;function a(a,b,e,f,g,h,i,j,k,r){if(f<0||f>86400){var u=d("WAJids").interpretAndValidateJid(i.jid).toString();throw c("err")("EphemeralSetting duration is invalid "+f+", jidType: "+u)}var v={ephemeralExpirationInSec:f,ephemeralLastUpdatedOrSetTimestamp:g};d("WALogger").LOG(p(),f,g);var w=d("WAJids").interpretAsUserJid(i.jid),x=s();if(w==null){q.ERROR(o());return d("MAWDexieTable").dexieResolve(t)}var y=d("WAJids").isAuthorMe(b)?d("MAWGlobals").getMyUserJid():b,z=e!=null?d("WAJids").toDeviceJid(y,e.id):null;return a.ephemeralSettings.get({userJid:w}).then(function(c){var e=x?d("MAWEphemeralSettingsCache").getEphemeralSettingCache(i.jid):c==null?void 0:c.ephemeralSetting,o=e==null?void 0:e.ephemeralExpirationInSec;c=e==null?void 0:e.ephemeralLastUpdatedOrSetTimestamp;if(r){if(e!=null&&z!=null&&!d("MAWEphemeralUtil").isLocalSettingOutdated(v,e,z))if(g!==c){d("WALogger").LOG(n(),o,c);return{dbMsg:null,outOfSyncEphemeralSetting:{chatJid:i.jid,correctEphemeralExpirationInSec:e.ephemeralExpirationInSec,correctEphemeralLastUpdatedOrSetTimestamp:e.ephemeralLastUpdatedOrSetTimestamp}}}else{d("WALogger").WARN(m());return t}d("MAWIndexedDb").afterTransaction({tag:"EphemeralSettingsUpdatedForUI",value:{author:d("WAJids").userIdFromJid(y),chatJid:i.jid,ephemeralSettingArgs:v,isEphemeralSettingReset:h}});if(x)return t}c={ephemeralSetting:v,ephemeralSyncResponseBackoffInfo:void 0,userJid:w};return a.ephemeralSettings.put(c).then(function(){if(!x&&(e==null||o!==f)){q.LOG(l(),f,g,e==null?void 0:e.ephemeralLastUpdatedOrSetTimestamp,e==null?void 0:e.ephemeralExpirationInSec);var c=(e==null||o===0)&&f>0;return d("MAWEphemeralAdminMsgBuildTxns").writeEphemeralSettingAdminMsg(a,b,f,j,i,c,h,k).then(function(a){return{dbMsg:a}})}else return t})})}function b(a,b,e,f,g){var h=e;if(h<0)throw c("err")("Ephemeral duration should be 0 or more");var i=d("MAWEphemeralUtil").getUserJidForEphemeralSetting(b);return d("MAWDbThreadTxns").getThreadByJid(a,b).then(function(b){return!b.success?{success:!1}:a.ephemeralSettings.get({userJid:i}).then(function(c){if(!d("MAWEphemeralUtil").shouldUpdateForOutgoingUserEphemeralSettingChange(c,h,f))return{success:!1};var e,j=!0;if(c==null)e={ephemeralSetting:{ephemeralExpirationInSec:h,ephemeralLastUpdatedOrSetTimestamp:f},userJid:i};else{var k=c.ephemeralSetting;j=k==null||k.ephemeralExpirationInSec===0;e=babelHelpers["extends"]({},c,{ephemeralSetting:{ephemeralExpirationInSec:h,ephemeralLastUpdatedOrSetTimestamp:f}})}k=s();return d("MAWDexieTable").dexieAll([a.ephemeralSettings.put(e),k?d("MAWDexieTable").dexieResolve():d("MAWEphemeralAdminMsgBuildTxns").writeEphemeralSettingAdminMsg(a,d("MAWGlobals").getMyUserJid(),h,f,b.value,j,g)]).then(function(){return{success:!0}})})})}function e(a,b,e){var f=d("MAWEphemeralUtil").getUserJidForEphemeralSetting(b);return a.ephemeralSettings.get({userJid:f}).then(function(b){if(b==null||b.ephemeralSetting==null){r.ERROR(k(),f,b,b==null?void 0:b.ephemeralSetting);throw c("err")("Contact and ephemeral setting should not be null when receiving the server ack for outgoing ephemeral setting change")}b=babelHelpers["extends"]({},b,{ephemeralSetting:{ephemeralExpirationInSec:b.ephemeralSetting.ephemeralExpirationInSec,ephemeralLastUpdatedOrSetTimestamp:e}});return a.ephemeralSettings.put(b).then(function(){})})}function f(a,b){var e=[d("WAJids").interpretAsUserJid(b),s()],f=e[0],g=e[1];if(f==null)throw c("err")("Unexpected chatJid input to isEphemeralMessagesEnabledForContact");var h=d("MAWEphemeralSettingsCache").getEphemeralSettingCache(b);return a.ephemeralSettings.get({userJid:f}).then(function(a){if(g&&h.ephemeralLastUpdatedOrSetTimestamp===d("WATimeUtils").castToUnixTime(0)||a==null)return d("WAResultOrError").makeError("no_ephemeral_setting");a=g?h:a.ephemeralSetting;return a!=null&&a.ephemeralExpirationInSec>0?d("WAResultOrError").makeResult({outOfSyncEphemeralSetting:{chatJid:b,correctEphemeralExpirationInSec:a.ephemeralExpirationInSec,correctEphemeralLastUpdatedOrSetTimestamp:a.ephemeralLastUpdatedOrSetTimestamp}}):d("WAResultOrError").makeError("no_ephemeral_setting")})}function u(a,b){return a.ephemeralSettings.get({userJid:b}).then(function(c){if((c==null?void 0:c.ephemeralSyncResponseBackoffInfo)==null){q.LOG(j(),b);return d("WAResultOrError").makeResult()}c.ephemeralSyncResponseBackoffInfo=void 0;q.LOG(i(),b);return a.ephemeralSettings.put(c).then(function(){return d("WAResultOrError").makeResult()})})}g.getOccamMIEnabled=s;g.handleAndWriteIncomingEphemeralSetting=a;g.handleAndWriteOutgoingUserEphemeralSettingChange=b;g.updateContactWhenEphemeralSettingChangeMarkedSent=e;g.getOutOfSyncEphemeralSettingForIncomingNonEphemeralMsg=f;g.maybeResetEphemeralSyncResponseBackoffInfo=u}),98);
__d("MAWBridgeThread",["MAWTimeUtils","WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e,f){var g=d("WAJids").switchOnMsgrChatJidType(a.jid,{group:function(a){return!0},user:function(a){return!1}});return{authoritativeThreadKey:c,cannotReplyReason:a.cannotReplyReason,chatId:a.chatId,clientThreadKey:b,description:e,folder:a.folder,isGroup:g,jid:a.jid,lastActivityTs:d("MAWTimeUtils").ensureValidMillisTime(a.snippetMsgTs!=null&&d("WATimeUtils").fromMillisTime(a.snippetMsgTs)!==0?a.snippetMsgTs:f)||d("WATimeUtils").castToMillisTime(0),lastReadTs:d("MAWTimeUtils").ensureValidMillisTime(a.lastReadMsgTs)||d("WATimeUtils").castToMillisTime(0),muteExpireTimeMs:(c=a.muteExpireTimeMs)!=null?c:0}}function b(a,b,c,d){return{lastActivityTimestampMs:d,lastReadWatermarkTs:c,threadId:b,threadJid:a}}g.createBridgeThread=a;g.createBridgeThreadTimestampsUpdated=b}),98);
__d("MAWGetOrCreateThreadTxns",["MAWAdminMsgTxns","MAWBridgeThread","MAWBridgeTypesCreators","MAWDbMsgTxns","MAWDbThread","MAWDexieTable","MAWFolderTypes","MAWIndexedDb","WATimeUtils","getErrorSafe"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){if(a!=null&&b!=null){var c=d("WATimeUtils").fromMillisTime(a),e=d("WATimeUtils").fromMillisTime(b);return d("WATimeUtils").castToMillisTime(Math.max(c,e))}return(c=a)!=null?c:b}function i(a,b){return a.threads.get({jid:b})}function a(a,b){var c=b.deduplicationKey,e=b.jid;c=b.deduplicationKey!=null?a.threads.get({deduplicationKey:c}):d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([c,i(a,e)]).then(function(c){var d=c[0];c=c[1];if(d!=null)return{created:!1,thread:d};if(c==null)return j(a,b).then(function(a){return{created:!0,thread:a}});else return k(a,b,c).then(function(a){return{created:!1,thread:a}})})}function j(a,b){var e=b.authoritativeThreadKey,f=b.clientThreadKey,g=b.createTs,h=b.deduplicationKey,i=b.description,j=b.folder,k=b.jid,l=b.lastActivityTimestamp,m=b.lastReadWatermarkTimestamp,n=b.skipVerifyThread,o=(l=(b=l)!=null?b:g)!=null?l:d("WATimeUtils").millisTime();b=o!=null?d("WATimeUtils").castToMillisTime(Math.max(o-1,0)):null;l=(g=m)!=null?g:b;var p={authoritativeThreadKey:e!=null?e:void 0,deduplicationKey:h,folder:j!=null?j:d("MAWFolderTypes").FOLDER_ID.INBOX,jid:k,lastReadMsg:null,lastReadMsgReceiptSent:null,lastReadMsgTs:l,newestMsg:null,newestMsgTs:o,oldestMsg:null,optimisticThreadKey:(m=f)!=null?m:void 0,threadOrder:d("MAWDbThread").craftThreadOrder(o,k)};return a.threads.add(p).then(function(b){b=babelHelpers["extends"]({},p,{chatId:b});n!==!0&&d("MAWIndexedDb").afterTransaction({tag:"VerifyThreadExists",value:d("MAWBridgeThread").createBridgeThread(b,b.optimisticThreadKey,e,i,o)});return d("MAWAdminMsgTxns").writeE2EEThreadDescriptionMsg(a,b)})["catch"](function(a){a=c("getErrorSafe")(a);a.message="Error creating thread: "+a.message;throw a})}function k(a,b,e){var f=b.authoritativeThreadKey,g=b.clientThreadKey,i=b.deduplicationKey,j=b.description,k=b.folder,l=b.lastActivityTimestamp,m=b.lastReadWatermarkTimestamp,n=b.skipVerifyThread;return d("MAWDbMsgTxns").getThreadNewestMessageTsBySortOrder(a,e).then(function(b){var o,p=babelHelpers["extends"]({},e,{authoritativeThreadKey:(o=f)!=null?o:e.authoritativeThreadKey,cannotReplyReason:k!=null||g!=null?null:e.cannotReplyReason,deduplicationKey:k!=null||g!=null?i:e.deduplicationKey,folder:(o=k)!=null?o:e.folder,lastReadMsgTs:h(e.lastReadMsgTs,m),newestMsgTs:h(b,l),optimisticThreadKey:(o=g)!=null?o:e.optimisticThreadKey});return a.threads.update(e.chatId,p).then(function(){var a;n!==!0&&d("MAWIndexedDb").afterTransaction({tag:"VerifyThreadExists",value:d("MAWBridgeThread").createBridgeThread(p,p.optimisticThreadKey,f,j,b)});d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({folder:(a=p==null?void 0:p.folder)!=null?a:d("MAWFolderTypes").FOLDER_ID.INBOX,threadId:p.chatId,threadJid:p.jid})});return p})["catch"](function(a){a=c("getErrorSafe")(a);a.message="Error updating thread: "+a.message;throw a})})}g.getExistingThread=i;g.getOrCreateThread=a;g.createThread=j;g.updateThread=k}),98);
__d("MAWAfterWriteMsgUtil",["ArmadilloDataTraceType","I64","MAWBridgeMsg","MAWBridgeTrace","MAWBridgeTypesCreators","MAWCalculateBumpTimestampMs","MAWDbMsg","MAWIndexedDb","MAWLocalizationType","MAWMsgType","MAWXMAUtils","WAJids","WALogger","WATimeUtils","gkx","justknobx","qex"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Skipping local thread bump for threadId: ",", msgType: ",""]);i=function(){return a};return a}function a(a){var b=a.dbMsg,e=a.ebRestore,f=a.hasMoreAfter,g=a.hasMoreBefore,k=a.isFirstMsg,l=a.isOldestMsgUpdated,m=a.msgsLeftToRestoreForEB,n=a.openMessageOtid,o=a.openMessageParticipantCount,p=a.optimisticMsg,q=a.participantCount,r=a.prevOldestMsg,s=a.quotedReplyAttachmentMeta,t=a.snippet,u=a.updatedThread,v=u.authoritativeThreadKey,w=u.chatId,x=u.jid,y=u.lastReadMsgTs,z=u.newestMsgTs;u=u.oldestMsg;if(b.altIndex===d("MAWDbMsg").SPAM_ALT_INDEX||b.altIndex===d("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX)return;d("MAWIndexedDb").afterTransaction({tag:"StartTrace",value:d("MAWBridgeTrace").createBridgeStartTraceData(b,x,d("ArmadilloDataTraceType").armadilloMessageSend,n,k,o,q,v)});!d("MAWXMAUtils").isXMAStoryReply(b.xmaMessageType)&&c("qex")._("1210")!==!0&&d("MAWIndexedDb").afterTransaction({tag:"NewMsg",value:d("MAWBridgeMsg").createBridgeMsg(b,p,s)});n=j(a);n&&d("WALogger").LOG(i(),w,b.type);if(!n&&t!=null&&z!=null){k=t.snippetParams;o=t.snippetSenderContactId;q=t.snippetType;if(!c("gkx")("23996"))d("MAWIndexedDb").afterTransaction({tag:"ThreadBumped",value:d("MAWBridgeTypesCreators").createBridgeBumpedThread(w,x,z,y,q,k,o,"writeMsgAfterTransaction-"+b.type,b.externalId)});else{v=d("MAWCalculateBumpTimestampMs").calculateBumpTimestampMs(b.serverTs!=null?d("WATimeUtils").castUnixTimeToMillisTime(b.serverTs):z,(h||(h=d("I64"))).of_string_opt(b.externalId));d("MAWIndexedDb").afterTransaction({tag:"ThreadBumpedV2",value:d("MAWBridgeTypesCreators").createBridgeBumpedThreadV2({bumpTimestampMs:v,description:"writeMsgAfterTransaction-"+b.type,isMessageAuthorMe:b.author===d("WAJids").AUTHOR_ME,skipServerThreadBump:!0,snippetParams:k,snippetSenderContactId:o,snippetType:q,threadId:w,threadJid:x})})}}p=e!=null&&e&&m!=null&&m<=1;if((r==null||p)&&c("qex")._("1210")!==!0){d("MAWIndexedDb").afterTransaction({tag:"MsgsLoaded",value:d("MAWBridgeTypesCreators").createBridgeMsgsLoadedInfo(w,x,[b],!0,(s=g)!=null?s:!1,(a=f)!=null?a:!1)})}l&&u!=null&&d("MAWIndexedDb").afterTransaction({tag:"UpdateMinMessage",value:{minMessageId:u,minTimestampMs:d("MAWDbMsg").getCanonicalTsFromMsg(b)*1e3,threadId:w,threadJid:x}})}function j(a){var b=a.dbMsg,e=a.ebRestore;a=a.skipLocalThreadBump;a=a===void 0?!1:a;if(e!=null&&e)return!0;if(d("MAWXMAUtils").isXMAStoryReply(b.xmaMessageType))return!0;if(c("justknobx")._("2017")&&b.type===d("MAWMsgType").MSG_TYPE.ADMIN&&b.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION)return!0;return a?!0:!1}g.writeMsgAfterTransaction=a}),98);
__d("MAWAdminMsgTxns",["MAWAfterWriteMsgUtil","MAWDbMsg","MAWDbThread","MAWDbThreadTxns","MAWLocalizationType","MAWLocalizationUtils","MAWThreadSnippetUtils","MAWTimeUtils","MAWWriteBulkWriteIncomingAdminMsgTxns","MAWWriteMsgTxns","WALogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["writeReachabilityErrorAdminMsg failed to create or get 1:1 thread"]);h=function(){return a};return a}function a(a,b,c){var e=a.ts;e=d("WATimeUtils").castUnixTimeToMillisTime(e);c=d("MAWTimeUtils").ensureValidMillisTime(c)||d("WATimeUtils").castToMillisTime(0);e=e>c?e:c;c=d("MAWThreadSnippetUtils").isDbMsgDisabledForThreadSnippet(a);return babelHelpers["extends"]({},b,{newestMsg:a.msgId,newestMsgTs:e,oldestMsg:a.msgId,snippetMsg:c?void 0:a.msgId,snippetMsgTs:c?void 0:d("WATimeUtils").castUnixTimeToMillisTime(d("MAWDbMsg").getCanonicalTsFromMsg(a)),threadOrder:d("MAWDbThread").craftThreadOrder(e,b.jid)})}function b(a){a.forEach(function(a){return d("MAWAfterWriteMsgUtil").writeMsgAfterTransaction(a)})}function c(a,b){return d("MAWDbThreadTxns").getThreadByJid(a,b).then(function(b){if(!b.success){d("WALogger").WARN(h());return}b=b.value;var c=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:[],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.REACHABILITY_ERROR,version:0},b.chatId,b.jid,d("WATimeUtils").castMillisTimeToUnixTime(b.lastReadMsgTs));return d("MAWWriteMsgTxns").writeMsg(a,c,b).then(function(){})})}function e(a,b){return d("MAWWriteBulkWriteIncomingAdminMsgTxns").writeE2EEAdminMsgsForIncomingCreatedThreads(a,[b]).then(function(a){a=a[0];return a})}function f(a){var b=d("MAWDbMsg").craftE2eeAdminMsgAltIndex(a.chatId);b=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:[],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION,version:0},a.chatId,a.jid,d("WATimeUtils").castToUnixTime(0),b);return babelHelpers["extends"]({},b,{msgId:d("MAWDbMsg").craftMsgIdV2(a.chatId,1,b),sortOrderMs:0})}g.getUpdatedThreadForAdminMsg=a;g.syncMsgsDataAfterTransaction=b;g.writeReachabilityErrorAdminMsg=c;g.writeE2EEThreadDescriptionMsg=e;g.buildE2EEThreadDescriptionMsg=f}),98);
__d("MAWWriteBulkWriteIncomingAdminMsgTxns",["MAWAdminMsgTxns","MAWDbMsgTxns","MAWDexieTable","MAWThreadSnippetBuildTxns","MAWThreadSnippetForAdminOrEphemeralMsg","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["OfflineBulkWriteAdminmsg - Missing thread when write e2ee thread description"]);h=function(){return a};return a}function i(a,b){var e=[],f=[],g=[],i=new Map(),j=new Map(),k=b.map(function(b){return d("MAWDbMsgTxns").getThreadOldestMessageIdBySortOrder(a,b).then(function(a){return i.set(b.jid,a)})}),l=b.map(function(b){return d("MAWDbMsgTxns").getThreadNewestMessageTsBySortOrder(a,b).then(function(a){return j.set(b.jid,a)})});return d("MAWDexieTable").dexieAll([k,l]).then(function(){b.forEach(function(a){a==null&&d("WALogger").ERROR(h());var b=d("MAWAdminMsgTxns").buildE2EEThreadDescriptionMsg(a),k=d("MAWAdminMsgTxns").getUpdatedThreadForAdminMsg(b,a,j.get(a.jid)),l=c("MAWThreadSnippetForAdminOrEphemeralMsg")(b,d("MAWThreadSnippetBuildTxns").getSnippetContactId(b.author));a=i.get(a.jid);e.push(b);g.push(k);f.push({dbMsg:b,isFirstMsg:!1,isOldestMsgUpdated:a!=null&&b.msgId!==a,prevOldestMsg:a==null?void 0:a,snippet:l,updatedThread:k})});return{afterTransactionSyncMsgsData:f,e2eeThreadAdminMsgs:e,threadsToUpdate:g}})}function a(a,b){return i(a,b).then(function(b){var c=b.afterTransactionSyncMsgsData,e=b.e2eeThreadAdminMsgs,f=b.threadsToUpdate;return d("MAWDexieTable").dexieAll([a.messages.bulkAdd(e),a.threads.bulkPut(f)]).then(function(){d("MAWAdminMsgTxns").syncMsgsDataAfterTransaction(c);return f})})}g.writeE2EEAdminMsgsForIncomingCreatedThreads=a}),98);
__d("MAWAddQPLPointForHandleIncomingMsgApi",["MAWDexieTable","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(!c("gkx")("23963"))return;var e=d("MAWDexieTable").getDexiePSDItem("transactorQPLEvent"),f=d("MAWDexieTable").getDexiePSDItem("offlineQueueSize");f===1&&(e==null?void 0:e.addPoint(a,b))}g.addQPLPointForHIMApi=a}),98);
__d("MAWBuildIncomingMsgs",["MAWAckLevel","MAWDbMsg","MAWMsgType","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=6*d("WATimeUtils").HOUR_SECONDS;function a(a,b){var c=a.author;a=a.externalId;return{ack:d("MAWAckLevel").ACK.received,altIndex:void 0,author:c,externalId:a,serverTs:b,ts:b,type:d("MAWMsgType").MSG_TYPE.CIPHERTEXT}}function b(a,b){var c=a.author;a=a.externalId;return{ack:d("MAWAckLevel").ACK.failed,altIndex:void 0,author:c,externalId:a,serverTs:b,ts:b,type:d("MAWMsgType").MSG_TYPE.UNAVAILABLE}}function c(a,b){var c;return{ack:a.ack,author:a.author,externalId:a.externalId,messageDeleteForMeTs:d("WATimeUtils").castToUnixTime(d("WATimeUtils").unixTime()+h),msgContent:(c=d("MAWDbMsg").getMsgContent(a))==null?void 0:c.content,thread:b.chatId,threadJid:b.jid,ts:a.ts,type:d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME}}function e(a,b,c){return{ack:a.ack,altIndex:void 0,author:a.author,externalId:c.externalId,msgContent:d("MAWDbMsg").getMsgContent(a),originalTs:a.ts,revokedExternalId:c.revokedExternalId,thread:b.chatId,threadJid:b.jid,ts:c.ts,type:d("MAWMsgType").MSG_TYPE.REVOKED,unsendMsgContentDeleteTs:d("WATimeUtils").castToUnixTime(d("WATimeUtils").unixTime()+h)}}g.REVOKE_CONTENT_EXPIRATION_IN_SEC=h;g.buildUnstoredCiphertextMsg=a;g.buildUnstoredUnavailableMsg=b;g.buildUnstoredDeleteForMeMsg=c;g.buildUnstoredRevokedMsg=e}),98);
__d("MAWThreadEvent",["LSContactUtils","MAWBridge","MAWBridgeSendAndReceive","MAWContactRelationshipType","MAWJobDefinitions","MAWUIJob","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";b="placeholderConvertSubscription";function a(a,b,e){d("MAWBridge").getBridge().setHandlers("threadEvent",{placeholderConvertSubscription:function(f){var g=f.chatJid;f=f.msgId;a===g&&c("promiseDone")(d("MAWBridgeSendAndReceive").sendAndReceive("backend","getProtocolMsgIdByMsgId",{msgId:f}).then(function(a){if(a==null)return;d("MAWUIJob").UIJobStarters.fireAndForget(d("MAWJobDefinitions").jobSerializers.markThreadAsRead(g,b&&d("MAWContactRelationshipType").getContactRelationshipType(b),b?d("LSContactUtils").isContactBlocked(b):!1,b?d("LSContactUtils").isContactRestricted(b):!1,a,e))}))}})}g.PLACEHOLDER_CONVERT_SUBSCRIPTION=b;g.setThreadEventHandler=a}),98);
__d("MAWBridgeParticipants",["WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(a){var b=a.deliveredWatermarkTs,c=a.lastReadActionTs,e=a.lastReadWatermarkTs,f=a.threadId,g=a.threadJid,h=a.type;a=a.userJid;return{deliveredWatermarkTs:b||d("WATimeUtils").castToUnixTime(0),fbid:d("WAJids").extractUserId(a),isAdmin:h==="superadmin"||h==="admin",isInvited:h==="invitedParticipant",isSuperAdmin:h==="superadmin",lastReadActionTs:(b=c)!=null?b:d("WATimeUtils").castToUnixTime(0),readWatermarkTs:e||d("WATimeUtils").castToUnixTime(0),threadId:f,threadJid:g}}function a(a){return{participants:a.map(function(a){return h(a)})}}g.createBridgeParticipant=h;g.createBridgeParticipants=a}),98);
__d("MAWDbParticipantTxns",["MAWBridgeParticipants","MAWBridgeTypesCreators","MAWCurrentUser","MAWDbParticipant","MAWDexieTable","MAWIndexedDb","MAWODSProxy","WAJids","WAOdsEnums","WAResultOrError","WATimeUtils","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,d,e,f){e===void 0&&(e="participant");return h(a,b,c,[{addressable:f,type:e,userJid:d}]).then(function(a){return a[0]})}function h(a,b,c,d){return i(a,d.map(function(a){return babelHelpers["extends"]({},a,{threadId:b,threadJid:c})}))}function i(a,b){if(b.length===0)return d("MAWDexieTable").dexieResolve([]);var c=[];b.forEach(function(a){var b=a.addressable,e=a.threadId,f=a.threadJid,g=a.type;a=a.userJid;c.push({addressable:b,deliveredWatermarkTs:d("WATimeUtils").castToUnixTime(0),id:d("MAWDbParticipant").craftParticipantId__DEPRECATED(e,a),lastReadWatermarkTs:d("WATimeUtils").castToUnixTime(0),threadId:e,threadJid:f,type:g,userJid:a})});return a.participants.bulkPut(c).then(function(){d("MAWIndexedDb").afterTransaction({tag:"ParticipantsUpdated",value:d("MAWBridgeParticipants").createBridgeParticipants(c)});return c})}function b(a,b,c,e){return o(a,c).then(function(f){var g=[],i=new Set(e.map(function(a){return a.userJid}));for(var j=f,l=Array.isArray(j),m=0,j=l?j:j[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var n;if(l){if(m>=j.length)break;n=j[m++]}else{m=j.next();if(m.done)break;n=m.value}n=n;var o=i.has(n.userJid);o||g.push([n.threadJid,n.userJid])}o=[];n=new Set(f.map(function(a){return a.userJid}));for(m=0;m<e.length;m++){l=e[m];j=n.has(l.userJid);j||o.push(l)}g.length>0&&d("MAWODSProxy").odsBumpEntityKey({amount:1,entity:d("WAOdsEnums").Entity.MAW_ONE_TO_ONE_THREAD_PARTICIPANT_CLEANUP,key:d("MAWCurrentUser").isEmployee()?"employee":"public"});return d("MAWDexieTable").dexieAll([h(a,b,c,o),k(a,g)]).then(function(a){var b=a[0];a[1];a=e.reduce(function(a,c){var d=b.find(function(a){return a.userJid===c.userJid}),e=f.find(function(a){return a.userJid===c.userJid});d!=null&&e==null?a.push(d):e!=null&&a.push(e);return a},[]);return a})})}function e(a,b){return a.participants.bulkPut(b).then(function(){b.length>0&&d("MAWIndexedDb").afterTransaction({tag:"ParticipantsUpdated",value:d("MAWBridgeParticipants").createBridgeParticipants(b)});return b})}function f(a,b,c){if(c.length===0)return d("MAWDexieTable").dexieResolve();c=c.map(function(a){return[b,a]});return k(a,c)}function j(a,b,c){if(b.length===0)return d("MAWDexieTable").dexieResolve();b=b.map(function(a){return[a,c]});return k(a,b)}function k(a,b){return a.participants.where(["threadJid","userJid"]).anyOf(b).toArray().then(function(b){return a.participants.bulkDelete(b.map(function(a){return a.id})).then(function(){return a.threads.where("jid").anyOf(Array.from(new Set(b.map(function(a){return a.threadJid})))).toArray()}).then(function(a){var c=new Map(a.map(function(a){return[a.jid,a.chatId]}));b.forEach(function(a){var b=c.get(a.threadJid);b!=null&&d("MAWIndexedDb").afterTransaction({tag:"ParticipantRemoved",value:{threadId:b,threadJid:a.threadJid,userId:d("WAJids").extractUserId(a.userJid)}})})})})}function l(a,b){return a.participants.where("threadJid").equals(b)["delete"]()}function m(a,b,c,d,e){return n(a,[{deliveredWatermarkTs:c,lastReadActionTs:e,lastReadWatermarkTs:d,participantKey:b}]).then(function(a){return a[0]})}function n(a,b){if(b.length===0)return d("MAWDexieTable").dexieResolve([]);var c=new Map(),e=[];b.forEach(function(a){e.push(a.participantKey),c.set(JSON.stringify(a.participantKey),a)});return a.participants.where(["threadJid","userJid"]).anyOf(e).toArray().then(function(b){var e=[],f=[];b.forEach(function(a){var b=c.get(JSON.stringify([a.threadJid,a.userJid]));if(b==null)return;var d=b.deliveredWatermarkTs,g=b.lastReadActionTs;b=b.lastReadWatermarkTs;var h=a.deliveredWatermarkTs,i=a.lastReadWatermarkTs,j=a.lastReadActionTs,k=d>h,l=b>i,m=j==null||g>j;if(!k&&!l&&!m){f.push(a);return}e.push(babelHelpers["extends"]({},a,{deliveredWatermarkTs:k?d:h,lastReadActionTs:m?g:j,lastReadWatermarkTs:l?b:i}))});return a.participants.bulkPut(e).then(function(){e.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"ReceivedReceipt",value:d("MAWBridgeTypesCreators").createBridgeReceivedReceipt(a.threadId,a.threadJid,d("WAJids").extractUserId(a.userJid),a.deliveredWatermarkTs,a.lastReadWatermarkTs,a.lastReadActionTs)})});return[].concat(e,f)})})}function o(a,b){return a.participants.where("threadJid").equals(b).toArray()}function p(a,b){return a.participants.where("threadJid").anyOf(b).toArray()}function q(a,b){return o(a,b).then(function(a){return a.filter(function(a){return a.type==="invitedParticipant"})})}function r(a,b,c){return a.participants.where(["threadJid","userJid"]).equals([b,c]).first().then(function(a){return a==null?d("WAResultOrError").makeError("missing"):d("WAResultOrError").makeResult(a)})}function s(a,b){var d=Array.from(b.keys()).filter(Boolean);return a.participants.where("threadId").anyOf(d).toArray().then(function(d){var e=d.map(function(a){return[a.threadJid,a.userJid]}),f=d.map(function(a){var d=b.get(a.threadId);if(d==null)throw c("err")("New Thread Id is null - should not happen flow");return{addressable:a.addressable,threadId:d,threadJid:a.threadJid,type:a.type,userJid:a.userJid}});return k(a,e).then(function(){return i(a,f)}).then(function(){})})}function t(a,b){return a.participants.where(["threadJid","userJid"]).anyOf(b).toArray().then(function(a){var c=new Map(a.map(function(a){return[JSON.stringify([a.threadJid,a.userJid]),a]}));return b.map(function(a){return c.get(JSON.stringify(a))})})}g.addParticipant=a;g.bulkAddParticipants=h;g.bulkAddParticipantsInThreads=i;g.bulkUpsertParticiantsInThread=b;g.bulkUpdateParticipants=e;g.bulkDeleteParticipantsInThread=f;g.bulkDeleteParticipantAcrossThreads=j;g.bulkDeleteParticipants=k;g.deleteAllParticipantsForThread=l;g.updateParticipantTimestamps=m;g.bulkUpdateParticipantTimestamps=n;g.getParticipantsInThread=o;g.getParticipantsInThreads=p;g.getInvitedParticipantsInThread=q;g.getParticipant=r;g.bulkMigrateParticipantsToNewThreads=s;g.bulkGetParticipants=t}),98);
__d("MAWWriteMsgSideEffectTxns",["MAWDbMsg","MAWDbParticipantTxns","MAWDexieTable"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=d("MAWDbMsg").getCanonicalTsFromMsg(b),e=b.author;return e!=="@me"&&e!=="@system"?d("MAWDbParticipantTxns").updateParticipantTimestamps(a,[b.threadJid,e],c,c,c):d("MAWDexieTable").dexieResolve()}g.updateParticipantTimestampsForMsg=a}),98);
__d("MAWBridgeUpload",[],(function(a,b,c,d,e,f){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l){return{actionType:g,authTs:d,echoDocument:f,echoEncodingLatencyNs:e,errorCode:h,errorMessage:i,messageId:a,protoMsg:l,sortOrderMs:c,threadId:b,traceId:j,uploadTrackingInstanceKey:k}}function b(a,b,c,d,e,f){return{actionType:f,echoDocument:e,folderType:b,threadId:a,transportKey:c,ts:d}}function c(a,b,c,d,e,f,g,h,i){return{chatId:a,deliveryObjectId:b,mediaType:c,messageId:d,productType:e,threadId:f,threadJid:g,traceId:i,ts:h}}f.createBridgeUploadMessage=a;f.createBridgeDeleteMessagesOfThread=b;f.createBridgeUploadAttachment=c}),66);
__d("MAWConstants",[],(function(a,b,c,d,e,f){"use strict";a=5;b="Facebook user";c="Instagram user";d=24;e=3;var g=50;f.MESSAGE_RETRY_COUNT_LIMIT=a;f.FB_UNKNOWN_USER=b;f.INS_UNKNOWN_USER=c;f.MAX_APPDATA_RECIPIENTS=d;f.CURRENT_REGISTRATION_VERSION=e;f.BRIDGE_UPLOAD_BATCH_SIZE=g}),66);
__d("MAWWriteMsgTxns",["I64","MAWAddQPLPointForHandleIncomingMsgApi","MAWAfterWriteMsgUtil","MAWBridgeMsg","MAWBridgeTypesCreators","MAWBuildIncomingMsgs","MAWCalculateBumpTimestampMs","MAWDbMsg","MAWDbMsgTxns","MAWDbPendingStanzaTxns","MAWDbReactionsTxns","MAWDbThread","MAWDbThreadTxns","MAWDbUnrenderedMsgTxns","MAWDeleteForMeMsgContentCleaner","MAWDeleteThreadUtil","MAWDexieTable","MAWEBUploadMessageUtils","MAWEBUploadTrackingUtils","MAWEphemeralGatingUtil","MAWEphemeralMsgTxns","MAWFolderTypes","MAWGetMsgQuoteTxn","MAWGetOrCreateThreadTxns","MAWIndexedDb","MAWLoadReplyMediaTxns","MAWLocalizationUtils","MAWMsgType","MAWThreadEvent","MAWThreadSnippetBuildTxns","MAWThreadSnippetUtils","MAWTimeUtils","MAWUpdateQuotedMsgTxns","MAWWriteMsgSideEffectTxns","MAWWriteRevokeMessageTxns","WAGlobals","WAJids","WALogger","WATimeUtils","err","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handle"," Msg: Message from ",", chat ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["writeMsgAfterTransaction - sortOrderMs: ",""]);j=function(){return a};return a}function k(a,b,e,f){var g=e.ts;g=[d("WATimeUtils").castUnixTimeToMillisTime(g),e.type===d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN];var h=g[0],i=g[1];return d("MAWGetOrCreateThreadTxns").getExistingThread(a,b.jid).then(function(b){if(b==null)throw c("err")("at this point there's always a thread - checking for updates");var g=d("MAWDbMsgTxns").getThreadOldestMessageBySortOrderOrCache(a,b),j=d("MAWDbMsgTxns").getThreadNewestMessageBySortOrderOrCache(a,b);return d("MAWDexieTable").dexieAll([g,j]).then(function(c){var g,j,k=c[0];c=c[1];var l=c==null?1:d("MAWDbMsg").getInChatMsgIdFromMsgId(c.msgId)+1;g=d("WATimeUtils").castToMillisTime((g=c==null?void 0:c.sortOrderMs)!=null?g:0);var m=h>g&&!i?h:g;g=(g=d("MAWTimeUtils").ensureValidMillisTime(b.lastReadMsgTs))!=null?g:0;j=d("WATimeUtils").castToMillisTime((j=c==null?void 0:c.sortOrderMs)!=null?j:0);g=g<j;var n=e.author===d("WAJids").AUTHOR_ME||e.type===d("MAWMsgType").MSG_TYPE.ADMIN&&d("MAWLocalizationUtils").isParticipantChangeAdminMsg(e.msgContent.adminType)&&!g,o=babelHelpers["extends"]({},e,{msgId:d("MAWDbMsg").craftMsgIdV2(b.chatId,l,e)}),p=!d("MAWThreadSnippetUtils").isDbMsgDisabledForThreadSnippet(o)&&d("WATimeUtils").castUnixTimeToMillisTime(d("MAWDbMsg").getCanonicalTsFromMsg(o))>((j=b.snippetMsgTs)!=null?j:0);return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").calculateOldestAndNewestMsg(k,c,o,f),p?d("MAWThreadSnippetBuildTxns").buildThreadSnippet(a,o,b):d("MAWDexieTable").dexieResolve(null)]).then(function(a){var c=a[0],f=c.newestMsg;c=c.oldestMsg;a=a[1];return{isOldestMsgUpdated:k!=null&&c!==k.msgId,msgId:o.msgId,prevOldestMsg:k,updatedSnippet:a,updatedThread:babelHelpers["extends"]({},b,{lastReadMsg:n?o.msgId:b.lastReadMsg,lastReadMsgTs:n?m:b.lastReadMsgTs,newestMsg:f,newestMsgTs:m,oldestMsg:c,snippetMsg:p?o.msgId:b.snippetMsg,snippetMsgTs:p?d("WATimeUtils").castUnixTimeToMillisTime(d("MAWDbMsg").getCanonicalTsFromMsg(e)):b.snippetMsgTs,threadOrder:d("MAWDbThread").craftThreadOrder(m,b.jid)})}})})})}function l(a,b,e,f,g,h,i,l,m){var n;f===void 0&&(f={});f=f;var o=f.isFirstMsg,p=o===void 0?!1:o;o=f.isOutgoing;var q=o===void 0?!1:o,r=f.openMessageOtid,s=f.openMessageParticipantCount,t=f.optimisticMsg,u=f.participantCount,v=f.quotedReplyAttachmentMeta;o=f.skipLocalThreadBump;var w=o===void 0?!1:o;o=f.sortOrderMs;f=c("gkx")("23926");n=f?(n=o)!=null?n:d("MAWEBUploadMessageUtils").echoOverrideMessageSortOrder(b):o;o=f?(f=o)!=null?f:d("MAWEBUploadMessageUtils").echoOverrideMessageSortOrder(b):d("MAWEBUploadMessageUtils").echoOverrideMessageSortOrder(b);var x=babelHelpers["extends"]({},b,{sortOrderMs:o});return k(a,e,b,n).then(function(b){var c=b.isOldestMsgUpdated,e=b.msgId,f=b.prevOldestMsg,k=b.updatedSnippet,n=b.updatedThread,o=babelHelpers["extends"]({},x,{msgId:e});return l!=null&&l?a.messages.add(o).then(function(a){return babelHelpers["extends"]({},o,{rowId:a})}):d("MAWDexieTable").dexieAll([a.messages.add(o).then(function(a){return babelHelpers["extends"]({},o,{rowId:a})}),a.threads.put(n)]).then(function(a){var b=a[0];a[1];q&&d("WALogger").LOG(j(),b.sortOrderMs);d("MAWAfterWriteMsgUtil").writeMsgAfterTransaction({dbMsg:b,ebRestore:g,hasMoreAfter:i,hasMoreBefore:h,isFirstMsg:p,isOldestMsgUpdated:c,msgsLeftToRestoreForEB:m,openMessageOtid:r,openMessageParticipantCount:s,optimisticMsg:t,participantCount:u,prevOldestMsg:(f==null?void 0:f.msgId)==null?void 0:f.msgId,quotedReplyAttachmentMeta:v,skipLocalThreadBump:w,snippet:k,updatedThread:n});return b})})}function m(a,b,e){return d("MAWGetOrCreateThreadTxns").getExistingThread(a,e.jid).then(function(e){if(e==null)throw c("err")("at this point there's always a thread - checking for updates");return d("MAWDbUnrenderedMsgTxns").getNextUnrenderedMsgIdNumberForThread(a,e).then(function(c){var f=babelHelpers["extends"]({},b,{msgId:d("MAWDbMsg").craftUnrenderedMsgId(e.chatId,c)});return d("MAWDexieTable").dexieAll([a.unrenderedMessages.add(f),a.threads.put(e)]).then(function(a){var b=a[0];a[1];return babelHelpers["extends"]({},f,{rowId:b})})})})}function a(a,b,c){var e=[b.externalId,c.chatId,b.author],f=e[0],g=e[1];e=e[2];d("MAWAddQPLPointForHandleIncomingMsgApi").addQPLPointForHIMApi("msg_queries_start");return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByExternalId(a,f,g,e),d("MAWDbPendingStanzaTxns").maybeGetPendingRevokedStanza(a,f,e,g),d("MAWDbPendingStanzaTxns").maybeGetPendingDeletedStanza(a,f,e,g),d("MAWDbMsgTxns").checkIfMsgIsDeletedForMeOrRevoked(a,f,g,e),d("MAWDbPendingStanzaTxns").maybeGetDeleteThreadFromPendingStanza(a,c.jid).then(function(a){return d("MAWDeleteThreadUtil").isMsgDeletedViaDeleteThread(b.ts,a)})]).then(function(a){var b=a[0],c=a[1],e=a[2],f=a[3];a=a[4];d("MAWAddQPLPointForHandleIncomingMsgApi").addQPLPointForHIMApi("msg_queries_end");return{existingMsg:(b=b)!=null?b:null,isDeletedWithThread:a,isDeleteForMeOrRevoked:f,pendingDeleteForMeStanza:(b=e)!=null?b:null,pendingRevokedStanza:(a=c)!=null?a:null}})}function b(a,b,e){return d("MAWDbPendingStanzaTxns").maybeGetPendingRevokedStanza(a,b.externalId,b.author,e.chatId).then(function(f){if(f!=null)return n(a,b,e,f);f=b.author;d("WALogger").DEV(i(),b.type,f,e.jid);var g=babelHelpers["extends"]({},babelHelpers["extends"]({},b,{thread:e.chatId,threadJid:e.jid}));e.folder===d("MAWFolderTypes").FOLDER_ID.OTHER&&(g.altIndex=g.altIndex===d("MAWDbMsg").FUTUREPROOF_ALT_INDEX?d("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX:d("MAWDbMsg").SPAM_ALT_INDEX);return d("MAWGetMsgQuoteTxn").getMsgQuoteInfo(a,g,e.jid).then(function(b){b!=null&&(g=babelHelpers["extends"]({},g,{quote:b==null?void 0:b.quote,quoteExternalId:b==null?void 0:b.quoteExternalId}));return d("MAWDexieTable").dexieAll([d("MAWUpdateQuotedMsgTxns").associateQuotedMessage(a,e.chatId,g),d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,g),d("MAWLoadReplyMediaTxns").getReplyMediaForMsg(a,g)]).then(function(b){var f=b[0],i=b[1],j=b[2];d("MAWAddQPLPointForHandleIncomingMsgApi").addQPLPointForHIMApi("write_incoming_msg_start");d("WAGlobals").getConfig().useEbUploadQueue()||d("MAWEBUploadTrackingUtils").maybeStartTrackingForMiddleware(g,"receive");b=c("gkx")("23996")&&g.altIndex!==d("MAWDbMsg").SPAM_ALT_INDEX&&g.altIndex!==d("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX&&g.author!==d("WAJids").AUTHOR_ME;return l(a,g,e,{quotedReplyAttachmentMeta:i,skipLocalThreadBump:b}).then(function(b){g.altIndex!==d("MAWDbMsg").SPAM_ALT_INDEX&&g.altIndex!==d("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX&&g.author!==d("WAJids").AUTHOR_ME&&(!c("gkx")("23996")?d("MAWIndexedDb").afterTransaction({tag:"ThreadBumpedServer",value:{description:"writeNewMessage-"+g.type,isCurrentDeviceSendingMsg:!1,lastActivityTs:d("WATimeUtils").castUnixTimeToMillisTime(g.ts),lastMsgExternalId:(h||(h=d("I64"))).of_string_opt(g.externalId),threadId:e.chatId,threadJid:e.jid}}):d("MAWThreadSnippetBuildTxns").buildThreadSnippet(a,b,e).then(function(a){var b=a.snippetParams,c=a.snippetSenderContactId;a=a.snippetType;var f=g.externalId!==void 0?(h||(h=d("I64"))).of_string_opt(g.externalId):void 0;f=d("MAWCalculateBumpTimestampMs").calculateBumpTimestampMs(d("WATimeUtils").castUnixTimeToMillisTime(g.ts),f);d("MAWIndexedDb").afterTransaction({tag:"ThreadBumpedV2",value:d("MAWBridgeTypesCreators").createBridgeBumpedThreadV2({bumpTimestampMs:f,description:"writeNewIncomingMsg-"+g.type,isMessageAuthorMe:!1,snippetParams:b,snippetSenderContactId:c,snippetType:a,threadId:e.chatId,threadJid:e.jid})})}));d("MAWAddQPLPointForHandleIncomingMsgApi").addQPLPointForHIMApi("write_msg_additional_steps");return d("MAWDexieTable").dexieAll([d("MAWWriteMsgSideEffectTxns").updateParticipantTimestampsForMsg(a,g),d("MAWEphemeralGatingUtil").isSendBasedDisappearingMessageEnabled()?d("MAWEphemeralMsgTxns").markEphemeralMessageAsSent(a,b):d("MAWDexieTable").dexieResolve(b)]).then(function(a){a=a[1];f!=null&&f.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(a,void 0,j)})});d("MAWAddQPLPointForHandleIncomingMsgApi").addQPLPointForHIMApi("write_incoming_msg_end");return a||b})})})})})}function e(a,b,c,e){var f=babelHelpers["extends"]({},babelHelpers["extends"]({},b,{msgId:c.msgId,rowId:c.rowId,serverTs:c.serverTs,sortOrderMs:c.sortOrderMs,thread:c.thread,threadJid:e.jid,ts:c.ts}));return d("MAWDexieTable").dexieAll([d("MAWUpdateQuotedMsgTxns").associateQuotedMessage(a,e.chatId,f),d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,f),d("MAWLoadReplyMediaTxns").getReplyMediaForMsg(a,f),d("MAWGetMsgQuoteTxn").getMsgQuoteInfo(a,f,e.jid),d("MAWDbMsgTxns").getThreadNewestMessageIdBySortOrder(a,e)]).then(function(b){var c=b[0],g=b[1],h=b[2],i=b[3],j=b[4];f=babelHelpers["extends"]({},f,{quote:i==null?void 0:i.quote,quoteExternalId:i==null?void 0:i.quoteExternalId});d("MAWAddQPLPointForHandleIncomingMsgApi").addQPLPointForHIMApi("handle_ciphertext_start");return a.messages.put(f).then(function(){return d("MAWDbThreadTxns").needsRetroactiveReadReceiptInThread(a,f)}).then(function(b){if(b){f.altIndex=d("MAWDbMsg").craftToBeReadAltIndex(f.thread);return a.messages.put(f)}}).then(function(){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(f,void 0,h)});d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(f,void 0,g)});d("MAWIndexedDb").afterTransactionThreadEvent({chatJid:e.jid,msgId:f.msgId},d("MAWThreadEvent").PLACEHOLDER_CONVERT_SUBSCRIPTION);c!=null&&c.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(a,void 0,h)})});if(f.msgId===j){var b=f;b.rowId;b=babelHelpers.objectWithoutPropertiesLoose(b,["rowId"]);return d("MAWDexieTable").dexieAll([d("MAWThreadSnippetBuildTxns").buildThreadSnippet(a,f,e),d("MAWWriteMsgSideEffectTxns").updateParticipantTimestampsForMsg(a,b)]).then(function(a){a=a[0];var b=a.snippetParams,c=a.snippetSenderContactId;a=a.snippetType;d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({snippetParams:b,snippetSenderContactId:c,snippetType:a,threadId:e.chatId,threadJid:e.jid})});return f})}d("MAWAddQPLPointForHandleIncomingMsgApi").addQPLPointForHIMApi("handle_ciphertext_end");return f})})}function f(a,b,c,e){d("MAWAddQPLPointForHandleIncomingMsgApi").addQPLPointForHIMApi("handle_dfm_message_start");var f=d("MAWBuildIncomingMsgs").buildUnstoredDeleteForMeMsg(b,c);return d("MAWDexieTable").dexieAll([d("MAWDbReactionsTxns").deleteReactionsByUniqueMsgIdentifiers(a,[{author:f.author,chatId:f.thread,externalId:f.externalId}]),m(a,f,c),a.pendingStanzas["delete"](e.rowId)]).then(function(a){a[0];a=a[1];d("MAWAddQPLPointForHandleIncomingMsgApi").addQPLPointForHIMApi("handle_dfm_message_end");d("MAWDeleteForMeMsgContentCleaner").addNewDeleteForMeMsgContentCleanerTimestamp(f.messageDeleteForMeTs);return babelHelpers["extends"]({},f,{msgId:a.msgId,rowId:a.rowId})})}function n(a,b,e,f){var g=d("MAWDbPendingStanzaTxns").getRevokedContent(f);if(g==null)throw c("err")("missing revoked content");b=d("MAWBuildIncomingMsgs").buildUnstoredRevokedMsg(b,e,g);d("MAWAddQPLPointForHandleIncomingMsgApi").addQPLPointForHIMApi("handle_revoke_message_start");return d("MAWDexieTable").dexieAll([l(a,b,e),a.pendingStanzas["delete"](f.rowId)]).then(function(b){var c=b[0];return d("MAWWriteRevokeMessageTxns").markIncomingMessageRevoked(a,c,e).then(function(){d("MAWAddQPLPointForHandleIncomingMsgApi").addQPLPointForHIMApi("handle_revoke_message_end");return c})})}g.writeMsg=l;g.writeUnrenderedMsg=m;g.prepareMsgWriteData=a;g.writeNewIncomingMsg=b;g.writeCiphertextUpdate=e;g.handleDeleteForMeMessage=f;g.handleOutOfOrderRevokedMessage=n}),98);
__d("WAAckLevel",[],(function(a,b,c,d,e,f){"use strict";a={SENDER_BACKFILL_SENT:-7,INACTIVE_RECEIVED:-6,CONTENT_UNUPLOADABLE:-5,CONTENT_TOO_BIG:-4,CONTENT_GONE:-3,EXPIRED:-2,FAILED:-1,CLOCK:0,SENT:1,RECEIVED:2,READ:3,PLAYED:4};f.ACK=a}),66);
__d("WAMsgUtils",["WAJids"],(function(a,b,c,d,e,f,g){"use strict";var h="Facebook User";function a(a){return a==null||a===""}function b(a){return a==null||a===""?h:a}function c(a){return a!=null?d("WAJids").userIdFromJid(a):h}function e(a,b){b===void 0&&(b=2);a=a.slice(0,b);return[a.map(function(){return void 0}),a.reduce(function(a,b){return[].concat(a,[b])},[])]}g.UNKNOWN_USER=h;g.isUnknownName=a;g.maybeUnknownParticipantName=b;g.createAdminMsgContactId=c;g.getParticipantsAndUnknownNameJids=e}),98);
__d("WACreateParticipantAdminMsg",["WAGlobals","WAMsgUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:"participantAddedYou"};case 2:return{adminMsgContent:[b,c],adminType:"participantAddedYouAndOneUser"};default:return{adminMsgContent:[b,a.toString()],adminType:"participantAddedYouAndMoreThanOneUsers"}}}function i(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:"currentUserAddedOneParticipant"};case 2:return{adminMsgContent:[b,c],adminType:"currentUserAddedTwoParticipant"};default:return{adminMsgContent:[b,a.toString()],adminType:"currentUserAddedMoreThanTwoParticipant"}}}function j(a,b,c,d){switch(a){case 1:return{adminMsgContent:[b,c],adminType:"participantAddedOneUser"};case 2:return{adminMsgContent:[b,c,d],adminType:"participantAddedTwoUser"}}return{adminMsgContent:[b,c,a.toString()],adminType:"participantAddedMoreThanTwoUser"}}function a(a,b,c,e){e=e==null?b.map(d("WAMsgUtils").createAdminMsgContactId):e;var f=e[0];e=e[1];c=c==null?d("WAMsgUtils").createAdminMsgContactId(a):d("WAMsgUtils").maybeUnknownParticipantName(c);if(a===d("WAGlobals").getMyUserJid())return i(b.length,d("WAMsgUtils").maybeUnknownParticipantName(f),d("WAMsgUtils").maybeUnknownParticipantName(e));return b.includes(d("WAGlobals").getMyUserJid())?h(b.length,d("WAMsgUtils").maybeUnknownParticipantName(c),d("WAMsgUtils").maybeUnknownParticipantName(b[0]===d("WAGlobals").getMyUserJid()?e:f)):j(b.length,c,d("WAMsgUtils").maybeUnknownParticipantName(f),d("WAMsgUtils").maybeUnknownParticipantName(e))}g.createParticipantAdminMessage=a}),98);
__d("WARemoveParticipantAdminMsg",["WAGlobals","WAMsgUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:"participantRemovedYou"};case 2:return{adminMsgContent:[b,c],adminType:"participantRemovedYouAndOneUser"};default:return{adminMsgContent:[b,a.toString()],adminType:"participantRemovedYouAndMoreThanOneUsers"}}}function i(a,b,c,d){switch(a){case 1:return d?{adminMsgContent:[],adminType:"currentUserLeftGroup"}:{adminMsgContent:[b],adminType:"currentUserRemovedOneParticipant"};case 2:return{adminMsgContent:[b,c],adminType:"currentUserRemovedTwoParticipant"};default:return{adminMsgContent:[b,a.toString()],adminType:"currentUserRemovedMoreThanTwoParticipant"}}}function j(a,b,c,d,e){switch(a){case 1:return e?{adminMsgContent:[b],adminType:"participantLeftGroup"}:{adminMsgContent:[b,c],adminType:"participantRemovedOneUser"};case 2:return{adminMsgContent:[b,c,d],adminType:"participantRemovedTwoUser"}}return{adminMsgContent:[b,c,a.toString()],adminType:"participantRemovedMoreThanTwoUser"}}function a(a,b,c,e){e=e==null?b.map(d("WAMsgUtils").createAdminMsgContactId):e;var f=e[0];e=e[1];var g=c==null?d("WAMsgUtils").createAdminMsgContactId(a):d("WAMsgUtils").maybeUnknownParticipantName(c);if(a===d("WAGlobals").getMyUserJid())return i(b.length,d("WAMsgUtils").maybeUnknownParticipantName(f),d("WAMsgUtils").maybeUnknownParticipantName(e),b[0]===d("WAGlobals").getMyUserJid());return b.includes(d("WAGlobals").getMyUserJid())?h(b.length,d("WAMsgUtils").maybeUnknownParticipantName(c),d("WAMsgUtils").maybeUnknownParticipantName(b[0]===d("WAGlobals").getMyUserJid()?e:f)):j(b.length,g,d("WAMsgUtils").maybeUnknownParticipantName(f),d("WAMsgUtils").maybeUnknownParticipantName(e),b[0]===a)}g.removeParticipantAdminMessage=a}),98);
__d("WAAdminMsgHelpers",["WAAckLevel","WACreateParticipantAdminMsg","WAGlobals","WAJids","WARemoveParticipantAdminMsg","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h="Facebook User";function a(a,b,c){return{type:"Admin",ack:d("WAAckLevel").ACK.SENT,msgContent:d("WACreateParticipantAdminMsg").createParticipantAdminMessage(c==="@me"?d("WAGlobals").getMyUserJid():c,b),id:{chat:a,author:d("WAJids").AUTHOR_SYSTEM,externalId:d("WAGlobals").getDependencies().generateExternalId()},ts:d("WATimeUtils").unixTime()}}function b(a,b,c){return{type:"Admin",ack:d("WAAckLevel").ACK.SENT,msgContent:d("WARemoveParticipantAdminMsg").removeParticipantAdminMessage(c==="@me"?d("WAGlobals").getMyUserJid():c,b),id:{chat:a,author:d("WAJids").AUTHOR_SYSTEM,externalId:d("WAGlobals").getDependencies().generateExternalId()},ts:d("WATimeUtils").unixTime()}}function c(a,b,c){var e,f=d("WAGlobals").getMyUserJid();c=c==="@me"?f:c;if(c===f)e={adminMsgContent:[d("WAJids").userIdFromJid(b)],adminType:"currentUserPromotedParticipant"};else if(c==null)e=b===f?{adminMsgContent:[],adminType:"currentUserGotPromoted"}:{adminMsgContent:[d("WAJids").userIdFromJid(b)],adminType:"participantGotPromoted"};else{c=d("WAJids").userIdFromJid(c);e=b===f?{adminMsgContent:[c],adminType:"participantPromotedYou"}:{adminMsgContent:[c,d("WAJids").userIdFromJid(b)],adminType:"participantPromotedParticipant"}}return{type:"Admin",ack:d("WAAckLevel").ACK.SENT,msgContent:e,id:{chat:a,author:d("WAJids").AUTHOR_SYSTEM,externalId:d("WAGlobals").getDependencies().generateExternalId()},ts:d("WATimeUtils").unixTime()}}function e(a,b,c){var e,f=d("WAGlobals").getMyUserJid();c=c==="@me"?f:c;if(c===f)e=b===f?{adminType:"currentUserSelfDemoted",adminMsgContent:[]}:{adminMsgContent:[d("WAJids").userIdFromJid(b)],adminType:"currentUserDemotedParticipant"};else if(c==null)e=b===f?{adminMsgContent:[],adminType:"currentUserGotDemoted"}:{adminMsgContent:[d("WAJids").userIdFromJid(b)],adminType:"participantGotDemoted"};else{var g=d("WAJids").userIdFromJid(c);e=b===f?{adminMsgContent:[g],adminType:"participantDemotedYou"}:{adminMsgContent:[g,d("WAJids").userIdFromJid(b)],adminType:c===b?"participantSelfDemoted":"participantDemotedParticipant"}}return{type:"Admin",ack:d("WAAckLevel").ACK.SENT,msgContent:e,id:{chat:a,author:d("WAJids").AUTHOR_SYSTEM,externalId:d("WAGlobals").getDependencies().generateExternalId()},ts:d("WATimeUtils").unixTime()}}function f(a,b,c){var e=[],f=b.subject.content;if(f==null)return;b.subject.user===d("WAGlobals").getMyUserJid()?(b="currentUserNamedGroup",e.push(f)):c==null?(b="unkonwnUserNamedGroup",e.push(f)):(b="participantNamedGroup",e.push(c,f));return{type:"Admin",ack:d("WAAckLevel").ACK.SENT,msgContent:{adminType:b,adminMsgContent:e},id:{chat:a,author:d("WAJids").AUTHOR_SYSTEM,externalId:d("WAGlobals").getDependencies().generateExternalId()},ts:d("WATimeUtils").unixTime()}}function i(a,b,c){var e,f=[];if(c===d("WAGlobals").getMyUserJid())switch(b){case"all_member_add":e="currentUserSetAddModeAllMembers";break;case"admin_add":e="currentUserSetAddModeAdminOnly";break}else if(c!=null){f.push(d("WAJids").userIdFromJid(c));switch(b){case"all_member_add":e="participantSetAddModeAllMembers";break;case"admin_add":e="participantSetAddModeAdminOnly";break}}else switch(b){case"all_member_add":e="serverSetAddModeAllMembers";break;case"admin_add":e="serverSetAddModeAdminOnly";break}if(e==null)return;return{type:"Admin",ack:d("WAAckLevel").ACK.SENT,msgContent:{adminType:e,adminMsgContent:f},id:{chat:a,author:d("WAJids").AUTHOR_SYSTEM,externalId:d("WAGlobals").getDependencies().generateExternalId()},ts:d("WATimeUtils").unixTime()}}g.UNKNOWN_USER=h;g.createParticipantAddAdminMessage=a;g.createParticipantRemoveAdminMsg=b;g.createParticipantPromoteAdminMsg=c;g.createParticipantDemoteAdminMsg=e;g.createGroupNameChangeAdminMsg=f;g.createMemberAddModeChangeAdminMsg=i}),98);
__d("MAWAdminWriteUserDeviceMsgTxn",["MAWAckLevel","MAWDexieTable","MAWExternalId","MAWGlobals","MAWLocalizationType","MAWLocalizationUtils","MAWMsgType","MAWWriteMsgTxns","WAAdminMsgHelpers","WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";c={add:"add",remove:"remove",update:"update"};function h(a,b){switch(a){case"add":if(b)return d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_DEVICE;else return d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_DEVICE;case"remove":if(b)return d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_DEVICE;else return d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_DEVICE;case"update":if(b)return d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_UPDATED_DEVICE;else return d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UPDATED_DEVICE}}function a(a,b,c,e,f){if(c.newestMsg==null)return d("MAWDexieTable").dexieResolve();var g=b===d("MAWGlobals").getMyUserJid();e=h(e,g);g=g?[]:[d("WAJids").userIdFromJid(b)];b=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:g,adminType:e,version:1},c.chatId,c.jid,f);return d("MAWWriteMsgTxns").writeMsg(a,b,c).then(function(){})}function b(a,b,c,e){var f=d("WAAdminMsgHelpers").UNKNOWN_USER,g=b===d("MAWGlobals").getMyUserJid();b={ack:d("MAWAckLevel").ACK.received,altIndex:void 0,author:g?d("WAJids").AUTHOR_ME:b,externalId:d("MAWExternalId").generateExternalId(),msgContent:{adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.ICDC_ALERT_ADMIN_MESSAGE,authorName:f},thread:c.chatId,threadJid:c.jid,ts:(g=e)!=null?g:d("WATimeUtils").unixTime(),type:d("MAWMsgType").MSG_TYPE.ICDC_ALERT};return d("MAWWriteMsgTxns").writeMsg(a,b,c).then(function(){})}g.DeviceChange=c;g.getUserDeviceAdminType=h;g.writeUserDeviceAdminMsg=a;g.writeICDCAlert=b}),98);
__d("MAWConvertExtendedContentOverlayIconGlyphToXMAGatingType",["EchoMessageXMAFieldUtils","WAArmadilloXMA.pb","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Not a valid ExtendedContentOverlayIconGlyph: ",""]);h=function(){return a};return a}function a(a){switch(a){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.INFO:return d("EchoMessageXMAFieldUtils").XMAGatingType.INFO;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.EYE_OFF:return d("EchoMessageXMAFieldUtils").XMAGatingType.EYE_OFF;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.NEWS_OFF:return d("EchoMessageXMAFieldUtils").XMAGatingType.NEWS_OFF;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.WARNING:return d("EchoMessageXMAFieldUtils").XMAGatingType.WARNING;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.PRIVATE:return d("EchoMessageXMAFieldUtils").XMAGatingType.PRIVATE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.NONE:return d("EchoMessageXMAFieldUtils").XMAGatingType.NONE;default:d("WALogger").ERROR(h(),a);return d("EchoMessageXMAFieldUtils").XMAGatingType.NONE}}g.convertExtendedContentOverlayIconGlyphToXMAGatingType=a}),98);
__d("MAWConvertExtendedContentTargetTypeToXMATargetType",["EchoMessageXMAFieldUtils","WAArmadilloXMA.pb","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Not a valid ExtendedContentTargetType: ",""]);h=function(){return a};return a}function a(a){switch(a){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_MENTION:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_PHOTO_MENTION;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_IMAGE_POST_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_SINGLE_IMAGE_POST_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_MULTIPOST_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_MULTIPOST_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_VIDEO_POST_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_SINGLE_VIDEO_POST_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_PHOTO_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_VIDEO_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_CLIPS_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_CLIPS_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_IGTV_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_IGTV_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SHOP_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_SHOP_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_PROFILE_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_PROFILE_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_HIGHLIGHT_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_PHOTO_HIGHLIGHT_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_HIGHLIGHT_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_VIDEO_HIGHLIGHT_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REPLY:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_REPLY;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REACTION:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_REACTION;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.FB_FEED_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY:return d("EchoMessageXMAFieldUtils").XMAContentType.FB_STORY_REPLY;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.FB_STORY_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_MENTION:return d("EchoMessageXMAFieldUtils").XMAContentType.FB_STORY_MENTION;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_VIDEO_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.FB_FEED_VIDEO_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_GAMING_CUSTOM_UPDATE:return d("EchoMessageXMAFieldUtils").XMAContentType.FB_GAMING_CUSTOM_UPDATE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_PRODUCER_STORY_REPLY:return d("EchoMessageXMAFieldUtils").XMAContentType.FB_PRODUCER_STORY_REPLY;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.MSG_EXTERNAL_LINK_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_AUDIO_CALL:return d("EchoMessageXMAFieldUtils").XMAContentType.RTC_AUDIO_CALL;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_VIDEO_CALL:return d("EchoMessageXMAFieldUtils").XMAContentType.RTC_VIDEO_CALL;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_AUDIO_CALL:return d("EchoMessageXMAFieldUtils").XMAContentType.RTC_MISSED_AUDIO_CALL;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_VIDEO_CALL:return d("EchoMessageXMAFieldUtils").XMAContentType.RTC_MISSED_VIDEO_CALL;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_AUDIO_CALL:return d("EchoMessageXMAFieldUtils").XMAContentType.RTC_GROUP_AUDIO_CALL;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_VIDEO_CALL:return d("EchoMessageXMAFieldUtils").XMAContentType.RTC_GROUP_VIDEO_CALL;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_EVENT:return d("EchoMessageXMAFieldUtils").XMAContentType.FB_EVENT;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_RECEIVER_FETCH:return d("EchoMessageXMAFieldUtils").XMAContentType.MSG_RECEIVER_FETCH;default:d("WALogger").ERROR(h(),a);return d("EchoMessageXMAFieldUtils").XMAContentType.NONE}}g.convertExtendedContentTargetTypeToXMATargetType=a}),98);
__d("MAWConvertExtendedContentXMLLayoutTypeToXMALayoutType",["EchoMessageXMAFieldUtils","WAArmadilloXMA.pb","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Not a valid ExtendedContentXMLLayoutType: ",""]);h=function(){return a};return a}function a(a){switch(a){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_XMA_LAYOUT_TYPE.SINGLE:return d("EchoMessageXMAFieldUtils").XMALayoutType.SINGLE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_XMA_LAYOUT_TYPE.PORTRAIT:return d("EchoMessageXMAFieldUtils").XMALayoutType.PORTRAIT;default:d("WALogger").ERROR(h(),a);return d("EchoMessageXMAFieldUtils").XMALayoutType.SINGLE}}g.convertExtendedContentXMLLayoutTypeToXMALayoutType=a}),98);
__d("MAWDbEditMsgHistoryTxns",["MAWAckLevel","MAWDbEditMsgHistory","MAWDexieTable","MAWIndexedDb","WALogger","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[getEditHistoryMsgByEditedProtocolMsgId] Suspected multiple instances of same message!"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[getEditHistoryMsgByEditedProtocolMsgId] Can't have "," messages with the same editExternalId!"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["No msgId found mapped with externalId: Edit messages with the externalId do not have associated Msg in the IDB."]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["\n          'No edit history found for the messages despite there being an editCount greater than 0"]);k=function(){return a};return a}function a(a,b){var c=[];if(b.length===0)return d("MAWDexieTable").dexieResolve(c);b=b.filter(function(a){return a.editCount!=null&&a.editCount>0});var e=b.map(function(a){return[a.externalId,a.threadJid]});if(e.length===0)return d("MAWDexieTable").dexieResolve([]);var f=b.reduce(function(a,b){b.msgId!=null&&a.set(b.externalId,b.msgId);return a},new Map());return l(a,e).then(function(a){if(a.length===0){d("WATagsLogger").TAGS(["MAWLoadMsgsTxns"]).ERROR(k());return[]}for(var b=0;b<a.length;b++){var e=a[b],g=f.get(e.originalMsgExternalId);g!=null?c.push(babelHelpers["extends"]({},e,{editMsgHistoryId:d("MAWDbEditMsgHistory").convertToEditMsgHistoryId64(e.editMsgHistoryId),originalMsgId:g})):d("WATagsLogger").TAGS(["MAWLoadMsgsTxns"]).ERROR(j())}d("MAWIndexedDb").afterTransaction({tag:"EditMsgHistoryAdded",value:c});return c})}function l(a,b){return a.editMsgHistory.where(["originalMsgExternalId","threadJid"]).anyOf(b).toArray()}function b(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.editMsgHistory.get({editMsgHistoryId:b})}function c(a,b,c){return a.editMsgHistory.where("originalMsgExternalId").equals(c).filter(function(a){return a.editExternalId===b.externalId&&a.author===b.author&&a.threadJid===b.chat}).toArray().then(function(a){if(a.length>1){var b=a.map(function(a){return""+a.editTs.toString()});b=new Set(b).size===1;!b?d("WALogger").ERROR(i(),a.length):d("WALogger").ERROR(h())}return a[0]})}function e(a,b){return b==null?d("MAWDexieTable").dexieResolve([]):a.editMsgHistory.where("originalMsgExternalId").equals(b.externalId).filter(function(a){return a.author===b.author&&a.threadJid===b.chat}).toArray().then(function(a){var b=[];a.forEach(function(a){if(a==null)return;b.push(a)});return b})}function f(a,b){return a.editMsgHistory.bulkGet(b)}function m(a,b,c){var e=b.map(function(a,b){return babelHelpers["extends"]({},a,{editMsgHistoryId:d("MAWDbEditMsgHistory").convertToEditMsgHistoryId64(c[b])})});return a.messages.where("externalId").anyOf(e.map(function(a){return a.originalMsgExternalId})).toArray().then(function(a){var b=new Map();a.forEach(function(a){a!=null&&b.set(a.externalId,a)});return e.map(function(a){var c=b.get(a.originalMsgExternalId);return c==null?null:babelHelpers["extends"]({},a,{originalMsgId:c.msgId})}).filter(Boolean)}).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"EditMsgHistoryAdded",value:a});return c})}function n(a,b,c){c===void 0&&(c=!0);return a.editMsgHistory.bulkAdd(b,{allKeys:!0}).then(function(e){return c?m(a,b,e):d("MAWDexieTable").dexieResolve(e)})}function o(a,b,c,d){return d.then(function(d){return p(a,b,c,d)})}function p(a,b,c,e){var f=[];return a.editMsgHistory.where("originalMsgExternalId").equals(b).filter(function(a){return a.threadJid===e&&a.author===c&&(a.sendStatus==null||a.sendStatus>=d("MAWAckLevel").ACK.sent)}).toArray().then(function(a){a.forEach(function(a){f.push({messageId:a.editExternalId,originalMessageId:a.originalMsgExternalId,text:a.msgContent.content,timestamp:a.editTs})});return f})}function q(a,b,c,d){return a.editMsgHistory.where("originalMsgExternalId").equals(b).filter(function(a){return a.threadJid===d&&a.author===c})["delete"]().then(function(){})}var r=function(a,b){return a.editMsgHistory.where(["originalMsgExternalId","threadJid"]).anyOf(b)["delete"]().then(function(){return d("MAWDexieTable").dexieResolve(b.length)})};g.loadEditMsgHistory=a;g.getEditHistoryByOriginalMsgExternalIdAndThreadJid=l;g.maybeGetEditMsgHistoryFromEditMsgHistoryId=b;g.getEditHistoryMsgByEditedProtocolMsgId=c;g.maybeGetEditMsgHistoryFromProtocolMsgId=e;g.bulkGetEditMsgHistorys=f;g.bulkAddEditMsgHistory=n;g.getEditHistoryAsEchoWithJidPromise=o;g.getEditHistoryAsEcho=p;g.bulkRemoveEditHistory=q;g.deleteExpiredEditMsgHistory=r}),98);
__d("MAWGetAttachmentTypeForServerMediaType",["EchoMessageMediaFieldUtils","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Not a valid AttachmentType: ",""]);h=function(){return a};return a}function a(a){switch(a){case"image":return d("EchoMessageMediaFieldUtils").AttachmentType.IMAGE;case"video":return d("EchoMessageMediaFieldUtils").AttachmentType.VIDEO;case"ptt":return d("EchoMessageMediaFieldUtils").AttachmentType.PTT;case"gif":return d("EchoMessageMediaFieldUtils").AttachmentType.GIF;case"sticker":return d("EchoMessageMediaFieldUtils").AttachmentType.STICKER;case"xma-image":return d("EchoMessageMediaFieldUtils").AttachmentType.XMA;case"document":return d("EchoMessageMediaFieldUtils").AttachmentType.DOCUMENT;default:d("WALogger").WARN(h(),a);return null}}g.getAttachmentTypeForServerMediaType=a}),98);
__d("MAWGetMediaAttachmentTypeForServerMediaType",["EchoMessageMediaFieldUtils","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Not a valid EchoMessageActMediaAttachmentType: ",""]);h=function(){return a};return a}function a(a){switch(a){case"image":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.IMAGE;case"video":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.VIDEO;case"ptt":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.AUDIO;case"gif":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.GIF;case"sticker":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.STICKER;case"audio":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.AUDIO;case"document":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.DOCUMENT;case"ppic":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.PROFILE_PICTURE;case"md-app-state":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.APP_STATE;case"md-msg-hist":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.HISTORY_SYNC;case"thumbnail-image":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.THUMBNAIL_IMAGE;case"thumbnail-video":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.THUMBNAIL_VIDEO;case"thumbnail-gif":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.THUMBNAIL_GIF;case"thumbnail-document":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.THUMBNAIL_DOCUMENT;case"thumbnail-link":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.THUMBNAIL_LINK;case"novi-video":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.NOVI_VIDEO;case"novi-image":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.NOVI_IMAGE;case"xma-image":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.XMA_IMAGE;default:d("WALogger").ERROR(h(),a);return null}}g.getMediaAttachmentTypeForServerMediaType=a}),98);
__d("MAWGetPreviewContentTypeForMediaType",["EchoMessageMediaFieldUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(a){case"image":return d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.IMAGE_JPEG;case"gif":return d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.GIF;case"sticker":return d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.STICKER;case"video":return d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.AUDIO_MP4;case"ptt":return d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.AUDIO_WAV;case"xma-image":return d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.IMAGE_JPEG;default:return null}}g.getPreviewContentTypeForMediaType=a}),98);
__d("MAWUploadMessageTxns",["EchoCommonUtils","EchoEncodingUtils","EchoMessage","LSEBPayloadSerializerError","LSMEBTaskCreationSource","MAWBridgeEventTransmitter","MAWConvertExtendedContentOverlayIconGlyphToXMAGatingType","MAWConvertExtendedContentTargetTypeToXMATargetType","MAWConvertExtendedContentXMLLayoutTypeToXMALayoutType","MAWDbEditMsgHistoryTxns","MAWDbMediaTxns","MAWDbMsg","MAWDbMsgTxns","MAWDbMsgUtil","MAWDbReactionsTxns","MAWDbXMATxns","MAWDexieTable","MAWEBUploadMessageUtils","MAWEncryptedBackupCacheManager","MAWGetAttachmentTypeForServerMediaType","MAWGetMediaAttachmentTypeForServerMediaType","MAWGetPreviewContentTypeForMediaType","MAWGlobals","MAWJidUtils","MAWJids","MAWMsgType","MAWUploadMessagesBackup","MAWVault","WAArmadilloXMA.pb","WABase64","WAJids","WALogger","WAMediaUtils","WATimeUtils","err","gkx","qex"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] edit history has length ",", but edit count on message is ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] No XMA object found for msg with external id ",". Cannot upload XMA"]);k=function(){return a};return a}function l(a,b){return a.threads.get(b).then(function(a){if(a==null)throw c("err")("constructEchoMessage: thread not present");return a.jid})}var m="You unsent a message";function n(a){switch(a.specialTextSize){case 1:return d("EchoMessage").MessageTextSize.SMALL;case 2:return d("EchoMessage").MessageTextSize.MEDIUM;case 3:return d("EchoMessage").MessageTextSize.LARGE;default:return d("EchoMessage").MessageTextSize.NONE}}function o(a,b){return d("MAWDbXMATxns").maybeGetXMAFromProtocolMsgId(a,d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.threadJid,b.externalId)).then(function(e){if(e!=null)return e.previewMediaIds!=null?d("MAWDexieTable").dexieAll(e.previewMediaIds.map(function(b){return d("MAWDbMediaTxns").maybeGetMediaFromMediaId(a,b)})).then(function(a){for(var a=a,b=Array.isArray(a),f=0,a=b?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var g;if(b){if(f>=a.length)break;g=a[f++]}else{f=a.next();if(f.done)break;g=f.value}g=g;if(g==null)return d("MAWDexieTable").dexieResolve({maybeErrorDetail:{errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"constructEchoMessage: DbMedia is null for the XMA message",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.WARN},xmaData:void 0});if(g.fbid==null)return d("MAWDexieTable").dexieResolve({maybeErrorDetail:{errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"constructEchoMessage: fbid is null for the XMA message",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.WARN},xmaData:void 0})}return v(e)}):v(e);else{d("WALogger").ERROR(k(),b.externalId);return d("MAWDexieTable").dexieResolve({maybeErrorDetail:{errorCode:c("LSEBPayloadSerializerError").UNKNOWN_ERROR,errorMsg:"constructEchoMessage: no xma object found for msg with external id "+b.externalId,uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.WARN},xmaData:void 0})}})}function p(a,b){try{return d("MAWDbMsg").isMediaMsg(a)||a.type===d("MAWMsgType").MSG_TYPE.XMA}catch(e){a="[labyrinth_web] Invalid msg type for isMediaMsg check: "+e;d("WALogger").ERROR(j(),a);b.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:a,uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return!1}}function q(a,b){return{echoMessage:null,externalId:a,maybeErrorDetail:{errorCode:c("LSEBPayloadSerializerError").NOT_IMPLEMENTED,errorMsg:b,uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.WARN}}}function r(a,b,e){var f=e.threadJid!=null?d("MAWDexieTable").dexieResolve(e.threadJid):l(a,e.thread),g={mediaMetadata:null},h=p(e,g);h=h?t(a,e):d("MAWDexieTable").dexieResolve(g);g=u(a,e);b=e.quote!=null?A(a,e.quote,e.thread,f,b):d("MAWDexieTable").dexieResolve();var i=d("MAWDbMsg").isXMAMsg(e)?o(a,e):d("MAWDexieTable").dexieResolve(null),j=[];a=c("gkx")("23918")||c("qex")._("778")===!0?d("MAWDbEditMsgHistoryTxns").getEditHistoryAsEchoWithJidPromise(a,e.externalId,e.author,f):d("MAWDexieTable").dexieResolve(j);return{editHistoryPromise:a,mediaMetadataUploadPromise:h,quotedMsgPromise:b,reactionsPromise:g,threadJidPromise:f,xmaDataUploadRequestPromise:i}}function s(a,b,c,e,f,g,h,j){var k;a=d("WAJids").threadIdForChatJid(a);var l=h.serverTs;k=(k=h.editCount)!=null?k:0;g.length>0&&g.length-1!==h.editCount&&(d("WALogger").WARN(i(),g.length,h.editCount),k=g.length-1);l={authoritativeTimestampMs:l!=null?l*1e3:void 0,contentSubtype:d("EchoMessage").EchoMessageContentSubtype.NONE,contentType:d("EchoMessage").EchoMessageContentType.TEXT,displayTimestampMs:h.ts*1e3,editCount:k,editHistory:g,from:d("EchoCommonUtils").craftEchoAddress(null,j,"AdvancedCrypto"),isForwarded:h.isForwarded,messageId:h.externalId,serializationOrigin:d("EchoMessage").EchoSerializationOriginType.WEB,sortOrderMs:d("MAWEBUploadMessageUtils").echoOverrideMessageSortOrder(h),textSize:n(h),threadId:a,version:d("EchoMessage").ECHO_MESSAGE_MIGRATION_DOCUMENT_VERSION,xContentType:d("EchoEncodingUtils").convertDbMsgTypeToXMessageContentType(h.type),xMessagePlaceholderType:d("EchoMessage").EchoMessagePlaceholderType.NO_PLACEHOLDER,xOfflineThreadingId:h.externalId,xThreadId:a};((k=h.msgContent)==null?void 0:k.content)!=null&&(l=babelHelpers["extends"]({},l,{text:d("MAWVault").unvault(h.msgContent.content)}));h.type===d("MAWMsgType").MSG_TYPE.REVOKED&&(l.contentType=d("EchoMessage").EchoMessageContentType.PLACEHOLDER,l.contentSubtype=d("EchoMessage").EchoMessageContentSubtype.UNSEND,l.revokeSentTimestampMs=h.originalTs,l.revokeUnsentTimestampMS=h.unsendMsgContentDeleteTs,l.text=m);if(e!=null){g=z(e);j=g.senderId;a=d("EchoCommonUtils").craftEchoAddress(null,j,"AdvancedCrypto");e.sortOrderMs!=null&&(l.quoteData={quoteMessageId:e.externalId,quoteMessageSender:a,quoteSortOrderInMs:e.sortOrderMs})}if(d("MAWMsgType").isMAWSupportedMediaType(h.type)){k=b.mediaMetadata;if(k!=null)l=babelHelpers["extends"]({},l,{contentType:d("EchoMessage").EchoMessageContentType.MEDIA,mediaData:k});else if(h.type!==d("MAWMsgType").MSG_TYPE.XMA)return{echoMessage:l,externalId:h.externalId,maybeErrorDetail:b.maybeErrorDetail}}if(f!=null&&f.xmaData!=null&&h.type===d("MAWMsgType").MSG_TYPE.XMA){l.xmaData=f.xmaData;l.contentType=d("EchoMessage").EchoMessageContentType.XMA;if(l.mediaData==null&&((g=f.xmaData)==null?void 0:g.xmaDefaultCTA)!=null&&l.text==null){l.text=(j=f.xmaData)==null?void 0:j.xmaDefaultCTA}}else if(f!=null&&f.xmaData==null&&h.type===d("MAWMsgType").MSG_TYPE.XMA)return{echoMessage:l,externalId:h.externalId,maybeErrorDetail:f.maybeErrorDetail};return{echoMessage:babelHelpers["extends"]({},l,c),externalId:h.externalId}}function a(a,b){return d("MAWDexieTable").dexieAll(b.map(function(b){var c=b.dbMsg;b=b.quotedMsg;if(!d("MAWMsgType").isEBSupportedMsgType(c.type))return d("MAWDexieTable").dexieResolve(q(c.externalId,'constructEchoMessage: "'+String(c.type)+'" NYI'));if(c.serverTs==null)return d("MAWDexieTable").dexieResolve(q(c.externalId,'constructEchoMessage: "'+String(c.type)+'" Not authoritative msg. '));var e=d("WATimeUtils").castToUnixTime(0);if(c.serverTs===e||c.serverTs===null&&c.ts===e){e="constructEchoMessage: Invalid timestamp - timestamp for message corresponds to 1/1/1970";d("WALogger").ERROR(h(),e);return d("MAWDexieTable").dexieResolve(q(c.externalId,e))}e=z(c);var f=e.senderId;e=r(a,b,c);b=e.editHistoryPromise;var g=e.mediaMetadataUploadPromise,i=e.quotedMsgPromise,j=e.reactionsPromise,k=e.threadJidPromise;e=e.xmaDataUploadRequestPromise;return d("MAWDexieTable").dexieAll([k,g,j,i,e,b]).then(function(a){var b=a[0],d=a[1],e=a[2],g=a[3],h=a[4];a=a[5];return s(b,d,e,g,h,a,c,f)})}))}function t(a,b){var e={mediaMetadata:null};if(b.type===d("MAWMsgType").MSG_TYPE.XMA)return d("MAWDbXMATxns").maybeGetXMAFromProtocolMsgId(a,d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.threadJid,b.externalId)).then(function(b){if(b!=null)return w(a,b);else{e.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] Media meta data couldn't be created for XMA because DbXMA is not in IndexedDB. This probably means the XMA message was not sent properly by ChatX.",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return d("MAWDexieTable").dexieResolve(e)}});if(!d("MAWMsgType").isMAWSupportedMediaType(b.type)){e.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").NOT_SUPPORTED_ON_WEB,errorMsg:"[labyrinth_web] Media type is not supported for msg, type: "+b.type,uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.WARN};return d("MAWDexieTable").dexieResolve(e)}if(b.mediaId==null){e.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] No media id found in a media msg",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return d("MAWDexieTable").dexieResolve(e)}var f=d("WATimeUtils").DAY_SECONDS*28,g=b.serverTs;if(g!=null&&d("WATimeUtils").unixTime()-g>f){e.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] Media is older than 28 days and is not being uploaded.",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.WARN};return d("MAWDexieTable").dexieResolve(e)}return d("MAWDbMediaTxns").maybeGetMediaFromMediaId(a,b.mediaId).then(function(f){if(!f){e.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] No media db entry for media id",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return d("MAWDexieTable").dexieResolve(e)}var g=c("gkx")("23919")?d("MAWDbMediaTxns").maybeGetMediaBackupRowFromMsgId(a,b.msgId):d("MAWDexieTable").dexieResolve();return g.then(function(a){return d("MAWDexieTable").dexieResolve(x(b.msgId,f,!1,a))})})}function u(a,b){b=d("MAWDbMsgUtil").getProtocolMsgIdFromDbMsg(b);return b==null?d("MAWDexieTable").dexieResolve():d("MAWDbReactionsTxns").getReactionForEcho(a,b).then(function(a){if(a!=null&&a.length>0){var b=d("WAJids").extractUserId(d("MAWGlobals").getMyUserJid()),c=a.map(function(a){var c=d("WAJids").authorToUserId(a.author,b);return d("EchoCommonUtils").craftEchoAddress(a.reaction,c,"AdvancedCrypto")}),e=a.map(function(a){var c=d("WAJids").authorToUserId(a.author,b);return d("EchoCommonUtils").craftEchoAddress((a.ts*1e3).toString(),c,"AdvancedCrypto")});a=a.map(function(a){var c=d("WAJids").authorToUserId(a.author,b);return d("EchoCommonUtils").craftEchoAddress(a.externalId.toString(),c,"AdvancedCrypto")});return{reactionAuthoritativeTimestampMs:e,reactions:c,reactionXOfflineThreadingIds:a}}})}function v(a){var b={xmaData:null};if(a.isTombstoned==null){b.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] no isTombstoned to construct XMAData",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return b}var e={xmaContentRef:a.contentRef,xmaHeaderSubtitle:a.overlayTitle,xmaHeaderTitle:a.headerTitle,xmaIsTombstoned:a.isTombstoned,xmaMaxSubtitleNumLines:a.maxSubtitleNumOfLines,xmaMaxTitleNumLines:a.maxTitleNumOfLines,xmaSubtitleText:a.subtitleText,xmaTargetExpiry:a.targetExpiringAtSec,xmaTargetId:a.targetId,xmaTargetUsername:a.targetUsername,xmaTitleText:a.titleText},f=a.xmaLayoutType||d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_XMA_LAYOUT_TYPE.SINGLE;e=babelHelpers["extends"]({},e,{xmaLayoutType:d("MAWConvertExtendedContentXMLLayoutTypeToXMALayoutType").convertExtendedContentXMLLayoutTypeToXMALayoutType(f)});a.targetType!=null&&(e=babelHelpers["extends"]({},e,{xmaTargetType:d("MAWConvertExtendedContentTargetTypeToXMATargetType").convertExtendedContentTargetTypeToXMATargetType(a.targetType)}));a.overlayIconGlyph!=null&&(e=babelHelpers["extends"]({},e,{xmaGatingType:d("MAWConvertExtendedContentOverlayIconGlyphToXMAGatingType").convertExtendedContentOverlayIconGlyphToXMAGatingType(a.overlayIconGlyph)}));a.defaultCTA!=null&&a.defaultCTA.nativeUrl!=null&&(e=babelHelpers["extends"]({},e,{xmaDefaultCTA:a.defaultCTA.nativeUrl}));b.xmaData=e;return b}function w(a,b){var e={mediaMetadata:null};if(b.previewMediaIds!=null){var f=b.previewMediaIds[0];return d("MAWDbMediaTxns").maybeGetMediaFromMediaId(a,f).then(function(f){if(!f){e.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] No media db entry for media id to be used for xma",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.WARN};return d("MAWDexieTable").dexieResolve(e)}var g=b.msgId;if(g==null){e.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] No message id found in a xma msg",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return d("MAWDexieTable").dexieResolve(e)}var h=c("gkx")("23919")?d("MAWDbMediaTxns").maybeGetMediaBackupRowFromMsgId(a,g):d("MAWDexieTable").dexieResolve();return h.then(function(a){return d("MAWDexieTable").dexieResolve(x(g,f,!0,a))})})}else return d("MAWDexieTable").dexieResolve(e)}function x(a,b,e,f){var g={mediaMetadata:null},h=null;f!=null&&f.length>0&&(h=f.find(function(a){return a.mediaId===b.mediaId}));f=h!=null?h.fbid:b.fbid;a=b.mediaEntries.get(a);if(a==null){g.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] no media entry to construct mediaMetadata",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return g}a=d("WAMediaUtils").decodeMediaEntryData(a);h=h!=null?h.objectId:b.objectId;if(h==null)return g;var i=d("MAWGetAttachmentTypeForServerMediaType").getAttachmentTypeForServerMediaType(a.serverMediaType);if(i==null){g.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] no attachment type to construct mediaMetadata",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return g}var j=a.mediaKey;if(j==null){g.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] no mediaKey to construct mediaMetadata",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return g}var k=a.mediaKeyTimestamp;if(k==null){g.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] no mediaKeyTimestamp to construct mediaMetadata",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return g}var l=a.directPath;if(l==null){g.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] no directPath to construct mediaMetadata",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return g}if(a.serverMediaType==null){g.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] no mediaContentType to construct mediaMetadata",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return g}e=e?"image/jpeg":d("WAMediaUtils").getMimeTypeFromServerMediaType(a.serverMediaType);var m=d("MAWGetMediaAttachmentTypeForServerMediaType").getMediaAttachmentTypeForServerMediaType(a.serverMediaType);if(m==null){g.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] no xAttachmentType to construct mediaMetadata",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return g}if(a.serverMediaType!=null&&a.serverMediaType in{gif:1,image:1,sticker:1}&&b.validatedImageInfo==null){g.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] no imageinfo to construct mediaMetadata",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return g}if(a.serverMediaType==="video"&&b.validatedVideoInfo==null){g.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] no videoinfo to construct mediaMetadata",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return g}if(a.serverMediaType==="ptt"&&b.validatedAudioInfo==null){g.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] no audioinfo to construct mediaMetadata",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return g}if(a.fileSha256==null){g.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] no WA fileSha256 found",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return g}var n=d("WABase64").encodeB64UrlSafe(a.fileSha256);if(a.fileEncSha256==null){g.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] no WA fileEncSha256 found",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return g}g=d("WABase64").encodeB64UrlSafe(a.fileEncSha256);var o=null,p=null,q=null,r=null,s=null,t=void 0;a=d("MAWGetPreviewContentTypeForMediaType").getPreviewContentTypeForMediaType(a.serverMediaType);if(b.validatedImageInfo!=null){var u;o=(u=b.validatedImageInfo.width)!=null?u:0;p=(u=b.validatedImageInfo.height)!=null?u:0;r=(u=b.validatedImageInfo.jpegThumbnailWidth)!=null?u:0;s=(u=b.validatedImageInfo.jpegThumbnailHeight)!=null?u:0}if(b.validatedVideoInfo!=null){o=(u=b.validatedVideoInfo.width)!=null?u:0;p=(u=b.validatedVideoInfo.height)!=null?u:0;r=(u=b.validatedVideoInfo.jpegThumbnailWidth)!=null?u:0;s=(u=b.validatedVideoInfo.jpegThumbnailHeight)!=null?u:0;q=(u=b.validatedVideoInfo.duration)!=null?u:0}if(b.validatedAudioInfo!=null){q=(u=b.validatedAudioInfo.duration)!=null?u:0}b.validatedDocumentFileInfo!=null&&(t=b.validatedDocumentFileInfo.filename);u={attachmentObjectId:h,attachmentType:i,directPath:l,encryptedHash:g,mediaBackupStatus:"success",mediaContentType:e,mediaKey:d("EchoEncodingUtils").convertMediaKeyToString(j),mediaKeyTimestamp:k,plaintextHash:n,size:b.size,xAttachmentType:m,xContentType:"full"};u=y(u,f,a,o,p,q,r,s,t);return{mediaMetadata:u}}function y(a,b,c,d,e,f,g,h,i){a=a;b!=null&&(a=babelHelpers["extends"]({},a,{backupEntFbid:b}));c!=null&&(a=babelHelpers["extends"]({},a,{previewContentType:c}));d!=null&&(a=babelHelpers["extends"]({},a,{width:d}));e!=null&&(a=babelHelpers["extends"]({},a,{height:e}));f!=null&&(a=babelHelpers["extends"]({},a,{mediaPlayableDuration:f}));g!=null&&(a=babelHelpers["extends"]({},a,{previewContentWidth:g}));h!=null&&(a=babelHelpers["extends"]({},a,{previewContentHeight:h}));i!=null&&(a=babelHelpers["extends"]({},a,{filename:i}));return a}function z(a){a=d("WAJids").authorToUserId(a.author,d("WAJids").userIdFromJid(d("MAWGlobals").getMyUserJid()));var b=d("MAWJids").toUserJid(a);return{senderId:a,senderJid:b}}function A(a,b,e,f,g){var h=b.content.msgId,i=b.content.externalId;return g!=null?d("MAWDexieTable").dexieResolve(g):d("MAWDbMsgTxns").maybeGetMsg(a,h).then(function(a){if(a==null)return f.then(function(a){var b=d("WAJids").threadIdForChatJid(a);if(!d("MAWEncryptedBackupCacheManager").peekRestoreCache(i)){d("MAWEncryptedBackupCacheManager").addMsgEntryToReuploadCache(e,i);d("MAWBridgeEventTransmitter").issuePointQueryOutsideTxn(i,b,void 0,c("LSMEBTaskCreationSource").EB_POINT_QUERY_IN_ACT,a);return null}else{a=(b=d("MAWEncryptedBackupCacheManager").getRestoredCache(i))==null?void 0:b.dbMsg;return d("MAWDexieTable").dexieResolve(a)}});else return d("MAWDexieTable").dexieResolve(a)})}g.constructEchoMessage=a;g.constructXMAData=v;g.constructMediaMetadata=x;g.setConditionalFields=y}),98);
__d("MAWMediaAfterTxns",["MAWBridgeTypesCreators","MAWIndexedDb","MAWRavenUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a,b){return{ephemeralMediaState:b,ephemeralMediaViewMode:d("MAWRavenUtils").getEphemeralMediaViewMode(a)}};function a(a,b,c){b=a.ravenEphemeralType!=null&&a.ravenEphemeralMediaState!=null?d("MAWBridgeTypesCreators").createBridgeMedia(a.thread,a.threadJid,b,c,a.sortOrderMs,h(a.ravenEphemeralType,a.ravenEphemeralMediaState)):d("MAWBridgeTypesCreators").createBridgeMedia(a.thread,a.threadJid,b,c,a.sortOrderMs);d("MAWIndexedDb").afterTransaction({tag:"NewMedia",value:b})}g.handleNewMediaAfterTxn=a}),98);
__d("MAWSupportedDocumentTypes",[],(function(a,b,c,d,e,f){"use strict";var g=["apk","pyc","7z","z","gz","xz","rar","zip","zipx","ace","arc","zpaq","quad","balz","cab","arj","lzh","uue","bz","bz2","bzip2","jar","iso","tar","ade","adp","air","app","application","bas","bat","chm","cmd","com","command","cpl","crt","dll","dmg","dpkg","exe","hlp","hta","inf","ins","isp","jnlp","js","jse","lib","lnk","lua","mde","msc","msi","msp","mst","ocx","pcd","pif","pkg","ps1","reg","scr","sct","sh","shb","shs","sys","term","url","vb","vbe","vbs","vxd","webarchive","wsc","wsf","wsh","xbap"];function a(a){if(a==null)return!1;a=a.includes(".")?a.split(".").pop():null;return a!=null&&!g.includes(a)}f.isAllowedType=a}),66);
__d("WASortedLists",[],(function(a,b,c,d,e,f){"use strict";function a(){return[]}function b(){return[]}function c(a,b){return a.filter(b)}function d(a,b){return l(a.map(b))}function e(a,b){var c=a.length===b.length;for(var d=0;c&&d<a.length;d++)a[d]!==b[d]&&(c=!1);return c}function g(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return a;return a.concat([b]).sort()}function h(a,b){if(a.length<b.length)return!1;var c=!0;for(var d=0,e=0;c&&e<b.length;e++)do c=a[d]===b[e];while(!c&&++d<a.length);return c}function i(a,b){var c=[];for(var d=0,e=0;d<a.length;d++){var f=a[d];while(e<b.length&&f>b[e])e++;(e===b.length||f<b[e])&&c.push(f)}return c}function j(a,b){var c=[],d=0,e=0;while(d<a.length&&e<b.length){var f=a[d],g=b[e];f<g?d++:f===g?(c.push(f),d++,e++):e++}return c}function k(a,b){var c=[],d=0,e=0;while(d<a.length&&e<b.length)a[d]<b[e]?c.push(a[d++]):a[d]===b[e]?(c.push(a[d++]),e++):c.push(b[e++]);while(d<a.length)c.push(a[d++]);while(e<b.length)c.push(b[e++]);return c}function l(a){return m(a.slice().sort())}function m(a){var b=!1;for(var c=0;c<a.length-1;c++)a[c]===a[c+1]&&(b=!0);if(!b)return a;c=[];for(b=0;b<a.length-1;b++)a[b]!==a[b+1]&&c.push(a[b]);c.push(a[a.length-1]);return c}function n(a){return Array.from(a).sort()}function o(a){return a.slice().sort()}function p(a,b,c){var d=null;for(var e=0;!d&&e<a.length;e++)a[e]===b&&(d=a.slice(),d[e]=c,d=m(d.sort()));return d||a}function q(a){return[a]}function r(a){return a.length<1}function s(a,b,c){return a.slice(b,c)}f.emptySet=a;f.emptyList=b;f.filter=c;f.map=d;f.areEqual=e;f.addToSet=g;f.contains=h;f.subtract=i;f.intersect=j;f.joinUniq=k;f.sortAndDedupe=l;f.asSortedSet=n;f.sort=o;f.swapIn=p;f.singleElement=q;f.isEmpty=r;f.slice=s}),66);
__d("MAWMediaManagementTxns",["MAWBridgeTypesCreators","MAWBridgeUpload","MAWCastToMsgrServerMediaType","MAWDbChunkTxns","MAWDbMediaTxns","MAWDbMsgTxns","MAWDexieTable","MAWGlobals","MAWIndexedDb","MAWMediaAfterTxns","MAWMediaBackupTxns","MAWMediaUtils","MAWMsgType","MAWSupportedDocumentTypes","MAWWriteMsgTxns","WAErrorMessage","WAJids","WALogger","WAMediaUtils","WASortedLists","WATagsLogger","WATimeUtils","err","gkx","isInstamadilloEB"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] mediaBackup entry already exists for objectId ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Same FBId assigned for different mediaIds. fbId: "," - shared by hashedPlaintextHashes: "," ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Same objectId assigned for different mediaIds. objectId: "," shared by  hashedPlaintextHashes: "," ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][updateMediaWithEncodedMediaEntryData] media entry is missing, can't upate media with encoded data"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] media entry is missing, can't update media info"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Media failed to link. Possible duplicate? Will attempt a retry. Error: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Media failed to link. Possible duplicate? Will attempt a retry. For plaintextHash: ",", hashedPlaintextHash: ",". Error: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Media failed to link after retry. Error: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Media failed to link after retry. For plaintextHash: ",", hashedPlaintextHash: ",". Error: ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Media found after retry for plaintextHash: ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["Missing mandatory args for incoming media msg"]);r=function(){return a};return a}var s=d("WATagsLogger").TAGS(["MAWMediaManagementTxns"]),t=c("gkx")("23924");function a(a,b,c,e){var f=c==null||b.type===d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE&&(t||!d("MAWSupportedDocumentTypes").isAllowedType((c=c.validatedDocumentFileInfo)==null?void 0:c.filename));return d("MAWWriteMsgTxns").prepareMsgWriteData(a,b,e).then(function(a){return babelHelpers["extends"]({},a,{shouldDropDocument:f})})}function b(a,b,e,f){f===void 0&&(f=!1);var g={validatedAudioInfo:b.validatedAudioInfo,validatedDocumentFileInfo:b.validatedDocumentFileInfo,validatedImageInfo:b.validatedImageInfo,validatedVideoInfo:b.validatedVideoInfo},h=d("MAWMediaUtils").genHMACPlaintextHash(b.plaintextHash),i=d("WAMediaUtils").decodeMediaEntryData(b.mediaEntry),j=i.objectId!=null?d("WAMediaUtils").stringToDeliveryObjectId(i.objectId):null;return d("MAWDexieTable").dexieAll([u(a,e,b.plaintextHash,b.mediaType,b.size,b.mediaEntry,g,j,void 0,f),d("MAWDbChunkTxns").hasMediaChunk(a,h)]).then(function(a){var b=a[0];a=a[1];e.type!==d("MAWMsgType").MSG_TYPE.REVOKED&&!f&&d("MAWMediaAfterTxns").handleNewMediaAfterTxn(e,b,a);return b}).then(function(a){var b=d("MAWCastToMsgrServerMediaType").castToMsgrServerMediaType(i.serverMediaType,f),g=i.mediaKeyTimestamp;if(d("MAWMsgType").isMAWSupportedMediaType(e.type)&&!c("isInstamadilloEB")()){var h=e.threadJid;j!=null&&b!=null&&h!=null&&g!=null&&b!=="document"?d("MAWIndexedDb").afterTransaction({tag:"UploadAttachment",value:d("MAWBridgeUpload").createBridgeUploadAttachment(e.thread,j,b,e.externalId,d("MAWGlobals").getConfig().productTypeForEBAttachments,d("WAJids").threadIdForChatJid(h),h,g)}):d("WALogger").WARN(r())}return a})}function u(a,b,c,e,f,g,h,i,j,k){k===void 0&&(k=!1);return v(a,b,c,e,f,g,h,i,j,k).then(function(c){var e=k?d("MAWDexieTable").dexieResolve():d("MAWDbMsgTxns").updateMediaId(a,b,c.mediaId);return e.then(function(){return d("MAWMediaBackupTxns").linkMediaBackup(a,c.mediaId,b.msgId,i,j).then(function(){return c})})})}function v(a,b,c,e,f,g,h,i,j,k,l){k===void 0&&(k=!1);l===void 0&&(l=0);return d("MAWDbMediaTxns").maybeGetMediaFromPlaintextHash(a,c).then(function(r){var t=new Map(r==null?void 0:r.mediaEntries),u=z(g,i,j);u!=null&&t.set(b.msgId,u);if(r){l>0&&s.LOG(q(),c);var w=babelHelpers["extends"]({},r,h,{mediaEntries:t,msgIds:d("WASortedLists").addToSet(r.msgIds,b.msgId)});return a.media.put(w).then(function(){return w})}else{var x=d("MAWMediaUtils").genHMACPlaintextHash(c),y=babelHelpers["extends"]({fbid:(u=j)!=null?u:void 0,hashedPlaintextHash:x,mediaEntries:t,mediaType:e,msgIds:d("WASortedLists").singleElement(b.msgId),objectId:(r=i)!=null?r:void 0,plaintextHash:c,size:f,ts:d("WATimeUtils").unixTime()},h);return a.media.add(y).then(function(a){return babelHelpers["extends"]({},y,{mediaId:a})})["catch"](function(q){var r=d("WAErrorMessage").maybeGetMessageFromError(q);if(l>0){s.WARN(p(),c,x,r);s.ERROR(o(),r);throw q}else{s.WARN(n(),c,x,r);s.ERROR(m(),r);return v(a,b,c,e,f,g,h,i,j,k,l+1)}})}})}var w=function(a,b,e,f,g,h,i,j,k){k===void 0&&(k=!1);return d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b).then(function(b){if(b==null)throw c("err")("Do not have the media message in db when attachHashToMediaMsg");else return u(a,b,e,h,i,void 0,j,f,g,k)})},x=function(a,b,c){return d("MAWDbMediaTxns").maybeGetMediaFromHashedPlaintextHash(a,b).then(function(b){if(b!=null){var d=babelHelpers["extends"]({},b);c.validatedAudioInfo!=null&&(d.validatedAudioInfo=babelHelpers["extends"]({},b.validatedAudioInfo,c.validatedAudioInfo));c.validatedVideoInfo!=null&&(d.validatedVideoInfo=babelHelpers["extends"]({},b.validatedVideoInfo,c.validatedVideoInfo));c.validatedImageInfo!=null&&(d.validatedImageInfo=babelHelpers["extends"]({},b.validatedImageInfo,c.validatedImageInfo));c.validatedDocumentFileInfo!=null&&(d.validatedDocumentFileInfo=babelHelpers["extends"]({},b.validatedDocumentFileInfo,c.validatedDocumentFileInfo));return a.media.update(d.mediaId,d).then(function(){})}else s.WARN(l())})},y=function(a,b,c,e){return d("MAWDbMediaTxns").maybeGetMediaFromHashedPlaintextHash(a,b).then(function(b){if(b!=null){var f=e?b.mediaEntries.set(c,e):b.mediaEntries;b=babelHelpers["extends"]({},b,{mediaEntries:f});return a.media.update(b.mediaId,b)}else{s.ERROR(k());return d("MAWDexieTable").dexieResolve()}})};function e(a,b,c,e,f,g,h,i,j,k){k===void 0&&(k=!1);return d("MAWDexieTable").dexieAll([w(a,b,e,f,g,h,j.size,i,k),d("MAWDbChunkTxns").getOrCreateMediaChunk(a,e,c,j.type)]).then(function(a){a=a[0];return a})}function z(a,b,c){var e;a=a;a!=null&&b!=null&&(e=d("WAMediaUtils").decodeMediaEntryData(a),a=d("WAMediaUtils").encodeMediaEntryWithUpdatedObjectId(e,b));a!=null&&c!=null&&(e=d("WAMediaUtils").decodeMediaEntryData(a),a=d("WAMediaUtils").encodeMediaEntryWithUpdatedFbid(e,c));return a}function f(a,b,c){var e=new Map();a.mediaEntries.forEach(function(a,f){var g=d("WAMediaUtils").decodeMediaEntryData(a);g=g.objectId===b?d("WAMediaUtils").encodeMediaEntryWithUpdatedFbid(g,c):a;e.set(f,g)});return e}function A(a,b,c,e){var f=new Map();b.forEach(function(a){var b;b=(b=f.get(a.hashedPlaintextHash))!=null?b:[];b.push(a);f.set(a.hashedPlaintextHash,b)});return d("MAWDbMediaTxns").maybeBulkGetMediaFromHashedPlaintextHash(a,[].concat(Array.from(f.keys()))).then(function(g){var h=new Map(g.map(function(a){return[a.hashedPlaintextHash,a]})),i=new Map();b.forEach(function(a){var b=h.get(a.hashedPlaintextHash);if(a==null)return;var c=z(a==null?void 0:a.entry,a==null?void 0:a.objectId,a==null?void 0:a.fbId);if(b){var e=c?b.mediaEntries.set(a.msgId,c):b.mediaEntries;e=babelHelpers["extends"]({},b,{mediaEntries:e,msgIds:d("WASortedLists").addToSet(b.msgIds,a.msgId)});h.set(a.hashedPlaintextHash,e)}else I(i,a,c)});var j=new Map(),k=new Map();g=Array.from(i.values()).filter(function(a){return B(a,j,k)});return d("MAWDexieTable").dexieAll([a.media.bulkAdd(g),a.media.bulkPut(Array.from(h.values()))]).then(function(){return C(a,[].concat(Array.from(f.keys())),f,c,e)})})}function B(a,b,c){if(a.objectId!=null){var d=b.get(a.objectId);if(d!=null&&d!==a.hashedPlaintextHash){s.ERROR(j(),a.objectId,d,a.hashedPlaintextHash);return!1}}if(a.fbid!=null){d=c.get(a.fbid);if(d!=null&&d!==a.hashedPlaintextHash){s.ERROR(i(),a.fbid,d,a.hashedPlaintextHash);return!1}}a.objectId!=null&&b.set(a.objectId,a.hashedPlaintextHash);a.fbid!=null&&c.set(a.fbid,a.hashedPlaintextHash);return!0}function C(a,b,c,e,f){return d("MAWDbMediaTxns").maybeBulkGetMediaFromHashedPlaintextHash(a,b).then(function(b){return d("MAWDexieTable").dexieAll([F(a,b,c),d("MAWMediaBackupTxns").bulkLinkMediaBackup(a,G(b,c))]).then(function(){D(b,c,e,f);return b})})}function D(a,b,c,e){a.forEach(function(a){var f=b.get(a.hashedPlaintextHash);f!=null&&!E(f)&&d("MAWIndexedDb").afterTransaction({tag:"NewMedia",value:d("MAWBridgeTypesCreators").createBridgeMedia(c,e,a,!1)})})}function E(a){return a.reduce(function(a,b){return a||b.isXMAShare},!1)}function F(a,b,c){b=b.reduce(function(a,b){var d;(d=c.get(b.hashedPlaintextHash))==null?void 0:d.filter(function(a){return a!=null&&!a.isXMAShare}).forEach(function(c){return a.set(c.msgId,b.mediaId)});return a},new Map());return d("MAWDbMsgTxns").bulkUpdateMediaId(a,b)}function G(a,b){var c=new Map();a.forEach(function(a){var d;d=(d=b.get(a.hashedPlaintextHash))!=null?d:[];d.forEach(function(b){c.has(b.objectId)?s.ERROR(h(),b.objectId):b.objectId!=null&&c.set(b.objectId,{fbid:b.fbId,mediaId:a.mediaId,msgId:b.msgId,objectId:b.objectId})})});return Array.from(c.values())}function H(a,b){var c;a=a?new Map([[b.msgId,a]]):new Map();return babelHelpers["extends"]({fbid:(c=b.fbId)!=null?c:void 0,hashedPlaintextHash:b.hashedPlaintextHash,mediaEntries:a,mediaType:b.mediaType,msgIds:d("WASortedLists").singleElement(b.msgId),objectId:(c=b.objectId)!=null?c:void 0,plaintextHash:b.plaintextHash,size:b.size,ts:d("WATimeUtils").unixTime()},b.mediaInfo)}function I(a,b,c){var d=a.get(b.hashedPlaintextHash);d==null?a.set(b.hashedPlaintextHash,H(c,b)):(c!=null&&d.mediaEntries.set(b.msgId,c),d.msgIds.push(b.msgId))}g.prepareMediaWriteData=a;g.handleUnstoredDbMedia=b;g.linkMedia=u;g.createOrUpdateMediaRow=v;g.attachHashToMediaMsg=w;g.updateMediaEntryWithValidatedMediaInfo=x;g.updateMediaWithEncodedMediaEntryData=y;g.attachHashAndSaveMedia=e;g.updateBackupFbidInMediaEntries=f;g.bulkLinkMedia=A;g.linkMessageAndMediaBackupForMediaList=C}),98);
__d("MAWConvertFutureproofMsgTxns",["MAWBridgeMsg","MAWBridgeTypesCreators","MAWDbMsg","MAWDbThreadTxns","MAWDexieTable","MAWIndexedDb","MAWLoadReplyMediaTxns","MAWMediaManagementTxns","MAWMsgType","MAWThreadEvent","MAWThreadSnippetBuildTxns","WAArrayZip","WAJids","err"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,c){return a.type===d("MAWMsgType").MSG_TYPE.REVOKED?babelHelpers["extends"]({},a,{altIndex:"foobar",msgId:b.msgId,rowId:b.rowId,sortOrderMs:b.sortOrderMs,thread:b.thread,threadJid:c,ts:b.ts}):babelHelpers["extends"]({},a,{msgId:b.msgId,rowId:b.rowId,sortOrderMs:b.sortOrderMs,thread:b.thread,threadJid:c,ts:b.ts})}function a(a,b,e,f,g){var i=h(b,e,g.jid);return a.messages.put(i).then(function(){return d("MAWDbThreadTxns").needsRetroactiveReadReceiptInThread(a,i)}).then(function(b){if(b){i.altIndex=d("MAWDbMsg").craftToBeReadAltIndex(i.thread);return a.messages.put(i)}}).then(function(){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,i)}).then(function(b){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(i,void 0,b)});d("MAWIndexedDb").afterTransactionThreadEvent({chatJid:g.jid,msgId:i.msgId},d("MAWThreadEvent").PLACEHOLDER_CONVERT_SUBSCRIPTION);b=i.msgId===g.newestMsg?d("MAWThreadSnippetBuildTxns").buildThreadSnippet(a,i,g).then(function(a){var b=a.snippetParams,c=a.snippetSenderContactId;a=a.snippetType;d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({snippetParams:b,snippetSenderContactId:c,snippetType:a,threadId:g.chatId,threadJid:g.jid})})}):d("MAWDexieTable").dexieResolve();var e=f!=null?d("MAWMediaManagementTxns").handleUnstoredDbMedia(a,f,i).then(function(a){if(d("WAJids").isAuthorSystem(i.author))throw c("err")("This cannot happen");return{plaintextHash:a.plaintextHash,protocolMsgId:{author:i.author,chat:g.jid,externalId:i.externalId}}}):d("MAWDexieTable").dexieResolve(null);return d("MAWDexieTable").dexieAll([b,e]).then(function(a){a[0];a=a[1];return a})})}function b(a,b){var e=[];b.forEach(function(a){e.push(h(a.unstoredDbMsg,a.dbMsg,a.thread.jid))});var f=d("MAWDbThreadTxns").bulkNeedsRetroactiveReadReceiptInThread(a,e).then(function(a){d("WAArrayZip").zip(e,a).forEach(function(a){var b=a[0];a=a[1];a&&(b.altIndex=d("MAWDbMsg").craftToBeReadAltIndex(b.thread))})});return f.then(function(){return a.messages.bulkPut(e).then(function(){var f=[];e.forEach(function(e){var g=d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,e).then(function(f){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(e,void 0,f)});var g=(f=b.get(e.msgId))==null?void 0:f.thread;f=(f=b.get(e.msgId))==null?void 0:f.unstoredDbMedia;if(g==null)throw c("err")("MAWConvertFutureproofMsgTxns: thread is null cannot happen");d("MAWIndexedDb").afterTransactionThreadEvent({chatJid:g.jid,msgId:e.msgId},d("MAWThreadEvent").PLACEHOLDER_CONVERT_SUBSCRIPTION);var h=e.msgId===g.newestMsg?d("MAWThreadSnippetBuildTxns").buildThreadSnippet(a,e,g).then(function(a){var b=a.snippetParams,c=a.snippetSenderContactId;a=a.snippetType;d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({snippetParams:b,snippetSenderContactId:c,snippetType:a,threadId:g.chatId,threadJid:g.jid})})}):d("MAWDexieTable").dexieResolve();f=f!=null?d("MAWMediaManagementTxns").handleUnstoredDbMedia(a,f,e).then(function(a){if(d("WAJids").isAuthorSystem(e.author))throw c("err")("This cannot happen");return{plaintextHash:a.plaintextHash,protocolMsgId:{author:e.author,chat:g.jid,externalId:e.externalId}}}):d("MAWDexieTable").dexieResolve(null);return d("MAWDexieTable").dexieAll([h,f]).then(function(a){a[0];a=a[1];return a})});f.push(g)});return d("MAWDexieTable").dexieAll(f).then(function(a){return a.map(function(a){return a})})})})}g.convertFutureproofMsg=a;g.bulkConvertFutureproofMsgs=b}),98);
__d("MAWUnsafeCoerce",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}f.unsafeCoerce=a}),66);
__d("MAWWriteEditTxns",["FBLogger","MAWAckLevel","MAWBridgeMsg","MAWBridgeTypesCreators","MAWDbEditMsgHistoryTxns","MAWDbMsgTxns","MAWDexieTable","MAWEBSwitch","MAWEBUploadTrackingUtils","MAWIndexedDb","MAWLoadReplyMediaTxns","MAWThreadSnippetForTextMsg","MAWUnsafeCoerce","WAGlobals","WAJids","WAMsgType","WAResultOrError","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var e=b.args,f=b.externalId,g=e.editMsgContent;e=e.originalProtocolMsgId;var i=e.chat,j=e.externalId;return d("MAWDexieTable").dexieAll([a.threads.get({jid:i}),d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,e),a.messages.where("quoteExternalId").equals(j).toArray(),a.editMsgHistory.where("originalMsgExternalId").equals(j).toArray()]).then(function(e){var k=e[0],l=e[1],m=e[2];e=e[3];if(k==null)return d("WAResultOrError").makeError("missing_thread");if(l==null)return d("WAResultOrError").makeError("missing_msg");if(l.type!==d("WAMsgType").MSG_TYPE.TEXT)throw c("err")("Msg other than text cannot be edited.");var n=e.find(function(a){return a.author===d("WAJids").AUTHOR_ME&&a.threadJid===i&&a.editExternalId===f});if((n==null?void 0:n.sendStatus)!=null&&n.sendStatus>d("MAWAckLevel").ACK.clock)return d("WAResultOrError").makeError("already_sent");n=[];n.push(h(b,i,j));e=e.find(function(a){return a.author===d("WAJids").AUTHOR_ME&&a.threadJid===i&&a.editExternalId===j});e==null&&(l.editCount==null||l.editCount===0)&&n.push(h(l,i,j));return d("MAWDbEditMsgHistoryTxns").bulkAddEditMsgHistory(a,n,!1).then(function(){if(c("MAWEBSwitch").isEnabled()&&!d("WAGlobals").getConfig().useEbUploadQueue()){var b=d("MAWEBUploadTrackingUtils").genInstanceKeyForMiddleware(f);b!=null&&d("MAWEBUploadTrackingUtils").startUploadTracking(f,d("WAMsgType").MSG_TYPE.EDIT_ACTION,"send",b)}var e=babelHelpers["extends"]({},l,{ack:d("MAWAckLevel").ACK.clock,editCount:((b=l.editCount)!=null?b:0)+1,msgContent:g});if(k.newestMsg!=null&&k.newestMsg===e.msgId){b=d("WAJids").userIdFromJid(d("WAGlobals").getMyUserJid());var h=c("MAWThreadSnippetForTextMsg")(e,b,d("WAJids").interpretAsGroupJid(k.jid)!=null),n=h.snippetParams;h=h.snippetType;d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({snippetParams:n,snippetSenderContactId:b,snippetType:h,threadId:k.chatId,threadJid:k.jid})})}var o=[],p=d("WAGlobals").getMyUserJid();n=m.find(function(a){var b;return(((b=a.quote)==null?void 0:b.content.author)===d("WAJids").AUTHOR_ME||((b=a.quote)==null?void 0:b.content.author)===p)&&a.threadJid===i});if(n!=null){b=n.quote;h=n.quoteExternalId;if(b==null)c("FBLogger")("messenger_e2ee_web").warn("[edit message] Failed to get the quoted content for a msg that has been quoted.",h);else{h=babelHelpers["extends"]({},n,{quote:babelHelpers["extends"]({},b,{content:babelHelpers["extends"]({},b.content,{msgContent:babelHelpers["extends"]({},e.msgContent)})})});o.push(h)}}return a.messages.bulkPut([e].concat(o)).then(function(){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,l)}).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(e,void 0,a)})}).then(function(){o.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(a)})});return d("WAResultOrError").makeResult({originalMsgExternalId:j,originalMsgId:l.msgId,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:i,externalId:f}})})})})}function h(a,b,c){var e;return{author:d("WAJids").AUTHOR_ME,editExternalId:a.externalId,editTs:(e=a.serverTs)!=null?e:a.ts,msgContent:(e=(e=a.args)==null?void 0:e.editMsgContent)!=null?e:d("MAWUnsafeCoerce").unsafeCoerce(a.msgContent),originalMsgExternalId:c,sendStatus:d("MAWAckLevel").ACK.clock,specialTextSize:a.specialTextSize,threadJid:b}}g.writeEdit=a}),98);
__d("MAWWriteReactionTxns",["MAWAuthor","MAWDbMsg","MAWDbReaction","MAWDbReactionUtils","MAWDbReactionsTxns","MAWDexieTable","WAJids","qex"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e){var f=b.author,g=b.externalId,h=b.groupingKey,i=b.reaction,j=b.reactToAuthor,k=b.reactToExternalId,l=b.ts;return d("MAWDexieTable").dexieAll([a.messages.where("externalId").equals(k).toArray(),a.reactions.where("reactToExternalId").equals(k).toArray(),d("MAWDbReactionsTxns").getNextReactionIdNumberForThread(a,e)]).then(function(b){var m=b[0],n=b[1];b=b[2];n=d("MAWDbReaction").findMatchingReaction(n,e.jid,f);var o=d("MAWAuthor").getAuthorUserJid(j);m=m.find(function(a){return a.thread===e.chatId&&o===d("MAWAuthor").getAuthorUserJid(a.author)});var p=d("MAWDbReaction").formatReactionForDb(e.jid,g,d("MAWDbMsg").craftReactionId(e.chatId,b),k,i,h,j,m==null?void 0:m.msgId,l,(b=f)!=null?b:d("WAJids").AUTHOR_ME,n==null?void 0:n.rowId);return d("MAWDbReactionsTxns").putReaction(a,p).then(function(a){a=babelHelpers["extends"]({},p,{rowId:a});var b=e.chatId;c("qex")._("1215")!==!0&&d("MAWDbReactionUtils").dispatchReaction(a,b);return a})})}g.writeReaction=a}),98);
__d("WAConsumerApplication.pb",["WACommon.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){var h;a={SMALL:1,MEDIUM:2,LARGE:3};b={SANS_SERIF:0,SERIF:1,NORICAN_REGULAR:2,BRYNDAN_WRITE:3,BEBASNEUE_REGULAR:4,OSWALD_HEAVY:5};c={NONE:0,VIDEO:1};e={};f={};var i={},j={},k={},l={},m={},n={},o={},p={},q={},r={},s={},t={},u={},v={},w={},x={},y={},z={},A={},B={},C={},D={},E={},F={},G={},H={},I={},J={},K={},L={},M={};e.internalSpec={payload:[1,(h=d("WAProtoConst")).TYPES.MESSAGE,f],metadata:[2,h.TYPES.MESSAGE,j]};f.internalSpec={content:[1,h.TYPES.MESSAGE,m],applicationData:[2,h.TYPES.MESSAGE,l],signal:[3,h.TYPES.MESSAGE,k],subProtocol:[4,h.TYPES.MESSAGE,i],__oneofs__:{payload:["content","applicationData","signal","subProtocol"]}};i.internalSpec={futureProof:[1,h.TYPES.ENUM,(d=d("WACommon.pb")).FUTURE_PROOF_BEHAVIOR]};j.internalSpec={specialTextSize:[1,h.TYPES.ENUM,a]};k.internalSpec={};l.internalSpec={revoke:[1,h.TYPES.MESSAGE,v],__oneofs__:{applicationContent:["revoke"]}};m.internalSpec={messageText:[1,h.TYPES.MESSAGE,d.MessageTextSpec],imageMessage:[2,h.TYPES.MESSAGE,I],contactMessage:[3,h.TYPES.MESSAGE,A],locationMessage:[4,h.TYPES.MESSAGE,D],extendedTextMessage:[5,h.TYPES.MESSAGE,C],statusTextMessage:[6,h.TYPES.MESSAGE,B],documentMessage:[7,h.TYPES.MESSAGE,F],audioMessage:[8,h.TYPES.MESSAGE,H],videoMessage:[9,h.TYPES.MESSAGE,G],contactsArrayMessage:[10,h.TYPES.MESSAGE,z],liveLocationMessage:[11,h.TYPES.MESSAGE,y],stickerMessage:[12,h.TYPES.MESSAGE,E],groupInviteMessage:[13,h.TYPES.MESSAGE,x],viewOnceMessage:[14,h.TYPES.MESSAGE,w],reactionMessage:[16,h.TYPES.MESSAGE,u],pollCreationMessage:[17,h.TYPES.MESSAGE,s],pollUpdateMessage:[18,h.TYPES.MESSAGE,r],editMessage:[19,h.TYPES.MESSAGE,n],__oneofs__:{content:["messageText","imageMessage","contactMessage","locationMessage","extendedTextMessage","statusTextMessage","documentMessage","audioMessage","videoMessage","contactsArrayMessage","liveLocationMessage","stickerMessage","groupInviteMessage","viewOnceMessage","reactionMessage","pollCreationMessage","pollUpdateMessage","editMessage"]}};n.internalSpec={key:[1,h.TYPES.MESSAGE,d.MessageKeySpec],message:[2,h.TYPES.MESSAGE,d.MessageTextSpec],timestampMs:[3,h.TYPES.INT64]};o.internalSpec={pollOption:[1,h.FLAGS.REPEATED|h.TYPES.MESSAGE,t]};p.internalSpec={selectedOptions:[1,h.FLAGS.REPEATED|h.TYPES.BYTES],senderTimestampMs:[2,h.TYPES.INT64]};q.internalSpec={encPayload:[1,h.TYPES.BYTES],encIv:[2,h.TYPES.BYTES]};r.internalSpec={pollCreationMessageKey:[1,h.TYPES.MESSAGE,d.MessageKeySpec],vote:[2,h.TYPES.MESSAGE,q],addOption:[3,h.TYPES.MESSAGE,q]};s.internalSpec={encKey:[1,h.TYPES.BYTES],name:[2,h.TYPES.STRING],options:[3,h.FLAGS.REPEATED|h.TYPES.MESSAGE,t],selectableOptionsCount:[4,h.TYPES.UINT32]};t.internalSpec={optionName:[1,h.TYPES.STRING]};u.internalSpec={key:[1,h.TYPES.MESSAGE,d.MessageKeySpec],text:[2,h.TYPES.STRING],groupingKey:[3,h.TYPES.STRING],senderTimestampMs:[4,h.TYPES.INT64],reactionMetadataDataclassData:[5,h.TYPES.STRING],style:[6,h.TYPES.INT32]};v.internalSpec={key:[1,h.TYPES.MESSAGE,d.MessageKeySpec]};w.internalSpec={imageMessage:[1,h.TYPES.MESSAGE,I],videoMessage:[2,h.TYPES.MESSAGE,G],__oneofs__:{viewOnceContent:["imageMessage","videoMessage"]}};x.internalSpec={groupJid:[1,h.TYPES.STRING],inviteCode:[2,h.TYPES.STRING],inviteExpiration:[3,h.TYPES.INT64],groupName:[4,h.TYPES.STRING],jpegThumbnail:[5,h.TYPES.BYTES],caption:[6,h.TYPES.MESSAGE,d.MessageTextSpec]};y.internalSpec={location:[1,h.TYPES.MESSAGE,L],accuracyInMeters:[2,h.TYPES.UINT32],speedInMps:[3,h.TYPES.FLOAT],degreesClockwiseFromMagneticNorth:[4,h.TYPES.UINT32],caption:[5,h.TYPES.MESSAGE,d.MessageTextSpec],sequenceNumber:[6,h.TYPES.INT64],timeOffset:[7,h.TYPES.UINT32]};z.internalSpec={displayName:[1,h.TYPES.STRING],contacts:[2,h.FLAGS.REPEATED|h.TYPES.MESSAGE,A]};A.internalSpec={contact:[1,h.TYPES.MESSAGE,d.SubProtocolSpec]};B.internalSpec={text:[1,h.TYPES.MESSAGE,C],textArgb:[6,h.TYPES.FIXED32],backgroundArgb:[7,h.TYPES.FIXED32],font:[8,h.TYPES.ENUM,b]};C.internalSpec={text:[1,h.TYPES.MESSAGE,d.MessageTextSpec],matchedText:[2,h.TYPES.STRING],canonicalUrl:[3,h.TYPES.STRING],description:[4,h.TYPES.STRING],title:[5,h.TYPES.STRING],thumbnail:[6,h.TYPES.MESSAGE,d.SubProtocolSpec],previewType:[7,h.TYPES.ENUM,c]};D.internalSpec={location:[1,h.TYPES.MESSAGE,L],address:[2,h.TYPES.STRING]};E.internalSpec={sticker:[1,h.TYPES.MESSAGE,d.SubProtocolSpec]};F.internalSpec={document:[1,h.TYPES.MESSAGE,d.SubProtocolSpec],fileName:[2,h.TYPES.STRING]};G.internalSpec={video:[1,h.TYPES.MESSAGE,d.SubProtocolSpec],caption:[2,h.TYPES.MESSAGE,d.MessageTextSpec]};H.internalSpec={audio:[1,h.TYPES.MESSAGE,d.SubProtocolSpec],ptt:[2,h.TYPES.BOOL]};I.internalSpec={image:[1,h.TYPES.MESSAGE,d.SubProtocolSpec],caption:[2,h.TYPES.MESSAGE,d.MessageTextSpec]};J.internalSpec={polygonVertices:[1,h.FLAGS.REPEATED|h.TYPES.MESSAGE,K],location:[2,h.TYPES.MESSAGE,L],__oneofs__:{action:["location"]}};K.internalSpec={x:[1,h.TYPES.DOUBLE],y:[2,h.TYPES.DOUBLE]};L.internalSpec={degreesLatitude:[1,h.TYPES.DOUBLE],degreesLongitude:[2,h.TYPES.DOUBLE],name:[3,h.TYPES.STRING]};M.internalSpec={protocol:[1,h.TYPES.MESSAGE,d.SubProtocolSpec]};g.CONSUMER_APPLICATION_METADATA_SPECIAL_TEXT_SIZE=a;g.CONSUMER_APPLICATION_STATUS_TEXT_MESAGE_FONT_TYPE=b;g.CONSUMER_APPLICATION_EXTENDED_TEXT_MESSAGE_PREVIEW_TYPE=c;g.ConsumerApplicationSpec=e;g.ConsumerApplication$PayloadSpec=f;g.ConsumerApplication$SubProtocolPayloadSpec=i;g.ConsumerApplication$MetadataSpec=j;g.ConsumerApplication$SignalSpec=k;g.ConsumerApplication$ApplicationDataSpec=l;g.ConsumerApplication$ContentSpec=m;g.ConsumerApplication$EditMessageSpec=n;g.ConsumerApplication$PollAddOptionMessageSpec=o;g.ConsumerApplication$PollVoteMessageSpec=p;g.ConsumerApplication$PollEncValueSpec=q;g.ConsumerApplication$PollUpdateMessageSpec=r;g.ConsumerApplication$PollCreationMessageSpec=s;g.ConsumerApplication$OptionSpec=t;g.ConsumerApplication$ReactionMessageSpec=u;g.ConsumerApplication$RevokeMessageSpec=v;g.ConsumerApplication$ViewOnceMessageSpec=w;g.ConsumerApplication$GroupInviteMessageSpec=x;g.ConsumerApplication$LiveLocationMessageSpec=y;g.ConsumerApplication$ContactsArrayMessageSpec=z;g.ConsumerApplication$ContactMessageSpec=A;g.ConsumerApplication$StatusTextMesageSpec=B;g.ConsumerApplication$ExtendedTextMessageSpec=C;g.ConsumerApplication$LocationMessageSpec=D;g.ConsumerApplication$StickerMessageSpec=E;g.ConsumerApplication$DocumentMessageSpec=F;g.ConsumerApplication$VideoMessageSpec=G;g.ConsumerApplication$AudioMessageSpec=H;g.ConsumerApplication$ImageMessageSpec=I;g.ConsumerApplication$InteractiveAnnotationSpec=J;g.ConsumerApplication$PointSpec=K;g.ConsumerApplication$LocationSpec=L;g.ConsumerApplication$MediaPayloadSpec=M}),98);
__d("validateMAWMediaAndComposeEntryForProtoMsg",["WAMediaUtils","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(b==null)throw c("err")("DbMedia is null in validateMediaAndComposeEntryForProtoMsg");if(!b.msgIds.includes(a))throw c("err")("the media ("+b.mediaId+") is not linked to the msg ("+a+")");a=b.mediaEntries.get(a);if(a==null)throw c("err")("media entry not found in validateMediaAndComposeEntryForProtoMsg");var e=b.plaintextHash,f=d("WAMediaUtils").mediaEntryDataToRawData(e,a);e=["fileSha256","mediaKey","fileEncSha256","directPath","mediaKeyTimestamp"];a=e.filter(function(a){return f[a]==null});if(a.length>0)throw c("err")("missing fields in mediaEntryData: "+a.toString());return[b,f]}g["default"]=a}),98);
__d("encodeMAWDocumentFileMessage",["WAMediaTransport.pb","encodeProtobuf","validateMAWMediaAndComposeEntryForProtoMsg"],(function(a,b,c,d,e,f,g){"use strict";var h="application/pdf";function a(a,b){return i(a.msgId,b)}function i(a,b){a=c("validateMAWMediaAndComposeEntryForProtoMsg")(a,b);b=a[0];a=a[1];return j(b,a)}function j(a,b){b={ancillary:{},integral:{transport:{ancillary:{fileLength:a.size,mimetype:h,objectId:b.objectId,thumbnail:{jpegThumbnail:new ArrayBuffer(1),thumbnailHeight:1,thumbnailWidth:1}},integral:{directPath:b.directPath,fileEncSha256:b.fileEncSha256,fileSha256:b.fileSha256,mediaKey:b.mediaKey,mediaKeyTimestamp:b.mediaKeyTimestamp}}}};b=d("encodeProtobuf").encodeProtobuf(d("WAMediaTransport.pb").DocumentTransportSpec,b);return{payload:{content:{documentMessage:{document:{payload:b.readBuffer(),version:1},fileName:(b=a.validatedDocumentFileInfo)==null?void 0:b.filename}}}}}g["default"]=a}),98);
__d("MAWAsConsumerApplication",["I64","LSIntEnum","MAWDbMedia","MAWGlobals","MAWJids","MAWMsgType","MAWVault","WAAssertUnreachable","WAConsumerApplication.pb","WAJids","WAMediaTransport.pb","encodeMAWDocumentFileMessage","encodeProtobuf","err","validateMAWMediaAndComposeEntryForProtoMsg"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j="image/jpeg",k="video/mp4",l="audio/wav",m="image/gif",n="image/webp",o="application/pdf",p=new ArrayBuffer(0);function a(a,b,e){switch(a.type){case d("MAWMsgType").MSG_TYPE.TEXT:return r(a);case d("MAWMsgType").MSG_TYPE.IMAGE:return s(a,b);case d("MAWMsgType").MSG_TYPE.VIDEO:return z(a,b);case d("MAWMsgType").MSG_TYPE.PTT:return C(a,b);case d("MAWMsgType").MSG_TYPE.REVOKED:return F(a);case d("MAWMsgType").MSG_TYPE.GIF:return z(a,b);case d("MAWMsgType").MSG_TYPE.STICKER:return w(a,b);case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return c("encodeMAWDocumentFileMessage")(a,b);case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE:case d("MAWMsgType").MSG_TYPE.SK_DISTRIBUTION:return null;case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:throw c("err")("Implemented ephemeral setting message in MAWAsConsumerApplication");case d("MAWMsgType").MSG_TYPE.XMA:throw c("err")("XMA content message is not consumer application. It should be addressed as ArmadilloApplication");case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:case d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME:throw c("err")("We do not support converting to protoMsg with "+a.type+" type","mpf_web_foundations");case d("MAWMsgType").MSG_TYPE.RAVEN:case d("MAWMsgType").MSG_TYPE.RAVEN_ACTION:throw c("err")("Raven content message is not consumer application. It should be addressed as ArmadilloApplication");case d("MAWMsgType").MSG_TYPE.EDIT_ACTION:throw c("err")("We do not support editing messages right now since the sending flow is not implemented yet. ");case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:return G(a,e);case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:throw c("err")("Sending bump messages is not supported yet.");default:return c("WAAssertUnreachable")(a.type)}}function b(a,b){if(b==null)return q(a);else switch(b.mediaType){case d("MAWDbMedia").MEDIA_TYPE.IMAGE:return t(a.msgId,b);case d("MAWDbMedia").MEDIA_TYPE.VIDEO:return A(a.msgId,b);case d("MAWDbMedia").MEDIA_TYPE.PTT:return D(a.msgId,b);case d("MAWDbMedia").MEDIA_TYPE.GIF:return A(a.msgId,b);case d("MAWDbMedia").MEDIA_TYPE.STICKER:return x(a.msgId,b);default:return null}}function q(a){var b=null;if(a.type===d("MAWMsgType").MSG_TYPE.REVOKED&&a.msgContent!=null&&a.msgContent.content!=null)b=a.msgContent.content;else if(a.type===d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME&&a.msgContent!=null)b=a.msgContent;else return null;return{payload:{content:{messageText:{mentionedJid:[],text:d("MAWVault").unvault(b)}}}}}function r(a){var b={payload:{content:{messageText:{mentionedJid:a.msgContent.mentionedJids,text:d("MAWVault").unvault(a.msgContent.content)}}}};if(a.specialTextSize!=null){a=a.specialTextSize===1?d("WAConsumerApplication.pb").CONSUMER_APPLICATION_METADATA_SPECIAL_TEXT_SIZE.SMALL:a.specialTextSize===2?d("WAConsumerApplication.pb").CONSUMER_APPLICATION_METADATA_SPECIAL_TEXT_SIZE.MEDIUM:d("WAConsumerApplication.pb").CONSUMER_APPLICATION_METADATA_SPECIAL_TEXT_SIZE.LARGE;b.metadata={specialTextSize:a}}return b}function s(a,b){return t(a.msgId,b)}function t(a,b){a=c("validateMAWMediaAndComposeEntryForProtoMsg")(a,b);b=a[0];a=a[1];return v(b,a)}function u(a,b){var c;a={ancillary:{height:(c=a.validatedImageInfo)==null?void 0:c.height,scanLengths:((c=b.progressiveJpegDetails)==null?void 0:c.scanLengths)||[],scansSidecar:(c=b.progressiveJpegDetails)==null?void 0:c.sidecar,width:(c=a.validatedImageInfo)==null?void 0:c.width},integral:{transport:{ancillary:{fileLength:a.size,mimetype:j,objectId:b.objectId,thumbnail:{downloadableThumbnail:b.downloadableThumbnail,jpegThumbnail:void 0,thumbnailHeight:(c=a.validatedImageInfo)==null?void 0:c.jpegThumbnailHeight,thumbnailWidth:(c=a.validatedImageInfo)==null?void 0:c.jpegThumbnailWidth}},integral:{directPath:b.directPath,fileEncSha256:b.fileEncSha256,fileSha256:b.fileSha256,mediaKey:b.mediaKey,mediaKeyTimestamp:b.mediaKeyTimestamp}}}};return d("encodeProtobuf").encodeProtobuf(d("WAMediaTransport.pb").ImageTransportSpec,a).readBuffer()}function v(a,b){a=u(a,b);return{payload:{content:{imageMessage:{caption:{mentionedJid:[]},image:{payload:a,version:1}}}}}}function e(a){return{payload:{content:{editMessage:{key:{fromMe:!0,id:a.originalMsgExternalId,remoteJid:a.threadJid},message:{mentionedJid:a.msgContent.mentionedJids,text:d("MAWVault").unvault(a.msgContent.content)},timestampMs:a.editTs}}}}}function w(a,b){return x(a.msgId,b)}function x(a,b){a=c("validateMAWMediaAndComposeEntryForProtoMsg")(a,b);b=a[0];a=a[1];return y(b,a)}function y(a,b){var c;a={ancillary:{height:(c=a.validatedImageInfo)==null?void 0:c.height,width:(c=a.validatedImageInfo)==null?void 0:c.width},integral:{transport:{ancillary:{fileLength:a.size,mimetype:n,objectId:b.objectId,thumbnail:{thumbnailHeight:(c=a.validatedImageInfo)==null?void 0:c.jpegThumbnailHeight,thumbnailWidth:(c=a.validatedImageInfo)==null?void 0:c.jpegThumbnailWidth}},integral:{directPath:b.directPath,fileEncSha256:b.fileEncSha256,fileSha256:b.fileSha256,mediaKey:b.mediaKey,mediaKeyTimestamp:b.mediaKeyTimestamp}}}};c=d("encodeProtobuf").encodeProtobuf(d("WAMediaTransport.pb").StickerTransportSpec,a);return{payload:{content:{stickerMessage:{sticker:{payload:c.readBuffer(),version:1}}}}}}function z(a,b){return A(a.msgId,b)}function A(a,b){a=c("validateMAWMediaAndComposeEntryForProtoMsg")(a,b);b=a[0];a=a[1];return B(b,a)}function B(a,b){var c,e=a.mediaType===d("MAWDbMedia").MEDIA_TYPE.GIF,f=e?a.validatedImageInfo:a.validatedVideoInfo;c={ancillary:{gifPlayback:e,height:f==null?void 0:f.height,seconds:e?void 0:(c=a.validatedVideoInfo)==null?void 0:c.duration,sidecar:b.sidecar,width:f==null?void 0:f.width},integral:{transport:{ancillary:{fileLength:a.size,mimetype:e?m:k,objectId:b.objectId,thumbnail:e?{thumbnailHeight:f==null?void 0:f.jpegThumbnailHeight,thumbnailWidth:f==null?void 0:f.jpegThumbnailWidth}:{downloadableThumbnail:b.downloadableThumbnail,jpegThumbnail:void 0,thumbnailHeight:f==null?void 0:f.jpegThumbnailHeight,thumbnailWidth:f==null?void 0:f.jpegThumbnailWidth}},integral:{directPath:b.directPath,fileEncSha256:b.fileEncSha256,fileSha256:b.fileSha256,mediaKey:b.mediaKey,mediaKeyTimestamp:b.mediaKeyTimestamp}}}};a=d("encodeProtobuf").encodeProtobuf(d("WAMediaTransport.pb").VideoTransportSpec,c);return{payload:{content:{videoMessage:{caption:{mentionedJid:[]},video:{payload:a.readBuffer(),version:1}}}}}}function C(a,b){return D(a.msgId,b)}function D(a,b){a=c("validateMAWMediaAndComposeEntryForProtoMsg")(a,b);b=a[0];a=a[1];return E(b,a)}function E(a,b){var c;c={ancillary:{seconds:(c=a.validatedAudioInfo)==null?void 0:c.duration},integral:{transport:{ancillary:{fileLength:a.size,mimetype:l,objectId:b.objectId,thumbnail:{jpegThumbnail:p}},integral:{directPath:b.directPath,fileEncSha256:b.fileEncSha256,fileSha256:b.fileSha256,mediaKey:b.mediaKey,mediaKeyTimestamp:b.mediaKeyTimestamp}}}};a=d("encodeProtobuf").encodeProtobuf(d("WAMediaTransport.pb").AudioTransportSpec,c);return{payload:{content:{audioMessage:{audio:{payload:a.readBuffer(),version:1},ptt:!0}}}}}function F(a){return{payload:{applicationData:{revoke:{key:{fromMe:!0,id:a.revokedExternalId}}}}}}function f(a){var b=d("WAJids").isAuthorMe(a.reactToAuthor)||d("MAWGlobals").getMyUserJid()===a.reactToAuthor,c=d("WAJids").interpretAsGroupJid(a.threadJid)!=null;c={groupingKey:a.groupingKey==null?void 0:a.groupingKey,key:{fromMe:b,id:a.reactToExternalId,participant:c&&!b?a.reactToAuthor:void 0,remoteJid:a.threadJid},senderTimestampMs:a.ts*1e3,text:a.reaction==null?void 0:a.reaction};return{payload:{content:{reactionMessage:c}}}}function G(a,b){if(a.threadJid==null)throw c("err")("msg threadJid is null in encodeGroupInviteMessage");if(b==null)throw c("err")("DbGroupInvite is null in encodeGroupInviteMessage");var e=d("WAJids").interpretAsGroupJid(a.threadJid);if(e==null)throw c("err")("groupJid is null in encodeGroupInviteMessage");return{payload:{content:{groupInviteMessage:{groupJid:e,groupName:a.groupName,inviteCode:b.inviteCode,inviteExpiration:b.inviteExpirationTs}}}}}function H(a){return(h||(h=d("I64"))).equal(a.displayedContentTypes,(i||(i=d("LSIntEnum"))).ofNumber(1))||(h||(h=d("I64"))).equal(a.displayedContentTypes,(i||(i=d("LSIntEnum"))).ofNumber(256))||a.textHasLinks||a.isUnsent?I(a):null}function I(a){var b;b=(b=a.mentionIds)==null?void 0:(b=b.split(","))==null?void 0:b.map(d("MAWJids").toUserJid);return{payload:{content:{messageText:{mentionedJid:(b=b)!=null?b:[],text:a.text}}}}}g.IMAGE_MIME_TYPE=j;g.VIDEO_MIME_TYPE=k;g.AUDIO_MIME_TYPE=l;g.GIF_MIME_TYPE=m;g.STICKER_MIME_TYPE=n;g.FILE_MIME_TYPE=o;g.emptyAudioFileArrayBuffer=p;g.asConsumerApplication=a;g.deletedMsgAsConsumerApplicationForSpamReporting=b;g.encodeValidatedMediaToImageTransport=u;g.encodeEditMessage=e;g.encodeReactionMessage=f;g.asConsumerApplicationLSDb=H}),98);
__d("WAMsgApplication.pb",["WACommon.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){var h;a={DEFAULT:0,VANISH_MODE:1,DISAPPEARING_MESSAGES:2};b={};c={};e={};f={};var i={},j={},k={},l={},m={},n={};b.internalSpec={payload:[1,(h=d("WAProtoConst")).TYPES.MESSAGE,i],metadata:[2,h.TYPES.MESSAGE,c]};c.internalSpec={chatEphemeralSetting:[1,h.TYPES.MESSAGE,n],ephemeralSettingList:[2,h.TYPES.MESSAGE,f],ephemeralSharedSecret:[3,h.TYPES.BYTES],forwardingScore:[5,h.TYPES.UINT32],isForwarded:[6,h.TYPES.BOOL],businessMetadata:[7,h.TYPES.MESSAGE,(d=d("WACommon.pb")).SubProtocolSpec],frankingKey:[8,h.TYPES.BYTES],frankingVersion:[9,h.TYPES.INT32],quotedMessage:[10,h.TYPES.MESSAGE,e],threadType:[11,h.TYPES.ENUM,a],readonlyMetadataDataclass:[12,h.TYPES.STRING],groupId:[13,h.TYPES.STRING],groupSize:[14,h.TYPES.UINT32],groupIndex:[15,h.TYPES.UINT32],botResponseId:[16,h.TYPES.STRING],collapsibleId:[17,h.TYPES.STRING],__oneofs__:{ephemeral:["chatEphemeralSetting","ephemeralSettingList","ephemeralSharedSecret"]}};e.internalSpec={stanzaId:[1,h.TYPES.STRING],remoteJid:[2,h.TYPES.STRING],participant:[3,h.TYPES.STRING],payload:[4,h.TYPES.MESSAGE,i]};f.internalSpec={chatJid:[1,h.TYPES.STRING],ephemeralSetting:[2,h.TYPES.MESSAGE,n]};i.internalSpec={coreContent:[1,h.TYPES.MESSAGE,m],signal:[2,h.TYPES.MESSAGE,l],applicationData:[3,h.TYPES.MESSAGE,k],subProtocol:[4,h.TYPES.MESSAGE,j],__oneofs__:{content:["coreContent","signal","applicationData","subProtocol"]}};j.internalSpec={futureProof:[1,h.TYPES.ENUM,d.FUTURE_PROOF_BEHAVIOR],consumerMessage:[2,h.TYPES.MESSAGE,d.SubProtocolSpec],businessMessage:[3,h.TYPES.MESSAGE,d.SubProtocolSpec],paymentMessage:[4,h.TYPES.MESSAGE,d.SubProtocolSpec],multiDevice:[5,h.TYPES.MESSAGE,d.SubProtocolSpec],voip:[6,h.TYPES.MESSAGE,d.SubProtocolSpec],armadillo:[7,h.TYPES.MESSAGE,d.SubProtocolSpec],__oneofs__:{subProtocol:["consumerMessage","businessMessage","paymentMessage","multiDevice","voip","armadillo"]}};k.internalSpec={};l.internalSpec={};m.internalSpec={};n.internalSpec={ephemeralExpiration:[2,h.TYPES.UINT32],ephemeralSettingTimestamp:[3,h.TYPES.INT64],isEphemeralSettingReset:[4,h.TYPES.BOOL]};g.MESSAGE_APPLICATION_METADATA_THREAD_TYPE=a;g.MessageApplicationSpec=b;g.MessageApplication$MetadataSpec=c;g.MessageApplication$Metadata$QuotedMessageSpec=e;g.MessageApplication$Metadata$EphemeralSettingMapSpec=f;g.MessageApplication$PayloadSpec=i;g.MessageApplication$SubProtocolPayloadSpec=j;g.MessageApplication$ApplicationDataSpec=k;g.MessageApplication$SignalSpec=l;g.MessageApplication$ContentSpec=m;g.MessageApplication$EphemeralSettingSpec=n}),98);
__d("WAMapContentTypeToFbType",["WAAssertUnreachable"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(a){case"text":return"text";case"media":return"media";case"reaction":return"reaction";case"live_location":case"pay":case"product_list":case"poll_creation":case"poll_vote":case"scheduled_call":return"text";default:a;throw c("WAAssertUnreachable")(a)}}g.mapContentTypeToFbType=a}),98);
__d("WAProtocolQueue",["WAErr","WAGlobals","WAJids","WALogger","WAMapContentTypeToFbType","WAPersistedQueue"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Protocol Queue is already initialized"]);h=function(){return a};return a}var i=5e3,j=null;function a(a){if(j!=null){d("WALogger").WARN(h());return j}a=d("WAPersistedQueue").initPersistedQueue("stanzaQueue",a,{cacheSize:null,maxDelay:i});j=a;return j}function b(){if(!j)throw c("WAErr")("Protocol queue not initialized");return j}function e(a){return{flush:function(){return a.flush()}}}function f(a){return a.map(function(a){return a.type==="message"?k(a):babelHelpers["extends"]({},a)})}function k(a){switch(a.subtype){case"unavailable":var b=a,c=d("WAJids").extractUserJid(b.from);c={type:"UnavailableMsg",id:{chat:b.jid,author:d("WAGlobals").getMyUserJid()===c?"@me":c,externalId:b.stanzaId},ts:b.serverTs};return{stanzaId:b.stanzaId,jid:b.jid,type:b.type,message:{decrypted:c,details:{count:null,externalId:b.stanzaId,folder:b.fbFolderId,from:d("WAJids").switchOnMsgrChatJidType(b.jid,{group:function(a){return{type:"group",groupJid:a,chat:a,author:b.from}},user:function(a){return{type:"device",deviceJid:b.from,chat:a,author:b.from}}}),hideDecryptionFailure:!1,messageAlreadyPresented:!1,offline:b.offline,recipient:b.recipient,reportingMeta:b.reportingMeta,retryCount:b.retryCount,ts:b.serverTs,isInstamadillo:!1,type:d("WAMapContentTypeToFbType").mapContentTypeToFbType(b.contentType)}},consumerRetries:a.consumerRetries,failAcks:a.failAcks,stanzaQueueId:a.stanzaQueueId,priority:b.priority};case"armadillo":var e=a;c=d("WAJids").extractUserJid(e.from);c={device:{id:d("WAJids").extractDeviceId(e.from),identity:e.remoteIdentity},folder:e.fbFolderId,id:{chat:e.jid,author:d("WAGlobals").getMyUserJid()===c?"@me":c,externalId:e.stanzaId},msg:e.message,recipientsCount:null,reportingMeta:e.reportingMeta,ts:e.serverTs,type:"IncomingMsg"};return{stanzaId:e.stanzaId,jid:e.jid,type:e.type,message:{decrypted:c,details:{count:null,externalId:e.stanzaId,folder:e.fbFolderId,from:d("WAJids").switchOnMsgrChatJidType(e.jid,{group:function(a){return{type:"group",groupJid:a,chat:a,author:e.from}},user:function(a){return{type:"device",deviceJid:e.from,chat:a,author:e.from}}}),hideDecryptionFailure:!1,messageAlreadyPresented:!1,offline:e.offline,recipient:e.recipient,reportingMeta:e.reportingMeta,retryCount:e.retryCount,ts:e.serverTs,isInstamadillo:!1,type:d("WAMapContentTypeToFbType").mapContentTypeToFbType(e.contentType)}},consumerRetries:a.consumerRetries,failAcks:a.failAcks,stanzaQueueId:a.stanzaQueueId,priority:e.priority};case"instamadillo":var f=a;c=d("WAJids").extractUserJid(f.from);c={device:{id:d("WAJids").extractDeviceId(f.from),identity:f.remoteIdentity},folder:f.fbFolderId,id:{chat:f.jid,author:d("WAGlobals").getMyUserJid()===c?"@me":c,externalId:f.stanzaId},msg:f.message,recipientsCount:null,reportingMeta:f.reportingMeta,ts:f.serverTs,type:"InstamadilloMsg"};return{stanzaId:f.stanzaId,jid:f.jid,type:f.type,priority:f.priority,message:{decrypted:c,details:{count:null,externalId:f.stanzaId,folder:f.fbFolderId,from:d("WAJids").switchOnMsgrChatJidType(f.jid,{group:function(a){return{type:"group",groupJid:a,chat:a,author:f.from}},user:function(a){return{type:"device",deviceJid:f.from,chat:a,author:f.from}}}),hideDecryptionFailure:!1,messageAlreadyPresented:!1,offline:f.offline,recipient:f.recipient,reportingMeta:f.reportingMeta,retryCount:f.retryCount,ts:f.serverTs,isInstamadillo:!0,type:d("WAMapContentTypeToFbType").mapContentTypeToFbType(f.contentType)}},consumerRetries:a.consumerRetries,failAcks:a.failAcks,stanzaQueueId:a.stanzaQueueId};case"ciphertext":var g=a;c=d("WAJids").extractUserJid(g.from);c={createPlaceholder:g.contentType!=="reaction",id:{chat:g.jid,author:d("WAGlobals").getMyUserJid()===c?"@me":c,externalId:g.stanzaId},ts:g.serverTs,type:"IncomingCiphertextMsg"};return{priority:g.priority,stanzaId:g.stanzaId,jid:g.jid,type:g.type,message:{decrypted:c,details:{count:null,externalId:g.stanzaId,folder:g.fbFolderId,from:d("WAJids").switchOnMsgrChatJidType(g.jid,{group:function(a){return{type:"group",groupJid:a,chat:a,author:g.from}},user:function(a){return{type:"device",deviceJid:g.from,chat:a,author:g.from}}}),hideDecryptionFailure:!1,messageAlreadyPresented:!1,offline:g.offline,recipient:g.recipient,reportingMeta:g.reportingMeta,retryCount:g.retryCount,ts:g.serverTs,isInstamadillo:!1,type:d("WAMapContentTypeToFbType").mapContentTypeToFbType(g.contentType)}},consumerRetries:a.consumerRetries,failAcks:a.failAcks,stanzaQueueId:a.stanzaQueueId};default:a;return babelHelpers["extends"]({},a)}}var l=9,m=5;function n(a){return a}function o(a){return a}g.initProtocolQueue=a;g.protocolQueue=b;g.protocolQueueFlushable=e;g.mapProtocolEntriesV2toV1=f;g.mapProcolQueueMessageV2toV1=k;g.WAProtocolQueuePriorityHigh=l;g.WAProtocolQueuePriorityLow=m;g.appdataApplicationProtocol=n;g.extractSubProtocolFromAppdataProtocol=o}),98);
__d("WAMessageKey",["WAErr","WAGlobals","WAJids","WAStanzaUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return a===d("WAJids").AUTHOR_ME||a==d("WAGlobals").getMyUserJid()}function a(a,b,e){if(e==null)throw c("WAErr")("messageKey is null");var f=e.id,g=e.remoteJid;if(f==null)throw c("WAErr")("messageKey.id is null");else if(g==null)throw c("WAErr")("messageKey.remoteJid is null");g=d("WAJids").interpretAndValidateJid(g);if(g.jidType==="unknown")throw c("WAErr")("messageKey.remoteJid is invalid");var i,j=d("WAJids").AUTHOR_ME;if(g.jidType==="group"){i=g.groupJid;if(h(b)&&e.fromMe===!0)j=d("WAJids").AUTHOR_ME;else if(e.fromMe==!0)j=b;else{var k=e.participant;if(k==null)throw c("WAErr")("key.participant is null");k=d("WAJids").interpretAndValidateJid(k);if(k.jidType==="msgrUser")j=k.userJid;else throw c("WAErr")("key.participant is invalid")}}else if(g.jidType==="msgrUser"||g.jidType==="msgrDevice"){k=d("WAJids").interpretAndValidateJid(a);if(k.jidType!=="msgrUser")throw c("WAErr")("expected user type jid.");i=k.userJid;h(b)?e.fromMe===!0?j=d("WAJids").AUTHOR_ME:j=k.userJid:e.fromMe===!0&&(j=k.userJid)}else throw c("WAErr")("Unsupported jidtype type");return{chat:i,author:h(j)?d("WAJids").AUTHOR_ME:j,externalId:d("WAStanzaUtils").toStanzaId(f)}}g.extractProtocolMessageId=a}),98);
__d("WAParseConsumerMessagePollCreation",["WAGlobals","WAHex","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e){a={unstoredMsg:{type:d("WAMsgType").MSG_TYPE.FUTUREPROOF,msgContent:{protobuf:d("WAHex").bytesToBuffer(a),subtype:d("WAGlobals").getConfig().isUnsupportedMessagesRedesignEnabled()?"pollCreationMessage":null},id:b.id,ts:b.ts,sentTs:b.sentTs,serverTs:b.serverTs,ack:b.ack,reportingMeta:c},unstoredMedia:null,unstoredQuotedMedia:null};return!e||!d("WAGlobals").getConfig().isPollsFallbackExperienceEnabled()?a:a}g["default"]=a}),98);
__d("WAParseProtocolUtils",["WAGlobals","WALogger","WALongInt","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unsupported franking version ",""]);h=function(){return a};return a}function a(a,b){b=i(b,a.serverTs);a=b==null?void 0:b.expirationTs;var c=b==null?void 0:b.deleteTs;b=b==null?void 0:b.ephemeralSetting;return{expirationTs:a,deleteTs:c,ephemeralSetting:b}}function b(a,b){b=j(b);b!=null&&(a.reportingMeta=b);return b}function i(a,b){var c;c=a==null?void 0:(c=a.chatEphemeralSetting)==null?void 0:c.ephemeralExpiration;a=a==null?void 0:(a=a.chatEphemeralSetting)==null?void 0:a.ephemeralSettingTimestamp;if(c==null||a==null||c===0||!d("WAGlobals").getConfig().isEphemeralMessagesEnabled())return null;b=d("WATimeUtils").castToUnixTime(b+d("WAGlobals").getConfig().ephemeralMaxDeletionWindowForUnseenMessage());var e=b,f=null;try{a=d("WALongInt").numberOrThrowIfTooLarge(a)/1e3;f=d("WATimeUtils").castToUnixTime(a)}catch(a){return null}return{expirationTs:b,deleteTs:e,ephemeralSetting:{expirationTs:c,updatedTs:f}}}function j(a){a=a==null?void 0:a.frankingVersion;a!=null&&a!==0&&d("WALogger").ERROR(h(),a);return{frankingKey:void 0,frankingTag:void 0,frankingVersion:a,reportingContent:void 0,reportingTag:void 0}}g.parseEphemerality=a;g.enhanceReportingMeta=b}),98);
__d("WAParseConsumerMessageProtocol",["WACommon.pb","WAConsumerApplication.pb","WAErr","WAGlobals","WAHex","WAJids","WALogger","WAMediaTransport.pb","WAMessageKey","WAMsgType","WAParseConsumerMessagePollCreation","WAParseMediaTransportProtocol","WAParseProtocolUtils","WAResultOrError","WAStanzaUtils","decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseConsumerMessageProtocol error :",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAParseConsumerMessageProtocol - ephemeralSetting duration is invalid ",", jidType: ",""]);i=function(){return a};return a}b=1;e=0;f=1;f=d("WAGlobals").getConfig().armadilloWebProcessFutureproof()?f+1:f;function a(a,b,e,f,g){var j;b=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAConsumerApplication.pb").ConsumerApplicationSpec,b);j=(j=b.payload)==null?void 0:(j=j.applicationData)==null?void 0:(j=j.revoke)==null?void 0:(j=j.key)==null?void 0:j.id;if(j!=null)return{unstoredMsg:{type:d("WAMsgType").MSG_TYPE.REVOKED,id:e.id,ts:e.ts,sentTs:e.sentTs,serverTs:e.serverTs,ack:e.ack,reportingMeta:e.reportingMeta,revokedExternalId:d("WAStanzaUtils").toStanzaId(j),unsendMsgContentDeleteTs:null,msgContent:null},unstoredMedia:null,unstoredQuotedMedia:null};var k=(g==null?void 0:g.isForwarded)||!1;j=d("WAParseProtocolUtils").parseEphemerality(e,g);var l=j.expirationTs,u=j.deleteTs,v=j.ephemeralSetting;if(v!=null&&(v.expirationTs<0||v.expirationTs>86400)){j=d("WAJids").interpretAndValidateJid(a);j=j.jidType;var w=v.expirationTs;v.expirationTs===4294967295&&(v.expirationTs=0);d("WALogger").ERROR(i(),w,j)}var x=d("WAParseProtocolUtils").enhanceReportingMeta(e,g),y=(w=n(g))!=null?w:void 0,z=(j=b.payload)==null?void 0:j.content;if(!z)return{unstoredMsg:null,unstoredMedia:null,unstoredQuotedMedia:null};var A=(g=b.metadata)==null?void 0:g.specialTextSize,B=s(z),C={contentTypeForLogging:B,unstoredMsg:{type:d("WAMsgType").MSG_TYPE.FUTUREPROOF,msgContent:{protobuf:d("WAHex").bytesToBuffer(f),subtype:null},id:e.id,ts:e.ts,sentTs:e.sentTs,serverTs:e.serverTs,ack:e.ack,reportingMeta:x},unstoredMedia:null,unstoredQuotedMedia:null};w=function(){try{switch(B){case"messageText":var b,g=z[B];if(g==null)throw c("WAErr")("consumerMessage has no messageText");b=((b=g.commands)==null?void 0:b.some(function(a){return a.commandType===d("WACommon.pb").COMMAND_COMMAND_TYPE.AI}))===!0;if(b)return C;if(g.text==null)throw c("WAErr")("consumerMessage has no messageText");return{unstoredMsg:babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.TEXT,msgContent:{content:g.text,mentionedJids:g.mentionedJid.map(d("WAJids").validateUserJid).filter(Boolean)},quote:y,expirationTs:l,deleteTs:u,ephemeralSetting:v,isForwarded:k},e,{specialTextSize:A}),unstoredMedia:null,unstoredQuotedMedia:null};case"reactionMessage":return{unstoredMsg:m(a,e,z[B]),unstoredMedia:null,unstoredQuotedMedia:null};case"imageMessage":b=o(z,e.ts);return{unstoredMsg:babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.IMAGE,quote:y,expirationTs:l,deleteTs:u,ephemeralSetting:v,isForwarded:k,mediaId:b.plaintextHash},e),unstoredMedia:b,unstoredQuotedMedia:null};case"videoMessage":var i;g=z[B];if(g==null)throw c("WAErr")("consumerMessage has no videoMessage");g=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMediaTransport.pb").VideoTransportSpec,g==null?void 0:(b=g.video)==null?void 0:b.payload);b=g==null?void 0:(b=g.integral)==null?void 0:(b=b.transport)==null?void 0:(b=b.ancillary)==null?void 0:b.mimetype;i=(g==null?void 0:(i=g.ancillary)==null?void 0:i.gifPlayback)===!0&&b==="image/gif";if(i&&!d("WAGlobals").getConfig().isGifEnabled())return C;b=d("WAParseMediaTransportProtocol").parseVideoMsg(g,e.ts,i);if(b==null)throw c("WAErr")("consumerMessage has no video media info");return{unstoredMsg:i?babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.GIF},e,{quote:y,expirationTs:l,deleteTs:u,ephemeralSetting:v,isForwarded:k,reportingMeta:x,mediaId:b.plaintextHash}):babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.VIDEO},e,{quote:y,expirationTs:l,deleteTs:u,ephemeralSetting:v,isForwarded:k,mediaId:b.plaintextHash}),unstoredMedia:b,unstoredQuotedMedia:null};case"audioMessage":g=p(z,e.ts);return{unstoredMsg:babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.PTT,quote:y,expirationTs:l,deleteTs:u,ephemeralSetting:v,isForwarded:k,mediaId:g.plaintextHash},e),unstoredMedia:g,unstoredQuotedMedia:null};case"stickerMessage":if(d("WAGlobals").getConfig().isStickerEnabled()){i=q(z,e.ts);return{unstoredMsg:babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.STICKER,quote:y,expirationTs:l,deleteTs:u,ephemeralSetting:v,isForwarded:k,reportingMeta:x,mediaId:i.plaintextHash},e),unstoredMedia:i,unstoredQuotedMedia:null}}return C;case"documentMessage":if(d("WAGlobals").getConfig().isDocumentReceiveEnabled()){b=r(z,e.ts);return{unstoredMsg:babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.DOCUMENT_FILE,quote:y,expirationTs:l,deleteTs:u,ephemeralSetting:v,isForwarded:k,reportingMeta:x,mediaId:b.plaintextHash},e),unstoredMedia:b,unstoredQuotedMedia:null}}return C;case"groupInviteMessage":return{unstoredMsg:null,unstoredMedia:null,unstoredQuotedMedia:null,unstoredIncomingGroupInvite:t(e,z)};case"editMessage":var j;g=z[B];i=g==null?void 0:g.message;b=i==null?void 0:i.text;j=g==null?void 0:(j=g.key)==null?void 0:j.id;if(g==null||i==null||b==null)throw c("WAErr")("consumerMessage with editMessage type has no editMessage");if(j==null)throw c("WAErr")("consumerMessage with editMessage type has no original Msg External Id.");g=d("WAStanzaUtils").toStanzaId(j);return{unstoredEditMsg:{type:d("WAMsgType").MSG_TYPE.EDIT_ACTION,editMsgContent:{content:b,mentionedJids:i.mentionedJid.map(d("WAJids").validateUserJid).filter(Boolean)},originalMsgExternalId:g,id:e.id,ts:e.ts,sentTs:e.sentTs,serverTs:e.serverTs,ack:e.ack,reportingMeta:x,specialTextSize:A},unstoredMsg:null,unstoredMedia:null,unstoredQuotedMedia:null};case"pollCreationMessage":return c("WAParseConsumerMessagePollCreation")(f,e,x,z[B]);case"contactMessage":case"locationMessage":case"extendedTextMessage":case"statusTextMessage":case"contactsArrayMessage":case"liveLocationMessage":case"viewOnceMessage":default:return C}}catch(a){d("WALogger").ERROR(h(),a);return{unstoredMsg:null,unstoredMedia:null,unstoredQuotedMedia:null}}}();return babelHelpers["extends"]({},w,{contentTypeForLogging:B})}function j(a){if(d("WAJids").isAuthorSystem(a))throw c("WAErr")("Got system author");return a}var k=30;function l(a){if(a==null)return d("WAResultOrError").makeResult(null);return a.length>k?d("WAResultOrError").makeError("invalid-reaction-text-length"):d("WAResultOrError").makeResult(a)}function m(a,b,e){if(e==null)throw c("WAErr")("consumerMessage has no reactionMessage");var f=j(b.id.author);a=d("WAMessageKey").extractProtocolMessageId(a,f,e.key);f=e.text;e=e.groupingKey;var g=l(f);if(!g.success){throw c("WAErr")('"'+((f=f)!=null?f:"")+'" is not a valid reaction ['+g.error+"]")}return{type:d("WAMsgType").MSG_TYPE.REACTION,ack:b.ack,id:b.id,reactToExternalId:a.externalId,reactToAuthor:a.author,reaction:g.value,groupingKey:e,ts:b.ts}}function n(a){var b,e;b=a==null?void 0:(b=a.quotedMessage)==null?void 0:b.stanzaId;e=a==null?void 0:(e=a.quotedMessage)==null?void 0:e.participant;a=a==null?void 0:(a=a.quotedMessage)==null?void 0:a.remoteJid;e=e!=null?d("WAJids").interpretAndValidateJid(e):null;var f;(e==null?void 0:e.jidType)==="msgrUser"&&e.userJid===d("WAGlobals").getMyUserJid()?f=d("WAJids").AUTHOR_ME:(e==null?void 0:e.jidType)==="msgrUser"?f=e.userJid:f=d("WAJids").AUTHOR_ME;if(b==null)return null;e={type:d("WAMsgType").MSG_TYPE.UNAVAILABLE,author:f,externalId:d("WAStanzaUtils").toStanzaId(b),ts:null};if(a!=null){f=d("WAJids").interpretAndValidateJid(a);if(f.jidType==="group")return{remoteJid:f.groupJid,content:e};else throw c("WAErr")("not supported")}else return{remoteJid:null,content:e}}function o(a,b){a=a.imageMessage;if(a==null)throw c("WAErr")("consumerMessage has no imageMessage");return d("WAParseMediaTransportProtocol").decodeImageTransport(a==null?void 0:(a=a.image)==null?void 0:a.payload,b)}function p(a,b){var e;a=a.audioMessage;if(a==null)throw c("WAErr")("consumerMessage has no audioMessage");e=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMediaTransport.pb").AudioTransportSpec,a==null?void 0:(e=a.audio)==null?void 0:e.payload);e=d("WAParseMediaTransportProtocol").parseAudioMsg(e,(a==null?void 0:a.ptt)||!1,b);if(e==null)throw c("WAErr")("consumerMessage has no audio media info");return e}function q(a,b){a=a.stickerMessage;if(a==null)throw c("WAErr")("consumerMessage has no stickerMessage");a=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMediaTransport.pb").StickerTransportSpec,a==null?void 0:(a=a.sticker)==null?void 0:a.payload);a=d("WAParseMediaTransportProtocol").parseStickerMsg(a,b);if(a==null)throw c("WAErr")("consumerMessage has no sticker media info");return a}function r(a,b){var e;a=a.documentMessage;if(a==null)throw c("WAErr")("consumerMessage has no documentMessage");e=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMediaTransport.pb").DocumentTransportSpec,a==null?void 0:(e=a.document)==null?void 0:e.payload);a=a==null?void 0:a.fileName;e=d("WAParseMediaTransportProtocol").parseDocumentMsg(e,a,b);if(e==null)throw c("WAErr")("consumerMessage has no document media info");return e}function s(a){var b=Object.keys(a).filter(function(a){return a!=="$$unknownFieldCount"});if(b.length!==1)throw c("WAErr")(JSON.stringify(a)+" consumerMessage payload content should have exactly one field, instead found "+JSON.stringify(b));return b[0]}function t(a,b){b=b.groupInviteMessage;if(b==null)throw c("WAErr")("consumerMessage has no GroupInvite Data");return babelHelpers["extends"]({ack:a.ack,author:a.id.author,externalId:a.id.externalId,ts:a.ts},b)}g.MINIMAL_MEDIA_DURATION=b;g.DEFAULT_FILE_SIZE=e;g.SUPPORTED_TYPES_VERSION=f;g.parseConsumerMessageProtocol=a;g.interpretAsNonSystemAuthor=j;g.validReactionMessageText=l;g.parseReactionMessage=m;g.parseOneOfContentType=s}),98);
__d("WAMedia",[],(function(a,b,c,d,e,f){"use strict";a="Image";b="Video";c="Ptt";d="Gif";e="Sticker";var g="DocumentFile",h={IMAGE:a,VIDEO:b,PTT:c,GIF:d,STICKER:e,DOCUMENT_FILE:g};f.IMAGE=a;f.VIDEO=b;f.PTT=c;f.GIF=d;f.STICKER=e;f.DOCUMENT_FILE=g;f.MEDIA_TYPE=h}),66);
__d("WAParseMediaTransportProtocol",["WAErr","WALogger","WALongInt","WAMedia","WAMediaTransport.pb","WAMediaUtils","WAMsgMap","WAParseConsumerMessageProtocol","WAProgressiveJpegGetScanLengths","WATimeUtils","decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["cannot compose mediaEntry with the media message"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["protobuf msg with too large size ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["protobuf msg with bad size ",", use default size instead"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["protobuf msg with no plaintext hash"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["There is unknown fileds in integral of VideoTransport"]);l=function(){return a};return a}function m(a,b,c){var e,f,g,m;if(!((e=a.integral)==null?void 0:e.transport))return null;e=(e=a.integral)==null?void 0:e.transport;if(d("decodeProtobuf").getUnknownFields(e.integral)!=null){d("WALogger").ERROR(l());return null}f=(f=e.integral)==null?void 0:f.fileSha256;if(!f){d("WALogger").ERROR(k());return null}g=(g=e.ancillary)==null?void 0:g.fileLength;g==null&&(d("WALogger").WARN(j(),g),g=d("WAParseConsumerMessageProtocol").DEFAULT_FILE_SIZE);try{g=d("WALongInt").numberOrThrowIfTooLarge(g)}catch(a){d("WALogger").ERROR(i(),g);return null}var n=null;if(((m=a.ancillary)==null?void 0:m.scansSidecar)!=null&&((m=a.ancillary)==null?void 0:m.scanLengths)!=null){n={sidecar:(m=a.ancillary)==null?void 0:m.scansSidecar,scanLengths:(m=a.ancillary)==null?void 0:(a=m.scanLengths)==null?void 0:a.map(d("WAProgressiveJpegGetScanLengths").asProgressiveJpegScanLength)}}if(((m=e.integral)==null?void 0:m.fileSha256)==null||((a=e.integral)==null?void 0:a.fileEncSha256)==null||((m=e.integral)==null?void 0:m.mediaKey)==null||((a=e.integral)==null?void 0:a.directPath)==null||((m=e.integral)==null?void 0:m.mediaKeyTimestamp)==null||((a=e.ancillary)==null?void 0:a.objectId)==null){d("WALogger").ERROR(h());return null}a=(m=e.ancillary.thumbnail)==null?void 0:m.downloadableThumbnail;b=d("WAMediaUtils").rawDataToMediaEntry(e.integral.fileSha256,e.integral.fileEncSha256,e.integral.mediaKey,e.integral.directPath,d("WATimeUtils").castLongIntToUnixTime(e.integral.mediaKeyTimestamp),b,(m=e.ancillary)==null?void 0:m.objectId,void 0,{directPath:a==null?void 0:a.directPath,fileEncSha256:a==null?void 0:a.fileEncSha256,fileSha256:a==null?void 0:a.fileSha256,mediaKey:a==null?void 0:a.mediaKey,mediaKeyTimestamp:(a==null?void 0:a.mediaKeyTimestamp)==null?null:d("WATimeUtils").castLongIntToUnixTime(a==null?void 0:a.mediaKeyTimestamp),objectId:a==null?void 0:a.objectId},c,n);return{size:g,plaintextHash:d("WAMediaUtils").toPlaintextHash(new Uint8Array(f)),mediaEntry:b}}function n(a,b){var c,e=m(a,"image");if(!e)return null;e=p(e,b);b=(b=a.ancillary)==null?void 0:b.width;c=(c=a.ancillary)==null?void 0:c.height;a.ancillary!=null&&(a.ancillary.width!=null&&a.ancillary.width===4294967295&&(b=void 0),a.ancillary.height!=null&&a.ancillary.height===4294967295&&(c=void 0));c=babelHelpers["extends"]({},e,{mediaType:d("WAMedia").MEDIA_TYPE.IMAGE,validatedVideoInfo:null,validatedImageInfo:{width:b,height:c,jpegThumbnail:(e=a.integral)==null?void 0:(b=e.transport)==null?void 0:(c=b.ancillary)==null?void 0:(e=c.thumbnail)==null?void 0:e.jpegThumbnail,jpegThumbnailHeight:(b=a.integral)==null?void 0:(c=b.transport)==null?void 0:(e=c.ancillary)==null?void 0:(b=e.thumbnail)==null?void 0:b.thumbnailHeight,jpegThumbnailWidth:(c=a.integral)==null?void 0:(e=c.transport)==null?void 0:(b=e.ancillary)==null?void 0:(a=b.thumbnail)==null?void 0:a.thumbnailWidth},validatedAudioInfo:null,validatedDocumentFileInfo:null});return c}function a(a,b){a=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMediaTransport.pb").ImageTransportSpec,a);a=n(a,b);if(a==null)throw c("WAErr")("consumerMessage has no image media info");return a}function b(a,b,c){var e;if(!((e=a.integral)==null?void 0:e.transport))return null;e=m(a,c?"gif":"video");if(!e)return null;e=p(e,b);e=babelHelpers["extends"]({},e,{mediaType:c?d("WAMedia").MEDIA_TYPE.GIF:d("WAMedia").MEDIA_TYPE.VIDEO,validatedVideoInfo:c?null:{duration:(a==null?void 0:(b=a.ancillary)==null?void 0:b.seconds)!=null&&(a==null?void 0:(e=a.ancillary)==null?void 0:e.seconds)>d("WAParseConsumerMessageProtocol").MINIMAL_MEDIA_DURATION?a==null?void 0:(b=a.ancillary)==null?void 0:b.seconds:d("WAParseConsumerMessageProtocol").MINIMAL_MEDIA_DURATION,width:a==null?void 0:(e=a.ancillary)==null?void 0:e.width,height:a==null?void 0:(b=a.ancillary)==null?void 0:b.height,mimetype:a==null?void 0:(e=a.integral)==null?void 0:(b=e.transport)==null?void 0:(e=b.ancillary)==null?void 0:e.mimetype,jpegThumbnail:(b=a.integral)==null?void 0:(e=b.transport)==null?void 0:(b=e.ancillary)==null?void 0:(e=b.thumbnail)==null?void 0:e.jpegThumbnail,jpegThumbnailHeight:(b=a.integral)==null?void 0:(e=b.transport)==null?void 0:(b=e.ancillary)==null?void 0:(e=b.thumbnail)==null?void 0:e.thumbnailHeight,jpegThumbnailWidth:(b=a.integral)==null?void 0:(e=b.transport)==null?void 0:(b=e.ancillary)==null?void 0:(e=b.thumbnail)==null?void 0:e.thumbnailWidth},validatedImageInfo:c?{width:(b=a.ancillary)==null?void 0:b.width,height:(e=a.ancillary)==null?void 0:e.height,jpegThumbnail:(c=a.integral)==null?void 0:(b=c.transport)==null?void 0:(e=b.ancillary)==null?void 0:(c=e.thumbnail)==null?void 0:c.jpegThumbnail,jpegThumbnailHeight:(b=a.integral)==null?void 0:(e=b.transport)==null?void 0:(c=e.ancillary)==null?void 0:(b=c.thumbnail)==null?void 0:b.thumbnailHeight,jpegThumbnailWidth:(e=a.integral)==null?void 0:(c=e.transport)==null?void 0:(b=c.ancillary)==null?void 0:(a=b.thumbnail)==null?void 0:a.thumbnailWidth}:null,validatedAudioInfo:null,validatedDocumentFileInfo:null});return e}function e(a,b,c){if(!((b=a.integral)==null?void 0:b.transport))return null;b=m(a,"ptt");if(!b)return null;b=p(b,c);b=babelHelpers["extends"]({},b,{mediaType:d("WAMedia").MEDIA_TYPE.PTT,validatedVideoInfo:null,validatedImageInfo:null,validatedDocumentFileInfo:null,validatedAudioInfo:{duration:(a==null?void 0:(c=a.ancillary)==null?void 0:c.seconds)!=null&&(a==null?void 0:(b=a.ancillary)==null?void 0:b.seconds)>d("WAParseConsumerMessageProtocol").MINIMAL_MEDIA_DURATION?a==null?void 0:(c=a.ancillary)==null?void 0:c.seconds:d("WAParseConsumerMessageProtocol").MINIMAL_MEDIA_DURATION,mimetype:a==null?void 0:(b=a.integral)==null?void 0:(c=b.transport)==null?void 0:(a=c.ancillary)==null?void 0:a.mimetype,played:!1}});return b}function f(a,b){var c;if(!((c=a.integral)==null?void 0:c.transport))return null;c=m(a,"sticker");if(!c)return null;c=p(c,b);c=babelHelpers["extends"]({},c,{mediaType:d("WAMedia").MEDIA_TYPE.STICKER,validatedVideoInfo:null,validatedImageInfo:{width:(b=a.ancillary)==null?void 0:b.width,height:(c=a.ancillary)==null?void 0:c.height,jpegThumbnail:(b=a.integral)==null?void 0:(c=b.transport)==null?void 0:(b=c.ancillary)==null?void 0:(c=b.thumbnail)==null?void 0:c.jpegThumbnail,jpegThumbnailHeight:(b=a.integral)==null?void 0:(c=b.transport)==null?void 0:(b=c.ancillary)==null?void 0:(c=b.thumbnail)==null?void 0:c.thumbnailHeight,jpegThumbnailWidth:(b=a.integral)==null?void 0:(c=b.transport)==null?void 0:(a=c.ancillary)==null?void 0:(b=a.thumbnail)==null?void 0:b.thumbnailWidth},validatedAudioInfo:null,validatedDocumentFileInfo:null});return c}function o(a,b,c){var e;if(!((e=a.integral)==null?void 0:e.transport))return null;e=m(a,"document",b);if(!e)return null;e=p(e,c);return babelHelpers["extends"]({},e,{mediaType:d("WAMedia").MEDIA_TYPE.DOCUMENT_FILE,validatedVideoInfo:null,validatedImageInfo:null,validatedAudioInfo:null,validatedDocumentFileInfo:{mimetype:a==null?void 0:(c=a.integral)==null?void 0:(e=c.transport)==null?void 0:(a=e.ancillary)==null?void 0:a.mimetype,filename:(c=b)!=null?c:void 0}})}function p(a,b){return{mediaEntry:a.mediaEntry,plaintextHash:a.plaintextHash,size:a.size,msgIds:[],mediaEntries:new(d("WAMsgMap").MsgMap)(),ts:b}}g.getMediaMeta=m;g.parseImageMsg=n;g.decodeImageTransport=a;g.parseVideoMsg=b;g.parseAudioMsg=e;g.parseStickerMsg=f;g.parseDocumentMsg=o}),98);
__d("MessageBackupSupplementalKeyGenerator",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";var g=b("$InternalEnum")({REACTION:"reaction",EDIT:"edit"}),h=":";function a(a,b){return""+g.getName(a)+h+b}function c(a){return a.split(h)[1]}function i(a,b){b=b.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");b=new RegExp("^"+b,"i");return b.test(a)}function d(a){return i(a,"reaction")}function e(a){return i(a,"edit")}f.SupplementalKeyPrefix=g;f.SUPPLEMENTAL_KEY_DELIMITER=h;f.createMessageSupplementalKey=a;f.getSupplementalSenderId=c;f.isSupplementalProtobufAReaction=d;f.isSupplementalProtobufAnEdit=e}),66);
__d("WAMsgIdToMessageKey",["WAGlobals","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.author,c=a.externalId;a=a.chat;var e=d("WAJids").isAuthorMe(b),f=d("WAJids").interpretAsGroupJid(a);b=e?d("WAGlobals").getMyUserJid():b;a=a;f=f!=null?b:void 0;return{fromMe:e,id:c,remoteJid:a,participant:f}}g.msgIdToMessageKey=a}),98);
__d("WAAsConsumerApplication",["WAAssertUnreachable","WAConsumerApplication.pb","WAErr","WAMsgIdToMessageKey","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";b="image/jpeg";e="video/mp4";f="audio/wav";var h="image/gif",i="image/webp";function a(a){switch(a.type){case d("WAMsgType").MSG_TYPE.TEXT:return j(a);case d("WAMsgType").MSG_TYPE.REACTION:return k(a);case d("WAMsgType").MSG_TYPE.REVOKED:return l(a);default:return c("WAAssertUnreachable")(a.type)}}function j(a){var b={payload:{content:{messageText:{mentionedJid:[],text:a.msgContent.content}}}};if(a.specialTextSize!=null){a=a.specialTextSize===1?d("WAConsumerApplication.pb").CONSUMER_APPLICATION_METADATA_SPECIAL_TEXT_SIZE.SMALL:a.specialTextSize===2?d("WAConsumerApplication.pb").CONSUMER_APPLICATION_METADATA_SPECIAL_TEXT_SIZE.MEDIUM:d("WAConsumerApplication.pb").CONSUMER_APPLICATION_METADATA_SPECIAL_TEXT_SIZE.LARGE;b.metadata={specialTextSize:a}}return b}function k(a){if(a.reactToMsgId==null)throw c("WAErr")("cannot send reaction that reacts to no message");var b=d("WAMsgIdToMessageKey").msgIdToMessageKey(a.reactToMsgId);b={groupingKey:a.groupingKey==null?void 0:a.groupingKey,key:b,senderTimestampMs:a.ts,text:a.reaction==null?void 0:a.reaction};return{payload:{content:{reactionMessage:b}}}}function l(a){a={remoteJid:a.id.chat,fromMe:!0,id:a.revokedExternalId};return{payload:{applicationData:{revoke:{key:a}}}}}g.IMAGE_MIME_TYPE=b;g.VIDEO_MIME_TYPE=e;g.AUDIO_MIME_TYPE=f;g.GIF_MIME_TYPE=h;g.STICKER_MIME_TYPE=i;g.asConsumerApplication=a;g.encodeTextMessage=j;g.encodeReactionMessage=k}),98);
__d("WACryptoPrimitives",["tweetnacl"],(function(a,b,c,d,e,f,g){"use strict";b={scalarbase:(a=d("tweetnacl")).lowlevel.scalarbase,crypto_hash:a.lowlevel.crypto_hash,modL:a.lowlevel.modL,pack25519:a.lowlevel.pack25519,S:a.lowlevel.S,M:a.lowlevel.M,A:a.lowlevel.A,Z:a.lowlevel.Z,D:a.lowlevel.D,unpack25519:a.lowlevel.unpack25519,pow2523:a.lowlevel.pow2523,crypto_verify_32:a.lowlevel.crypto_verify_32,set25519:a.lowlevel.set25519,add:a.lowlevel.add,scalarmult:a.lowlevel.scalarmult};g.hash=a.hash;g.scalarMult=a.scalarMult;g.verify=a.verify;g.lowlevel=b;g.keypairFromSecretKey=a.box.keyPair.fromSecretKey;g.keyPair=a.box.keyPair;g.signDetachedVerify=a.sign.detached.verify}),98);
__d("WACryptoUtils",["WACryptoDependencies","WACryptoPrimitives","WAErr"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return h(new Uint8Array(a),new Uint8Array(b))}function h(a,b){return a.length===0&&b.length===0||d("WACryptoPrimitives").verify(a,b)}function b(a,b){return a.length===0&&b.length===0||d("WACryptoPrimitives").verify(a,b)}function e(a,b){return a.length===0&&b.length===0||d("WACryptoPrimitives").verify(a,b)}function f(a){if(a!==(a|0))throw c("WAErr")("bound must be int32");if(a<=0)throw c("WAErr")("bound must not be positive");var b=new Int32Array(1),e=-1>>>1;e=a*Math.floor(e/a);var f=-1;while(f===-1){d("WACryptoDependencies").getCrypto().getRandomValues(b);var g=b[0]>>>1;g<e&&(f=g%a)}return f}g.arrayBuffersEqual=a;g.uint8ArraysEqual=h;g.rawKeysEqual=b;g.serializedPubKeysEqual=e;g.randomNumberLessThan=f}),98);
__d("WAFrankingTypes",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}function b(a){return a}f.castToFrankingTag=a;f.castToFrankingKey=b}),66);
__d("WAPREList",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({DECRYPT_MESSAGE_FINAL:"decrypt_message_final",FRANKING_VALIDATION:"franking_validation",GET_DEVICES:"get_devices",MEDIA_DOWNLOAD:"media_download",MEDIA_UPLOAD:"media_upload",DELETE_THREAD:"delete_thread",DOWNLOAD_AND_DECRYPT:"download_and_decrypt",MESSAGE_DECRYPTION:"message_decryption",MESSAGE_ENCRYPTION:"message_encryption",OFFLINE_QUEUE:"offline_queue",OFFLINE_RETRY:"offline_retry",ICDC_ERROR:"icdc_error",QUERY_GROUP:"query_group",QUERY_GROUPS:"query_groups",RETRY_RECEIPTS_SENT:"retry_receipts_sent",SYNCD_FATAL_ERROR:"syncd_fatal_error",SYNCD_CRITICAL_EVENT:"syncd_critical_event",SYNCD_CRITICAL_BOOTSTRAP_STAGE:"syncd_critical_bootstrap_stage",SYNCD_BOOTSTRAP_APP_STATE_DOWNLOAD:"syncd_bootstrap_app_state_download",SYNCD_DECRYPT_MUTATIONS:"syncd_decrypt_mutations",SYNCD_BOOTSTRAP_DATA_APPLIED:"syncd_bootstrap_data_applied",APP_STATE_SYNC_DAILY:"app_state_sync_daily",SYNCD:"syncd",SEND_MESSAGE:"send_message",RECEIVE_MESSAGE:"receive_message",SYNCD_KEY_ROTATION:"syncd_key_rotation",REMOVE_PARTICIPANTS:"remove_participants",CREATE_GROUP:"create_group",WA_JOBS_ORCHESTRATOR:"wa_jobs_orchestrator",WA_DISCONNECT:"wa_disconnect",WA_JOB_MANAGER:"wa_job_manager",STANZA_QUEUE_MESSAGE_CONSUMER:"stanza_queue_message_consumer",WA_FAIL_STANZA_QUEUE_ITEM:"stanza_queue_item_failure",ONE_QUEUE:"one_queue",PROTOCOL_QUEUE_CONSUMER:"protocol_queue_consumer",WA_NO_SIGNED_PRE_KEY:"wa_no_signed_pre_key"});f.PRE_METRIC=a}),66);
__d("WAPREMetrics",["WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[PRE] "," ends with an error ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[PRE] "," ends successfully"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[PRE] add point "," to ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[PRE] resume ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[PRE] start ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[PRE] There are no subscribers to PRE events"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Removing all listeners from PRE_METRICS"]);n=function(){return a};return a}var o=0;function a(){var b=[];function c(a){b.push(a)}function e(){d("WALogger").WARN(n()),b.length=0}function a(a){b.length===0&&d("WALogger").WARN(m()),b.forEach(function(b){b(a)})}return{subscribe:c,notify:a,clear:e}}c=a();var p=c.notify;e=c.clear;f=c.subscribe;function b(a,b,c){var e;c==null&&o++;var f=(e=c)!=null?e:o,g="open";c==null?(p({name:a,stage:"START",instanceKey:f,annotations:b}),d("WALogger").DEV(l(),a)):(p({name:a,stage:"RESUME",instanceKey:f,annotations:b}),d("WALogger").DEV(k(),a));return{addPoint:function(c,b){p({name:a,stage:"POINT",reason:c,instanceKey:f,annotations:b}),d("WALogger").DEV(j(),c,a)},addAnnotations:function(b){p({name:a,stage:"ANNOTATE",instanceKey:f,annotations:b})},endSuccess:function(b){p({name:a,stage:"SUCCESS",instanceKey:f,annotations:b}),g="closed",d("WALogger").DEV(i(),a)},endFail:function(c,b){p({name:a,stage:"FAIL",reason:c,instanceKey:f,annotations:b}),g="closed",d("WALogger").DEV(h(),a,c)},getFlowDetails:function(){return{name:a,instanceKey:f}},isActive:function(){return g==="open"}}}g.clear=e;g.subscribe=f;g.startMetric=b}),98);
__d("WAFranking",["$InternalEnum","WACryptoDependencies","WACryptoHmac","WACryptoUtils","WAFrankingTypes","WAGlobals","WAPREList","WAPREMetrics","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h=32,i=0,j=b("$InternalEnum").Mirrored(["KEEP","DROP"]);function a(){var a=new Uint8Array(h);d("WACryptoDependencies").getCrypto().getRandomValues(a);return d("WAFrankingTypes").castToFrankingKey(a)}function c(a){return(a=a)!=null?a:i}function e(a,b){return d("WACryptoHmac").hmacSha256(a,b).then(function(a){return d("WAFrankingTypes").castToFrankingTag(new Uint8Array(a))})}function k(a,c,e,f){var g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:h.t0=f;h.next=h.t0===void 0?3:h.t0===0?3:7;break;case 3:h.next=5;return b("regeneratorRuntime").awrap(d("WACryptoHmac").hmacSha256(c,a));case 5:g=h.sent;return h.abrupt("return",d("WACryptoUtils").uint8ArraysEqual(new Uint8Array(g),e));case 7:return h.abrupt("return",!0);case 8:case"end":return h.stop()}},null,this)}function f(a,c){var e,f,g,h,i,l,m,n;return b("regeneratorRuntime").async(function(o){while(1)switch(o.prev=o.next){case 0:if(!(!d("WAGlobals").getConfig().isFrankingEnabled()||a.version==="v3"&&a.type==="instamadillo")){o.next=2;break}return o.abrupt("return",{decision:j.KEEP,updatedReportingMeta:c});case 2:g=d("WAGlobals").getConfig().isFrankingDropOnInvalid();if(!((c==null?void 0:c.frankingTag)!=null&&((e=a.metadata)==null?void 0:e.frankingKey)==null)){o.next=7;break}c.frankingTag=null;c.reportingTag=null;return o.abrupt("return",{decision:j.KEEP,updatedReportingMeta:c});case 7:if(!((c==null?void 0:c.frankingTag)!=null&&a.version==="v3"&&a.type==="subprotocol"&&((f=a.metadata)==null?void 0:f.frankingKey)!=null&&a.frankingContent!=null)){o.next=24;break}h=c.frankingTag;i=a.frankingContent,l=a.metadata.frankingVersion;m=d("WAFrankingTypes").castToFrankingKey(new Uint8Array(a.metadata.frankingKey));n=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.FRANKING_VALIDATION);if(!(m==null)){o.next=15;break}n.endFail("tagButNoKey");return o.abrupt("return",g?{decision:j.DROP,updatedReportingMeta:c}:{decision:j.KEEP,updatedReportingMeta:c});case 15:o.next=17;return b("regeneratorRuntime").awrap(k(new Uint8Array(i),m,h,l));case 17:if(o.sent){o.next=20;break}n.endFail("tagMismatch");return o.abrupt("return",g?{decision:j.DROP,updatedReportingMeta:c}:{decision:j.KEEP,updatedReportingMeta:c});case 20:c.frankingKey=m;c.reportingContent=i;n.endSuccess();return o.abrupt("return",{decision:j.KEEP,updatedReportingMeta:c});case 24:return o.abrupt("return",d("WAGlobals").getConfig().isFrankingDropOnMissing()?{decision:j.DROP,updatedReportingMeta:c}:{decision:j.KEEP,updatedReportingMeta:c});case 25:case"end":return o.stop()}},null,this)}g.FrankingDecision=j;g.createFrankingKey=a;g.getFrankingVersion=c;g.genFrankingTag=e;g.validateFrankingTag=k;g.handleAndValidateFrankingFromIncomingMsg=f}),98);
__d("WAAsMessageApplication",["WAAsConsumerApplication","WAConsumerApplication.pb","WAFranking","WAMsgApplication.pb","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b;switch(a.type){default:b=d("WAAsConsumerApplication").asConsumerApplication(a)}var c=a.forwardingScore!=null?a.forwardingScore:0;a=a.isForwarded!=null?a.isForwarded:!1;c={metadata:{chatEphemeralSetting:null,forwardingScore:c,frankingKey:d("WAFranking").createFrankingKey(),frankingVersion:d("WAFranking").getFrankingVersion(),isForwarded:a,quotedMessage:null}};if(b!=null){a=d("encodeProtobuf").encodeProtobuf(d("WAConsumerApplication.pb").ConsumerApplicationSpec,b);c.payload={subProtocol:{consumerMessage:{payload:a.readBuffer(),version:1}}}}return d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,c).readByteArray()}function b(a){return a}g.asMessageApplication=a;g.castToMessageApplicationBytes=b}),98);
__d("WAServerRPCLogger",["WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";a=d("WATagsLogger").TAGS(["ServerRPC"]);g.logger=a}),98);
__d("MAWIncomingMsg",["MAWExternalId","WAGlobals","WAHashStringToNumber","WAJids","WAServerRPCLogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=d("WAServerRPCLogger").logger.TAGS(["HandleIncomingMsg"]);b=function(a){var b=a.consumerRetries,c=a.encTypes,e=a.msg,f=a.queueType;a=a.retryCount;return{"int":{consumerRetries:(b=b)!=null?b:0,messageAge:d("WATimeUtils").unixTime()-e.ts,msgId:d("WAHashStringToNumber").hashStringToNumber(e.externalId.toString()),offlineDelivery:e.offline,retryCount:a},string:{e2eePlatform:d("MAWExternalId").getPlatform(e.externalId),jid:e.from.chat,msgType:e.type,queueType:f,threadType:e.from.type,userHash:d("WAGlobals").getConfig().isEmployee()&&d("WAGlobals").getConfig().isUseridAnnotationEnabled()?d("WAJids").extractUserId(d("WAGlobals").getMyUserJid()).slice(-5):null},string_array:{encTypes:c}}};g.logger=a;g.prepareAnnotationsForIncomingMessage=b}),98);
__d("WAXmlParsingFailure",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a,b){this.parser=a,this.reason=b}var b=a.prototype;b.toString=function(){return"XmlParsingFailure: "+this.parser+": "+this.reason};return a}();f.XmlParsingFailure=a}),66);
__d("WAParsableXmlNode",["WAErr","WAHasProperty","WAXmlParsingFailure"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,b){var c=this;this.$1=a;this.$2=b;this.$3=Array.isArray(b.content)?b.content.map(function(b){return new c.constructor(a,b)}):null}var b=a.prototype;b.name=function(){return this.$1};b.node=function(){return this.$2};b.hasAttr=function(a){return c("WAHasProperty")(this.$2.attrs,a)};b.assertTag=function(a){this.$2.tag!==a&&this["throw"]("to be <"+a+">")};b.tag=function(){return this.$2.tag};b.maybeChild=function(a){var b=this.$3;if(!b)return null;for(var c=0;c<b.length;c++)if(b[c].tag()===a)return b[c];return null};b.hasChild=function(a){return!!this.maybeChild(a)};b.child=function(a){var b=this.maybeChild(a);return!b?this["throw"]("to have child <"+a+">"):b};b.assertAttr=function(a,b){var c=this.attrString(a);c!==b&&this["throw"]('to have "'+a+'"="'+b+'", but instead has "'+c+'"')};b.attrString=function(a){return!c("WAHasProperty")(this.$2.attrs,a)?this["throw"]('to have attribute "'+a+'"'):this.decodeAsString(this.$2.attrs[a])};b.forEachAttributeKey=function(a){var b=this.$2.attrs;Object.keys(b).forEach(function(b){return a(b)})};b.maybeAttrString=function(a){return this.hasAttr(a)?this.decodeAsString(this.$2.attrs[a]):null};b.maybeAttrInt=function(a,b,c){return this.hasAttr(a)?this.attrInt(a,b,c):null};b.attrEnumValues=function(a,b,c){b=new Set(b);var d=this.attrString(a);if(!b.has(d)){if(c!=null)return c;c=Array.from(b).join("|");return this["throw"]('to have "'+a+'"={'+c+'} but has value "'+d+'"')}return d};b.attrEnum=function(a,b){var d=this.attrString(a);if(!c("WAHasProperty")(b,d)){var e=Object.keys(b).join("|");return this["throw"]('to have "'+a+'"={'+e+'} but has value "'+d+'"')}return b[d]};b.attrEnumOrNullIfUnknown=function(a,b){a=this.attrString(a);return!c("WAHasProperty")(b,a)?null:b[a]};b.attrEnumOrDefault=function(a,b,c){return this.hasAttr(a)?this.attrEnum(a,b):c};b.attrInt=function(a,b,c){var d=this.attrString(a);return this.$4(d,a,b,c)};b.$4=function(a,b,c,d){var e=parseInt(a,10);if(Number.isNaN(e))return this["throw"]('to have "'+b+'"={integer} but has value "'+a+'"');else if(c!==void 0&&e<c)return this["throw"]('to have "'+b+'"={at least '+c+"} but has value "+e);else if(d!==void 0&&e>=d)return this["throw"]('to have "'+b+'"={below '+d+"} but has value "+e);return e};b.forEachChild=function(a){var b=this.$3;if(b)b.forEach(function(b){return a(b)});else if(this.$2.content!=null)return this["throw"]("to have children")};b.forEachChildWithTag=function(a,b){this.forEachChild(function(c){c.tag()===a&&b(c)})};b.mapChildren=function(a){var b=this.$3;return!b&&this.$2.content!=null?this["throw"]("to have children"):b?b.map(function(b){return a(b)}):[]};b.mapChildrenWithTag=function(a,b){var c=this.$3;return!c&&this.$2.content!=null?this["throw"]("to have children"):c?c.filter(function(b){return b.tag()===a}).map(function(a){return b(a)}):[]};b.mapFirstChild=function(a){var b=this.$3;return!b||b.length===0?this["throw"]("to have children"):a(b[0])};b.hasContent=function(){return!this.$3&&!!this.$2.content};b.hasChildren=function(){return this.$3!=null};b.getChildren=function(){return this.$3};b.mapAttrKeys=function(a){var b=this.getAttrKeys();return b&&b.length?b.map(a):[]};b.getAttrKeys=function(){return Object.keys(this.$2.attrs)};b.hasAttrs=function(){var a=this.$2.attrs?Object.keys(this.$2.attrs):[];return a.length>0};b.getNode=function(){return this.$2};b.unsafeSetChildren=function(a){this.$3=a};b.unsafeSetNodeContent=function(a){this.$2.content=a};b.contentUint=function(a){var b=this.contentBytes(a);return h(b,a)};b.contentBytes=function(a){a===void 0&&(a=-1);if(this.$3)return this["throw"]("to have binary content, but has children instead");else if(this.$2.content!=null){var b=this.$2.content;return a!==-1&&b.length!==a?this["throw"]("to be "+a+" bytes, but got "+b.length+" instead"):b}else return this["throw"]("to have content")};b.contentString=function(){if(this.$3)return this["throw"]("to have string content, but has children instead");else if(this.$2.content!=null)return this.$2.content;else return this["throw"]("to have content")};b.contentInt=function(a,b){var c=this.contentString();return this.$4(c,"content",a,b)};b.contentEnum=function(a){var b=this.contentString();if(!c("WAHasProperty")(a,b)){var d=Object.keys(a).join("|");return this["throw"]("to have content {"+d+'} but has value "'+b+'"')}return a[b]};b.decodeAsString=function(a){if(typeof a!=="string")throw c("WAErr")("decodeAsString: attribute is "+typeof a+" not a string: "+a);return a};b["throw"]=function(a){throw new(d("WAXmlParsingFailure").XmlParsingFailure)(this.$1,"expected <"+this.$2.tag+"> "+a)};b.toString=function(){return this.$2.toString()};return a}();function h(a,b){var c=0;for(var d=0;d<b;d++)c=c*256+a[d];return c}g.ParsableXmlNode=a;g.convertBytesToUint=h}),98);
__d("WASignalLocalStorageProtocol.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};e={};f={};var h={},i={},j={},k={},l={},m={},n={},o={},p={},q={};a.internalSpec={sessionVersion:[1,(d=d("WAProtoConst")).TYPES.UINT32],localIdentityPublic:[2,d.TYPES.BYTES],remoteIdentityPublic:[3,d.TYPES.BYTES],rootKey:[4,d.TYPES.BYTES],previousCounter:[5,d.TYPES.UINT32],senderChain:[6,d.TYPES.MESSAGE,e],receiverChains:[7,d.FLAGS.REPEATED|d.TYPES.MESSAGE,e],pendingKeyExchange:[8,d.TYPES.MESSAGE,c],pendingPreKey:[9,d.TYPES.MESSAGE,b],remoteRegistrationId:[10,d.TYPES.UINT32],localRegistrationId:[11,d.TYPES.UINT32],needsRefresh:[12,d.TYPES.BOOL],aliceBaseKey:[13,d.TYPES.BYTES]};b.internalSpec={preKeyId:[1,d.TYPES.UINT32],signedPreKeyId:[3,d.TYPES.INT32],baseKey:[2,d.TYPES.BYTES]};c.internalSpec={sequence:[1,d.TYPES.UINT32],localBaseKey:[2,d.TYPES.BYTES],localBaseKeyPrivate:[3,d.TYPES.BYTES],localRatchetKey:[4,d.TYPES.BYTES],localRatchetKeyPrivate:[5,d.TYPES.BYTES],localIdentityKey:[7,d.TYPES.BYTES],localIdentityKeyPrivate:[8,d.TYPES.BYTES]};e.internalSpec={senderRatchetKey:[1,d.TYPES.BYTES],senderRatchetKeyPrivate:[2,d.TYPES.BYTES],chainKey:[3,d.TYPES.MESSAGE,h],messageKeys:[4,d.FLAGS.REPEATED|d.TYPES.MESSAGE,f]};f.internalSpec={index:[1,d.TYPES.UINT32],cipherKey:[2,d.TYPES.BYTES],macKey:[3,d.TYPES.BYTES],iv:[4,d.TYPES.BYTES]};h.internalSpec={index:[1,d.TYPES.UINT32],key:[2,d.TYPES.BYTES]};i.internalSpec={currentSession:[1,d.TYPES.MESSAGE,a],previousSessions:[2,d.FLAGS.REPEATED|d.TYPES.MESSAGE,a]};j.internalSpec={id:[1,d.TYPES.UINT32],publicKey:[2,d.TYPES.BYTES],privateKey:[3,d.TYPES.BYTES]};k.internalSpec={id:[1,d.TYPES.UINT32],publicKey:[2,d.TYPES.BYTES],privateKey:[3,d.TYPES.BYTES],signature:[4,d.TYPES.BYTES],timestamp:[5,d.TYPES.FIXED64]};l.internalSpec={publicKey:[1,d.TYPES.BYTES],privateKey:[2,d.TYPES.BYTES]};m.internalSpec={senderKeyId:[1,d.TYPES.UINT32],senderChainKey:[2,d.TYPES.MESSAGE,p],senderSigningKey:[3,d.TYPES.MESSAGE,n],senderMessageKeys:[4,d.FLAGS.REPEATED|d.TYPES.MESSAGE,o]};n.internalSpec={"public":[1,d.TYPES.BYTES],"private":[2,d.TYPES.BYTES]};o.internalSpec={iteration:[1,d.TYPES.UINT32],seed:[2,d.TYPES.BYTES]};p.internalSpec={iteration:[1,d.TYPES.UINT32],seed:[2,d.TYPES.BYTES]};q.internalSpec={senderKeyStates:[1,d.FLAGS.REPEATED|d.TYPES.MESSAGE,m]};g.SessionStructureSpec=a;g.SessionStructure$PendingPreKeySpec=b;g.SessionStructure$PendingKeyExchangeSpec=c;g.SessionStructure$ChainSpec=e;g.SessionStructure$Chain$MessageKeySpec=f;g.SessionStructure$Chain$ChainKeySpec=h;g.RecordStructureSpec=i;g.PreKeyRecordStructureSpec=j;g.SignedPreKeyRecordStructureSpec=k;g.IdentityKeyPairStructureSpec=l;g.SenderKeyStateStructureSpec=m;g.SenderKeyStateStructure$SenderSigningKeySpec=n;g.SenderKeyStateStructure$SenderMessageKeySpec=o;g.SenderKeyStateStructure$SenderChainKeySpec=p;g.SenderKeyRecordStructureSpec=q}),98);
__d("WACryptoHkdf",["Promise","WABinary","WACryptoHmac","WAErr"],(function(a,b,c,d,e,f,g){"use strict";var h,i=255*d("WACryptoHmac").SHA256_BYTE_LENGTH;function j(a,e,f){if(f<0||f>i)return(h||(h=b("Promise"))).reject(c("WAErr")("HKDF::expand given bad length "+f));var g,j=Math.ceil(f/d("WACryptoHmac").SHA256_BYTE_LENGTH),k=d("WABinary").Binary.build(e).readByteArray(),l=new(d("WABinary").Binary)(),m=d("WACryptoHmac").encodeKeySha256(a).then(function(a){g=a;return new Uint8Array(0)});e=function(a){m=m.then(function(b){return d("WACryptoHmac").sign(g,d("WABinary").Binary.build(b,k,a).readByteArray())}).then(function(a){a=new Uint8Array(a);l.writeByteArray(a);return a})};for(a=1;a<=j;a++)e(a);return m.then(function(){return l.readBuffer(f)})}function a(a,b,c){return d("WACryptoHmac").extractSha256(null,a).then(function(a){return j(new Uint8Array(a),b,c)})}function e(a,b,c,e){return d("WACryptoHmac").extractSha256(b,a).then(function(a){return j(new Uint8Array(a),c,e)})}g.expand=j;g.extractAndExpand=a;g.extractWithSaltAndExpand=e}),98);
__d("WASignalOther",["WACryptoDependencies","WACryptoHkdf","WACryptoUtils","WAErr","WAParsableXmlNode","decodeProtobuf","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";var h={name:"AES-CBC"},i={name:"HMAC",hash:"SHA-256"};function j(a,b){if(a.length!==b)throw c("WAErr")("Signal expected "+b+" bytes, given "+a.length);return a}function a(a,b){return j(new Uint8Array(a),b)}function b(a){var b=a.buffer,c=a.byteOffset;a=a.length;return c===0&&a===b.byteLength?b:b.slice(c,c+a)}function e(a,b){return a.readByteArray(b)}function f(a){return new Uint8Array(a)}function k(a,b,d){if(a.length-b<d)throw c("WAErr")("Can not split off "+d+" bytes from index "+b+" of "+a.length+" bytes");return a.slice(b,b+d)}function l(a){a=a==="extendedRange"?(-1>>>1)-1:16380;return d("WACryptoUtils").randomNumberLessThan(a)+1}function m(a){return q(a)}function n(a){return d("WAParsableXmlNode").convertBytesToUint(a,4)}function o(){var a=-1>>>1;return d("WACryptoUtils").randomNumberLessThan(a)+1}function p(a){return q(a)}function q(a,b,d){b===void 0&&(b=0);d===void 0&&(d=4294967296);if(typeof a==="number"&&b<=a&&a<d&&Math.floor(a)===a)return a;else throw c("WAErr")("Expected integer in range ["+b+", "+d+"), given "+String(a))}function r(a,b){return d("encodeProtobuf").encodeProtobuf(a,b).readByteArray()}function s(a,b,c){return c(d("decodeProtobuf").decodeProtobuf(a,b))}function t(a,b,c,e){return d("WACryptoHkdf").extractWithSaltAndExpand(a,b,c,e).then(function(a){return new Uint8Array(a)})}function u(a,b){var c,e;b==="hmac-sha256"?(c=i,e=["sign"]):(b,c=h,e=["encrypt","decrypt"]);return d("WACryptoDependencies").getCrypto().subtle.importKey("raw",a,c,!1,e)}function v(a){return a}function w(a){return a}function x(a,b){return d("WACryptoUtils").arrayBuffersEqual(a,b)}g.AES_CBC=h;g.HMAC_SHA256=i;g.ensureSize=j;g.toBytes=a;g.toBuffer=b;g.readBytes=e;g.makeBytes=f;g.sliceBytes=k;g.makeRegistrationId=l;g.castRegistrationId=m;g.castRegistrationIdFromBytes=n;g.makeSenderKeyId=o;g.castSenderKeyId=p;g.ensureIntInRange=q;g.encodeSignalProto=r;g.decodeSignalProto=s;g.hkdf=t;g.makeCryptoKey=u;g.castToByteEncoded=v;g.castToSessionHash=w;g.areSessionHashesEqual=x}),98);
__d("WASignalKeys",["WACryptoDependencies","WACryptoPrimitives","WAErr","WALogger","WASignalLocalStorageProtocol.pb","WASignalOther","decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["deserializePreKey error ",""]);h=function(){return a};return a}var i=5,j=16777215;function k(a,b){return{publicKey:a,privateKey:b}}function a(a){a=d("WACryptoPrimitives").keypairFromSecretKey(a);var b=a.publicKey;a=a.secretKey;return k(d("WASignalOther").ensureSize(b,32),d("WASignalOther").ensureSize(a,32))}function b(a,b){return{publicKey:d("WASignalOther").toBytes(a,32),privateKey:d("WASignalOther").toBytes(b,32)}}function l(){var a=d("WACryptoPrimitives").keyPair(),b=a.publicKey;a=a.secretKey;a[0]&=248;a[31]=64|a[31]&63;return k(d("WASignalOther").ensureSize(b,32),d("WASignalOther").ensureSize(a,32))}function m(a,b){return k(d("WASignalOther").sliceBytes(b,1,32),a)}function n(a,b){return{serializedPubKey:b,privateKey:a}}function e(){var a=l();return n(a.privateKey,o(a))}function o(a){var b=d("WASignalOther").makeBytes(33);b[0]=i;b.set(a.publicKey,1);return b}function f(a){var b=d("WASignalOther").makeBytes(33);b[0]=i;b.set(d("WASignalOther").ensureSize(a,32),1);return b}function p(a){return n(a.privateKey,o(a))}function q(a,b){a=(a-1)%j;a<=0&&(a+=j);var c=[];for(var e=0;e<b;e++){var f=a===j?1:a+1,g=l(),h=d("WASignalOther").encodeSignalProto(d("WASignalLocalStorageProtocol.pb").PreKeyRecordStructureSpec,{id:f,publicKey:o(g),privateKey:g.privateKey});c.push({plainObject:{id:f,keyPair:g},record:h});a=f}return c}function r(a){try{a=d("decodeProtobuf").decodeProtobuf(d("WASignalLocalStorageProtocol.pb").PreKeyRecordStructureSpec,a);var b=a.id,c=a.publicKey;a=a.privateKey;return b==null||c==null||a==null?null:{id:s(b),keyPair:m(d("WASignalOther").toBytes(a,32),u(new Uint8Array(c)))}}catch(a){d("WALogger").DEV(h(),a);return null}}function s(a){return d("WASignalOther").ensureIntInRange(a,1,j)}function t(a){return d("WASignalOther").ensureIntInRange(a,0,j)}function u(a){if(a.length===0||a[0]!==i)throw c("WAErr")("Unrecognized public key type");return d("WASignalOther").ensureSize(a,33)}function v(){var a=d("WASignalOther").makeBytes(32);d("WACryptoDependencies").getCrypto().getRandomValues(a);return a}function w(a,b){return d("WACryptoPrimitives").scalarMult(a,b.subarray(1)).buffer}g.KEY_TYPE=i;g.makeKeyPairFrom=a;g.makeKeyPairFromArrayBuffers=b;g.makeKeyPair=l;g.makeKeyPairFromSerialized=m;g.makeSerializedKeyPairFrom=n;g.makeSerializedKeyPair=e;g.serializePubKey=o;g.serializeIdentity=f;g.toSerializedKeyPair=p;g.makePreKeys=q;g.deserializePreKey=r;g.castToPreKeyId=s;g.castToSignedPreKeyId=t;g.castToSerializedPubKey=u;g.makeRawSenderKey=v;g.ecdh=w}),98);
__d("WATextEncoding",[],(function(a,b,c,d,e,f){"use strict";e=TextEncoder;var g=TextDecoder,h=e,i=g;function a(){return new h()}function b(){return new i()}function c(a){h=a}function d(a){i=a}f.newTextEncoder=a;f.newTextDecoder=b;f.setTextEncoderClass=c;f.setTextDecoderClass=d}),66);
__d("WAWapDict",[],(function(a,b,c,d,e,f){a=3;b=["xmlstreamstart","xmlstreamend","s.whatsapp.net","type","participant","from","receipt","id","notification","disappearing_mode","status","jid","broadcast","user","devices","device_hash","to","offline","message","result","class","xmlns","duration","notify","iq","t","ack","g.us","enc","urn:xmpp:whatsapp:push","presence","config_value","picture","verified_name","config_code","key-index-list","contact","mediatype","routing_info","edge_routing","get","read","urn:xmpp:ping","fallback_hostname","0","chatstate","business_hours_config","unavailable","download_buckets","skmsg","verified_level","composing","handshake","device-list","media","text","fallback_ip4","media_conn","device","creation","location","config","item","fallback_ip6","count","w:profile:picture","image","business","2","hostname","call-creator","display_name","relaylatency","platform","abprops","success","msg","offline_preview","prop","key-index","v","day_of_week","pkmsg","version","1","ping","w:p","download","video","set","specific_hours","props","primary","unknown","hash","commerce_experience","last","subscribe","max_buckets","call","profile","member_since_text","close_time","call-id","sticker","mode","participants","value","query","profile_options","open_time","code","list","host","ts","contacts","upload","lid","preview","update","usync","w:stats","delivery","auth_ttl","context","fail","cart_enabled","appdata","category","atn","direct_connection","decrypt-fail","relay_id","mmg-fallback.whatsapp.net","target","available","name","last_id","mmg.whatsapp.net","categories","401","is_new","index","tctoken","ip4","token_id","latency","recipient","edit","ip6","add","thumbnail-document","26","paused","true","identity","stream:error","key","sidelist","background","audio","3","thumbnail-image","biz-cover-photo","cat","gcm","thumbnail-video","error","auth","deny","serial","in","registration","thumbnail-link","remove","00","gif","thumbnail-gif","tag","capability","multicast","item-not-found","description","business_hours","config_expo_key","md-app-state","expiration","fallback","ttl","300","md-msg-hist","device_orientation","out","w:m","open_24h","side_list","token","inactive","01","document","te2","played","encrypt","msgr","hide","direct_path","12","state","not-authorized","url","terminate","signature","status-revoke-delay","02","te","linked_accounts","trusted_contact","timezone","ptt","kyc-id","privacy_token","readreceipts","appointment_only","address","expected_ts","privacy","7","android","interactive","device-identity","enabled","attribute_padding","1080","03","screen_height"];c=["read-self","active","fbns","protocol","reaction","screen_width","heartbeat","deviceid","2:47DEQpj8","uploadfieldstat","voip_settings","retry","priority","longitude","conflict","false","ig_professional","replaced","preaccept","cover_photo","uncompressed","encopt","ppic","04","passive","status-revoke-drop","keygen","540","offer","rate","opus","latitude","w:gp2","ver","4","business_profile","medium","sender","prev_v_id","email","website","invited","sign_credential","05","transport","skey","reason","peer_abtest_bucket","America/Sao_Paulo","appid","refresh","100","06","404","101","104","107","102","109","103","member_add_mode","105","transaction-id","110","106","outgoing","108","111","tokens","followers","ig_handle","self_pid","tue","dec","thu","joinable","peer_pid","mon","features","wed","peer_device_presence","pn","delete","07","fri","audio_duration","admin","connected","delta","rcat","disable","collection","08","480","sat","phash","all","invite","accept","critical_unblock_low","group_update","signed_credential","blinded_credential","eph_setting","net","09","background_location","refresh_id","Asia/Kolkata","privacy_mode_ts","account_sync","voip_payload_type","service_areas","acs_public_key","v_id","0a","fallback_class","relay","actual_actors","metadata","w:biz","5","connected-limit","notice","0b","host_storage","fb_page","subject","privatestats","invis","groupadd","010","note.m4r","uuid","0c","8000","sun","372","1020","stage","1200","720","canonical","fb","011","video_duration","0d","1140","superadmin","012","Opening.m4r","keystore_attestation","dleq_proof","013","timestamp","ab_key","w:sync:app:state","0e","vertical","600","p_v_id","6","likes","014","500","1260","creator","0f","rte","destination","group","group_info","syncd_anti_tampering_fatal_exception_enabled","015","dl_bw","Asia/Jakarta","vp8/h.264","online","1320","fb:multiway","10","timeout","016","nse_retry","urn:xmpp:whatsapp:dirty","017","a_v_id","web_shops_chat_header_button_enabled","nse_call","inactive-upgrade","none","web","groups","2250","mms_hot_content_timespan_in_seconds","contact_blacklist","nse_read","suspended_group_deletion_notification","binary_version","018","https://www.whatsapp.com/otp/copy/","reg_push","shops_hide_catalog_attachment_entrypoint","server_sync",".","ephemeral_messages_allowed_values","019","mms_vcache_aggregation_enabled","iphone","America/Argentina/Buenos_Aires","01a","mms_vcard_autodownload_size_kb","nse_ver","shops_header_dropdown_menu_item","dhash","catalog_status","communities_mvp_new_iqs_serverprop","blocklist","default","11","ephemeral_messages_enabled","01b","original_dimensions","8","mms4_media_retry_notification_encryption_enabled","mms4_server_error_receipt_encryption_enabled","original_image_url","sync","multiway","420","companion_enc_static","shops_profile_drawer_entrypoint","01c","vcard_as_document_size_kb","status_video_max_duration","request_image_url","01d","regular_high","s_t","abt","share_ext_min_preliminary_image_quality","01e","32","syncd_key_rotation_enabled","data_namespace","md_downgrade_read_receipts2","patch","polltype","ephemeral_messages_setting","userrate","15","partial_pjpeg_bw_threshold","played-self","catalog_exists","01f","mute_v2"];d=["reject","dirty","announcement","020","13","9","status_video_max_bitrate","fb:thrift_iq","offline_batch","022","full","ctwa_first_business_reply_logging","h.264","smax_id","group_description_length","https://www.whatsapp.com/otp/code","status_image_max_edge","smb_upsell_business_profile_enabled","021","web_upgrade_to_md_modal","14","023","s_o","smaller_video_thumbs_status_enabled","media_max_autodownload","960","blocking_status","peer_msg","joinable_group_call_client_version","group_call_video_maximization_enabled","return_snapshot","high","America/Mexico_City","entry_point_block_logging_enabled","pop","024","1050","16","1380","one_tap_calling_in_group_chat_size","regular_low","inline_joinable_education_enabled","hq_image_max_edge","locked","America/Bogota","smb_biztools_deeplink_enabled","status_image_quality","1088","025","payments_upi_intent_transaction_limit","voip","w:g2","027","md_pin_chat_enabled","026","multi_scan_pjpeg_download_enabled","shops_product_grid","transaction_id","ctwa_context_enabled","20","fna","hq_image_quality","alt_jpeg_doc_detection_quality","group_call_max_participants","pkey","America/Belem","image_max_kbytes","web_cart_v1_1_order_message_changes_enabled","ctwa_context_enterprise_enabled","urn:xmpp:whatsapp:account","840","Asia/Kuala_Lumpur","max_participants","video_remux_after_repair_enabled","stella_addressbook_restriction_type","660","900","780","context_menu_ios13_enabled","mute-state","ref","payments_request_messages","029","frskmsg","vcard_max_size_kb","sample_buffer_gif_player_enabled","match_last_seen","510","4983","video_max_bitrate","028","w:comms:chat","17","frequently_forwarded_max","groups_privacy_blacklist","Asia/Karachi","02a","web_download_document_thumb_mms_enabled","02b","hist_sync","biz_block_reasons_version","1024","18","web_is_direct_connection_for_plm_transparent","view_once_write","file_max_size","paid_convo_id","online_privacy_setting","video_max_edge","view_once_read","enhanced_storage_management","multi_scan_pjpeg_encoding_enabled","ctwa_context_forward_enabled","video_transcode_downgrade_enable","template_doc_mime_types","hq_image_bw_threshold","30","body","u_aud_limit_sil_restarts_ctrl","other","participating","w:biz:directory","1110","vp8","4018","meta","doc_detection_image_max_edge","image_quality","1170","02c","smb_upsell_chat_banner_enabled","key_expiry_time_second","pid","stella_interop_enabled","19","linked_device_max_count","md_device_sync_enabled","02d","02e","360","enhanced_block_enabled","ephemeral_icon_in_forwarding","paid_convo_status","gif_provider","project_name","server-error","canonical_url_validation_enabled","wallpapers_v2","syncd_clear_chat_delete_chat_enabled","medianotify","02f","shops_required_tos_version","vote","reset_skey_on_id_change","030","image_max_edge","multicast_limit_global","ul_bw","21","25","5000","poll","570","22","031","1280","WhatsApp","032","bloks_shops_enabled","50","upload_host_switching_enabled","web_ctwa_context_compose_enabled","ptt_forwarded_features_enabled","unblocked","partial_pjpeg_enabled","fbid:devices","height","ephemeral_group_query_ts","group_join_permissions","order","033","alt_jpeg_status_quality","migrate","popular-bank","win_uwp_deprecation_killswitch_enabled","web_download_status_thumb_mms_enabled","blocking","url_text","035","web_forwarding_limit_to_groups","1600","val","1000","syncd_msg_date_enabled","bank-ref-id","max_subject","payments_web_enabled","web_upload_document_thumb_mms_enabled","size","request","ephemeral","24","receipt_agg","ptt_remember_play_position","sampling_weight","enc_rekey","mute_always","037","034","23","036","action","click_to_chat_qr_enabled","width","disabled","038","md_blocklist_v2","played_self_enabled","web_buttons_message_enabled","flow_id","clear","450","fbid:thread","bloks_session_state","America/Lima","attachment_picker_refresh","download_host_switching_enabled","1792","u_aud_limit_sil_restarts_test2","custom_urls","device_fanout","optimistic_upload","2000","key_cipher_suite","web_smb_upsell_in_biz_profile_enabled","e","039","siri_post_status_shortcut","pair-device","lg","lc","stream_attribution_url","model","mspjpeg_phash_gen","catalog_send_all","new_multi_vcards_ui","share_biz_vcard_enabled","-","clean","200","md_blocklist_v2_server","03b","03a","web_md_migration_experience","ptt_conversation_waveform","u_aud_limit_sil_restarts_test1"];e=["64","ptt_playback_speed_enabled","web_product_list_message_enabled","paid_convo_ts","27","manufacturer","psp-routing","grp_uii_cleanup","ptt_draft_enabled","03c","business_initiated","web_catalog_products_onoff","web_upload_link_thumb_mms_enabled","03e","mediaretry","35","hfm_string_changes","28","America/Fortaleza","max_keys","md_mhfs_days","streaming_upload_chunk_size","5541","040","03d","2675","03f","...","512","mute","48","041","alt_jpeg_quality","60","042","md_smb_quick_reply","5183","c","1343","40","1230","043","044","mms_cat_v1_forward_hot_override_enabled","user_notice","ptt_waveform_send","047","Asia/Calcutta","250","md_privacy_v2","31","29","128","md_messaging_enabled","046","crypto","690","045","enc_iv","75","failure","ptt_oot_playback","AIzaSyDR5yfaG7OG8sMTUj8kfQEb8T9pN8BM6Lk","w","048","2201","web_large_files_ui","Asia/Makassar","812","status_collapse_muted","1334","257","2HP4dm","049","patches","1290","43cY6T","America/Caracas","web_sticker_maker","campaign","ptt_pausable_enabled","33","42","attestation","biz","04b","query_linked","s","125","04a","810","availability","1411","responsiveness_v2_m1","catalog_not_created","34","America/Santiago","1465","enc_p","04d","status_info","04f","key_version","..","04c","04e","md_group_notification","1598","1215","web_cart_enabled","37","630","1920","2394","-1","vcard","38","elapsed","36","828","peer","pricing_category","1245","invalid","stella_ios_enabled","2687","45","1528","39","u_is_redial_audio_1104_ctrl","1025","1455","58","2524","2603","054","bsp_system_message_enabled","web_pip_redesign","051","verify_apps","1974","1272","1322","1755","052","70","050","1063","1135","1361","80","1096","1828","1851","1251","1921","key_config_id","1254","1566","1252","2525","critical_block","1669","max_available","w:auth:backup:token","product","2530","870","1022","participant_uuid","web_cart_on_off","1255","1432","1867","41","1415","1440","240","1204","1608","1690","1846","1483","1687","1749","69","url_number","053","1325","1040","365","59","Asia/Riyadh","1177","test_recommended","057","1612","43","1061","1518","1635","055","1034","1375","750","1430","event_code","1682","503","55","865","78","1309","1365","44","America/Guayaquil","535","LIMITED","1377","1613","1420","1599","1822","05a","1681","password","1111","1214","1376","1478","47","1082","4282","Europe/Istanbul","1307","46","058","1124","256","rate-overlimit","retail","u_a_socket_err_fix_succ_test","1292","1370","1388","520","861","psa","regular","1181","1766","05b","1183","1213","1304","1537"];var g=["1724","profile_picture","1071","1314","1605","407","990","1710","746","pricing_model","056","059","061","1119","6027","65","877","1607","05d","917","seen","1516","49","470","973","1037","1350","1394","1480","1796","keys","794","1536","1594","2378","1333","1524","1825","116","309","52","808","827","909","495","1660","361","957","google","1357","1565","1967","996","1775","586","736","1052","1670","bank","177","1416","2194","2222","1454","1839","1275","53","997","1629","6028","smba","1378","1410","05c","1849","727","create","1559","536","1106","1310","1944","670","1297","1316","1762","en","1148","1295","1551","1853","1890","1208","1784","7200","05f","178","1283","1332","381","643","1056","1238","2024","2387","179","981","1547","1705","05e","290","903","1069","1285","2436","062","251","560","582","719","56","1700","2321","325","448","613","777","791","51","488","902","Asia/Almaty","is_hidden","1398","1527","1893","1999","2367","2642","237","busy","065","067","233","590","993","1511","54","723","860","363","487","522","605","995","1321","1691","1865","2447","2462","NON_TRANSACTIONAL","433","871","432","1004","1207","2032","2050","2379","2446","279","636","703","904","248","370","691","700","1068","1655","2334","060","063","364","533","534","567","1191","1210","1473","1827","069","701","2531","514","prev_dhash","064","496","790","1046","1139","1505","1521","1108","207","544","637","final","1173","1293","1694","1939","1951","1993","2353","2515","504","601","857","modify","spam_request","p_121_aa_1101_test4","866","1427","1502","1638","1744","2153","068","382","725","1704","1864","1990","2003","Asia/Dubai","508","531","1387","1474","1632","2307","2386","819","2014","066","387","1468","1706","2186","2261","471","728","1147","1372","1961"],h=[c,d,e,g];f.DICT_VERSION=a;f.SINGLE_BYTE_TOKEN=b;f.DICTIONARY_0_TOKEN=c;f.DICTIONARY_1_TOKEN=d;f.DICTIONARY_2_TOKEN=e;f.DICTIONARY_3_TOKEN=g;f.DICTIONARIES=h}),66);
__d("WAWapJid",["$InternalEnum","WAJids"],(function(a,b,c,d,e,f,g){"use strict";var h={JID:0,JID_U:1,JID_AD:1,JID_FB:3,JID_INTEROP:4},i=b("$InternalEnum")({WHATSAPP:0,LID:1,HOSTED:128,HOSTED_LID:129});a=function(){function a(a){this.$1=a}a.createAD=function(b,c,d){return new a({type:h.JID_AD,user:b,device:d==null?0:d,agent:c==null?0:c,domainType:i.WHATSAPP})};a.createJidU=function(b,c,d){return new a({type:h.JID_U,user:b,device:d==null?0:d,domainType:c==null?i.WHATSAPP:c})};a.createFbJid=function(b,c){c=c==null?0:c;return new a({type:h.JID_FB,user:b,device:c})};a.createInteropJid=function(b,c,d){c=c==null?0:c;return new a({type:h.JID_INTEROP,user:b,device:c,integrator:d})};a.create=function(b,c){return new a({type:h.JID,user:b,server:c})};var b=a.prototype;b.toString=function(){if(this.$1.type===h.JID_AD||this.$1.type===h.JID_U){var a=this.$1,b=a.user,c=a.device;a=a.domainType;var e;a===i.WHATSAPP?e=d("WAJids").WA_USER_JID_SUFFIX:a===i.HOSTED?e=d("WAJids").HOSTED_SUFFIX:a===i.HOSTED_LID?e=d("WAJids").HOSTED_LID_SUFFIX:e=d("WAJids").LID_SUFFIX;return c===0?b+"@"+e:b+":"+c+"@"+e}else if(this.$1.type===h.JID_FB){a=this.$1;b=a.user;c=a.device;e=d("WAJids").MSGR_USER_JID_SUFFIX;return b+":"+c+"@"+e}else if(this.$1.type===h.JID_INTEROP){a=this.$1;b=a.user;c=a.device;e=a.integrator;a=d("WAJids").INTEROP_USER_JID_SUFFIX;return e+"-"+b+":"+c+"@"+a}else{this.$1.type;e=this.$1;b=e.user;c=e.server;return b!=null?b+"@"+c:c}};b.getInnerJid=function(){return this.$1};return a}();g.WAP_JID_SUBTYPE=h;g.DomainType=i;g.WapJid=a}),98);
__d("WAXmlFormatter",[],(function(a,b,c,d,e,f){"use strict";function a(a){a=a.replace(/>\s{0,}</g,"><").replace(/</g,"~::~<").replace(/\s*xmlns:/g,"~::~xmlns:").replace(/\s*xmlns=/g,"~::~xmlns=").split("~::~");var b=a.length,c=!1,d=0,e="",f=0,h=["\n"];for(f=0;f<100;f++)h.push(h[f]+"    ");var i=function(b,a){var c=/^<[\w:\-.,]+/.exec(b[a-1]);b=/^<\/[\w:\-.,]+/.exec(b[a]);return c!=null&&b!=null&&c[0]===b[0]};for(f=0;f<b;f++)a[f].search(/<!/)>-1?(e+=h[d]+a[f],c=!0,(a[f].search(/-->/)>-1||a[f].search(/\]>/)>-1||a[f].search(/!DOCTYPE/)>-1)&&(c=!1)):a[f].search(/-->/)>-1||a[f].search(/\]>/)>-1?(e+=a[f],c=!1):i(a,f)?(e+=a[f],c||d--):a[f].search(/<\w/)>-1&&a[f].search(/<\//)===-1&&a[f].search(/\/>/)===-1?(a[f]=g(a[f]),e=c?e+=a[f]:e+=h[d++]+a[f]):a[f].search(/<\w/)>-1&&a[f].search(/<\//)>-1?e=c?e+=a[f]:e+=h[d]+a[f]:a[f].search(/<\//)>-1?e=c?e+=a[f]:e+=h[d===0?d:--d]+a[f]:a[f].search(/\/>/)>-1?e=c?e+=a[f]:e+=h[d]+a[f]:a[f].search(/<\?/)>-1?e+=h[d]+a[f]:a[f].search(/xmlns:/)>-1||a[f].search(/xmlns=/)>-1?e+=h[d]+a[f]:e+=a[f];return e[0]==="\n"?e.slice(1):e}function g(a){var b=a.match(/(<query.*>|<result>)(\{.*\})/);if(b===null)return a;try{var c=b[1];b=JSON.stringify(JSON.parse(b[2]),null,2);return c+"\n"+b}catch(b){return a+"[Error formatting JSON]"}}f["default"]=a}),66);
__d("WAXmlNode",["WAHex"],(function(a,b,c,d,e,f,g){"use strict";var h={};a=function(){function a(a,b,c){b===void 0&&(b=h),c===void 0&&(c=null),this.tag=a,this.attrs=b,this.content=c}var b=a.prototype;b.toString=function(){var a="<"+this.tag;a+=i(this.attrs);var b=this.content;Array.isArray(b)?a+=">"+b.map(String).join("")+"</"+this.tag+">":b instanceof Uint8Array?a+=">"+j(b)+"</"+this.tag+">":b!=null?a+=">"+String(b)+"</"+this.tag+">":a+=" />";return a};return a}();function i(a){var b=Object.keys(a),c="";for(var d=0;d<b.length;d++){var e=b[d];c+=" "+e+'="'+a[e].toString()+'"'}return c}function j(a){var b;a.length===0?b="<!-- empty binary -->":a.length<50?b=d("WAHex").bytesToDebugString(a):b="<!-- "+a.length+" bytes -->";return b}g.XmlNode=a;g.attrsToString=i;g.uint8ArrayToDebugString=j}),98);
__d("WAWap",["WAAssertUnreachable","WABinary","WACryptoDependencies","WAErr","WAJids","WALogger","WALongInt","WATextEncoding","WAWapDict","WAWapJid","WAXmlFormatter","WAXmlNode"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["decodeNullableString got invalid value: ",", string expected"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["decodeString got invalid value: ",", string expected"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Decoding compressed stanza"]);k=function(){return a};return a}var l=(h=d("WAJids")).MSGR_USER_DOMAIN.replace("@",""),aa=h.WA_USER_DOMAIN.replace("@",""),m=h.LID_DOMAIN.replace("@",""),n=h.INTEROP_DOMAIN.replace("@",""),o=h.HOSTED_DOMAIN.replace("@",""),p=2,ba=128,q=0,r=236,s=237,t=238,u=239,ca=[r,s,t,u],v=245,w=246,x=247,y=248,z=249,A=250,B=251,C=252,D=253,E=254,F=255,da=["0","1","2","3","4","5","6","7","8","9","-",".","\ufffd","\ufffd","\ufffd","\ufffd"],ea=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],G="",fa=1,H={sentinel:"DROP_ATTR"},I=(s=d("WAWapJid")).WapJid.create(null,"g.us"),J=s.WapJid.create(null,h.WA_SERVER_JID_SUFFIX);t=s.WapJid.create("status","broadcast");var K=s.WapJid.create(null,"newsletter");h=s.WapJid.create(null,"hosted");s=s.WapJid.create(null,"hosted.lid");var L={},M=!1;function a(){M=!0}var ga=d("WATextEncoding").newTextEncoder(),N=function(){function a(a,b,c){b===void 0&&(b=L),c===void 0&&(c=null),this.tag=a,this.attrs=b,this.content=c}var b=a.prototype;b.toString=function(){var a="<"+this.tag;a+=d("WAXmlNode").attrsToString(this.attrs);var b=this.content;Array.isArray(b)?a+=">"+b.map(String).join("")+"</"+this.tag+">":b?a+=">"+d("WAXmlNode").uint8ArrayToDebugString(b)+"</"+this.tag+">":a+=" />";M&&(a=c("WAXmlFormatter")(a));return a};return a}();function b(a,b,e){var f=null;if(b&&b.children!=null)throw c("WAErr")('Children should not be passed via props (see eslint check "react/no-children-props")');if(Array.isArray(e))f=e.filter(Boolean);else if(typeof e==="string")f=d("WABinary").Binary.build(e).readByteArray();else if(e instanceof ArrayBuffer)f=new Uint8Array(e);else if(e instanceof Uint8Array)f=e;else{var g=[];for(var h=2;h<arguments.length;h++){var i=arguments[h];i&&g.push(i)}f=g}Array.isArray(f)&&f.length===0&&(f=null);var j={};if(b){var k=b;Object.keys(k).forEach(function(b){if(["__self","__source"].includes(b))return;var d=k[b];if(d==null)throw c("WAErr")("Attr "+b+" in <"+a+"> is null");if(d===H)return;j[b]=d})}return new N(a,j,f)}var ha=b;function e(a){return a instanceof d("WAWapJid").WapJid?a.toString():a}function O(a){var b=a.content;Array.isArray(b)?b=b.map(O):typeof b==="string"&&(b=d("WABinary").Binary.build(b).readByteArray());return new N(a.tag,a.attrs||L,b)}function f(a){a=a instanceof N?a:O(a);var b=new(d("WABinary").Binary)();P(a,b);a=0;b=b.readByteArray();var c=new Uint8Array(1+b.length);c[0]=a;c.set(b,1);return c}function P(a,b){if(a==null)b.writeUint8(q);else if(a instanceof N)Q(a,b);else if(a instanceof d("WAWapJid").WapJid)ia(a,b);else if(typeof a==="string")U(a,b);else if(a instanceof Uint8Array)ja(a,b);else{a;b=typeof a;throw c("WAErr")("Invalid payload type "+b)}}function ia(a,b){a=a.getInnerJid();if(a.type===d("WAWapJid").WAP_JID_SUBTYPE.JID_U){var c=a.user,e=a.device,f=a.domainType;b.writeUint8(x);b.writeUint8(f);b.writeUint8(e);P(c,b)}else if(a.type===d("WAWapJid").WAP_JID_SUBTYPE.JID_FB){f=a.user;e=a.device;b.writeUint8(w);P(f,b);b.writeUint16(e);P(l,b)}else if(a.type===d("WAWapJid").WAP_JID_SUBTYPE.JID_INTEROP){c=a.user;f=a.device;e=a.integrator;b.writeUint8(v);P(c,b);b.writeUint16(f);b.writeUint16(e)}else{c=a.user;f=a.server;b.writeUint8(A);c!=null?P(c,b):b.writeUint8(q);P(f,b)}}function Q(a,b){if(a.tag===void 0){b.writeUint8(y);b.writeUint8(q);return}var c=1;a.attrs&&(c+=Object.keys(a.attrs).length*2);a.content&&c++;c<256?(b.writeUint8(y),b.writeUint8(c)):c<65536&&(b.writeUint8(z),b.writeUint16(c));P(a.tag,b);a.attrs&&Object.keys(a.attrs).forEach(function(c){U(c,b),P(a.attrs[c],b)});c=a.content;if(Array.isArray(c)){c.length<256?(b.writeUint8(y),b.writeUint8(c.length)):c.length<65536&&(b.writeUint8(z),b.writeUint16(c.length));for(var d=0;d<c.length;d++)Q(c[d],b)}else c&&P(c,b)}var R,S;function T(a){var b=new Map();for(var c=0;c<a.length;c++)b.set(a[c],c);return b}function U(a,b){if(a===""){b.writeUint8(C);b.writeUint8(0);return}R==null&&(R=T(d("WAWapDict").SINGLE_BYTE_TOKEN));var c=R.get(a);if(c!=null){b.writeUint8(c+1);return}if(S==null){S=[];for(c=0;c<d("WAWapDict").DICTIONARIES.length;++c)S.push(T(d("WAWapDict").DICTIONARIES[c]))}for(c=0;c<S.length;++c){var e=S[c].get(a);if(e!=null){b.writeUint8(ca[c]);b.writeUint8(e);return}}e=d("WABinary").numUtf8Bytes(a);if(e<128){c=/[^0-9.-]+?/;var f=/[^0-9A-F]+?/;if(!c.exec(a)){V(a,F,b);return}else if(!f.exec(a)){V(a,B,b);return}}ka(e,b);b.writeString(a)}function V(a,b,d){var e=a.length%2===1;d.writeUint8(b);var f=Math.ceil(a.length/2);e&&(f|=ba);d.writeUint8(f);e=0;for(f=0;f<a.length;f++){var g=a.charCodeAt(f),h=null;48<=g&&g<=57?h=g-48:b===F?g===45?h=10:g===46&&(h=11):b===B&&(65<=g&&g<=70&&(h=g-55));if(h==null)throw c("WAErr")("Cannot nibble encode "+g);else f%2===0?(e=h<<4,f===a.length-1&&(e|=15,d.writeUint8(e))):(e|=h,d.writeUint8(e))}}function ja(a,b){ka(a.length,b),b.writeByteArray(a)}function ka(a,b){if(a<256)b.writeUint8(C),b.writeUint8(a);else if(a<1048576)b.writeUint8(D),b.writeUint8(a>>>16&255),b.writeUint8(a>>>8&255),b.writeUint8(a&255);else if(a<4294967296)b.writeUint8(E),b.writeUint32(a);else throw c("WAErr")("Binary with length "+a+" is too big for WAP protocol")}function la(a,b){a=new(d("WABinary").Binary)(a);var c=a.readUint8();c=c&p;if(c){d("WALogger").LOG(k());return b(a.readByteArray()).then(function(a){return X(new(d("WABinary").Binary)(a))})}return Promise.resolve(X(a))}function ma(a){a=new(d("WABinary").Binary)(a);var b=a.readUint8();b=b&p;if(b)throw c("WAErr")("Cannot pass compressed stanza to decodeStanzaDebug");return X(a)}function W(a,b){var e=a.readUint8();if(e===q)return null;if(e===y)return na(a,a.readUint8());if(e===z)return na(a,a.readUint16());if(e===C){var f=a.readUint8();return Z(a,f,b)}if(e===D){f=a.readUint8();var g=a.readUint8(),h=a.readUint8();f=((f&15)<<16)+(g<<8)+h;return Z(a,f,b)}if(e===E){g=a.readUint32();return Z(a,g,b)}if(e===A)return pa(a);if(e===w)return qa(a);if(e===v)return ra(a);if(e===x)return sa(a);if(e===F){h=a.readUint8();f=h>>>7;g=h&127;return ta(a,da,f,g)}if(e===B){b=a.readUint8();h=b>>>7;f=b&127;return ta(a,ea,h,f)}if(e<=0||e>=240)throw c("WAErr")("Unable to decode WAP buffer");if(e>=r&&e<=u){g=e-r;b=d("WAWapDict").DICTIONARIES[g];if(b===void 0)throw c("WAErr")("Missing WAP dictionary "+g);h=a.readUint8();f=b[h];if(f===void 0)throw c("WAErr")("Invalid value index "+h+" in dict "+g);return f}a=d("WAWapDict").SINGLE_BYTE_TOKEN[e-1];if(a===void 0)throw c("WAErr")("Undefined token with index "+e);return a}function na(a,b){var c=[];for(var d=0;d<b;d++)c.push(X(a));return c}function X(a){var b=a.readUint8(),e;if(b===y)e=a.readUint8();else if(b===z)e=a.readUint16();else throw c("WAErr")("Failed to decode node since type byte "+String(b)+" is invalid");b=void 0;var f=null;if(e===0)throw c("WAErr")("Failed to decode node, list cannot be empty");var g=Y(a);e-=1;while(e>1){b||(b={});var h=Y(a),i=W(a,!0);b[h]=i;e-=2}e===1&&(f=W(a,!1),f instanceof d("WAWapJid").WapJid&&(f=String(f)),typeof f==="string"&&(f=ga.encode(f)));return new N(g,b,f)}function Y(a){a=W(a,!0);if(typeof a!=="string"){d("WALogger").DEV(j(),String(a));throw c("WAErr")("WAWap:decodeString got invalid value, string expected")}return a}function oa(a){a=W(a,!0);if(a!=null&&typeof a!=="string"){d("WALogger").DEV(i(),String(a));throw c("WAErr")("WAWap:decodeNullableString got invalid value, string expected")}return a}function pa(a){var b=oa(a);a=Y(a);return d("WAWapJid").WapJid.create(b,a)}function qa(a){var b=Y(a),c=a.readUint16();Y(a);return d("WAWapJid").WapJid.createFbJid(b,c)}function ra(a){var b=Y(a),c=a.readUint16(),e=a.readUint16();Y(a);return d("WAWapJid").WapJid.createInteropJid(b,c,e)}function sa(a){var b=null,e=a.readUint8();if(e===0)b=d("WAWapJid").DomainType.WHATSAPP;else if(e===1)b=d("WAWapJid").DomainType.LID;else if((1&e)===0&&(128&e)!==0)b=d("WAWapJid").DomainType.HOSTED;else if(e===129)b=d("WAWapJid").DomainType.HOSTED_LID;else throw c("WAErr")("decodeJidU - Invalid domain type encoding "+e);e=a.readUint8();a=Y(a);return d("WAWapJid").WapJid.createJidU(a,b,e)}function Z(a,b,c){c===void 0&&(c=!1);if(c)return a.readString(b);else return a.readByteArray(b)}function ta(a,b,c,d){d=new Array(d*2-c);for(var e=0;e<d.length-1;e+=2){var f=a.readUint8();d[e]=b[f>>>4];d[e+1]=b[f&15]}if(c){f=a.readUint8();d[d.length-1]=b[f>>>4]}return d.join("")}function ua(){if(!G){var a=new Uint16Array(2);d("WACryptoDependencies").getCrypto().getRandomValues(a);G=String(a[0])+"."+String(a[1])+"-"}return""+G+fa++}function va(a){switch(a.type){case"group":return a.groupJid;case"status":return d("WAJids").STATUS_JID;case"device":return a.deviceJid;case"newsletter":return a.newsletterJid;case"hosted":return a.hostedDeviceJid;case"hostedLid":return a.hostedLidDeviceJid;default:a.type;return a.broadcastJid}}function wa(a){switch(a.type){case"group":return a.author;case"status":return a.author;case"broadcast":return a.author;default:a.type;return null}}function xa(a){return a.type==="status"||a.type==="group"||a.type==="broadcast"?$(a.author):H}function ya(a){return $(va(a))}function $(a){var b=d("WAJids").validateDomainJid(a);if(b!=null)return za(b);b=a.split("@");a=b[0];b=b[1];var e=null;if((b===aa||b===l||b===n||b===m||b===o||b===d("WAJids").HOSTED_LID_SUFFIX)&&a.indexOf(":")!==-1){var f=a.split(":");a=f[0];f=f[1];e=parseInt(f,10)}if(b===n){f=a.split("-");var g=f[0];f=f[1];return d("WAWapJid").WapJid.createInteropJid(f,e,parseInt(g,10))}else if(b===l)return d("WAWapJid").WapJid.createFbJid(a,e);f=null;if(b===m)f=d("WAWapJid").DomainType.LID;else if(b===o){if(e!==99)throw c("WAErr")("wid unexpected deviceId");f=d("WAWapJid").DomainType.HOSTED}else if(b===d("WAJids").HOSTED_LID_SUFFIX){if(e!==99)throw c("WAErr")("lid invalid deviceId");f=d("WAWapJid").DomainType.HOSTED_LID}else f=d("WAWapJid").DomainType.WHATSAPP;return e!=null&&e!==0?d("WAWapJid").WapJid.createJidU(a,f,e):d("WAWapJid").WapJid.create(a,b)}function za(a){if(a==="s.whatsapp.net")return J;else if(a==="g.us")return I;else if(a==="newsletter")return K;else return c("WAAssertUnreachable")(a)}function Aa(a){return $(a)}function Ba(a){return $(a)}function Ca(a){return $(a)}function Da(a){return $(a)}function Ea(a){return $(a)}function Fa(a){return $(a)}function Ga(a){if(a.jidType==="phoneDevice")return $(a.deviceJid);else if(a.jidType==="msgrDevice")return $(a.deviceJid);else if(a.jidType==="lidDevice")return $(a.deviceJid);else if(a.jidType==="phoneUser")return $(a.userJid);else if(a.jidType==="msgrUser")return $(a.userJid);else if(a.jidType==="lidUser")return $(a.userJid);else if(a.jidType==="group")return $(a.groupJid);else if(a.jidType==="status")return $(a.statusJid);else if(a.jidType==="call")return $(a.callJid);else if(a.jidType==="interopDevice")return $(a.deviceJid);else if(a.jidType==="interopUser")return $(a.userJid);else if(a.jidType==="newsletter")return $(a.newsletterJid);else if(a.jidType==="hosted")return $(a.hostedDeviceJid);else if(a.jidType==="hostedLid")return $(a.hostedLidDeviceJid);else{a.jidType;return $(a.broadcastJid)}}function Ha(a){return a}function Ia(a){return a.toString()}function Ja(a){return a}function Ka(a){return a==null?H:a}function La(a){return a.toString()}function Ma(a){return d("WALongInt").longIntToDecimalString(a)}function Na(a,b){b===void 0&&(b=4);a=a;var c=new Uint8Array(b);for(b=b-1;b>=0;b--)c[b]=a&255,a>>>=8;return c}g.DROP_ATTR=H;g.G_US=I;g.S_WHATSAPP_NET=J;g.STATUS_BROADCAST=t;g.NEWSLETTER=K;g.HOSTED=h;g.HOSTED_LID=s;g.enableXMLFormat=a;g.WapNode=N;g.makeWapNode=b;g.wap=ha;g.decodeAsString=e;g.makeStanza=O;g.encodeStanza=f;g.decodeStanza=la;g.decodeStanzaDebug=ma;g.generateId=ua;g.extractToJid=va;g.extractParticipantJid=wa;g.PARTICIPANT_JID=xa;g.TO_JID=ya;g.JID=$;g.DOMAIN_JID=za;g.USER_JID=Aa;g.DEVICE_JID=Ba;g.GROUP_JID=Ca;g.BROADCAST_JID=Da;g.CALL_JID=Ea;g.NEWSLETTER_JID=Fa;g.TO_WAP_JID=Ga;g.STANZA_ID=Ha;g.SMAX_ID=Ia;g.CUSTOM_STRING=Ja;g.MAYBE_CUSTOM_STRING=Ka;g.INT=La;g.LONG_INT=Ma;g.BIG_ENDIAN_CONTENT=Na}),98);
__d("WAParsableWapNode",["WABinary","WAErr","WAJids","WALogger","WALongInt","WAParsableXmlNode","WASignalKeys","WATimeUtils","WAWap","WAWapJid"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["ParsableWapNode: attrFromJid() is called with ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["ParsableWapNode: attrFromJid() is called with ",""]);i=function(){return a};return a}var j=function(b){babelHelpers.inheritsLoose(a,b);function a(a,c){var d;d=b.call(this,"XmppParsingFailure: "+a+": "+c)||this;d.name="XmppParsingFailure";d.parser=a;d.reason=c;return d}var c=a.prototype;c.toString=function(){return"XmppParsingFailure: "+this.parser+": "+this.reason};return a}(babelHelpers.wrapNativeSuper(Error));a=function(a){babelHelpers.inheritsLoose(b,a);function b(b,c){return a.call(this,b,c)||this}var e=b.prototype;e.assertFromServer=function(){var a=this.attrString("from");a!==d("WAJids").WA_SERVER_JID_SUFFIX&&this["throw"]('to have "from"="s.whatsapp.net", but instead has "'+a+'"')};e.attrUserJid=function(a){var b=this.attrString(a),c=d("WAJids").interpretAndValidateJid(b);return c.userJid==null?this["throw"]('to have "'+a+'"={UserJid}, but instead has "'+b+'"'):c.userJid};e.attrPhoneUserJid=function(a){var b=this.attrString(a),c=d("WAJids").interpretAndValidateJid(b);return c.jidType==="phoneUser"?c.userJid:this["throw"]('to have "'+a+'"={PhoneUserJid}, but instead has "'+b+'"')};e.attrLidUserJid=function(a){var b=this.attrString(a),c=d("WAJids").interpretAndValidateJid(b);return c.jidType==="lidUser"?c.userJid:this["throw"]('to have "'+a+'"={LidUserJid}, but instead has "'+b+'"')};e.maybeAttrUserJid=function(a){return this.hasAttr(a)?this.attrUserJid(a):null};e.maybeAttrPhoneUserJid=function(a){return this.hasAttr(a)?this.attrPhoneUserJid(a):null};e.maybeAttrLidUserJid=function(a){return this.hasAttr(a)?this.attrLidUserJid(a):null};e.attrGroupJid=function(a){var b=this.attrString(a),c=d("WAJids").interpretAndValidateJid(b);return c.groupJid==null?this["throw"]('to have "'+a+'"={GroupJid}, but instead has "'+b+'"'):c.groupJid};e.maybeAttrGroupJid=function(a){return this.hasAttr(a)?this.attrGroupJid(a):null};e.attrChatJid=function(a){var b=this.attrString(a),c=d("WAJids").interpretAndValidateJid(b);if(c.userJid!=null)return c.userJid;return c.groupJid!=null?c.groupJid:this["throw"]('to have "'+a+'"={ChatJid}, but instead has "'+b+'"')};e.attrPhoneChatJid=function(a){var b=this.attrString(a),c=d("WAJids").interpretAndValidateJid(b);if(c.jidType==="phoneUser")return c.userJid;else if(c.jidType==="group")return c.groupJid;else return this["throw"]('to have "'+a+'"={ChatJid}, but instead has "'+b+'"')};e.attrDeviceJid=function(a){var b=this.attrString(a),c=d("WAJids").interpretAndValidateJid(b);if(c.deviceJid!=null)return c.deviceJid;if(c.userJid!=null)return d("WAJids").defaultDeviceJidForUser(c.userJid);if(c.hostedDeviceJid!=null)return c.hostedDeviceJid;return c.hostedLidDeviceJid!=null?c.hostedLidDeviceJid:this["throw"]('to have "'+a+'"={DeviceJid}, but instead has "'+b+'"')};e.attrPhoneDeviceJid=function(a){var b=this.attrString(a),c=d("WAJids").interpretAndValidateJid(b);if(c.jidType==="phoneDevice")return c.deviceJid;return c.jidType==="phoneUser"?d("WAJids").defaultPhoneDeviceJidForUser(c.userJid):this["throw"]('to have "'+a+'"={PhoneDeviceJid}, but instead has "'+b+'"')};e.attrLidDeviceJid=function(a){var b=this.attrString(a),c=d("WAJids").interpretAndValidateJid(b);if(c.jidType==="lidDevice")return c.deviceJid;return c.jidType==="lidUser"?d("WAJids").defaultLidDeviceJidForLidUserJid(c.userJid):this["throw"]('to have "'+a+'"={LidDeviceJid}, but instead has "'+b+'"')};e.attrDeviceId=function(a){a=this.attrInt(a);return d("WAJids").interpretAsDeviceId(a)};e.attrFromJidChat=function(){var a=this.attrJidWithType();switch(a.jidType){case"msgrUser":var b=a.userJid,e=d("WAJids").defaultDeviceJidForUser(b);return{type:"device",chat:b,deviceJid:e,author:e};case"interopUser":b=a.userJid;e=d("WAJids").defaultDeviceJidForUser(b);return{type:"device",chat:b,deviceJid:e,author:e};case"phoneUser":b=a.userJid;e=d("WAJids").defaultDeviceJidForUser(b);return{type:"device",chat:b,deviceJid:e,author:e};case"lidUser":b=a.userJid;e=d("WAJids").defaultLidDeviceJidForLidUserJid(b);return{type:"device",chat:b,deviceJid:e,author:e};case"phoneDevice":b=a.deviceJid;return{type:"device",chat:d("WAJids").extractUserJid(b),deviceJid:b,author:b};case"msgrDevice":e=a.deviceJid;return{type:"device",chat:d("WAJids").extractUserJid(e),deviceJid:e,author:e};case"interopDevice":b=a.deviceJid;return{type:"device",chat:d("WAJids").extractUserJid(b),deviceJid:b,author:b};case"lidDevice":e=a.deviceJid;return{type:"device",chat:d("WAJids").extractUserJid(e),deviceJid:e,author:e};case"group":b=this.hasAttr("participant")?this.attrDeviceJid("participant"):null;return b==null?this["throw"]("expected to have participant JID for group"):{type:"group",chat:a.groupJid,groupJid:a.groupJid,author:b};case"broadcast":e=this.hasAttr("participant")?this.attrDeviceJid("participant"):null;return e==null?this["throw"]("expected to have participant JID for group"):{type:"broadcast",broadcastJid:a.broadcastJid,chat:d("WAJids").extractUserJid(e),author:e};case"hosted":b=a.hostedDeviceJid;return{type:"device",chat:d("WAJids").extractUserJid(b),deviceJid:b,author:b};case"hostedLid":e=a.hostedLidDeviceJid;return{type:"device",chat:d("WAJids").extractUserJid(e),deviceJid:e,author:e};case"call":d("WALogger").ERROR(i(),a.callJid);throw c("WAErr")("ParsableWapNode: attrFromJid() does not support CallJid");default:a.jidType;return this["throw"]("attrFromJidChat should not be used with jid of type "+a.jidType)}};e.attrFromJidPhoneChat=function(){var a=this.attrJidWithType();switch(a.jidType){case"phoneUser":var b=a.userJid,e=d("WAJids").defaultPhoneDeviceJidForUser(b);return{type:"device",chat:b,deviceJid:e,author:e};case"phoneDevice":b=a.deviceJid;return{type:"device",chat:d("WAJids").extractPhoneUserJid(b),deviceJid:b,author:b};case"group":e=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return e==null?this["throw"]("expected to have participant JID for group"):{type:"group",chat:a.groupJid,groupJid:a.groupJid,author:e};case"broadcast":b=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return b==null?this["throw"]("expected to have participant JID for group"):{type:"broadcast",broadcastJid:a.broadcastJid,chat:d("WAJids").extractPhoneUserJid(b),author:b};case"call":d("WALogger").ERROR(h(),a.callJid);throw c("WAErr")("ParsableWapNode: attrFromJid() does not support CallJid");default:a.jidType;return this["throw"]("attrFromJidChat should not be used with jid of type "+a.jidType)}};e.attrFromPhoneJid=function(){var a=this.attrJidWithType();if(a.jidType==="status"){a=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return a==null?this["throw"]("to have participant for status msg"):{type:"status",author:a}}else return this.attrFromJidPhoneChat()};e.attrFromJid=function(){var a=this.attrJidWithType();if(a.jidType==="status"){var b=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return b==null?this["throw"]("to have participant for status msg"):{type:"status",author:b}}if(a.jidType==="newsletter")return{type:"newsletter",newsletterJid:a.newsletterJid};if(a.jidType==="hosted")return{type:"hosted",hostedDeviceJid:a.hostedDeviceJid};return a.jidType==="hostedLid"?{type:"hostedLid",hostedLidDeviceJid:a.hostedLidDeviceJid}:this.attrFromJidChat()};e.attrJidWithType=function(a){a===void 0&&(a="from");var b=this.attrString(a),c=d("WAJids").interpretAndValidateJid(b);return c.jidType==="unknown"?this["throw"]('to have "'+a+'"={Jid}, but instead has "'+b+'"'):c};e.attrWapJid=function(a){a===void 0&&(a="from");a=this.attrString(a);var b=d("WAJids").interpretAndValidateJid(a);return b.jidType==="unknown"?d("WAWapJid").WapJid.create(null,a):d("WAWap").JID(d("WAJids").extractFromJid(b))};e.attrLongInt=function(a){a=this.attrString(a);return d("WALongInt").decimalStringToLongInt(a)};e.attrTime=function(a){return d("WATimeUtils").castToUnixTime(this.attrInt(a))};e.attrFutureTime=function(a){a=this.attrInt(a);return d("WATimeUtils").futureUnixTime(a)};e.contentString=function(){if(this.hasChildren())return this["throw"]("to have string content, but has children instead");else if(this.hasContent()){var a=new(d("WABinary").Binary)(this.contentBytes());return a.readString(a.size())}else return this["throw"]("to have content")};e.decodeAsString=function(a){return d("WAWap").decodeAsString(a)};e.contentSerializedPubKey=function(){if(this.hasContent())return d("WASignalKeys").serializeIdentity(this.contentBytes());else return this["throw"]("to have content")};e.createParseError=function(a){return new j(this.name(),"expected <"+this.tag()+"> "+a)};e["throw"]=function(a){throw this.createParseError(a)};return b}(d("WAParsableXmlNode").ParsableXmlNode);g.XmppParsingFailure=j;g.ParsableWapNode=a}),98);
__d("WADeprecatedWapParser",["WAErr","WAParsableWapNode"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,b){this.$1=a,this.$2=b}var b=a.prototype;b.parse=function(a){a=new(d("WAParsableWapNode").ParsableWapNode)(this.$1,a);try{return{success:this.$2(a)}}catch(a){if(a instanceof d("WAParsableWapNode").XmppParsingFailure)return{error:a};else throw a}};b.parseOrThrow=function(a){a=this.parse(a);if(a.error)throw c("WAErr")(String(a.error));return a.success};return a}();g["default"]=a}),98);
__d("WAAckParser",["WADeprecatedWapParser","WAJids"],(function(a,b,c,d,e,f,g){"use strict";b=new(c("WADeprecatedWapParser"))("ack",function(a){a.assertTag("ack");return{id:a.attrString("id"),ts:a.maybeAttrString("t"),"class":a.attrString("class"),type:a.maybeAttrString("type"),from:a.attrJidWithType(),participant:a.hasAttr("participant")?a.attrDeviceJid("participant"):null,recipient:a.hasAttr("recipient")?a.attrUserJid("recipient"):null}});function a(a,b){return a.id===b.id&&(b["class"]===void 0||a["class"]===b["class"])&&(b.type===void 0||a.type===b.type)&&(b.from===void 0||h(a.from,b.from))&&(b.participant===void 0||a.participant===b.participant)&&(b.recipient===void 0||a.recipient===b.recipient)&&(b.ts===void 0||a.ts===b.ts)}function h(a,b){if(d("WAJids").extractFromJid(a)===b)return!0;if(a.userJid!=null)return d("WAJids").defaultDeviceJidForUser(a.userJid)===b;if(a.deviceJid!=null){a=a.deviceJid;return d("WAJids").extractDeviceId(a)===0&&d("WAJids").extractUserJid(a)===b}return!1}g.AckParser=b;g.ackMatchesTemplate=a;g.fromJidsAreEqual=h}),98);
__d("WAArrayUtils",["regeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";var g=b("regeneratorRuntime").mark(c);function a(a,b){var c=a.pop();b<a.length&&(a[b]=c)}function c(a,c){var d;return b("regeneratorRuntime").wrap(function(b){while(1)switch(b.prev=b.next){case 0:d=0;case 1:if(!(d<a.length)){b.next=7;break}b.next=4;return a.slice(d,d+c);case 4:d+=c;b.next=1;break;case 7:case"end":return b.stop()}},g,this)}f.removeIndexWithoutPreservingOrder=a;f.peekEvery=c}),66);
__d("WAErrors",["WACustomError"],(function(a,b,c,d,e,f,g){"use strict";b=(a=d("WACustomError")).customError("BufferTooLarge",!1);c=a.customError("Disconnected",!1);e=a.customError("Offline",!1,c);f=a.customError("MaxRetries",!1);g.BufferTooLargeError=b;g.Disconnected=c;g.Offline=e;g.MaxRetries=f}),98);
__d("WANotifyConnectionChangeFactory",[],(function(a,b,c,d,e,f){"use strict";var g=15e3;function a(a,b,c){c===void 0&&(c=g);var d={timeoutID:null,connectionStatus:"disconnected",optimismLevel:"optimist"},e=function(){var a=d.optimismLevel,e=d.connectionStatus;a==="optimist"?d.timeoutID=setTimeout(function(){d.optimismLevel="realist",b(e)},c):b(e)};return function(c){d.connectionStatus=c,c==="disconnected"?e():c==="in_handshake"?e():(c,d.timeoutID!=null&&(clearTimeout(d.timeoutID),d.timeoutID=null),b(c)),a(c)}}f.notifyConnectionChangeFactory=a}),66);
__d("WAPromiseBackoffs",["Promise","WAErr"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){if(a===0)return 0;var c=o(b.algo);for(var d=1;d<a;d++)c();return j(b,c())}function i(a){var b=a.relativeDelay,c=b===void 0?!1:b,d=null,e=o(a.algo);return function(){var b=d;if(b==null){d=c?Date.now():0;return 0}var f=j(a,e());if(c){var g=Date.now();b=g-b;b>0&&(f=Math.max(0,f-b));d=g}return f}}function d(a){var c=i(a);return function(a){return new(h||(h=b("Promise")))(function(b){var d=c();d>0?setTimeout(b,d,a):b(a)})}}function j(a,b){var c=a.max,d=a.min;a=a.jitter;a=a===void 0?.1:a;b=b;c!=null&&b>c&&(b=c);d!=null&&b<d&&(b=d);a!==0&&(b=Math.ceil(b*(1+a*Math.random())));return b}function k(a){var b=a.second-a.first,c=a.first-b;return function(){var a=b+c;c=b;b=a;return a}}function l(a){var b=a.base,c=b===void 0?2:b,d=a.first;return function(){var a=d;d*=c;return a}}function m(a){var b=a.delay;return function(){return b}}function n(a){var b=a.toMs;a=a.backoff;var c=o(a);return function(){return b(c())}}function o(a){switch(a.type){case"fibonacci":return k(a);case"exponential":return l(a);case"constant":return m(a);case"adjust":return n(a);default:a;throw c("WAErr")("makeTimeFunc unrecognized backoff "+a.type)}}g.getDelay=a;g.createTimer=i;g.createPromiseTimer=d}),98);
__d("WAPromiseRetryLoop",["Promise","WAErr","WALogger","WAPromiseBackoffs","WAPromiseDelays","WAResolvable"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["PromiseRetryLoop: retrying "," in ","ms"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["PromiseRetryLoop: resetting ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["PromiseRetryLoop was called several times. You may have race conditions"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["PromiseRetryLoop: starting ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["PromiseRetryLoop: resetting ",""]);m=function(){return a};return a}a=function(){function a(a){var b=this;this.$2=new(d("WAResolvable").Resolvable)();this.$3=null;this.$4=null;this.$5=0;this.endWithValue=function(a){b.$5++,b.$2.resolve(a)};this.$1=a}var e=a.prototype;e.resetTimeoutAfter=function(a){this.$4=Date.now()+a};e.cancelReset=function(){this.$4=null};e.reset=function(){if(this.$2.resolveWasCalled())return;d("WALogger").LOG(m(),this.$1.name);this.$5++;this.$6()};e.start=function(){if(this.$2.resolveWasCalled())return;d("WALogger").LOG(l(),this.$1.name);this.$5!==0&&d("WALogger").ERROR(k());this.$5++;this.$6()};e.$6=function(){var a=this,c=this.$1,e=this.$5,f=d("WAPromiseBackoffs").createTimer(this.$1.timer);f();var g=function b(){if(a.$2.resolveWasCalled())return;if(e!==a.$5)return;var g=Date.now();a.$3=c.code(a.endWithValue).then(function(){if(a.$2.resolveWasCalled())return;var e=c.resetDelay;(e!==void 0&&Date.now()>=g+e||a.$4!=null&&a.$4<=Date.now())&&(d("WALogger").LOG(j(),c.name),f=d("WAPromiseBackoffs").createTimer(a.$1.timer));a.$4=null;e=f();d("WALogger").LOG(i(),c.name,e);return d("WAPromiseDelays").delayMs(e).then(b)});return a.$3};this.$3=(h||(h=b("Promise"))).resolve().then(g)};e.promise=function(){var a=this;if(this.$2.resolveWasCalled())return this.$2.promise;return!this.$3?(h||(h=b("Promise"))).reject(c("WAErr")("PromiseRetryLoop "+this.$1.name+" had promise() called before start()")):(h||(h=b("Promise"))).race([this.$2.promise,this.$3.then(function(){return a.$2.promise})])};return a}();g.PromiseRetryLoop=a}),98);
__d("WASmaxInPingsEnums",["WAJids"],(function(a,b,c,d,e,f,g){a={validators:[d("WAJids").validateDomainJid,d("WAJids").validateUserJid],typeName:"DomainJid|UserJid"};g.DOMAINJID_USERJID=a}),98);
__d("WADeepEquals",[],(function(a,b,c,d,e,f){"use strict";function g(a,b){if(a===b)return!0;if(!a||!b||typeof a!=="object"&&typeof b!=="object")return!1;var c=Array.isArray(a),d=Array.isArray(b);if(c!==d)return!1;d=!0;if(c){c=a.length;if(c!==b.length)return!1;for(var e=0;d&&e<c;e++)d=g(a[e],b[e]);return d}c=Object.keys(a);for(e=0;d&&e<c.length;e++){var f=c[e];d=b.propertyIsEnumerable(f)&&g(a[f],b[f])}return d&&Object.keys(b).length===c.length}f.deepEqual=g}),66);
__d("WASmaxParseUtils",["WABase64","WABinary","WACryptoUtils","WADeepEquals","WAHasProperty","WAResultOrError","WAStanzaUtils","WAWapJid"],(function(a,b,c,d,e,f,g){"use strict";var h=d("WAResultOrError").makeResult();function a(a,b){return a.tag!==b?H(a,"to be <"+b+">"):h}function i(a,b){return!I(a,b)?H(a,'to have attribute "'+b+'"'):J(a,a.attrs[b])}function j(a,b,c,e){var f=i(a,b);if(!f.success)return f;c=c(f.value);return c!=null?d("WAResultOrError").makeResult(c):H(a,'to have "'+b+'"={'+e+'}, but instead has "'+f.value+'"')}function k(a,b,c){var e=B(a);if(!e.success)return e;b=b(e.value);return b!=null?d("WAResultOrError").makeResult(b):H(a,"to have "+c+' content, but instead has "'+e.value+'"')}function b(a,b,c){var d=i(a,b);if(!d.success)return d;else if(d.value!==c)return H(a,'to have "'+b+'"="'+c+'", but instead has "'+d.value+'"');return h}function e(a,b){return j(a,b,d("WAStanzaUtils").toStanzaId,"stanzaID")}function l(a,b){return j(a,b,K,"integer")}function f(a,b,c,e){var f=l(a,b);if(!f.success)return f;f=f.value;if(c!==void 0&&f<c)return H(a,'to have "'+b+'"={at least '+c+"} but has value "+f);else if(e!==void 0&&f>e)return H(a,'to have "'+b+'"={at most '+e+"} but has value "+f);return d("WAResultOrError").makeResult(f)}function m(a){var b=a.content;return b instanceof Uint8Array?H(a,"to have children"):d("WAResultOrError").makeResult(b)}function n(a,b){var c=m(a);if(!c.success)return c;c=c.value;if(c==null)return h;var e=null;for(var f=0;f<c.length;f++){var g=c[f];if(g.tag===b){if(e!=null)return H(a,"to have 1 child <"+b+">, but found more than 1");e=g}}return d("WAResultOrError").makeResult(e)}function o(a,b,c){a=n(a,b);if(!a.success)return a;return a.value==null?h:c(a.value)}function p(a,b,c){c=o(a,b,c);if(!c.success)return c;c=c.value;return c==null?H(a,"to have 1 child <"+b+">, but found 0"):d("WAResultOrError").makeResult(c)}function q(a,b){var c=n(a,b);if(!c.success)return c;return c.value==null?H(a,"to have 1 child <"+b+">, but found 0"):d("WAResultOrError").makeResult(c.value)}function r(a,b,c,e,f){a=L(a,b,c,e);if(!a.success)return a;b=[];for(c=0;c<a.value.length;c++){e=f(a.value[c]);if(!e.success)return e;b.push(e.value)}return d("WAResultOrError").makeResult(b)}function s(a,b,c,e,f){a=L(a,b,c,e);if(!a.success)return a;b=a.value.length;for(c=0;c<b;c++){e=f(a.value[c]);if(!e.success)return e}return d("WAResultOrError").makeResult(b)}function t(a,b,c){b=r(a,b,0,Infinity,c);if(!b.success)return b;for(c=0;c<b.value.length;c++)if(!d("WADeepEquals").deepEqual(b.value[0],b.value[c]))return H(a,"to have homogeneous children, but found two children that are not equal");return b}function u(a,b,c){a=t(a,b,c);return!a.success?a:d("WAResultOrError").makeResult(a.value.length)}function v(a,b,c,d,e){return I(b,c)?a(b,c,d,e):h}function w(a,b,c,e){if(e==null)return h;a=v(a,b,c);if(!a.success)return a;if(a.value===e)return d("WAResultOrError").makeResult(e);return a.value==null?h:H(b,'to have "'+c+'"={'+e+'}, but instead has "'+a.value+'"')}function x(a,b,c,e){a=a(b,c);if(!a.success)return a;return a.value===e?d("WAResultOrError").makeResult(e):H(b,'to have "'+c+'"={'+e+'}, but instead has "'+a.value+'"')}function y(a,b,c){a=a(b);if(!a.success)return a;return a.value===c?d("WAResultOrError").makeResult(c):H(b,'to have content "'+c+'", but instead has "'+a.value+'"')}function z(a,b,c){var e=i(a,b);if(!e.success)return e;var f=c[e.value];if(f!=null)return d("WAResultOrError").makeResult(f);f=Object.values(c).join("|");return H(a,'to have "'+b+'"={'+f+'}, but instead has "'+e.value+'"')}function A(a,b){var c=B(a);if(!c.success)return c;var e=b[c.value];if(e!=null)return d("WAResultOrError").makeResult(e);e=Object.values(b).join("|");return H(a,'to have content "'+e+'", but instead has "'+c.value+'"')}function B(a){var b=C(a);if(!b.success)return b;else try{b=new(d("WABinary").Binary)(b.value);b=b.readString(b.size());return d("WAResultOrError").makeResult(b)}catch(b){return H(a,"to have string content, but run into decoding error: "+b.message)}}function C(a){var b=a.content;if(b==null)return H(a,"to have content");else if(Array.isArray(b))return H(a,"to have content, but has children instead");else return d("WAResultOrError").makeResult(b)}function D(a,b){var c=C(a);if(!c.success)return c;return d("WACryptoUtils").uint8ArraysEqual(c.value,b)?d("WAResultOrError").makeResult(b):H(a,'to have content ":binary:'+d("WABase64").encodeB64(b)+'", but instead has ":binary:'+d("WABase64").encodeB64(c.value)+'"')}function E(a,b,c){var e=a.content;if(e==null)if(b===void 0||b<1)return d("WAResultOrError").makeResult(new Uint8Array([]));else return H(a,"to have content");else if(Array.isArray(e))return H(a,"to have content, but has children instead");else{var f=e.length;if(b!==void 0&&f<b)return H(a,"to have binary content at least "+b+" bytes but has "+f+" bytes");else if(c!==void 0&&f>c)return H(a,"to have binary content at most "+c+" bytes but has "+f+" bytes");return d("WAResultOrError").makeResult(e)}}function F(a){return k(a,K,"integer")}function G(a){return a}function H(a,b){return d("WAResultOrError").makeError("expected <"+a.tag+">: "+b)}function I(a,b){return c("WAHasProperty")(a.attrs,b)}function J(a,b){if(b instanceof d("WAWapJid").WapJid)return d("WAResultOrError").makeResult(b.toString());return typeof b==="string"?d("WAResultOrError").makeResult(b):H(a,"decodeAsString: attribute is "+typeof b+" not a string: "+String(b))}function K(a){a=parseInt(a,10);return Number.isNaN(a)?null:a}function L(a,b,c,e){var f=m(a);if(!f.success)return f;f=f.value;if(f==null)if(c!==0)return H(a,"to have at least "+c+" <"+b+"> children, but found 0");else return d("WAResultOrError").makeResult([]);var g=[];for(var h=0;h<f.length;h++){var i=f[h];i.tag===b&&g.push(i)}i=g.length;if(i<c)return H(a,"to have at least "+c+" <"+b+"> children, but found "+i);else if(i>e)return H(a,"to have at most "+e+" <"+b+"> children, but found "+i);return d("WAResultOrError").makeResult(g)}var M={};function N(a,b,c){var d=b.map(function(a,b){return a+": "+c[b].error});return H(a,["to match any of following mixins: "+b.join(", ")+", but all mixins failed."].concat(d).join(" "))}g.voidSuccess=h;g.assertTag=a;g.attrString=i;g.attrValidate=j;g.contentValidate=k;g.assertAttr=b;g.attrStanzaId=e;g.attrInt=l;g.attrIntRange=f;g.maybeChildren=m;g.optionalChild=n;g.optionalChildWithTag=o;g.childWithTag=p;g.flattenedChildWithTag=q;g.mapChildrenWithTag=r;g.countChildrenWithTag=s;g.mapHomogeneousChildrenWithTag=t;g.countHomogeneousChildrenWithTag=u;g.optional=v;g.optionalLiteral=w;g.literal=x;g.literalContent=y;g.attrStringEnum=z;g.contentStringEnum=A;g.contentString=B;g.contentBytes=C;g.contentLiteralBytes=D;g.contentBytesRange=E;g.contentInt=F;g.identity=G;g.errorMessage=H;g.emptyObject=M;g.errorMixinDisjunction=N}),98);
__d("WASmaxParseJid",["WAJids","WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("WASmaxParseUtils").attrValidate(a,b,d("WAJids").validateUserJid,"UserJid")}function b(a,b){return d("WASmaxParseUtils").attrValidate(a,b,d("WAJids").validateDeviceJid,"DeviceJid")}function c(a,b){return d("WASmaxParseUtils").attrValidate(a,b,d("WAJids").validateGroupJid,"GroupJid")}function e(a,b){return d("WASmaxParseUtils").attrValidate(a,b,d("WAJids").validateCallJid,"CallJid")}function f(a,b){return d("WASmaxParseUtils").attrValidate(a,b,d("WAJids").validateDomainJid,"DomainJid")}function h(a,b){return d("WASmaxParseUtils").attrValidate(a,b,d("WAJids").validateBroadcastJid,"BroadcastJid")}function i(a,b){return d("WASmaxParseUtils").attrValidate(a,b,d("WAJids").validateStatusJid,"StatusJid")}function j(a,b){return d("WASmaxParseUtils").attrValidate(a,b,d("WAJids").validateNewsletterJid,"NewsletterJid")}function k(a,b,c){var e=d("WASmaxParseUtils").attrString(a,b);if(!e.success)return e;var f=c.validators;c=c.typeName;for(var g=0;g<f.length;g++){var h=f[g](e.value);if(h!=null)return d("WAResultOrError").makeResult(h)}return d("WASmaxParseUtils").errorMessage(a,'to have "'+b+'"={'+c+'}, but instead has "'+e.value+'"')}function l(a,b,c,e){a=a(b,c);if(!a.success)return a;return a.value===e?a:d("WASmaxParseUtils").errorMessage(b,'to have "'+c+'"={'+e+'}, but instead has "'+a.value+'"')}function m(a,b,c,e){a=d("WASmaxParseUtils").optional(a,b,c);if(!a.success)return a;return a.value==null||a.value===e?a:d("WASmaxParseUtils").errorMessage(b,'to have "'+c+'"={'+e+'}, but instead has "'+a.value+'"')}g.attrUserJid=a;g.attrDeviceJid=b;g.attrGroupJid=c;g.attrCallJid=e;g.attrDomainJid=f;g.attrBroadcastJid=h;g.attrStatusJid=i;g.attrNewsletterJid=j;g.attrJidEnum=k;g.literalJid=l;g.optionalLiteralJid=m}),98);
__d("WASmaxParseReference",["WAHasProperty","WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,c,d,e){b=j(b,c);if(!b.success)return l(b);a=a(b.value,c[c.length-1],d,e);return!a.success?l(a):a}function a(a,b,c,e,f){return k(b,c)?h(a,b,c,e,f):d("WASmaxParseUtils").voidSuccess}function i(a,b){return h(d("WASmaxParseUtils").attrString,a,b)}function b(a,b){return k(a,b)?i(a,b):d("WASmaxParseUtils").voidSuccess}function e(a,b){a=j(a,b);if(!a.success)return l(a);b=d("WASmaxParseUtils").contentString(a.value);return!b.success?l(b):b}function j(a,b){var c=b.length;a=a;for(var e=0;e<c-1;e++){var f=b[e];f=d("WASmaxParseUtils").flattenedChildWithTag(a,f);if(!f.success)return f;a=f.value}return d("WAResultOrError").makeResult(a)}function k(a,b){a=j(a,b);return a.success&&c("WAHasProperty")(a.value.attrs,b[b.length-1])}function l(a){return d("WAResultOrError").makeError("in the reference, "+a.error)}g.attrFromReference=h;g.optionalAttrFromReference=a;g.attrStringFromReference=i;g.optionalAttrStringFromReference=b;g.contentStringFromReference=e}),98);
__d("WASmaxInPingsClientResponseServerResponse",["WAResultOrError","WASmaxInPingsEnums","WASmaxParseJid","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseJid").attrJidEnum(a,"from",d("WASmaxInPingsEnums").DOMAINJID_USERJID);if(!c.success)return c;var e=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");if(!e.success)return e;b=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",b.value);if(!b.success)return b;b=d("WASmaxParseUtils").attrInt(a,"t");return!b.success?b:d("WAResultOrError").makeResult({from:c.value,type:e.value,t:b.value})}g.parseClientResponseServerResponse=a}),98);
__d("WASmaxJsx",["WAWap"],(function(a,b,c,d,e,f,g){"use strict";g.smax=d("WAWap").wap}),98);
__d("WASmaxMixins",["WAArrayBufferUtils","WAWapJid"],(function(a,b,c,d,e,f,g){"use strict";var h="smax$any";function i(a,b){j(a,b);k(a,b);b.content instanceof Uint8Array?m(a,b.content):b.content!=null&&n(a,b.content);return a}function a(a,b,c,d){return c!=null?a(b,c,d):b}function j(a,b){a=a.tag;b=b.tag;if(b===h)return;if(a!==b)throw new Error("tag mismatch: "+a+" != "+b)}function k(a,b){var c=a.attrs,d=b.attrs;Object.keys(d).forEach(function(a){var b=d[a],e=c[a];if(b!=null&&e!=null){if(l(b,e))return;throw new Error("conflict for key: "+a)}c[a]=b})}function l(a,b){if(typeof a==="string"&&typeof b==="string")return a===b;return a instanceof d("WAWapJid").WapJid&&b instanceof d("WAWapJid").WapJid?a.toString()===b.toString():!1}function m(a,b){var c=a.content;if(c instanceof Uint8Array){if(!d("WAArrayBufferUtils").uint8ArraysEqualUNSAFE(c,b))throw new Error("elementValue mismatch: bytes dose not equal");return}if(c!=null)throw new Error("elementValue mismatch: destination has children");a.content=b}function n(a,b){var c=a.content;if(c instanceof Uint8Array)throw new Error("children mismatch: destination has element value");if(c==null||c.length===0){a.content=b;return}if(!o(c,b))throw new Error("children mismatch: child counts are not compatible");var d=[],e=Array.from(c);b.forEach(function(a){var b=e.findIndex(function(b){return b.tag===a.tag});if(b===-1)d.push(a);else{b=e.splice(b,1);b=i(b[0],a);d.push(b)}});e.forEach(function(a){return d.push(a)});a.content=d}function o(a,b){b=p(b);a=p(a);var c=Object.keys(b);for(var d=0;d<c.length;d++){var e=c[d],f=b[e];e=a[e];if(f!=null&&e!=null&&f!==e)return!1}return!0}function p(a){return a.reduce(function(a,b){b=b.tag;var c=a[b];a[b]=c==null?1:c+1;return a},{})}g.mergeStanzas=i;g.optionalMerge=a}),98);
__d("WASmaxOutPingsClientWellFormedToMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{to:d("WAWap").S_WHATSAPP_NET});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeClientWellFormedToMixin=a}),98);
__d("WASmaxOutPingsClientRequest",["WASmaxJsx","WASmaxOutPingsClientWellFormedToMixin","WAWap"],(function(a,b,c,d,e,f,g){function a(){var a=d("WASmaxOutPingsClientWellFormedToMixin").mergeClientWellFormedToMixin(d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),type:"get",xmlns:"w:p"}));return a}g.makeClientRequest=a}),98);
__d("WAComms",["Promise","WAArrayUtils","WAErr","WAErrors","WALogger","WANotifyConnectionChangeFactory","WAPromiseRetryLoop","WAResolvable","WAResultOrError","WAShiftTimer","WASmaxInPingsClientResponseServerResponse","WASmaxOutPingsClientRequest","WASmaxParseUtils","WATimeUtils","WAWap","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms has no open socket"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: closeSocket called"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: Socket "," closed"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: socketLoopIteration failed ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: socketLoopIteration socket closed while in noise handshake"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: socketLoopIteration socket disconnected while in noise handshake"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: socketLoopIteration socket closed while in noise handshake using treasureHunt strategy"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: Socket "," closed"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: Socket "," opened"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: Socket "," opening"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: maybeResetSocketLoop"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: closeSocketAndPreventRetry called"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleAck: unrecognized ",""]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: job response is NO_ACK"]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: job response is CLOSE_SOCKET"]);w=function(){return a};return a}function x(){var a=babelHelpers.taggedTemplateLiteralLoose(["--- Receiving ---\n",""],["--- Receiving ---\\n",""]);x=function(){return a};return a}function y(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failure parsing stanza!"]);y=function(){return a};return a}function z(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms.startHandlingRequests"]);z=function(){return a};return a}function A(){var a=babelHelpers.taggedTemplateLiteralLoose(["castStanza error ",""]);A=function(){return a};return a}function B(){var a=babelHelpers.taggedTemplateLiteralLoose(["castStanza async error ",""]);B=function(){return a};return a}function C(){var a=babelHelpers.taggedTemplateLiteralLoose(["--- Sending ---\n",""],["--- Sending ---\\n",""]);C=function(){return a};return a}function D(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error in onBeforeCastStanza, we consumed and continue with normal stanza sending to the server:\n",""],["Error in onBeforeCastStanza, we consumed and continue with normal stanza sending to the server:\\n",""]);D=function(){return a};return a}function E(){var a=babelHelpers.taggedTemplateLiteralLoose(["Dropping stanza since onBeforeCastStanza matched. We return mock response directly."]);E=function(){return a};return a}function F(){var a=babelHelpers.taggedTemplateLiteralLoose(["--- Receive (via SMAX+E2E) ---\n",""],["--- Receive (via SMAX+E2E) ---\\n",""]);F=function(){return a};return a}function G(){var a=babelHelpers.taggedTemplateLiteralLoose(["Dropping stanza since onBeforeCastStanza matched:\n",". We return mock response directly."],["Dropping stanza since onBeforeCastStanza matched:\\n",". We return mock response directly."]);G=function(){return a};return a}function H(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms has no open socket, will resend stanza when socket opens"]);H=function(){return a};return a}function I(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: No stanzaId in ping request stanza"]);I=function(){return a};return a}function J(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: sendPing ping still pending"]);J=function(){return a};return a}function K(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: sendPing when socket dead"]);K=function(){return a};return a}function L(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: Socket "," expired"]);L=function(){return a};return a}function M(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: testing socket"]);M=function(){return a};return a}function N(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleIq no handler for iq"]);N=function(){return a};return a}function O(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleIq no handler for iq with id ",""]);O=function(){return a};return a}var P=null,Q=null,R=1,S=0,T=function(){function a(a,c,e){var f=this;this.nextSocketId=1;this.pendingIqs=new Map();this.ackHandlers=[];this.pendingSmaxStanzas=new Map();this.$2=new(d("WAResolvable").Resolvable)();this.socketAbortController=null;this.activePing=null;this.$3=new Set();this.socketId=S;this.socket=null;this.softCloseSocket=null;this.handleStanza=function(a,b,c){var e=d("WASmaxParseUtils").attrString(a,"id");if(e.success&&a.tag!=="receipt"){e=e.value;var g=f.pendingSmaxStanzas.get(e);if(g){f.pendingSmaxStanzas["delete"](e);g.resolve(a);f.maybeScheduleHealthCheck();return"NO_ACK"}}e=$(a);if(e!=null){g=f.pendingIqs.get(e);g?(f.pendingIqs["delete"](e),g.resolve(a),f.maybeScheduleHealthCheck()):(d("WALogger").WARN(O(),e),d("WALogger").ERROR(N()))}else if(a.tag==="ack")f.handleAck(a);else return a.tag==="failure"&&f.config.shouldBlockReceivingUntilSuccess?f.$1(a,b,c):f.$2.promise.then(function(){return f.$1(a,b,c)});return"NO_ACK"};this.healthCheckTimer=new(d("WAShiftTimer").ShiftTimer)(function(){d("WALogger").DEV(M());if(!f.socketId)return;f.sendPing()});this.deadSocketTimer=new(d("WAShiftTimer").ShiftTimer)(function(a){d("WALogger").LOG(L(),a);if(a!==f.socketId)return;f.softCloseSocket&&f.softCloseSocket()});this.sendPing=function(){var a,c,e,f,g,i,j,k;return b("regeneratorRuntime").async(function(l){while(1)switch(l.prev=l.next){case 0:a=Z("sendPing");if(a.socketId){l.next=4;break}d("WALogger").LOG(K());return l.abrupt("return",(h||(h=b("Promise"))).resolve());case 4:if(!(a.activePing&&a.activePing.socketId===a.socketId)){l.next=7;break}d("WALogger").LOG(J());return l.abrupt("return",(h||(h=b("Promise"))).resolve());case 7:a.activePing&&a.activePing.handler.resolve();c=d("WASmaxOutPingsClientRequest").makeClientRequest();e=c.attrs.id;if(!(typeof e!=="string")){l.next=13;break}d("WALogger").ERROR(I());return l.abrupt("return",(h||(h=b("Promise"))).resolve());case 13:f=new(d("WAResolvable").Resolvable)();a.activePing={socketId:a.socketId,stanzaId:e,handler:f};a.callStanza(c);l.next=18;return b("regeneratorRuntime").awrap(f.promise);case 18:g=l.sent,g&&(i=d("WASmaxInPingsClientResponseServerResponse").parseClientResponseServerResponse(g,c),i.success&&(j=d("WATimeUtils").castToUnixTime(i.value.t),k=Math.round(Date.now()/1e3-j),a.config.handlers.onClockSkewUpdate==null?void 0:a.config.handlers.onClockSkewUpdate(k)));case 20:case"end":return l.stop()}},null,this)};this.$1=a;this.onConnectionChange=d("WANotifyConnectionChangeFactory").notifyConnectionChangeFactory((a=c.handlers.onConnectionChange)!=null?a:function(){},(a=c.handlers.onOptimisticConnectionChange)!=null?a:function(){});this.gzipInflate=e;this.config=c;this.socketLoop=new(d("WAPromiseRetryLoop").PromiseRetryLoop)({name:"MainSocketLoop",code:W,timer:{jitter:.1,max:c.maxSocketLoopWaitTime,algo:{type:"fibonacci",first:1e4,second:1e4},relativeDelay:!0},resetDelay:3e4})}var e=a.prototype;e.filterPending=function(a){var b=[];function c(c){a(c)&&b.push(c)}this.pendingIqs.forEach(c);this.ackHandlers.forEach(c);this.pendingSmaxStanzas.forEach(c);return b};e.sendPendingStanza=function(a){a.cleanup==null?void 0:a.cleanup(),a.cleanup=void 0,this.callStanza(a.stanza)};e.maybeSendPendingStanza=function(a){if(a.attempt>=this.config.maxRetries)this.config.handlers.onDropStanza==null?void 0:this.config.handlers.onDropStanza(a),a.cleanup==null?void 0:a.cleanup(),a.cleanup=void 0,this.removeHandler(a,"max-retries");else if(this.socket){a.attempt+=1;this.sendPendingStanza(a);return}else d("WALogger").LOG(H())};e.callStanzaAsync=function(a,c){var d;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(this.callStanza(a,c));case 2:d=e.sent;return e.abrupt("return",d);case 4:case"end":return e.stop()}},null,this)};e.callStanza=function(a,b){a=this.castStanza(a,b);this.deadSocketTimer.onOrBefore(this.config.deadSocketTime,this.socketId);this.healthCheckTimer.cancel();return a};e.castStanzaAsync=function(a){var c;return b("regeneratorRuntime").async(function(d){while(1)switch(d.prev=d.next){case 0:d.next=2;return b("regeneratorRuntime").awrap(this.castStanza(a));case 2:c=d.sent;return d.abrupt("return",c);case 4:case"end":return d.stop()}},null,this)};e.castStanza=function(a,c){var e=this;try{var f=this.config.handlers.onBeforeCastStanzaForE2E==null?void 0:this.config.handlers.onBeforeCastStanzaForE2E(a,c);if(f!=null){d("WALogger").DEV_XMPP(G(),a);d("WALogger").DEV_XMPP(F(),f);d("WALogger").ERROR(E());if(Array.isArray(f))return(h||(h=b("Promise"))).all(f.map(function(a){return(h||(h=b("Promise"))).resolve(e.handleStanza(a,e.socketId,S))}));else{this.handleStanza(f,this.socketId,S);return(h||(h=b("Promise"))).resolve()}}}catch(a){d("WALogger").DEV_XMPP(D(),a)}f=this.socketOrThrow("castStanza");try{d("WALogger").DEV_XMPP(C(),a);return f.sendFrame(d("WAWap").encodeStanza(a)).then(function(){e.config.handlers.onCastStanza==null?void 0:e.config.handlers.onCastStanza(a,c)})["catch"](function(a){d("WALogger").ERROR(B(),a).devConsole(a);if(a instanceof d("WAErrors").BufferTooLargeError)return(h||(h=b("Promise"))).reject(a)})}catch(a){d("WALogger").ERROR(A(),a).devConsole(a)}return(h||(h=b("Promise"))).resolve()};e.socketOrThrow=function(a){var b=this.socket;if(b)return b;throw c("WAErr")("Comms."+a+" called while no socket")};e.startHandlingRequests=function(){d("WALogger").LOG(z());this.$2.resolve();return this.$2.promise.then(function(){})};e.parseAndHandleStanza=function(a,b){var c=this;a===this.socketId&&(this.deadSocketTimer.cancel(),Q&&(Q.resolve(),Q=null));var e=d("WAWap").decodeStanza(b,this.gzipInflate)["catch"](function(a){d("WALogger").ERROR(y()).devConsole(b);throw a}).then(function(e){d("WALogger").DEV_XMPP(x(),e);c.config.handlers.onHandleStanza==null?void 0:c.config.handlers.onHandleStanza(e,a,b.byteLength);var f=c.activePing;if(f&&f.socketId===a&&f.stanzaId===$(e)){c.activePing=null;f.handler.resolve(e);c.maybeScheduleHealthCheck();return"NO_ACK"}return c.handleStanza(e,a,b.byteLength)}).then(function(b){if(a!==c.socketId)return;if(b==="CLOSE_SOCKET"){d("WALogger").LOG(w());var e=c.socket;e&&e.close()}else b==="NO_ACK"?d("WALogger").DEV(v()):c.castStanza(b);return"NO_ACK"});this.$3.add(e);e["finally"](function(){return void c.$3["delete"](e)})};e.handleAck=function(a){var b=this.ackHandlers,c=-1,e=null;while(!e&&++c<b.length)e=b[c].parseAndTest(a);if(e){var f=b[c];d("WAArrayUtils").removeIndexWithoutPreservingOrder(b,c);this.config.handlers.onHandleAck==null?void 0:this.config.handlers.onHandleAck(a);f.resolve(e);this.maybeScheduleHealthCheck()}else d("WALogger").WARN(u(),a)};e.removeHandler=function(a,c){c===void 0&&(c="disconnect");if(a.type==="iq"||a.type==="smax"){var e=a.stanza.attrs.id;if(!e||typeof e!=="string")return;if(a.type==="iq"&&!this.pendingIqs["delete"](e)||a.type==="smax"&&!this.pendingSmaxStanzas["delete"](e))return}else{a.type;e=this.ackHandlers.indexOf(a);if(e===-1)return;d("WAArrayUtils").removeIndexWithoutPreservingOrder(this.ackHandlers,e)}c==="disconnect"?a.resolve((h||(h=b("Promise"))).reject(new(d("WAErrors").Disconnected)())):a.resolve((h||(h=b("Promise"))).reject(new(d("WAErrors").MaxRetries)()))};e.maybeScheduleHealthCheck=function(){if(this.healthCheckTimer.isScheduled())return;if(this.activePing||this.ackHandlers.length||this.pendingIqs.size||this.pendingSmaxStanzas.size)return;var a=this.config.healthCheckInterval;a=Math.ceil(a*1e3*(1+Math.random()));this.healthCheckTimer.onOrBefore(a)};return a}();function a(){return P}function e(a,b,c,d){d===void 0&&(d=!0);if(P)return;P=new T(a,b,c);d&&setTimeout(U,0)}function f(){var a=Z("stopComms");a.socketLoop.endWithValue();a.socket&&X();P=null}function aa(){var a=Z("closeSocketAndPreventRetry");a.socketLoop.endWithValue();a.socket&&(d("WALogger").LOG(t()),X())}function U(){Z("openSocketLoop").socketLoop.start()}function ba(){d("WALogger").LOG(s()),V()||Z("maybeResetSocketLoop").socketLoop.reset()}function ca(){Z("forceResetSocketLoop").socketLoop.reset()}function da(){var a,b=Z("socketAbortController");(a=b.socketAbortController)==null?void 0:a.abort();b.softCloseSocket==null?void 0:b.softCloseSocket()}function V(){var a;return!!((a=P)==null?void 0:a.socket)}function W(){var a=Z("socketLoopIteration"),b=a.nextSocketId++;d("WALogger").LOG(r(),b);var c=function(){a.onConnectionChange("in_handshake")};a.config.handlers.onSocketLoopIteration==null?void 0:a.config.handlers.onSocketLoopIteration(a.socketAbortController);typeof AbortController==="function"&&(a.socketAbortController=new AbortController());return a.config.openChatSocket(c,(c=a.socketAbortController)==null?void 0:c.signal).then(d("WAResultOrError").onResult(function(c){a.config.handlers.onSocketOpen==null?void 0:a.config.handlers.onSocketOpen();var e=new(d("WAResolvable").Resolvable)();d("WALogger").LOG(q(),b);a.socketId=b;a.socket=c;a.softCloseSocket=function(){a.softCloseSocket=null,a.socket&&a.config.shouldCloseStaleSocket&&(X(),a.socket=null),e.resolve()};a.socketLoop.resetTimeoutAfter(1e4);a.deadSocketTimer.cancel();a.maybeScheduleHealthCheck();c.setOnFrame(function(c){return a.parseAndHandleStanza(b,c)});c.setOnClose(function(){d("WALogger").LOG(p(),b);a.activePing&&b===a.activePing.socketId&&(a.activePing.handler.resolve(),a.activePing=null);a.filterPending(function(a){return a.attachedToSocketId===b}).forEach(function(b){return void a.removeHandler(b)});if(b!==a.socketId)return;a.socketId=S;a.socket=null;a.onConnectionChange("disconnected");a.config.handlers.onDisconnect==null?void 0:a.config.handlers.onDisconnect();e.resolve()});a.onConnectionChange("connected");a.config.handlers.onConnect==null?void 0:a.config.handlers.onConnect();a.filterPending(function(a){return!a.attachedToSocketId}).sort(function(a,b){return a.orderedId-b.orderedId}).forEach(function(b){switch(b.type){case"smax":case"iq":a.maybeSendPendingStanza(b);break;case"ack":a.callStanza(b.stanza);break;default:b.type;break}});return e.promise})).then(d("WAResultOrError").catchError(function(a){switch(a){case"max-hunters":d("WALogger").WARN(o());break;case"disconnected":d("WALogger").WARN(n());break;default:a;return}}))["catch"](function(a){a instanceof d("WAErrors").Disconnected?d("WALogger").LOG(m()):d("WALogger").ERROR(l(),a).devConsole(a)})}function X(){var a=Z("closeSocket");a.socket&&(d("WALogger").LOG(k(),a.socketId),d("WALogger").LOG(j()),a.socket.close())}function ea(){Z("onStreamErrorReceived").socketLoop.cancelReset()}function fa(){Z("waitForConnection").sendPing();Q||(Q=new(d("WAResolvable").Resolvable)());return Q.promise}function ga(a,b){var c=Z("castStanza");c.socket?c.castStanza(a,b):d("WALogger").LOG(i())}function ha(a){var b=Z("castStanza");return b.socketId===a}function Y(a,e,f,g,i){f===void 0&&(f=0);i===void 0&&(i="iq");return new(h||(h=b("Promise")))(function(j){var k=Z("sendIq"),l=a.attrs.id;if(!l||typeof l!=="string")throw c("WAErr")("Comms:sendIq given iq without id: "+String(a));var m=k.socketId;if(e&&!m){j((h||(h=b("Promise"))).reject(new(d("WAErrors").Offline)()));return}var n=function(){var a=i==="iq"?k.pendingIqs.get(l):k.pendingSmaxStanzas.get(l);if(!a){j((h||(h=b("Promise"))).reject(c("WAErr")("Comms:_sendIq unexisting stanza to be cancelled: "+l)));return}k.removeHandler(a)},o=null;if(f>0){var p=setTimeout(n,f*1e3);o=function(){clearTimeout(p)}}if(g!=null)if(g.aborted){j((h||(h=b("Promise"))).reject(new(d("WAErrors").Disconnected)()));return}else g.addEventListener("abort",n),o=function(){g.removeEventListener("abort",n)};m={resolve:j,stanza:a,attachedToSocketId:e?m:S,orderedId:R++,attempt:0,cleanup:o};if(i==="iq"){o=babelHelpers["extends"]({type:i},m);k.pendingIqs.set(l,o);k.config.handlers.onSendIq==null?void 0:k.config.handlers.onSendIq(a);k.maybeSendPendingStanza(o)}else{i;o=babelHelpers["extends"]({type:i},m);k.pendingSmaxStanzas.set(l,o);k.maybeSendPendingStanza(o)}})}function ia(a,b){var c,d;c=(c=b==null?void 0:b.withoutRetry)!=null?c:!1;d=(d=b==null?void 0:b.timeoutSeconds)!=null?d:0;b=(b=b==null?void 0:b.signal)!=null?b:null;return Y(a,c,d,b,"smax")}function ja(){var a=Z("sendPing");return a.sendPing()}function ka(){return Z("startHandlingRequests").startHandlingRequests()}function la(){P&&P.deadSocketTimer.cancel()}function Z(a){if(P)return P;throw c("WAErr")("Comms::"+a+" called before startComms")}function $(a){if(a.tag==="iq"){var b=a.attrs.type;if(b==="result"||b==="error")return d("WAWap").decodeAsString(a.attrs.id)||null}return null}function ma(){return R++}function na(){P=null,Q=new(d("WAResolvable").Resolvable)(),R=1}g.DEFAULT_SOCKET_ID=S;g.getComms=a;g.startComms=e;g.stopComms=f;g.closeSocketAndPreventRetry=aa;g.openSocketLoop=U;g.maybeResetSocketLoop=ba;g.forceResetSocketLoop=ca;g.forceAbortSocketConnection=da;g.isSocketConnected=V;g.socketLoopIteration=W;g.closeSocket=X;g.onStreamErrorReceived=ea;g.waitForConnection=fa;g.castSmaxStanza=ga;g.isActiveSocket=ha;g._sendIq=Y;g.sendSmaxStanza=ia;g.sendPing=ja;g.startHandlingRequests=ka;g.cancelDeadSocketTimer=la;g.singletonOrThrowIfUninitialized=Z;g.getAndIncrementNextOrderedId=ma;g.resetStateForTests=na}),98);
__d("WAParseIqResponse",["WAWap"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){var e=a.content;if(e&&Array.isArray(e)&&e[0]){e=e[0];if(e.tag==="error"){var f=e.attrs||{},g;c&&(typeof c==="function"?g=c(a):g=c.parseOrThrow(e));c=g;return{success:!1,errorCode:parseInt(f.code,10),errorText:d("WAWap").decodeAsString(f.text)||"",errorType:d("WAWap").decodeAsString(f.type)||"",errorBackoff:parseInt(f.backoff,10),toString:h,customError:c}}}if(typeof b==="function")return{success:!0,result:b(a)};else return{success:!0,result:b.parseOrThrow(a)}}function h(){return"IqError "+this.errorCode+": "+this.errorText}g.parseIqResponse=a}),98);
__d("WADeprecatedSendIq",["Promise","WAAckParser","WAArrayUtils","WAComms","WALogger","WAParseIqResponse"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms has no open socket, will send stanza when socket opens"]);i=function(){return a};return a}function a(a,b){return d("WAComms")._sendIq(a,!1).then(function(a){return d("WAParseIqResponse").parseIqResponse(a,b)})}function c(a,b,c){return d("WAComms")._sendIq(a,!1).then(function(a){return d("WAParseIqResponse").parseIqResponse(a,b,c)})}function e(a,b,c){return d("WAComms")._sendIq(a,!1,c).then(function(a){return d("WAParseIqResponse").parseIqResponse(a,b)})}function f(a,b){return d("WAComms")._sendIq(a,!0).then(function(a){return d("WAParseIqResponse").parseIqResponse(a,b)})}function j(a,b){return k(a,b).then(function(){})}function k(a,c){return new(h||(h=b("Promise")))(function(e){var f=d("WAComms").singletonOrThrowIfUninitialized("deprecatedSendStanzaAndReturnAck"),g=function(a){var b=d("WAAckParser").AckParser.parse(a);return!b.error&&d("WAAckParser").ackMatchesTemplate(b.success,c)?a:null},j={type:"ack",parseAndTest:g,resolve:e,stanza:a,attachedToSocketId:d("WAComms").DEFAULT_SOCKET_ID,orderedId:d("WAComms").getAndIncrementNextOrderedId()};f.ackHandlers.push(j);if(!f.socket){d("WALogger").LOG(i());return}f.callStanza(a)["catch"](function(a){var c=f.ackHandlers.indexOf(j);if(c===-1)return;d("WAArrayUtils").removeIndexWithoutPreservingOrder(f.ackHandlers,c);j.resolve((h||(h=b("Promise"))).reject(a))})})}function l(a,b){d("WAComms").castSmaxStanza(a,b)}g.deprecatedSendIq=a;g.deprecatedSendIqErrorParser=c;g.deprecatedSendIqIfConnectedWithin=e;g.deprecatedSendIqWithoutRetry=f;g.deprecatedSendStanzaAndWaitForAck=j;g.deprecatedSendStanzaAndReturnAck=k;g.deprecatedCastStanza=l}),98);
__d("MAWOptimisticUploadManager",[],(function(a,b,c,d,e,f){"use strict";var g=new Map();function a(){return g}function b(){g.clear()}f.getOptimisticUploadManager=a;f.clearOptimisticUploadManager=b}),66);
__d("WAArmadilloICDC.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};a.internalSpec={seq:[1,(c=d("WAProtoConst")).TYPES.INT32],timestamp:[2,c.TYPES.INT64],devices:[3,c.FLAGS.REPEATED|c.TYPES.BYTES],signingDeviceIndex:[4,c.TYPES.INT32]};b.internalSpec={details:[1,c.TYPES.BYTES],signature:[2,c.TYPES.BYTES]};g.ICDCIdentityListSpec=a;g.SignedICDCIdentityListSpec=b}),98);
__d("WACryptoEd25519",["WACryptoPrimitives","WAErr"],(function(a,b,c,d,e,f,g){"use strict";var h=null;function i(a){var b=h;h=[];try{return a()}finally{((a=h)!=null?a:[]).forEach(function(a){return void a.fill(0)});h=b}}function j(a,b){if(h==null)throw c("WAErr")("allocate called outside of active scope");return new a(b)}function a(a,b,c){d("WACryptoPrimitives").lowlevel.crypto_hash(a,b,c)}function b(a,b){for(var c=0;c<64;++c)b[c]=a[c],a[c]=0;l(a,b);b.fill(0)}function e(a,b){var c=[k(),k(),k(),k()];d("WACryptoPrimitives").lowlevel.scalarbase(c,b);R(a,c)}function k(a){var b=j(Float64Array,16);if(a){if(a.length>16)throw c("WAErr")("Incorrect initialiser array provided to the fieldElement");for(var d=0;d<a.length;d++)b[d]=a[d]}return b}function l(a,b){d("WACryptoPrimitives").lowlevel.modL(a,b)}var m=function(){return k([0])},n=function(){return k([1])},o=function(){return k([2])},p=function(){return k([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139])};function q(){return[k(),k(),k(),k()]}function r(){return[k(),k(),k(),k()]}function s(){return[k(),k(),k()]}function t(a,b){var c=0;b=b;while(b>0){var d=b%65536;a[c]=d;b=(b-d)/65536;c++}}function u(a,b){return T(a,b)?0:1}function v(a){var b=d("WACryptoPrimitives").lowlevel.pack25519,c=j(Uint8Array,32);b(c,a);return c[0]&1}function w(a,b){var c=d("WACryptoPrimitives").lowlevel.S,e=d("WACryptoPrimitives").lowlevel.M,f=o(),g=k();c(g,b);e(a,f,g)}function x(a,b){var c=d("WACryptoPrimitives").lowlevel.S,e=d("WACryptoPrimitives").lowlevel.M,f=d("WACryptoPrimitives").lowlevel.A,g=m(),h=n(),i=k(),j=k(),l=k(),o=k();t(g,486662);c(i,b);e(j,g,b);f(l,i,j);f(o,l,h);e(a,b,o)}function y(a,b,c){c===1&&a.set(b)}var z=new Uint8Array([176,160,14,74,39,27,238,196,120,228,47,173,6,24,67,47,167,215,251,61,153,0,77,43,11,223,193,79,128,36,131,43]);function A(a,b){var c,e=(c=d("WACryptoPrimitives")).lowlevel.unpack25519,f=c.lowlevel.pow2523,g=c.lowlevel.M;c=c.lowlevel.S;var h=k();e(h,z);e=k();f(e,b);f=k();g(f,b,e);e=k();c(e,f);c=k();g(c,f,h);y(f,c,1^u(e,b));a.set(f)}function B(a,b){var c=d("WACryptoPrimitives").lowlevel.Z,e=d("WACryptoPrimitives").lowlevel.A,f=d("WACryptoPrimitives").lowlevel.M,g=n(),h=k(),i=k(),j=k();c(h,b,g);e(i,b,g);S(j,i);f(a,h,j)}function C(a,b){var c=d("WACryptoPrimitives").lowlevel.Z,e=m();c(a,e,b)}function D(a,b){var c=d("WACryptoPrimitives").lowlevel.M;c(a[0],b[0],b[3]);c(a[1],b[1],b[2]);c(a[2],b[2],b[3])}function E(a,b){var c=d("WACryptoPrimitives").lowlevel.M;c(a[0],b[0],b[3]);c(a[1],b[1],b[2]);c(a[2],b[2],b[3]);c(a[3],b[0],b[1])}function F(a,b){var c=d("WACryptoPrimitives").lowlevel.S,e=d("WACryptoPrimitives").lowlevel.A,f=d("WACryptoPrimitives").lowlevel.Z;c(a[0],b[0]);c(a[2],b[1]);w(a[3],b[2]);e(a[1],b[0],b[1]);b=k();c(b,a[1]);e(a[1],a[2],a[0]);f(a[2],a[2],a[0]);f(a[0],b,a[1]);f(a[3],a[3],a[2])}var G=new Uint8Array([6,126,69,255,170,4,110,204,130,26,125,75,209,211,161,197,126,79,252,3,220,8,123,210,187,6,160,96,244,237,38,15]);function H(a,b,c){var e=d("WACryptoPrimitives").lowlevel.unpack25519,f=d("WACryptoPrimitives").lowlevel.M,g=k();e(g,G);e=k();B(e,b);var h=k();x(h,b);var i=k();A(i,h);h=k();f(h,b,g);b=k();S(b,i);g=k();f(g,h,b);i=k();C(i,g);y(g,i,v(g)^c);a[0].set(g);a[1].set(e);a[2].set(n());f(a[3],a[0],a[1])}function I(a,b){a[0].set(b[0]),a[1].set(b[1]),a[2].set(b[2])}function J(a,b){var c=s();I(c,b);F(a,c)}function K(a,b){var c=r(),d=s();J(c,b);D(d,c);F(c,d);D(d,c);F(c,d);E(a,c)}function L(a){var b,c=(b=d("WACryptoPrimitives")).lowlevel.S,e=b.lowlevel.M,f=b.lowlevel.pow2523;b=b.lowlevel.pack25519;var g=k(),h=k(),i=k(),j=k(),l=k();f(g,a);c(h,g);c(i,h);e(j,i,a);e(l,j,a);f=new Uint8Array(32);b(f,l);return 1&f[31]}function M(a,b){C(a[0],b[0]),a[1].set(b[1]),a[2].set(b[2]),C(a[3],b[3])}function f(a,b){var c=q();b=U(c,b);if(b!==0)return-1;M(a,c);return 0}function N(a,b){var c=d("WACryptoPrimitives").lowlevel.M,e=d("WACryptoPrimitives").lowlevel.A;b=b;var f=n(),g=m();t(g,486662);var h=k();w(h,b);b=k();e(b,h,f);h=k();S(h,b);f=k();c(f,h,g);b=k();C(b,f);c=k();x(c,b);h=L(c);f=k([0]);y(f,g,h);c=k();e(c,b,f);g=k();C(g,c);y(c,g,h);a.set(c)}function O(a){var b=d("WACryptoPrimitives").lowlevel.unpack25519;a=d("WACryptoPrimitives").hash(a);var c=(a[31]&128)>>7;a[31]&=127;var e=k();b(e,a);b=k();P(b,e);a=q();H(a,b,c);e=q();K(e,a);return e}function P(a,b){return i(function(){return N(a,b)})}function Q(a){return i(function(){return O(a)})}function R(a,b){var c=k(),e=k(),f=k(),g=d("WACryptoPrimitives").lowlevel.M,h=d("WACryptoPrimitives").lowlevel.pack25519;S(f,b[2]);g(c,b[0],f);g(e,b[1],f);h(a,e);g=new Uint8Array(32);h(g,c);a[31]^=(g[0]&1)<<7}function S(a,b){var c=k();c.set(b);var e=d("WACryptoPrimitives").lowlevel.M,f=d("WACryptoPrimitives").lowlevel.S;for(var g=253;g>=0;--g)f(c,c),g!==2&&g!==4&&e(c,c,b);a.set(c)}function T(a,b){var c=d("WACryptoPrimitives").lowlevel.pack25519,e=d("WACryptoPrimitives").lowlevel.crypto_verify_32,f=new Uint8Array(32),g=new Uint8Array(32);c(f,a);c(g,b);return e(f,0,g,0)}function U(a,b){var c,e=(c=d("WACryptoPrimitives")).lowlevel.set25519,f=c.lowlevel.S,g=c.lowlevel.M,h=c.lowlevel.Z,i=c.lowlevel.A,j=c.lowlevel.D,l=c.lowlevel.unpack25519;c=c.lowlevel.pow2523;var o=k(),q=k(),r=k(),s=k(),t=k(),u=k(),v=k();e(a[2],n());l(a[1],b);f(r,a[1]);g(s,r,j);h(r,r,a[2]);i(s,a[2],s);f(t,s);f(u,t);g(v,u,t);g(o,v,r);g(o,o,s);c(o,o);g(o,o,r);g(o,o,s);g(o,o,s);g(a[0],o,s);f(q,a[0]);g(q,q,s);T(q,r)&&g(a[0],a[0],p());f(q,a[0]);g(q,q,s);if(T(q,r))return-1;V(a[0])===b[31]>>7&&h(a[0],m(),a[0]);g(a[3],a[0],a[1]);return 0}function V(a){var b=d("WACryptoPrimitives").lowlevel.pack25519,c=new Uint8Array(32);b(c,a);return c[0]&1}g.runInAllocationScope=i;g.allocate=j;g.hashSha512=a;g.reduce=b;g.scalarmultBase=e;g.fieldElement=k;g.modL=l;g.p3Element=q;g.unpack=f;g.elligator=P;g.hashToPoint=Q;g.pack=R;g.inv25519=S;g.unpackneg=U}),98);
__d("WADevicesState",["Promise","WAErr","WALogger","WAResolvable"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["GetDevices cahce is already initialized"]);i=function(){return a};return a}var j=null;function a(a){if(j!=null){d("WALogger").WARN(i());return}j=new k(a)}function e(){if(j==null)throw c("WAErr")("GetDevices cache is not initialized");return j}var k=function(){function a(a){this.$1=new Map(),this.$2=a}var c=a.prototype;c.waitForUserDevices=function(a,c,e){var f=this;e===void 0&&(e=!1);var g=new Map(),i=[];a.forEach(function(a){var b=f.$1.get(a);if(b==null){var c=new(d("WAResolvable").Resolvable)();g.set(a,c);f.$1.set(a,c.promise)}else i.push(b)});return(g.size>0?this.$2.fetchAndSaveDevices(new Set(g.keys()),c,e):(h||(h=b("Promise"))).resolve(new Map())).then(function(a){for(var b=g,c=Array.isArray(b),d=0,b=c?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=b.length)break;e=b[d++]}else{d=b.next();if(d.done)break;e=d.value}e=e;var h=e[0];e=e[1];var i=a.get(h);(i==null?void 0:i.success)?e.resolve():(e.reject("Failed to fetch devices for user: "+h),f.$1["delete"](h))}})["catch"](function(a){for(var b=g,c=Array.isArray(b),d=0,b=c?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=b.length)break;e=b[d++]}else{d=b.next();if(d.done)break;e=d.value}e=e;var h=e[0];e=e[1];e.reject(a);f.$1["delete"](h)}}).then(function(){return(h||(h=b("Promise"))).all([].concat(i,Array.from(g.values()).map(function(a){return a.promise}))).then(function(){})})};c.reset=function(a){var c=this;a.forEach(function(a){return c.$1["delete"](a)});return(h||(h=b("Promise"))).resolve()};return a}();g.initDevicesState=a;g.getDevicesState=e}),98);
__d("WAIdentityUtils",["WABinary","WACryptoDependencies","WASignalOther"],(function(a,b,c,d,e,f,g){"use strict";function h(a){var b=a.length===33&&a[0]===5;return b?a.slice(1):a}function i(a,b){for(var c=0;c<a.length&&c<b.length;++c)if(a[c]!==b[c])return a[c]-b[c];return a.length-b.length}function a(a){a=a.map(function(a){return h(a)});var b=new(d("WABinary").Binary)();a.sort(i).forEach(function(a){return b.writeByteArray(a)});a=d("WACryptoDependencies").getCrypto().subtle.digest("SHA-256",b.readByteArray());return a.then(function(a){a=new Uint8Array(a);return d("WASignalOther").sliceBytes(a,0,10)})}g.removeKeyTypeIfNeeded=h;g.computeIdentitiesHash=a}),98);
__d("WAProtocolQueueState",["Promise","WAProtocolQueue","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){var c=d("WAProtocolQueue").protocolQueue();void (h||(h=b("Promise"))).all(a.map(function(a){return c.write(a)}));return h.resolve()}function c(a){void d("WAProtocolQueue").protocolQueue().write(a);return(h||(h=b("Promise"))).resolve()}function e(a){return d("WAProtocolQueue").protocolQueue().ack(a)}function f(a){return d("WAProtocolQueue").protocolQueue()["delete"](a)}var i=function(a){var c,e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:c=a.jid,e=a.priority,f=a.limit,g=a.order;if(!(c!=null&&e!=null)){j.next=7;break}j.next=4;return b("regeneratorRuntime").awrap(d("WAProtocolQueue").protocolQueue().index("[jid+priority]").equals([c,e],f,g));case 4:h=j.sent;j.next=22;break;case 7:if(!(c!=null)){j.next=13;break}j.next=10;return b("regeneratorRuntime").awrap(d("WAProtocolQueue").protocolQueue().index("jid").equals([c],f,g));case 10:h=j.sent;j.next=22;break;case 13:if(!(e!=null)){j.next=19;break}j.next=16;return b("regeneratorRuntime").awrap(d("WAProtocolQueue").protocolQueue().index("priority").equals([e],f,g));case 16:h=j.sent;j.next=22;break;case 19:j.next=21;return b("regeneratorRuntime").awrap(d("WAProtocolQueue").protocolQueue().read(f,g));case 21:h=j.sent;case 22:i=d("WAProtocolQueue").mapProtocolEntriesV2toV1(h);return j.abrupt("return",i);case 24:case"end":return j.stop()}},null,this)},j=function(){return d("WAProtocolQueue").protocolQueue().read(1).then(function(a){return a.length===0})};g.persistStanzas=a;g.persistStanza=c;g.ackProtocols=e;g.deleteQueueIDs=f;g.where=i;g.isProtocolQueueEmpty=j}),98);
__d("WASignalSignatures",["Promise","WACryptoDependencies","WACryptoEd25519","WACryptoPrimitives","WAErr","WAHex","WALogger","WALongInt","WASignalKeys","WASignalLocalStorageProtocol.pb","WASignalOther","decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["deserializeSignedPreKey error ",""]);i=function(){return a};return a}function j(a,b,c){return d("WACryptoEd25519").runInAllocationScope(function(){var e,f=b.length,g=a.privateKey,h=new Uint8Array(32);(e=d("WACryptoEd25519")).scalarmultBase(h,g);var i=h[31]&128,j=new Uint8Array(f+128);j[0]=254;j.fill(255,1,32);j.set(g,32);j.set(b,64);j.set(c,f+64);var k=e.allocate(Uint8Array,64);e.hashSha512(k,j,f+128);j.set(h,32);h=e.allocate(Float64Array,64);e.reduce(k,h);e.scalarmultBase(j,k);var l=e.allocate(Uint8Array,64);e.hashSha512(l,j,f+64);e.reduce(l,h);for(f=0;f<32;++f)h[f]=k[f];for(f=0;f<32;++f)for(k=0;k<32;++k)h[f+k]+=l[f]*g[k];e.modL(j.subarray(32,64),h);return{pubKeyNegative:i!==0,signedMsg:j}})}function a(a,c){return(h||(h=b("Promise"))).resolve().then(function(){var b=d("WASignalOther").makeBytes(64);d("WACryptoDependencies").getCrypto().getRandomValues(b);return k(a,c,b)})}function e(a,b,c){var e=c[63];return e&96?!1:d("WACryptoEd25519").runInAllocationScope(function(){var f,g,h=(f=d("WACryptoPrimitives")).lowlevel.A,i=f.lowlevel.M,j=f.lowlevel.Z,k=f.lowlevel.pack25519,l=f.lowlevel.unpack25519,m=(g=d("WACryptoEd25519")).allocate(Uint8Array,64);m.set(c);m[63]=e&127;var n=g.fieldElement(),o=g.fieldElement(),p=g.fieldElement(),q=g.fieldElement(),r=g.fieldElement(),s=g.allocate(Uint8Array,32),t=g.fieldElement();t[0]=1;l(n,a.subarray(1));j(o,n,t);h(p,n,t);g.inv25519(q,p);i(r,o,q);k(s,r);s[31]=s[31]&127|e&128;return f.signDetachedVerify(b,m,s)})}function k(a,b,c){a=j(a,b,c);b=d("WASignalOther").sliceBytes(a.signedMsg,0,64);b[63]=b[63]&127|(a.pubKeyNegative?128:0);return b}function l(a,b,e){var f=d("WASignalKeys").makeKeyPair(),g=d("WASignalOther").makeBytes(64);d("WACryptoDependencies").getCrypto().getRandomValues(g);e=k(e,d("WASignalKeys").serializePubKey(f),g);if(!Number.isSafeInteger(b))throw c("WAErr")("Expected timestamp to be a safe integer, given "+String(b));return{id:d("WASignalKeys").castToPreKeyId(a),ts:b,keyPair:f,signature:e}}function f(a,b){var c=d("WASignalOther").makeBytes(64);d("WACryptoDependencies").getCrypto().getRandomValues(c);return k(a,b,c)}function m(a){var b=a.id,c=a.keyPair;return d("WASignalOther").encodeSignalProto(d("WASignalLocalStorageProtocol.pb").SignedPreKeyRecordStructureSpec,{id:b,publicKey:d("WASignalKeys").serializePubKey(c),privateKey:c.privateKey,signature:a.signature,timestamp:a.ts})}function n(a){try{a=d("decodeProtobuf").decodeProtobuf(d("WASignalLocalStorageProtocol.pb").SignedPreKeyRecordStructureSpec,a);var b=a.id,c=a.publicKey,e=a.privateKey,f=a.signature;a=a.timestamp;return b==null||c==null||e==null||f==null||a==null?null:{id:d("WASignalKeys").castToSignedPreKeyId(b),ts:d("WALongInt").numberOrThrowIfTooLarge(a),keyPair:d("WASignalKeys").makeKeyPairFromSerialized(d("WASignalOther").toBytes(e,32),d("WASignalKeys").castToSerializedPubKey(new Uint8Array(c))),signature:d("WASignalOther").toBytes(f,64)}}catch(a){d("WALogger").DEV(i(),a);return null}}function o(a){return new Uint8Array(d("WAHex").parseHex(a))}function p(a){if(a.length===33)return d("WASignalKeys").castToSerializedPubKey(a);else if(a.length===32)return d("WASignalKeys").serializeIdentity(a);else throw c("WAErr")("verifyCertificate publicKey incorrect length")}function q(a,c,d){return(h||(h=b("Promise"))).resolve().then(function(){var b=l(a,c,d),e=m(b);return{plainObject:b,record:e}})}g.signMsg=a;g.verifyMsgSignalVariant=e;g.makeSignature=k;g.makeSignedPreKey=l;g.signSenderKeyMessage=f;g.serializeSignedPreKeyForPrivateStorage=m;g.deserializeSignedPreKey=n;g.convertPublicKeyHexToUint8Array=o;g.convertPublicKeyToSerializedPubKey=p;g.generateSignedPreKey=q}),98);
__d("WAICDCUtils",["WAArmadilloICDC.pb","WABase64","WABinary","WABridge","WACryptoDependencies","WACryptoEd25519","WACryptoUtils","WADevicesState","WAErr","WAGlobals","WAIdentityUtils","WAJids","WALogger","WAOdsEnums","WAProtocolQueue","WAProtocolQueueState","WASignalKeys","WASignalOther","WASignalSignatures","WATimeUtils","decodeProtobuf","encodeProtobuf","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["The number of ICDC failures is higher "," than allowed amount ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to wait for user devices: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["flushing ICDC payload with "," entries from ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["flushing ICDC payload returned early"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["flushing ICDC payload"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["ICDC timestamp is negative. time: ",", closkSkew: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["signingDeviceIndex not found. This should never happen. ",". caller: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received ICDC has mismatched missed signingDeviceIndex"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received ICDC has mismatched timestamp between XML node and byte structure"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received ICDC has mismatched sequence between XML node and byte structure"]);q=function(){return a};return a}function a(a,b,c,e){if(a!==e.details.seq){d("WALogger").ERROR(q());return null}if(c!==e.details.timestamp){d("WALogger").ERROR(p());return null}if(e.details.signingDeviceIndex==null){d("WALogger").ERROR(o());return null}var f=e.details.signingDeviceIndex;return{dirty:b,sequence:a,timestamp:c,signingDeviceIndex:f,devices:e.details.devices.map(function(a){return new Uint8Array(a)})}}function r(a){return a.signingDeviceIndex<0||a.signingDeviceIndex>=a.devices.length}function s(a,b){if(r(b))return null;var c=new Set(),e=new Set();b.devices.forEach(function(a){c.add(a.id),e.add(a.identity.toString())});var f=new Set(),g=new Set();a.devicesInfo.forEach(function(a){var b=d("WAJids").extractDeviceId(a.jid);a=d("WAIdentityUtils").removeKeyTypeIfNeeded(a.identity);(!c.has(b)||!e.has(a.toString()))&&(f.add(b),g.add(a.buffer))});return{seq:b.sequence,signingDevice:d("WAIdentityUtils").removeKeyTypeIfNeeded(b.devices[b.signingDeviceIndex].identity).buffer,unknownDevices:Array.from(g),unknownDeviceIds:Array.from(f)}}function e(a,b,c){var d=new Map();c.forEach(function(a){d.set(a.user,a)});c=d.get(a.user);var e=void 0;c!=null&&(e=s(a,c));var f=[],g=[];b.forEach(function(a){var b=d.get(a.user);if(b!=null){b=s(a,b);b!=null&&f.push(b)}g.push(a.user)});return{senderIdentity:(a=e)!=null?a:void 0,recipientIdentities:f,recipientUserJids:g}}function t(a,b,c){if(a==null){d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.ICDC,key:"missing_icdc_payload"});return{action:"none"}}else if(b==null||a.seq==null||a.signingDevice==null){b==null&&d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.ICDC,key:"error.missing_stored_icdc"});(a.seq==null||a.signingDevice==null)&&d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.ICDC,key:"error.invalid_icdc_payload"});return{action:"error",failureTs:d("WATimeUtils").unixTime(),sync:!0}}var e=a.seq,f=a.signingDevice;if(e===b.sequence){var g=new Set();c.forEach(function(a){return g.add(d("WAIdentityUtils").removeKeyTypeIfNeeded(a).toString())});e=!g.has(new Uint8Array(f).toString());b=a.unknownDevices.some(function(a){return!g.has(new Uint8Array(a).toString())});if(e||b){d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.ICDC,key:"error.unknow_device"});return{action:"error",failureTs:d("WATimeUtils").unixTime(),sync:!0}}}else{d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.ICDC,key:"error.incorrect_seq"});return{action:"error",failureTs:d("WATimeUtils").unixTime(),sync:!0}}return{action:"none"}}function f(a){a=d("decodeProtobuf").decodeProtobuf(d("WAArmadilloICDC.pb").SignedICDCIdentityListSpec,a);var b=a.signature;a=d("decodeProtobuf").decodeProtobuf(d("WAArmadilloICDC.pb").ICDCIdentityListSpec,a.details);return{signature:b,details:a}}function u(a){return a.map(function(a){return d("WASignalKeys").serializeIdentity(new Uint8Array(d("WABase64").decodeB64UrlSafe(a)))})}function v(a,b,e,f,g){var h=d("WAIdentityUtils").removeKeyTypeIfNeeded(a.publicKey);e=e.map(function(a){return d("WAIdentityUtils").removeKeyTypeIfNeeded(a)});var i=e.findIndex(function(a){return d("WACryptoUtils").uint8ArraysEqual(a,h)});if(i===-1){d("WALogger").ERROR(n(),f,g);throw c("WAErr")("signingDeviceIndex not found")}f=b==null?1:b+1;g=d("WATimeUtils").unixTime();g<0&&d("WALogger").ERROR(m(),Date.now(),d("WATimeUtils").getClockSkew());b={seq:f,timestamp:g,devices:e,signingDeviceIndex:i};f=d("encodeProtobuf").encodeProtobuf(d("WAArmadilloICDC.pb").ICDCIdentityListSpec,b).readBuffer();g=w(a,d("WABinary").Binary.build(f).readByteArray());e={details:f,signature:g};i=d("encodeProtobuf").encodeProtobuf(d("WAArmadilloICDC.pb").SignedICDCIdentityListSpec,e).readBuffer();return{icdcInfo:b,encodedSignedICDC:i}}function w(a,b){var c=d("WASignalOther").makeBytes(64);d("WACryptoDependencies").getCrypto().getRandomValues(c);var e=new Uint8Array(64);d("WACryptoEd25519").hashSha512(e,b,b.length);e=d("WASignalSignatures").makeSignature(a,b,c);return d("WABinary").Binary.build(e).readBuffer()}var x=4*d("WATimeUtils").HOUR_SECONDS;function y(a){return a==null?!0:!d("WATimeUtils").happenedWithin(a,x)}var z=function(){function a(){this.$1=[]}var c=a.prototype;c.enqueue=function(a){this.$1.push(a)};c.flush=function(a,c,e){var f,g,m,n,o,p,q,r,s,u,v,w,x,y,z,A,B,C,D,E,F,G,H;return b("regeneratorRuntime").async(function(I){while(1)switch(I.prev=I.next){case 0:c.LOG(l()),f=new Map(),(g=this.$1,m=Array.isArray(g),n=0,g=m?g:g[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]());case 3:if(!m){I.next=9;break}if(!(n>=g.length)){I.next=6;break}return I.abrupt("break",18);case 6:o=g[n++];I.next=13;break;case 9:n=g.next();if(!n.done){I.next=12;break}return I.abrupt("break",18);case 12:o=n.value;case 13:a=o,p=a.from,f.set(p,a);case 16:I.next=3;break;case 18:q=Array.from(f.values());if(!(q.length===0)){I.next=24;break}c.LOG(k());return I.abrupt("return");case 24:c.LOG(j(),q.length,Array.from(f.keys()).join(","));case 25:e=new Set(q.map(function(a){a=a.from;return d("WAJids").extractUserJid(a)}));I.next=28;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().loadContacts(Array.from(e)));case 28:r=I.sent,s=new Set(),u=new Set(),v=[],(w=q.slice(),x=Array.isArray(w),y=0,w=x?w:w[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]());case 33:if(!x){I.next=39;break}if(!(y>=w.length)){I.next=36;break}return I.abrupt("break",56);case 36:A=w[y++];I.next=43;break;case 39:y=w.next();if(!y.done){I.next=42;break}return I.abrupt("break",56);case 42:A=y.value;case 43:B=A;C=B.icdc;p=B.from;D=B.serverTs;E=d("WAJids").extractUserJid(p);F=r.get(E);G=t(C.senderIdentity,F==null?void 0:F.icdcInfo,(F==null?void 0:(z=F.icdcInfo)==null?void 0:z.devices.map(function(a){return d("WASignalKeys").serializeIdentity(a)}))||[]);if(!(G.action==="error")){I.next=54;break}H=function(){var a;G.sync&&s.add(E);var b=G.failureTs;a=((a=F==null?void 0:F.icdcFails)!=null?a:[]).filter(function(a){return a.timeBucket>=d("WATimeUtils").pastUnixTime(d("WAGlobals").getConfig().icdcIntervalInMinutes()*60,b)});if(a.length>0&&d("WATimeUtils").futureUnixTime(d("WAGlobals").getConfig().icdcCooldownIntervalInMinutes()*60,a[a.length-1].timeBucket)>b)return"continue";F!=null&&(u.add(E),r.set(E,babelHelpers["extends"]({},F,{icdcFails:[].concat(a,[{timeBucket:b,alert:!0}])})));var c=d("WAGlobals").getConfig().icdcAlertTriggerFailureCounter(),e=a.filter(function(a){return a.alert===!0}).length>=c;e&&(d("WALogger").WARN(h(),a.length,c),v.push({type:"instruction",instruction:"icdcError",consumerRetries:0,jid:d("WAJids").extractUserJid(p),notificationTs:D,priority:d("WAGlobals").getConfig().isIdleOQM1()?d("WAProtocolQueue").WAProtocolQueuePriorityLow:d("WAProtocolQueue").WAProtocolQueuePriorityHigh}))}();if(!(H==="continue")){I.next=54;break}return I.abrupt("continue",54);case 54:I.next=33;break;case 56:s.size>0&&d("WADevicesState").getDevicesState().waitForUserDevices(Array.from(s),"ICDC")["catch"](function(a){d("WALogger").ERROR(i(),a)});if(!(u.size>0)){I.next=60;break}I.next=60;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().bulkPutContacts(Array.from(u).flatMap(function(a){a=r.get(a);return a?[a]:[]})));case 60:if(!(v.length>0)){I.next=63;break}I.next=63;return b("regeneratorRuntime").awrap(d("WAProtocolQueueState").persistStanzas(v));case 63:this.$1=[];case 64:case"end":return I.stop()}},null,this)};return a}(),A=new z();g.validateAndPrepareICDCFromNotification=a;g.isICDCIndexInvalid=r;g.computeICDCParticipantDevices=e;g.validateICDCInfo=t;g.decodeICDCInfo=f;g.base64DeviceIdentitiesToSerializedPubKeys=u;g.computeICDCInfoForUpload=v;g.isLastSyncTsExpired=y;g.ICDCFlushable=z;g.icdcFlushable=A}),98);
__d("WAConvertRegistrationIdMixin",["WAParsableXmlNode"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("WAParsableXmlNode").convertBytesToUint(a.registrationElementValue,4)}g.registrationIdMixin=a}),98);
__d("WAConvertSignedPreKeyMixin",["WAParsableXmlNode"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return{id:d("WAParsableXmlNode").convertBytesToUint(a.skeyIdKeyIDMixin.elementValue,3),pubkey:a.skeyValueKeyDataMixin.elementValue,signature:a.skeySignatureElementValue}}g.convertSignedPreKeyMixin=a}),98);
__d("WASmaxInPreKeysIQErrorResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","error");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQErrorResponseMixin=a}),98);
__d("WASmaxInPreKeysIQErrorBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","bad-request");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",400);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorBadRequestMixin=a}),98);
__d("WASmaxInPreKeysIQErrorFallbackClientMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"text");if(!b.success)return b;a=d("WASmaxParseUtils").attrIntRange(a,"code",400,499);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorFallbackClientMixin=a}),98);
__d("WASmaxInPreKeysIQErrorNoValidJIDMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","not-acceptable");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",406);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorNoValidJIDMixin=a}),98);
__d("WASmaxInPreKeysRequestErrorsFetch",["WAResultOrError","WASmaxInPreKeysIQErrorBadRequestMixin","WASmaxInPreKeysIQErrorFallbackClientMixin","WASmaxInPreKeysIQErrorNoValidJIDMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:b.value});var c=d("WASmaxInPreKeysIQErrorNoValidJIDMixin").parseIQErrorNoValidJIDMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorNoValidJID",value:c.value});var e=d("WASmaxInPreKeysIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(a);return e.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackClient",value:e.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorBadRequest","IQErrorNoValidJID","IQErrorFallbackClient"],[b,c,e])}g.parseRequestErrorsFetch=a}),98);
__d("WASmaxInPreKeysFetchKeyBundlesResponseRequestError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysRequestErrorsFetch","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysRequestErrorsFetch").parseRequestErrorsFetch(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRequestErrorsFetch:b.value}))}g.parseFetchKeyBundlesResponseRequestError=a}),98);
__d("WASmaxInPreKeysIQErrorFallbackServerMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"text");if(!b.success)return b;a=d("WASmaxParseUtils").attrIntRange(a,"code",500,599);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorFallbackServerMixin=a}),98);
__d("WASmaxInPreKeysIQErrorServiceUnavailableMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","service-unavailable");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",503);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorServiceUnavailableMixin=a}),98);
__d("WASmaxInPreKeysServerErrors",["WAResultOrError","WASmaxInPreKeysIQErrorFallbackServerMixin","WASmaxInPreKeysIQErrorServiceUnavailableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysIQErrorServiceUnavailableMixin").parseIQErrorServiceUnavailableMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorServiceUnavailable",value:b.value});var c=d("WASmaxInPreKeysIQErrorFallbackServerMixin").parseIQErrorFallbackServerMixin(a);return c.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackServer",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorServiceUnavailable","IQErrorFallbackServer"],[b,c])}g.parseServerErrors=a}),98);
__d("WASmaxInPreKeysFetchKeyBundlesResponseServerError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysServerErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysServerErrors").parseServerErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorServerErrors:b.value}))}g.parseFetchKeyBundlesResponseServerError=a}),98);
__d("WASmaxInPreKeysEnums",["WAJids"],(function(a,b,c,d,e,f,g){b={validators:[(a=d("WAJids")).validateDeviceJid,a.validateDeviceJid],typeName:"DeviceJid|DeviceJid"};c={validators:[a.validateDeviceJid,a.validateDeviceJid,a.validateInteropDeviceJid,a.validateInteropDeviceJid],typeName:"DeviceJid|DeviceJid|InteropDeviceJid|InteropDeviceJid"};e={validators:[a.validateDeviceJid,a.validateDomainJid],typeName:"DeviceJid|DomainJid"};f={validators:[a.validateUserJid,a.validateUserJid],typeName:"UserJid|UserJid"};g.DEVICEJID_DEVICEJID=b;g.DEVICEJID_DEVICEJID_INTEROPDEVICEJID_INTEROPDEVICEJID=c;g.DEVICEJID_DOMAINJID=e;g.USERJID_USERJID=f}),98);
__d("WASmaxInPreKeysIQResultResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQResultResponseMixin=a}),98);
__d("WASmaxInPreKeysFetchKeyBundlesUserErrorFallbackMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"user");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!b.success)return b;a=d("WASmaxParseUtils").attrString(b.value,"text");if(!a.success)return a;b=d("WASmaxParseUtils").attrIntRange(b.value,"code",500,599);return!b.success?b:d("WAResultOrError").makeResult({errorText:a.value,errorCode:b.value})}g.parseFetchKeyBundlesUserErrorFallbackMixin=a}),98);
__d("WASmaxInPreKeysFetchKeyBundlesUserErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"user");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!b.success)return b;a=d("WASmaxParseUtils").attrString(b.value,"text");if(!a.success)return a;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,b.value,"code",500);return!b.success?b:d("WAResultOrError").makeResult({errorText:a.value,errorCode:b.value})}g.parseFetchKeyBundlesUserErrorMixin=a}),98);
__d("WASmaxInPreKeysDeviceIdentityMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"device-identity");if(!a.success)return a;a=d("WASmaxParseUtils").contentBytes(a.value);return!a.success?a:d("WAResultOrError").makeResult({deviceIdentityElementValue:a.value})}g.parseDeviceIdentityMixin=a}),98);
__d("WASmaxInPreKeysKeyDataMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").contentBytesRange(a,32,32);return!a.success?a:d("WAResultOrError").makeResult({elementValue:a.value})}g.parseKeyDataMixin=a}),98);
__d("WASmaxInPreKeysIdentityKeyMixin",["WASmaxInPreKeysKeyDataMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"identity");if(!a.success)return a;a=d("WASmaxInPreKeysKeyDataMixin").parseKeyDataMixin(a.value);return!a.success?a:a}g.parseIdentityKeyMixin=a}),98);
__d("WASmaxInPreKeysKeyTypeMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"type");if(!a.success)return a;a=d("WASmaxParseUtils").contentLiteralBytes(a.value,new Uint8Array([5]));return!a.success?a:d("WAResultOrError").makeResult({typeElementValue:a.value})}g.parseKeyTypeMixin=a}),98);
__d("WASmaxInPreKeysKeyIDMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"id");if(!b.success)return b;b=d("WASmaxParseUtils").contentBytesRange(a,3,3);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}g.parseKeyIDMixin=a}),98);
__d("WASmaxInPreKeysPreKeyMixin",["WAResultOrError","WASmaxInPreKeysKeyDataMixin","WASmaxInPreKeysKeyIDMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"key");if(!a.success)return a;var b=d("WASmaxParseUtils").flattenedChildWithTag(a.value,"id");if(!b.success)return b;a=d("WASmaxParseUtils").flattenedChildWithTag(a.value,"value");if(!a.success)return a;b=d("WASmaxInPreKeysKeyIDMixin").parseKeyIDMixin(b.value);if(!b.success)return b;a=d("WASmaxInPreKeysKeyDataMixin").parseKeyDataMixin(a.value);return!a.success?a:d("WAResultOrError").makeResult({keyIdKeyIDMixin:b.value,keyValueKeyDataMixin:a.value})}g.parsePreKeyMixin=a}),98);
__d("WASmaxInPreKeysRegistrationIDMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"registration");if(!a.success)return a;a=d("WASmaxParseUtils").contentBytesRange(a.value,4,4);return!a.success?a:d("WAResultOrError").makeResult({registrationElementValue:a.value})}g.parseRegistrationIDMixin=a}),98);
__d("WASmaxInPreKeysSignedPreKeyMixin",["WAResultOrError","WASmaxInPreKeysKeyDataMixin","WASmaxInPreKeysKeyIDMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"skey");if(!a.success)return a;var b=d("WASmaxParseUtils").flattenedChildWithTag(a.value,"id");if(!b.success)return b;var c=d("WASmaxParseUtils").flattenedChildWithTag(a.value,"value");if(!c.success)return c;a=d("WASmaxParseUtils").flattenedChildWithTag(a.value,"signature");if(!a.success)return a;a=d("WASmaxParseUtils").contentBytesRange(a.value,64,64);if(!a.success)return a;b=d("WASmaxInPreKeysKeyIDMixin").parseKeyIDMixin(b.value);if(!b.success)return b;c=d("WASmaxInPreKeysKeyDataMixin").parseKeyDataMixin(c.value);return!c.success?c:d("WAResultOrError").makeResult({skeySignatureElementValue:a.value,skeyIdKeyIDMixin:b.value,skeyValueKeyDataMixin:c.value})}g.parseSignedPreKeyMixin=a}),98);
__d("WASmaxInPreKeysFetchKeyBundlesUserSuccessMixin",["WAResultOrError","WASmaxInPreKeysDeviceIdentityMixin","WASmaxInPreKeysIdentityKeyMixin","WASmaxInPreKeysKeyTypeMixin","WASmaxInPreKeysPreKeyMixin","WASmaxInPreKeysRegistrationIDMixin","WASmaxInPreKeysSignedPreKeyMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"user");if(!b.success)return b;b=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"t",0,void 0);if(!b.success)return b;var c=d("WASmaxParseUtils").optionalLiteral(d("WASmaxParseUtils").attrString,a,"is_cloud_api","true");if(!c.success)return c;var e=d("WASmaxInPreKeysRegistrationIDMixin").parseRegistrationIDMixin(a);if(!e.success)return e;var f=d("WASmaxInPreKeysKeyTypeMixin").parseKeyTypeMixin(a),g=d("WASmaxInPreKeysIdentityKeyMixin").parseIdentityKeyMixin(a);if(!g.success)return g;var h=d("WASmaxInPreKeysPreKeyMixin").parsePreKeyMixin(a),i=d("WASmaxInPreKeysSignedPreKeyMixin").parseSignedPreKeyMixin(a);if(!i.success)return i;a=d("WASmaxInPreKeysDeviceIdentityMixin").parseDeviceIdentityMixin(a);return d("WAResultOrError").makeResult(babelHelpers["extends"]({t:b.value,isCloudApi:c.value},e.value,{keyTypeMixin:f.success?f.value:null},g.value,{preKeyMixin:h.success?h.value:null},i.value,{deviceIdentityMixin:a.success?a.value:null}))}g.parseFetchKeyBundlesUserSuccessMixin=a}),98);
__d("WASmaxInPreKeysUserFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup",["WAResultOrError","WASmaxInPreKeysFetchKeyBundlesUserErrorFallbackMixin","WASmaxInPreKeysFetchKeyBundlesUserErrorMixin","WASmaxInPreKeysFetchKeyBundlesUserSuccessMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysFetchKeyBundlesUserSuccessMixin").parseFetchKeyBundlesUserSuccessMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"FetchKeyBundlesUserSuccess",value:b.value});var c=d("WASmaxInPreKeysFetchKeyBundlesUserErrorMixin").parseFetchKeyBundlesUserErrorMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"FetchKeyBundlesUserError",value:c.value});var e=d("WASmaxInPreKeysFetchKeyBundlesUserErrorFallbackMixin").parseFetchKeyBundlesUserErrorFallbackMixin(a);return e.success?d("WAResultOrError").makeResult({name:"FetchKeyBundlesUserErrorFallback",value:e.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["UserSuccess","UserError","UserErrorFallback"],[b,c,e])}g.parseUserFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup=a}),98);
__d("WASmaxInPreKeysFetchKeyBundlesResponseSuccess",["WAResultOrError","WASmaxInPreKeysEnums","WASmaxInPreKeysIQResultResponseMixin","WASmaxInPreKeysUserFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"user");if(!b.success)return b;b=d("WASmaxParseJid").attrJidEnum(a,"jid",d("WASmaxInPreKeysEnums").DEVICEJID_DEVICEJID);if(!b.success)return b;a=d("WASmaxInPreKeysUserFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup").parseUserFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup(a);return!a.success?a:d("WAResultOrError").makeResult({jid:b.value,userFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup:a.value})}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"list");if(!c.success)return c;a=d("WASmaxInPreKeysIQResultResponseMixin").parseIQResultResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"user",0,1e5,h);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{listUser:b.value}))}g.parseFetchKeyBundlesResponseSuccessListUser=h;g.parseFetchKeyBundlesResponseSuccess=a}),98);
__d("WASmaxAttrs",["WAWap"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(b==null)return d("WAWap").DROP_ATTR;else return a(b)}function b(a,b){if(b)return a;else return d("WAWap").DROP_ATTR}g.OPTIONAL=a;g.OPTIONAL_LITERAL=b}),98);
__d("WASmaxChildren",["WADeepEquals"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(b==null)return null;else return a(b)}function b(a,b){if(b==null)return null;else if(b)return a()}function c(a,b){if(b)for(var c=1;c<b.length;c++)if(!d("WADeepEquals").deepEqual(b[c],b[0]))throw new Error("expected all homogeneous children to be equal, but they were not");c=h(a,b,0,Infinity);return c}function e(a,b){return i(a,b,0,Infinity)}function h(a,b,c,d){if(b==null){if(c>0)throw new Error("expected at least "+c+" children, but none provided");return[]}var e=b.length;if(e<c)throw new Error("expected at least "+c+" children, but found "+e);else if(e>d)throw new Error("expected at most "+d+" children, but found "+e);return b.map(function(b){return a(b)})}function i(a,b,c,d){if(b===0){if(c>0)throw new Error("expected at least "+c+" children, but none provided");return[]}if(b<c)throw new Error("expected at least "+c+" children, but found "+b);else if(b>d)throw new Error("expected at most "+d+" children, but found "+b);c=[];for(d=0;d<b;d++)c.push(a());return c}g.OPTIONAL_CHILD=a;g.HAS_OPTIONAL_CHILD=b;g.HOMOGENEOUS_CHILD=c;g.HOMOGENEOUS_CHILD_COUNT=e;g.REPEATED_CHILD=h;g.REPEATED_CHILD_COUNT=i}),98);
__d("WASmaxOutPreKeysClientRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),xmlns:"encrypt",to:d("WAWap").S_WHATSAPP_NET});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeClientRequestMixin=a}),98);
__d("WASmaxOutPreKeysFetchKeyBundlesRequest",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxOutPreKeysClientRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.userJid;a=a.hasUserReasonIdentity;b=d("WASmaxJsx").smax("user",{jid:d("WAWap").JID(b),reason:d("WASmaxAttrs").OPTIONAL_LITERAL("identity",a)});return b}function a(a){a=a.userArgs;a=d("WASmaxOutPreKeysClientRequestMixin").mergeClientRequestMixin(d("WASmaxJsx").smax("iq",{type:"get"},d("WASmaxJsx").smax("key",null,d("WASmaxChildren").REPEATED_CHILD(h,a,1,1e5))));return a}g.makeFetchKeyBundlesRequestKeyUser=h;g.makeFetchKeyBundlesRequest=a}),98);
__d("WASmaxParsingFailure",[],(function(a,b,c,d,e,f){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(b){var c;c=a.call(this,"SmaxParsingFailure: "+b)||this;c.name="SmaxParsingFailure";c.reason=b;return c}var c=b.prototype;c.toString=function(){return"SmaxParsingFailure: "+this.reason};return b}(babelHelpers.wrapNativeSuper(Error));f.SmaxParsingFailure=a}),66);
__d("WASmaxRpcUtils",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){var c=Object.keys(b).map(function(a){var c=a==="Request"?"<request>":'<response name="'+a+'">';return"Tried "+c+", but failed with "+b[a].error+"."}).join(" ");return'Failed to parse incoming stanza of <rpc name="'+a+'">. '+c}f.errorMessageRpcParsing=a}),66);
__d("WASmaxPreKeysFetchKeyBundlesRPC",["WAComms","WASmaxInPreKeysFetchKeyBundlesResponseRequestError","WASmaxInPreKeysFetchKeyBundlesResponseServerError","WASmaxInPreKeysFetchKeyBundlesResponseSuccess","WASmaxOutPreKeysFetchKeyBundlesRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:e=d("WASmaxOutPreKeysFetchKeyBundlesRequest").makeFetchKeyBundlesRequest(a);j.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=j.sent;g=d("WASmaxInPreKeysFetchKeyBundlesResponseSuccess").parseFetchKeyBundlesResponseSuccess(f,e);if(!g.success){j.next=7;break}return j.abrupt("return",{name:"FetchKeyBundlesResponseSuccess",value:g.value});case 7:h=d("WASmaxInPreKeysFetchKeyBundlesResponseRequestError").parseFetchKeyBundlesResponseRequestError(f,e);if(!h.success){j.next=10;break}return j.abrupt("return",{name:"FetchKeyBundlesResponseRequestError",value:h.value});case 10:i=d("WASmaxInPreKeysFetchKeyBundlesResponseServerError").parseFetchKeyBundlesResponseServerError(f,e);if(!i.success){j.next=13;break}return j.abrupt("return",{name:"FetchKeyBundlesResponseServerError",value:i.value});case 13:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("FetchKeyBundles",{Success:g,RequestError:h,ServerError:i}));case 14:case"end":return j.stop()}},null,this)}g.sendFetchKeyBundlesRPC=a}),98);
__d("WAFetchPreKeyBundlesProtocol",["WAConvertRegistrationIdMixin","WAConvertSignedPreKeyMixin","WAParsableXmlNode","WAResultOrError","WASignalKeys","WASmaxPreKeysFetchKeyBundlesRPC","WATagsLogger","WATimeUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["RequestError: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["ServerError: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["fetched prekey successfully"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["start fetching prekey of ","..."]);k=function(){return a};return a}var l=d("WATagsLogger").TAGS(["fetchPreKeyBundlesProtocol"]);function a(a){var c,e,f,g;return b("regeneratorRuntime").async(function(n){while(1)switch(n.prev=n.next){case 0:l.LOG(k(),a.join(", "));n.next=3;return b("regeneratorRuntime").awrap(d("WASmaxPreKeysFetchKeyBundlesRPC").sendFetchKeyBundlesRPC({userArgs:a.map(function(a){return{userJid:a,hasUserReasonIdentity:!1}})}));case 3:c=n.sent;n.t0=c.name;n.next=n.t0==="FetchKeyBundlesResponseSuccess"?7:n.t0==="FetchKeyBundlesResponseServerError"?11:n.t0==="FetchKeyBundlesResponseRequestError"?14:17;break;case 7:l.LOG(j());e=new Map();c.value.listUser.map(function(a){var b=a.userFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup;b.name==="FetchKeyBundlesUserSuccess"&&e.set(a.jid,m(b.value))});return n.abrupt("return",d("WAResultOrError").makeResult(e));case 11:f=c.value.errorServerErrors.name;l.WARN(i(),f);return n.abrupt("return",d("WAResultOrError").makeError({type:"server-error",payload:f}));case 14:g=c.value.errorRequestErrorsFetch.name;l.ERROR(h(),g);return n.abrupt("return",d("WAResultOrError").makeError({type:"request-error",payload:g}));case 17:case"end":return n.stop()}},null,this)}function m(a){var b=d("WAConvertRegistrationIdMixin").registrationIdMixin(a),c=d("WASignalKeys").serializeIdentity(a.elementValue),e=d("WAConvertSignedPreKeyMixin").convertSignedPreKeyMixin(a),f=a.preKeyMixin?n(a.preKeyMixin):null;a=d("WATimeUtils").castToUnixTime(a.t||0);return{keys:{regId:b,identity:c,oneTimeKey:f,signedKey:{id:e.id,signature:e.signature,publicKey:d("WASignalKeys").serializeIdentity(e.pubkey)}},timestamp:a}}function n(a){return{id:d("WAParsableXmlNode").convertBytesToUint(a.keyIdKeyIDMixin.elementValue,3),publicKey:d("WASignalKeys").serializeIdentity(a.keyValueKeyDataMixin.elementValue)}}g.fetchPreKeyBundlesProtocol=a}),98);
__d("WABulkRequestKeys",["WAFetchPreKeyBundlesProtocol","WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(d("WAFetchPreKeyBundlesProtocol").fetchPreKeyBundlesProtocol(a));case 2:c=e.sent;if(c.success){e.next=5;break}return e.abrupt("return",d("WAResultOrError").makeError("errRequestKeysParsingFailed"));case 5:return e.abrupt("return",d("WAResultOrError").makeResult(c.value));case 6:case"end":return e.stop()}},null,this)}g.bulkRequestKeys=a}),98);
__d("WALock",["Promise","WAResolvable","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Lock failed for ",""]);i=function(){return a};return a}function a(a){return{lock:function(c,e){var f=new(d("WAResolvable").Resolvable)(),g=c.map(function(a){return[a,new(d("WAResolvable").Resolvable)()]});(h||(h=b("Promise"))).all(g.map(function(b){var c=b[0],d=b[1];return a.enqueue(c,function(){d.resolve();return f.promise})}))["catch"](function(){d("WATagsLogger").TAGS(["WALock"]).ERROR(i(),c)});return h.all(g.map(function(a){a[0];a=a[1];return a.promise})).then(function(){return e()})["finally"](function(){f.resolve()})},wait:function(b){return a.wait(b)}}}g.makeLock=a}),98);
__d("WALockMap",["WALock","WAPromiseQueue"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a===void 0&&(a=-1);a=new(d("WAPromiseQueue").PromiseQueueMap)(a);return d("WALock").makeLock(a)}g.makeLockMap=a}),98);
__d("WASignalSessions",["WABinary","WAErr","WASignalKeys","WASignalOther"],(function(a,b,c,d,e,f,g){"use strict";var h=3;function a(a,b){return i(a,0,b,[])}function i(a,b,c,d){return{ratchetPubKey:a,nextMsgIndex:b,chainKey:c,unusedMsgKeys:d}}function b(a,b){return j(a,0,b)}function j(a,b,c){return{ratchetKey:a,nextMsgIndex:b,chainKey:c}}function k(a,b,c){return{remoteOneTimeId:a,remoteSignedId:b,localOneTimePubKey:c}}function e(a,b){return n(a.local,a.remote,a.rootKey,a.recvChains,a.sendChain,a.initialExchangeInfo,a.prevSendChainHighestIndex,b,a.aliceBaseKey)}function f(a,b,c){return n(a.local,a.remote,a.rootKey,b,c,a.initialExchangeInfo,a.prevSendChainHighestIndex,a.prevSessions,a.aliceBaseKey)}function l(a,b,c,d){c===void 0&&(c=a.sendChain);return n(a.local,a.remote,d,b,c,null,Math.max(a.sendChain.nextMsgIndex-1,0),a.prevSessions,a.aliceBaseKey)}function m(a,b,c,d,e,f,g){return n(a,b,c,d,e,f,0,[],g)}function n(a,b,c,d,e,f,g,h,i){return{local:a,remote:b,rootKey:c,sendChain:e,recvChains:d,initialExchangeInfo:f,prevSendChainHighestIndex:g,prevSessions:h,aliceBaseKey:i}}function o(a,b){b=new(d("WABinary").Binary)(b);var c=d("WASignalOther").readBytes(b,32),e=d("WASignalOther").readBytes(b,32);b=d("WASignalOther").readBytes(b,16);return p(a,c,e,b)}function p(a,b,c,d){return{index:a,cipherKey:b,macKey:c,iv:d}}function q(a){return{senderRatchetKey:a.ratchetPubKey,chainKey:{index:a.nextMsgIndex,key:a.chainKey},messageKeys:a.unusedMsgKeys}}function r(a){var b=a.ratchetKey;return{senderRatchetKey:b.serializedPubKey,senderRatchetKeyPrivate:b.privateKey,chainKey:{index:a.nextMsgIndex,key:a.chainKey}}}function s(a){var b=a.local,c=a.remote,d=a.initialExchangeInfo,e=void 0;if(d){var f=d.remoteOneTimeId;e={preKeyId:f!=null?f:void 0,signedPreKeyId:d.remoteSignedId,baseKey:d.localOneTimePubKey}}return{currentSession:{sessionVersion:h,localIdentityPublic:b.pubKey,remoteIdentityPublic:c.pubKey,rootKey:a.rootKey,previousCounter:a.prevSendChainHighestIndex,senderChain:r(a.sendChain),receiverChains:a.recvChains.map(q),pendingPreKey:e,remoteRegistrationId:c.regId,localRegistrationId:b.regId,aliceBaseKey:a.aliceBaseKey},previousSessions:a.prevSessions}}function t(a){var b=a.local,c=a.remote,e=a.sendChain,f=a.initialExchangeInfo,g=void 0;if(f){var i=f.remoteOneTimeId;g={preKeyId:i!=null?i:void 0,signedPreKeyId:f.remoteSignedId,baseKey:d("WASignalOther").toBuffer(f.localOneTimePubKey)}}return{sessionVersion:h,localIdentityPublic:d("WASignalOther").toBuffer(b.pubKey),remoteIdentityPublic:d("WASignalOther").toBuffer(c.pubKey),rootKey:d("WASignalOther").toBuffer(a.rootKey),previousCounter:a.prevSendChainHighestIndex,senderChain:{senderRatchetKey:d("WASignalOther").toBuffer(e.ratchetKey.serializedPubKey),senderRatchetKeyPrivate:d("WASignalOther").toBuffer(e.ratchetKey.privateKey),chainKey:{index:e.nextMsgIndex,key:d("WASignalOther").toBuffer(e.chainKey)},messageKeys:[]},receiverChains:a.recvChains.map(function(a){return{senderRatchetKey:d("WASignalOther").toBuffer(a.ratchetPubKey),chainKey:{index:a.nextMsgIndex,key:d("WASignalOther").toBuffer(a.chainKey)},messageKeys:a.unusedMsgKeys.map(function(a){return{index:a.index,cipherKey:d("WASignalOther").toBuffer(a.cipherKey),macKey:d("WASignalOther").toBuffer(a.macKey),iv:d("WASignalOther").toBuffer(a.iv)}})}}),pendingPreKey:g,remoteRegistrationId:c.regId,localRegistrationId:b.regId,aliceBaseKey:a.aliceBaseKey==null?void 0:d("WASignalOther").toBuffer(a.aliceBaseKey)}}function u(a){var b=A(a.currentSession,"currentSession");return w(b,a.previousSessions)}function v(a){return w(a,[])}function w(a,b){var e=A(a.sessionVersion,"sessionVersion");if(e!==h)throw c("WAErr")("Signal: bad session version "+e);e=A(a.senderChain,"senderChain");var f=A(e.chainKey,"senderChain.chainKey");e=j(d("WASignalKeys").makeSerializedKeyPairFrom(z(e.senderRatchetKeyPrivate,32,"senderRatchetKeyPrivate"),y(e.senderRatchetKey,"senderRatchetKey")),A(f.index,"senderChain.chainKey.index"),z(f.key,32,"senderChain.chainKey.key"));f=A(a.receiverChains,"receiverChains").map(function(a){var b=A(a.chainKey,"receiverChains[].chainKey");return i(y(a.senderRatchetKey,"receiverChains[].senderRatchetKey"),A(b.index,"receiverChains[].chainKey.index"),z(b.key,32,"receiverChains[].chainKey.key"),x(a.messageKeys))});var g={regId:d("WASignalOther").castRegistrationId(A(a.localRegistrationId,"localRegistrationId")),pubKey:y(a.localIdentityPublic,"localIdentityPublic")},l={regId:d("WASignalOther").castRegistrationId(A(a.remoteRegistrationId,"remoteRegistrationId")),pubKey:y(a.remoteIdentityPublic,"remoteIdentityPublic")},m=a.pendingPreKey,o=null;if(m){var p=m.preKeyId;o=k(p!=null?d("WASignalKeys").castToPreKeyId(p):null,d("WASignalKeys").castToSignedPreKeyId(A(m.signedPreKeyId,"pendingPreKey.signedPreKeyId")),y(m.baseKey,"pendingPreKey.baseKey"))}p=a.aliceBaseKey==null?null:y(a.aliceBaseKey,"aliceBaseKey");return n(g,l,z(a.rootKey,32,"rootKey"),f,e,o,a.previousCounter||0,b,p)}function x(a){return a.map(function(a){return{index:A(a.index,"messageKeys[].index"),cipherKey:z(a.cipherKey,32,"messageKeys[].cipherKey"),macKey:z(a.macKey,32,"messageKeys[].macKey"),iv:z(a.iv,16,"messageKeys[].iv")}})}function y(a,b){return d("WASignalKeys").castToSerializedPubKey(new Uint8Array(A(a,b)))}function z(a,b,c){return d("WASignalOther").toBytes(A(a,c),b)}function A(a,b){if(a==null)throw c("WAErr")("Signal: protobuf is missing "+b);return a}g.FORMAT_VERSION=h;g.makeFreshRecvChain=a;g.makeRecvChain=i;g.makeFreshSendChain=b;g.makeSendChain=j;g.makeInitialExchangeInfo=k;g.setPrevSessions=e;g.updateChains=f;g.ratchetSession=l;g.makeFreshSession=m;g.makeSession=n;g.splitMsgKey=o;g.serializeSession=s;g.detachSession=t;g.parseSessionFromRecord=u;g.parseSession=v;g._parseSession=w;g.bytesOrThrow=z;g.definedOrThrow=A}),98);
__d("WASignalWhisperTextProtocol.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};e={};f={};var h={};a.internalSpec={ratchetKey:[1,(d=d("WAProtoConst")).TYPES.BYTES],counter:[2,d.TYPES.UINT32],previousCounter:[3,d.TYPES.UINT32],ciphertext:[4,d.TYPES.BYTES]};b.internalSpec={registrationId:[5,d.TYPES.UINT32],preKeyId:[1,d.TYPES.UINT32],signedPreKeyId:[6,d.TYPES.UINT32],baseKey:[2,d.TYPES.BYTES],identityKey:[3,d.TYPES.BYTES],message:[4,d.TYPES.BYTES]};c.internalSpec={id:[1,d.TYPES.UINT32],baseKey:[2,d.TYPES.BYTES],ratchetKey:[3,d.TYPES.BYTES],identityKey:[4,d.TYPES.BYTES],baseKeySignature:[5,d.TYPES.BYTES]};e.internalSpec={id:[1,d.TYPES.UINT32],iteration:[2,d.TYPES.UINT32],ciphertext:[3,d.TYPES.BYTES]};f.internalSpec={id:[1,d.TYPES.UINT32],iteration:[2,d.TYPES.UINT32],chainKey:[3,d.TYPES.BYTES],signingKey:[4,d.TYPES.BYTES]};h.internalSpec={generation:[1,d.TYPES.UINT32],signature:[2,d.TYPES.BYTES]};g.SignalMessageSpec=a;g.PreKeySignalMessageSpec=b;g.KeyExchangeMessageSpec=c;g.SenderKeyMessageSpec=e;g.SenderKeyDistributionMessageSpec=f;g.DeviceConsistencyCodeMessageSpec=h}),98);
__d("WASignalGroupSession",["WASignalKeys","WASignalSessions"],(function(a,b,c,d,e,f,g){"use strict";var h=5,i=3;function j(a){var b=d("WASignalSessions").definedOrThrow(a.senderSigningKey,"senderSigningKey"),c=d("WASignalSessions").definedOrThrow(a.senderMessageKeys,"senderMessageKeys"),e=d("WASignalSessions").definedOrThrow(a.senderChainKey,"senderChainKey");return{senderSigningKeyPublic:r(b["public"],"public"),senderSigningKeyPrivate:b["private"]?d("WASignalSessions").bytesOrThrow(b["private"],32,"private"):void 0,senderKeyId:d("WASignalSessions").definedOrThrow(a.senderKeyId,"senderKeyId"),unusedMsgKeys:c.map(function(a){return k(d("WASignalSessions").definedOrThrow(a.iteration,"iteration"),d("WASignalSessions").bytesOrThrow(a.seed,50,"seed"))}),senderKeyChainKey:l(d("WASignalSessions").definedOrThrow(e.iteration,"iteration"),d("WASignalSessions").bytesOrThrow(e.seed,32,"seed"))}}function a(a,b,c,d,e){return{senderSigningKeyPublic:a,senderSigningKeyPrivate:b,senderKeyChainKey:c,senderKeyId:d,unusedMsgKeys:e==null?[]:e}}function b(a,b){var c=a.senderKeyStates.findIndex(function(a){return a.senderKeyId===b.senderKeyId});return{senderKeyStates:a.senderKeyStates.map(function(a,d){return d===c?b:a})}}function c(a,b){a=a.senderKeyStates.slice(a.senderKeyStates.length>h-1?1:0);a.push(b);return{senderKeyStates:a}}function e(a){return{senderKeyStates:[a]}}function k(a,b){return{iteration:a,seed:b}}function l(a,b){return{nextMsgIndex:a,chainKey:b}}function f(a){a=d("WASignalSessions").definedOrThrow(a.senderKeyStates,"senderKeyStates");return m(a)}function m(a){return n(a)}function n(a){a=a.map(function(a){return j(a)});return{senderKeyStates:a}}function o(a,b){var c=a.senderKeyStates.findIndex(function(a){return a.senderKeyId===b});return c===-1?void 0:a.senderKeyStates[c]}function p(a){return{senderKeyStates:a.senderKeyStates.map(function(a){return q(a)})}}function q(a){return{senderKeyId:a.senderKeyId,senderChainKey:{iteration:a.senderKeyChainKey.nextMsgIndex,seed:a.senderKeyChainKey.chainKey},senderSigningKey:{"public":a.senderSigningKeyPublic,"private":a.senderSigningKeyPrivate},senderMessageKeys:a.unusedMsgKeys.map(function(a){var b=a.iteration;a=a.seed;return{iteration:b,seed:a}})}}function r(a,b){return d("WASignalKeys").castToSerializedPubKey(new Uint8Array(d("WASignalSessions").definedOrThrow(a,b)))}function s(a){return a}g.FORMAT_VERSION=i;g.makeSenderKeyState=a;g.updateSessionWithUpdatedSenderKeyState=b;g.updateSessionWithNewSenderKeyState=c;g.makeNewSenderKeySession=e;g.makeSenderKeyMsgKey=k;g.makeSenderKeyChainKey=l;g.parseSessionFromRecord=f;g._parseSession=m;g.makeSenderKeySessionFromRecord=n;g.findSenderKeyState=o;g.serializeSession=p;g.serializeSenderKeyState=q;g.convertFromRawToSenderKeyState=s}),98);
__d("WASignalWhitepaper",["Promise","WABinary","WACryptoDependencies","WASignalGroupSession","WASignalKeys","WASignalOther","WASignalSessions","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new Uint8Array(32);i.fill(255);var j=new Uint8Array([1]),k=new Uint8Array([2]);function a(a,c,e){var f,g,h,j,k,l,m,q,r,s,t,u,v,w,x,y,z;return b("regeneratorRuntime").async(function(A){while(1)switch(A.prev=A.next){case 0:g=a.regId,h=a.staticKeyPair;j=c.identity;k=c.signedKey.publicKey;l=e.privateKey;m=h.privateKey;q=(f=c.oneTimeKey)==null?void 0:f.publicKey;r=d("WABinary").Binary.build(i,p(m,k),p(l,j),p(l,k),q&&p(l,q)).readByteArray();A.next=9;return b("regeneratorRuntime").awrap(o(r,"WhisperText"));case 9:s=A.sent;t=s[0];u=s[1];v=c.ratchetKey;w=d("WASignalSessions").makeFreshRecvChain(v,u);x=d("WASignalKeys").makeSerializedKeyPair();A.next=17;return b("regeneratorRuntime").awrap(n(t,x,v));case 17:y=A.sent;z=d("WASignalSessions").makeInitialExchangeInfo(c.oneTimeKey==null?null:c.oneTimeKey.id,c.signedKey.id,d("WASignalKeys").serializePubKey(e));return A.abrupt("return",d("WASignalSessions").makeFreshSession({regId:g,pubKey:d("WASignalKeys").serializePubKey(h)},{regId:c.regId,pubKey:j},y.rootKey,[w],d("WASignalSessions").makeFreshSendChain(x,y.chainKey),z,d("WASignalKeys").serializePubKey(e)));case 20:case"end":return A.stop()}},null,this)}function c(a,c,e,f){var g,h,j,k,l,m,n,p,r,s,t,u,v,w;return b("regeneratorRuntime").async(function(x){while(1)switch(x.prev=x.next){case 0:h=a.regId,j=a.staticKeyPair;k=j.privateKey;l=f.signed.privateKey;m=e;n=c.pubKey;p=(g=f.oneTime)==null?void 0:g.privateKey;r=d("WABinary").Binary.build(i,q(n,l),q(m,k),q(m,l),p&&q(m,p)).readByteArray();x.next=9;return b("regeneratorRuntime").awrap(o(r,"WhisperText"));case 9:s=x.sent;t=s[0];u=s[1];v=f.ratchet;w=d("WASignalSessions").makeFreshSendChain(v,u);return x.abrupt("return",d("WASignalSessions").makeSession({regId:h,pubKey:d("WASignalKeys").serializePubKey(j)},c,t,[],w,null,0,[],e));case 15:case"end":return x.stop()}},null,this)}function e(a){a=d("WASignalGroupSession").makeSenderKeyState(d("WASignalKeys").serializePubKey(a),a.privateKey,d("WASignalGroupSession").makeSenderKeyChainKey(0,d("WASignalKeys").makeRawSenderKey()),d("WASignalOther").makeSenderKeyId(),[]);return(h||(h=b("Promise"))).resolve(d("WASignalGroupSession").makeNewSenderKeySession(a))}function f(a,c,e,f,g){e=d("WASignalGroupSession").makeSenderKeyState(e,void 0,d("WASignalGroupSession").makeSenderKeyChainKey(c,f),a,[]);c=null;g?c=d("WASignalGroupSession").updateSessionWithNewSenderKeyState(g,e):c=d("WASignalGroupSession").makeNewSenderKeySession(e);return(h||(h=b("Promise"))).resolve(c)}function l(a,c){var e,f,g,i;return b("regeneratorRuntime").async(function(l){while(1)switch(l.prev=l.next){case 0:l.next=2;return b("regeneratorRuntime").awrap(d("WASignalOther").makeCryptoKey(c,"hmac-sha256"));case 2:e=l.sent;f=function(a){return d("WACryptoDependencies").getCrypto().subtle.sign({name:"HMAC",hash:"SHA-256"},e,a)};g=f(j).then(function(a){return d("WASignalOther").hkdf(new Uint8Array(a),null,"WhisperMessageKeys",80)}).then(function(b){return d("WASignalSessions").splitMsgKey(a,b)});i=f(k).then(function(a){return d("WASignalOther").toBytes(a,32)});return l.abrupt("return",(h||(h=b("Promise"))).all([i,g]));case 7:case"end":return l.stop()}},null,this)}function m(a,c){var e,f,g,i;return b("regeneratorRuntime").async(function(l){while(1)switch(l.prev=l.next){case 0:l.next=2;return b("regeneratorRuntime").awrap(d("WASignalOther").makeCryptoKey(c,"hmac-sha256"));case 2:e=l.sent;f=function(a){return d("WACryptoDependencies").getCrypto().subtle.sign({name:"HMAC",hash:"SHA-256"},e,a)};g=f(j).then(function(a){return d("WASignalOther").hkdf(new Uint8Array(a),null,"WhisperGroup",50)}).then(function(b){return d("WASignalGroupSession").makeSenderKeyMsgKey(a,b)});i=f(k).then(function(a){return d("WASignalOther").toBytes(a,32)});return l.abrupt("return",(h||(h=b("Promise"))).all([i,g]));case 7:case"end":return l.stop()}},null,this)}function n(a,c,e){var f,g,h,i,j,k;return b("regeneratorRuntime").async(function(l){while(1)switch(l.prev=l.next){case 0:f=c.privateKey;g=e;h=d("WASignalKeys").ecdh(f,g);l.next=5;return b("regeneratorRuntime").awrap(o(new Uint8Array(h),"WhisperRatchet",a));case 5:i=l.sent;j=i[0];k=i[1];return l.abrupt("return",{rootKey:j,chainKey:k});case 9:case"end":return l.stop()}},null,this)}function o(a,c,e){var f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:e===void 0&&(e=null);g.next=3;return b("regeneratorRuntime").awrap(d("WASignalOther").hkdf(a,e,c,64));case 3:f=g.sent;return g.abrupt("return",[d("WASignalOther").sliceBytes(f,0,32),d("WASignalOther").sliceBytes(f,32,32)]);case 5:case"end":return g.stop()}},null,this)}function p(a,b){return new Uint8Array(d("WASignalKeys").ecdh(a,b))}function q(a,b){return p(b,a)}g.initiateSessionOutgoing=a;g.initiateSessionIncoming=c;g.initiateSenderKeySessionOutgoing=e;g.initiateSenderKeySessionIncoming=f;g.deriveMsgKey=l;g.deriveSenderKeyMsgKey=m;g.calculateRatchet=n}),98);
__d("WASignalCipher",["Promise","WABaseGlobals","WABinary","WACryptoDependencies","WACryptoUtils","WALogger","WAResultOrError","WASignalKeys","WASignalOther","WASignalSessions","WASignalSignatures","WASignalWhisperTextProtocol.pb","WASignalWhitepaper","decodeProtobuf","encodeProtobuf","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["This would only fail if config is not initialised"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["decryptMsgFromSession error ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["deserializePkMsg error ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["deserializeMsg error ",""]);l=function(){return a};return a}var m=40,n=8,o=2e3;function a(a,c){var e,f,g,h,i,j,k,l,m,o,p,q,r,s,t,v,y,z,A,B,C;return b("regeneratorRuntime").async(function(D){while(1)switch(D.prev=D.next){case 0:e=a.sendChain;D.next=3;return b("regeneratorRuntime").awrap(d("WASignalWhitepaper").deriveMsgKey(e.nextMsgIndex,e.chainKey));case 3:f=D.sent;g=f[0];h=f[1];D.next=8;return b("regeneratorRuntime").awrap(x(h));case 8:i=D.sent;j=i.cipherKey;k=i.macKey;D.next=13;return b("regeneratorRuntime").awrap(d("WACryptoDependencies").getCrypto().subtle.encrypt({name:"AES-CBC",iv:h.iv},j,c));case 13:l=D.sent;m=new(d("WABinary").Binary)();m.writeByteArray(a.local.pubKey);m.writeByteArray(a.remote.pubKey);o=m.size();m.writeUint8(u(d("WASignalSessions").FORMAT_VERSION,d("WASignalSessions").FORMAT_VERSION));d("encodeProtobuf").encodeProtobuf(d("WASignalWhisperTextProtocol.pb").SignalMessageSpec,{ratchetKey:e.ratchetKey.serializedPubKey,counter:h.index,previousCounter:a.prevSendChainHighestIndex,ciphertext:l},m);p=m.readByteArray();D.next=23;return b("regeneratorRuntime").awrap(w(k,p));case 23:q=D.sent;r=p.subarray(o);s=d("WABinary").Binary.build(r,new Uint8Array(q,0,n)).readByteArray();y=a.initialExchangeInfo;y!=null?(A=new(d("WABinary").Binary)(),A.writeUint8(u(d("WASignalSessions").FORMAT_VERSION,d("WASignalSessions").FORMAT_VERSION)),d("encodeProtobuf").encodeProtobuf(d("WASignalWhisperTextProtocol.pb").PreKeySignalMessageSpec,{registrationId:a.local.regId,preKeyId:(z=y.remoteOneTimeId)!=null?z:void 0,signedPreKeyId:y.remoteSignedId,baseKey:y.localOneTimePubKey,identityKey:a.local.pubKey,message:s},A),t="pkmsg",v=A.readByteArray()):(t="msg",v=s);B=d("WASignalSessions").makeSendChain(e.ratchetKey,h.index+1,g);C=d("WASignalSessions").updateChains(a,a.recvChains,B);return D.abrupt("return",[C,{type:t,ciphertext:v}]);case 31:case"end":return D.stop()}},null,this)}function c(a,c){var e,f,g,h,i,j,k,l,m,n,o,p,q,s;return b("regeneratorRuntime").async(function(t){while(1)switch(t.prev=t.next){case 0:if(!(a==null)){t.next=2;break}return t.abrupt("return",d("WAResultOrError").makeError("errSignalNoSession"));case 2:t.next=4;return b("regeneratorRuntime").awrap(r(a,c));case 4:e=t.sent;if(!e.success){t.next=10;break}f=e.value,g=f[0],h=f[1];return t.abrupt("return",d("WAResultOrError").makeResult({newSessionInfo:null,updatedSession:g,plaintext:h}));case 10:i=a.prevSessions,j=e,k=0;case 13:if(!(!j.success&&k<i.length)){t.next=22;break}l=d("WASignalSessions").parseSession(i[k]);t.next=17;return b("regeneratorRuntime").awrap(r(l,c));case 17:m=t.sent,m.success&&((n=m.value,o=n[0],p=n[1]),q=d("WASignalSessions").setPrevSessions(o,[d("WASignalSessions").detachSession(a)].concat(i.slice(0,k),i.slice(k+1))),s=!a||!d("WACryptoUtils").serializedPubKeysEqual(q.remote.pubKey,a.remote.pubKey)?q.remote.pubKey:null,j=d("WAResultOrError").makeResult({newSessionInfo:{newIdentity:s,baseSession:l,usedPreKey:null},updatedSession:q,plaintext:p}));case 19:k++;t.next=13;break;case 22:return t.abrupt("return",j);case 23:case"end":return t.stop()}},null,this)}function e(a,b){if(y(a,b))return a;var c=a.prevSessions;for(var e=0;e<c.length;e++){var f=d("WASignalSessions").parseSession(c[e]);if(y(f,b))return d("WASignalSessions").setPrevSessions(f,[d("WASignalSessions").detachSession(a)].concat(c.slice(0,e),c.slice(e+1)))}return null}function f(a,c,e,f){var g,h,i,j,k,l,n,o,p,q,s,t;return b("regeneratorRuntime").async(function(u){while(1)switch(u.prev=u.next){case 0:h=f.localSignedPreKey;if(!(h==null)){u.next=3;break}return u.abrupt("return",d("WAResultOrError").makeError("errSignalInvalidSignedPreKey"));case 3:i=d("WASignalSignatures").deserializeSignedPreKey(h);if(!(i==null)){u.next=6;break}return u.abrupt("return",d("WAResultOrError").makeError("errSignalSignedPreKeyDeserialization"));case 6:if(!(i.id!==e.localSignedPreKeyId)){u.next=8;break}return u.abrupt("return",d("WAResultOrError").makeError("errSignalSignedPreKeyIdMismatch"));case 8:j=null;if(!(e.localOneTimeKeyId!=null)){u.next=18;break}k=f.localOneTimeKey;if(!(k==null)){u.next=13;break}return u.abrupt("return",d("WAResultOrError").makeError("errSignalInvalidOneTimeKey"));case 13:j=d("WASignalKeys").deserializePreKey(k);if(!(j==null)){u.next=16;break}return u.abrupt("return",d("WAResultOrError").makeError("errSignalOneTimeKeyDeserialization"));case 16:if(!(j.id!==e.localOneTimeKeyId)){u.next=18;break}return u.abrupt("return",d("WAResultOrError").makeError("errSignalOneTimeKeyMismatch"));case 18:u.next=20;return b("regeneratorRuntime").awrap(d("WASignalWhitepaper").initiateSessionIncoming(a,e.remote,e.sessionBaseKey,{signed:i.keyPair,oneTime:(g=j)==null?void 0:g.keyPair,ratchet:d("WASignalKeys").toSerializedKeyPair(i.keyPair)}));case 20:l=u.sent;n=l.remote.pubKey;o=!c||!d("WACryptoUtils").serializedPubKeysEqual(n,c.remote.pubKey)?n:null;c&&!o&&(l=d("WASignalSessions").setPrevSessions(l,[d("WASignalSessions").detachSession(c)].concat(c.prevSessions.slice(0,m-1))));u.next=26;return b("regeneratorRuntime").awrap(r(l,e));case 26:p=u.sent;if(p.success){u.next=29;break}return u.abrupt("return",p);case 29:q=p.value,s=q[0],t=q[1];return u.abrupt("return",d("WAResultOrError").makeResult({newIdentity:o,baseSession:l,updatedSession:s,plaintext:t}));case 31:case"end":return u.stop()}},null,this)}function p(a){var b,c,e=null;try{var f=t(a,d("WASignalSessions").FORMAT_VERSION,n);if(!f.success)return f;f=d("decodeProtobuf").decodeProtobuf(d("WASignalWhisperTextProtocol.pb").SignalMessageSpec,f.value);var g=f.ratchetKey;e=f.counter;c=f.ciphertext;if(g==null||e==null||c==null)return d("WAResultOrError").makeError("errSignalDeserializeInvalidProtoFormat");b=d("WASignalKeys").castToSerializedPubKey(new Uint8Array(g))}catch(a){d("WALogger").DEV(l(),a);return d("WAResultOrError").makeError("errSignalDeserializeRatchetKeyBadFormat")}f={ratchetPubKey:b,counter:e,ciphertext:new Uint8Array(c),versionContentMac:a};return d("WAResultOrError").makeResult(f)}function q(a){a=t(a,d("WASignalSessions").FORMAT_VERSION,0);if(!a.success)return a;var b,c,e,f,g;try{a=d("decodeProtobuf").decodeProtobuf(d("WASignalWhisperTextProtocol.pb").PreKeySignalMessageSpec,a.value);var h=a.registrationId,i=a.preKeyId,j=a.signedPreKeyId,l=a.baseKey,m=a.identityKey;a=a.message;if(h==null||j==null||l==null||m==null||a==null)return d("WAResultOrError").makeError("errSignalDeserializePkInvalidProtoFormat");f=d("WASignalKeys").castToSerializedPubKey(new Uint8Array(l));b={regId:d("WASignalOther").castRegistrationId(h),pubKey:d("WASignalKeys").castToSerializedPubKey(new Uint8Array(m))};e=i!=null?d("WASignalKeys").castToPreKeyId(i):null;c=d("WASignalKeys").castToSignedPreKeyId(j);g=new Uint8Array(a)}catch(a){d("WALogger").DEV(k(),a);return d("WAResultOrError").makeError("errSignalDeserializePkKeyBadFormat")}l=p(g);return!l.success?l:d("WAResultOrError").makeResult(babelHelpers["extends"]({},l.value,{remote:b,sessionBaseKey:f,localSignedPreKeyId:c,localOneTimeKeyId:e}))}function r(a,c){var e,f,g,h,i,k,l,m,o,p,q,r,t,u,v,y,z,A,B,C,D,E,F,G,H,I;return b("regeneratorRuntime").async(function(J){while(1)switch(J.prev=J.next){case 0:e=c.ratchetPubKey,f=c.counter,g=c.ciphertext,h=c.versionContentMac;i=a.recvChains;k=a.recvChains.findIndex(function(a){return d("WACryptoUtils").serializedPubKeysEqual(a.ratchetPubKey,e)});if(!(k===-1)){J.next=24;break}J.next=6;return b("regeneratorRuntime").awrap(d("WASignalWhitepaper").calculateRatchet(a.rootKey,a.sendChain.ratchetKey,e));case 6:o=J.sent;p=d("WASignalSessions").makeFreshRecvChain(e,o.chainKey);J.next=10;return b("regeneratorRuntime").awrap(s(p,f));case 10:q=J.sent;if(q.success){J.next=13;break}return J.abrupt("return",q);case 13:r=q.value;t=d("WASignalKeys").makeSerializedKeyPair();J.next=17;return b("regeneratorRuntime").awrap(d("WASignalWhitepaper").calculateRatchet(o.rootKey,t,e));case 17:u=J.sent;v=i.slice(-4);v.push(r.updatedChain);m=r.msgKey;l=d("WASignalSessions").ratchetSession(a,v,d("WASignalSessions").makeFreshSendChain(t,u.chainKey),u.rootKey);J.next=34;break;case 24:J.next=26;return b("regeneratorRuntime").awrap(s(i[k],f));case 26:y=J.sent;if(y.success){J.next=29;break}return J.abrupt("return",y);case 29:z=y.value,A=i.slice(),A[k]=z.updatedChain,m=z.msgKey,l=d("WASignalSessions").updateChains(a,A,a.sendChain);case 34:J.next=36;return b("regeneratorRuntime").awrap(x(m));case 36:B=J.sent;C=B.cipherKey;D=B.macKey;E=d("WABinary").Binary.build(a.remote.pubKey,a.local.pubKey,h.subarray(0,-n)).readByteArray();J.next=42;return b("regeneratorRuntime").awrap(w(D,E));case 42:F=J.sent;G=h.subarray(-n);H=!d("WACryptoUtils").uint8ArraysEqual(new Uint8Array(F,0,n),G);I=null;J.prev=46;J.next=49;return b("regeneratorRuntime").awrap(d("WACryptoDependencies").getCrypto().subtle.decrypt({name:"AES-CBC",iv:m.iv},C,g));case 49:I=J.sent;J.next=55;break;case 52:J.prev=52,J.t0=J["catch"](46),d("WALogger").DEV(j(),J.t0);case 55:if(!(H&&I==null)){J.next=59;break}if(!(k===-1)){J.next=58;break}return J.abrupt("return",d("WAResultOrError").makeError("errInvalidMacInvalidCipherKeyNewChain"));case 58:return J.abrupt("return",d("WAResultOrError").makeError("errInvalidMacInvalidCipherKey"));case 59:if(!H){J.next=61;break}return J.abrupt("return",d("WAResultOrError").makeError("errInvalidMacWithDecryptedPlaintext"));case 61:if(!(I==null)){J.next=63;break}return J.abrupt("return",d("WAResultOrError").makeError("errUnknownInvalidCipherKey"));case 63:return J.abrupt("return",d("WAResultOrError").makeResult([l,I]));case 64:case"end":return J.stop()}},null,this,[[46,52]])}function s(a,c){var e,f,g,h,j,k,l,m,n,p,q,r;return b("regeneratorRuntime").async(function(s){while(1)switch(s.prev=s.next){case 0:e=c-a.nextMsgIndex;f=2e3;try{f=d("WABaseGlobals").getConfig().getSignalFutureMessagesMax()}catch(a){d("WALogger").ERROR(i())}if(!(e>f)){s.next=5;break}return s.abrupt("return",d("WAResultOrError").makeError("errSignalTooManyMessagesInFuture"));case 5:g=a.unusedMsgKeys;if(!(e<0)){s.next=11;break}h=g.findIndex(function(a){return a.index===c});if(!(h===-1)){s.next=10;break}return s.abrupt("return",d("WAResultOrError").makeError("errDuplicateMsg"));case 10:return s.abrupt("return",d("WAResultOrError").makeResult({msgKey:g[h],updatedChain:d("WASignalSessions").makeRecvChain(a.ratchetPubKey,a.nextMsgIndex,a.chainKey,v(g,h))}));case 11:j=a.nextMsgIndex;s.next=14;return b("regeneratorRuntime").awrap(d("WASignalWhitepaper").deriveMsgKey(j,a.chainKey));case 14:k=s.sent;l=k[0];m=k[1];n=null;if(!(e>0)){s.next=32;break}p=e+g.length-o;p>0?(n=g.slice(p),p-=g.length):n=g.slice();q=j+1;case 22:if(!(q<=c)){s.next=32;break}p>0?p--:n.push(m);s.next=26;return b("regeneratorRuntime").awrap(d("WASignalWhitepaper").deriveMsgKey(q,l));case 26:r=s.sent,l=r[0],m=r[1];case 29:q++;s.next=22;break;case 32:return s.abrupt("return",d("WAResultOrError").makeResult({msgKey:m,updatedChain:d("WASignalSessions").makeRecvChain(a.ratchetPubKey,c+1,l,n||g)}));case 33:case"end":return s.stop()}},null,this)}function t(a,b,c){if(a.length<1)return d("WAResultOrError").makeError("errSignalEmptyVersionContentSuffix");var e=a[0]>>>4;if(e!==b)return e<b?d("WAResultOrError").makeError("errSignalLegacyMsg"):d("WAResultOrError").makeError("errSignalInvalidVersion");e=a.length-c;return e<1?d("WAResultOrError").makeError("errSignalContentExceededExpectedLength"):d("WAResultOrError").makeResult(a.subarray(1,e))}function u(a,b){return(a<<4|b)&255}function v(a,b){var c=[];for(var d=0;d<a.length;d++)d!==b&&c.push(a[d]);return c}function w(a,b){return d("WACryptoDependencies").getCrypto().subtle.sign(d("WASignalOther").HMAC_SHA256,a,b)}function x(a){return(h||(h=b("Promise"))).all([d("WASignalOther").makeCryptoKey(a.cipherKey,"aes-cbc"),d("WASignalOther").makeCryptoKey(a.macKey,"hmac-sha256")]).then(function(a){var b=a[0];a=a[1];return{cipherKey:b,macKey:a}})}function y(a,b){a=a.aliceBaseKey;return!a?!1:d("WACryptoUtils").serializedPubKeysEqual(a,b)}g.MAX_UNUSED_KEYS=o;g.encryptMsg=a;g.decryptMsg=c;g.findMatchingSession=e;g.decryptPkMsgWithNewSession=f;g.deserializeMsg=p;g.deserializePkMsg=q;g.decryptMsgFromSession=r;g.readContent=t;g.versionByte=u}),98);
__d("WASignalGroupCipher",["WABaseGlobals","WABinary","WACryptoDependencies","WALogger","WAResultOrError","WASignalCipher","WASignalGroupSession","WASignalKeys","WASignalOther","WASignalSessions","WASignalSignatures","WASignalWhisperTextProtocol.pb","WASignalWhitepaper","decodeProtobuf","encodeProtobuf","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["This would only fail if config is not initialised"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Exception caught during SenderKeyMessageSpec Proto: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["deserializeSenderKeyDistributionMsg error ",""]);j=function(){return a};return a}var k=64;function a(a,c){var e,f,g,h,i,j,k;return b("regeneratorRuntime").async(function(m){while(1)switch(m.prev=m.next){case 0:e=l(a);if(e.success){m.next=3;break}return m.abrupt("return",e);case 3:f=e.value,g=f.senderKeyId,h=f.iteration,i=f.signingKeyPublic,j=f.chainKey;m.next=6;return b("regeneratorRuntime").awrap(d("WASignalWhitepaper").initiateSenderKeySessionIncoming(g,h,i,j,c));case 6:k=m.sent;return m.abrupt("return",d("WAResultOrError").makeResult(k));case 8:case"end":return m.stop()}},null,this)}function c(a){a=d("WASignalGroupSession").serializeSenderKeyState(a);var b=new(d("WABinary").Binary)();b.writeUint8(d("WASignalCipher").versionByte(d("WASignalGroupSession").FORMAT_VERSION,d("WASignalGroupSession").FORMAT_VERSION));d("encodeProtobuf").encodeProtobuf(d("WASignalWhisperTextProtocol.pb").SenderKeyDistributionMessageSpec,{id:a.senderKeyId,iteration:d("WASignalSessions").definedOrThrow(a.senderChainKey,"senderChainKey").iteration,chainKey:d("WASignalSessions").definedOrThrow(a.senderChainKey,"senderChainKey").seed,signingKey:d("WASignalSessions").definedOrThrow(a.senderSigningKey,"senderSigningKey")["public"]},b);return b.readByteArray()}function e(a,c){var e,f,g,h,i,j,k,l,m,o,p,q,r,s,t;return b("regeneratorRuntime").async(function(u){while(1)switch(u.prev=u.next){case 0:if(!(!a.senderKeyStates||a.senderKeyStates.length===0)){u.next=2;break}return u.abrupt("return",d("WAResultOrError").makeError("errSignalNoSession"));case 2:e=a.senderKeyStates[a.senderKeyStates.length-1];u.next=5;return b("regeneratorRuntime").awrap(d("WASignalWhitepaper").deriveSenderKeyMsgKey(e.senderKeyChainKey.nextMsgIndex,e.senderKeyChainKey.chainKey));case 5:f=u.sent;g=f[0];h=f[1];u.next=10;return b("regeneratorRuntime").awrap(n(h.seed));case 10:i=u.sent;j=i[0];k=i[1];u.next=15;return b("regeneratorRuntime").awrap(d("WACryptoDependencies").getCrypto().subtle.encrypt({name:"AES-CBC",iv:k},j,c));case 15:l=u.sent;m=new(d("WABinary").Binary)();d("encodeProtobuf").encodeProtobuf(d("WASignalWhisperTextProtocol.pb").SenderKeyMessageSpec,{id:e.senderKeyId,iteration:h.iteration,ciphertext:l},m);o=new(d("WABinary").Binary)();o.writeUint8(d("WASignalCipher").versionByte(d("WASignalGroupSession").FORMAT_VERSION,d("WASignalGroupSession").FORMAT_VERSION));o.writeBinary(m);p=d("WASignalKeys").makeKeyPairFromSerialized(d("WASignalSessions").definedOrThrow(e.senderSigningKeyPrivate,"senderSigningKeyPrivate"),e.senderSigningKeyPublic);q=d("WASignalSignatures").signSenderKeyMessage(p,o.readByteArray());r=new(d("WABinary").Binary)();r.writeUint8(d("WASignalCipher").versionByte(d("WASignalGroupSession").FORMAT_VERSION,d("WASignalGroupSession").FORMAT_VERSION));r.writeBinary(m);r.writeByteArray(q);s=d("WASignalGroupSession").makeSenderKeyChainKey(h.iteration+1,g);t=d("WASignalGroupSession").updateSessionWithUpdatedSenderKeyState(a,d("WASignalGroupSession").makeSenderKeyState(e.senderSigningKeyPublic,e.senderSigningKeyPrivate,s,e.senderKeyId,e.unusedMsgKeys));return u.abrupt("return",d("WAResultOrError").makeResult([t,r.readByteArray()]));case 30:case"end":return u.stop()}},null,this)}function f(a,c){var e,f,g,h,i,j,k,l,m,q,r,s,t,u,v;return b("regeneratorRuntime").async(function(w){while(1)switch(w.prev=w.next){case 0:e=c.senderKeyMessageId,f=c.iteration,g=c.ciphertext,h=c.versionContentMac;i=d("WASignalGroupSession").findSenderKeyState(a,e);if(!(i==null)){w.next=4;break}return w.abrupt("return",d("WAResultOrError").makeError("errSignalNoSession"));case 4:j=i.senderSigningKeyPublic;k=o(h,j);if(k){w.next=8;break}return w.abrupt("return",d("WAResultOrError").makeError("errSignalInvalidKey"));case 8:w.next=10;return b("regeneratorRuntime").awrap(p(i,f));case 10:l=w.sent;if(l.success){w.next=13;break}return w.abrupt("return",l);case 13:m=l.value;q=m.msgKey;r=d("WASignalGroupSession").updateSessionWithUpdatedSenderKeyState(a,m.updatedSenderKeyState);w.next=18;return b("regeneratorRuntime").awrap(n(q.seed));case 18:s=w.sent;t=s[0];u=s[1];w.next=23;return b("regeneratorRuntime").awrap(d("WACryptoDependencies").getCrypto().subtle.decrypt({name:"AES-CBC",iv:u},t,g));case 23:v=w.sent;return w.abrupt("return",d("WAResultOrError").makeResult([r,v]));case 25:case"end":return w.stop()}},null,this)}function l(a){var b,c,e,f;try{a=d("WASignalCipher").readContent(a,d("WASignalGroupSession").FORMAT_VERSION,0);if(!a.success)return a;a=d("decodeProtobuf").decodeProtobuf(d("WASignalWhisperTextProtocol.pb").SenderKeyDistributionMessageSpec,a.value);b=a.id;c=a.iteration;var g=d("WASignalSessions").bytesOrThrow(a.signingKey,33,"signingKey");e=d("WASignalKeys").castToSerializedPubKey(g);f=d("WASignalSessions").bytesOrThrow(a.chainKey,32,"chainKey");if(b==null||c==null)return d("WAResultOrError").makeError("errSignalGrpInvalidProtoFormat")}catch(a){d("WALogger").DEV(j(),a);return d("WAResultOrError").makeError("errSignalGrpInvalidKeyFormat")}return d("WAResultOrError").makeResult({senderKeyId:b,iteration:c,signingKeyPublic:e,chainKey:f})}function m(a){if(a.length<1)return d("WAResultOrError").makeError("errSignalGrpVersionContentEmpty");var b=a[0]>>>4;if(b!==d("WASignalGroupSession").FORMAT_VERSION)return b<d("WASignalGroupSession").FORMAT_VERSION?d("WAResultOrError").makeError("errSignalLegacyMsg"):d("WAResultOrError").makeError("errSignalInvalidVersion");if(a.length<1+k)return d("WAResultOrError").makeError("errSignalGrpInvalidVersionContentLength");var c,e,f;try{b=a.subarray(1,-k);b=d("decodeProtobuf").decodeProtobuf(d("WASignalWhisperTextProtocol.pb").SenderKeyMessageSpec,b);c=b.id;e=b.iteration;f=b.ciphertext;if(c==null||e==null||f==null)return d("WAResultOrError").makeError("errSignalGrpSenderKeyInvalidProtoFormat")}catch(a){d("WALogger").ERROR(i(),a);return d("WAResultOrError").makeError("errSignalGrpSenderKeyProtoError")}return d("WAResultOrError").makeResult({senderKeyMessageId:c,iteration:e,ciphertext:new Uint8Array(f),versionContentMac:a})}function n(a){var c,e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:c=new(d("WABinary").Binary)(a);e=d("WASignalOther").readBytes(c,16);f=d("WASignalOther").readBytes(c,32);g.next=5;return b("regeneratorRuntime").awrap(d("WASignalOther").makeCryptoKey(f,"aes-cbc"));case 5:g.t0=g.sent;g.t1=e;return g.abrupt("return",[g.t0,g.t1]);case 8:case"end":return g.stop()}},null,this)}function o(a,b){var c=a.subarray(a.length-k);a=a.subarray(0,a.length-k);return d("WASignalSignatures").verifyMsgSignalVariant(b,a,d("WASignalOther").toBytes(d("WASignalOther").toBuffer(c),64))}function p(a,c){var e,f,g,i,j,k,l,m,n,o,p,r,s;return b("regeneratorRuntime").async(function(t){while(1)switch(t.prev=t.next){case 0:e=a;f=c-e.senderKeyChainKey.nextMsgIndex;g=2e3;try{g=d("WABaseGlobals").getConfig().getSignalFutureMessagesMax()}catch(a){d("WALogger").ERROR(h())}if(!(f>g)){t.next=6;break}return t.abrupt("return",d("WAResultOrError").makeError("errSignalGrpTooManyMessagesInFuture"));case 6:i=a.unusedMsgKeys||[];if(!(f<0)){t.next=12;break}j=i.findIndex(function(a){return a.iteration===c});if(!(j===-1)){t.next=11;break}return t.abrupt("return",d("WAResultOrError").makeError("errDuplicateMsg"));case 11:return t.abrupt("return",d("WAResultOrError").makeResult({msgKey:i[j],updatedSenderKeyState:d("WASignalGroupSession").makeSenderKeyState(e.senderSigningKeyPublic,e.senderSigningKeyPrivate,e.senderKeyChainKey,e.senderKeyId,q(i,j))}));case 12:k=e.senderKeyChainKey.nextMsgIndex;t.next=15;return b("regeneratorRuntime").awrap(d("WASignalWhitepaper").deriveSenderKeyMsgKey(k,e.senderKeyChainKey.chainKey));case 15:l=t.sent;m=l[0];n=l[1];o=null;if(!(f>0)){t.next=33;break}p=f+i.length-d("WASignalCipher").MAX_UNUSED_KEYS;p>0?(o=i.slice(p),p-=i.length):o=i.slice();r=k+1;case 23:if(!(r<=c)){t.next=33;break}p>0?p--:o.push(n);t.next=27;return b("regeneratorRuntime").awrap(d("WASignalWhitepaper").deriveSenderKeyMsgKey(r,m));case 27:s=t.sent,m=s[0],n=s[1];case 30:r++;t.next=23;break;case 33:return t.abrupt("return",d("WAResultOrError").makeResult({msgKey:n,updatedSenderKeyState:d("WASignalGroupSession").makeSenderKeyState(e.senderSigningKeyPublic,e.senderSigningKeyPrivate,d("WASignalGroupSession").makeSenderKeyChainKey(c+1,m),a.senderKeyId,o||i)}));case 34:case"end":return t.stop()}},null,this)}function q(a,b){var c=[];for(var d=0;d<a.length;d++)d!==b&&c.push(a[d]);return c}g.processSenderKeyDistributionMsg=a;g.createSenderKeyDistributionProto=c;g.encryptSenderKeyMsgWithSession=e;g.decryptSenderKeyMsgFromSession=f;g.deserializeSenderKeyMsg=m}),98);
__d("WACryptoLibrary",["WACryptoUtils","WAJids","WALockMap","WALogger","WAResultOrError","WASignalCipher","WASignalGroupCipher","WASignalGroupSession","WASignalKeys","WASignalOther","WASignalSignatures","WASignalWhitepaper","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["getSessionForRecipient pkmsg signature verification result: ",""]);h=function(){return a};return a}var i=d("WALockMap").makeLockMap(60*1e3),j=[],k=300;function l(a){j.push(a),j.length>=k&&j.shift()}function a(a){a(j),j=[]}function m(a,c){var e,f,g,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:l("createOutgoingSession");e=t(c);f=e.signedKey;j.next=5;return b("regeneratorRuntime").awrap(d("WASignalSignatures").verifyMsgSignalVariant(e.identity,f.publicKey,f.signature));case 5:g=j.sent;d("WALogger").DEV(h(),g);if(g){j.next=10;break}l("createOutgoingSession: errSignalInvalidKey");return j.abrupt("return",d("WAResultOrError").makeError("errSignalInvalidKey"));case 10:j.next=12;return b("regeneratorRuntime").awrap(d("WASignalWhitepaper").initiateSessionOutgoing(a,e,d("WASignalKeys").makeKeyPair()));case 12:i=j.sent;return j.abrupt("return",d("WAResultOrError").makeResult(i));case 14:case"end":return j.stop()}},null,this)}function c(a,c,d,e,f){var g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:g=a.handleNewSession;l("establishOutgoingSession");j.next=4;return b("regeneratorRuntime").awrap(m(c,e));case 4:h=j.sent;if(h.success){j.next=7;break}return j.abrupt("return",h);case 7:i=h.value;return j.abrupt("return",g(d,i,i.remote.pubKey,null,f));case 9:case"end":return j.stop()}},null,this)}function e(a,c,e,f){var g=a.loadSession,h=a.handleNewSession;l("encryptContent");return i.lock([d("WAJids").extractUserJid(c)],function(){var a,i,j,k,m,n;return b("regeneratorRuntime").async(function(o){while(1)switch(o.prev=o.next){case 0:a=null;case 1:o.next=3;return b("regeneratorRuntime").awrap(g(c,"cryptoLibraryEncryptContent"));case 3:i=o.sent;if(!(i==null)){o.next=7;break}l("encryptContent: errSignalInvalidKey");return o.abrupt("return",d("WAResultOrError").makeError("errSignalInvalidKey"));case 7:if(!(f!=null&&!d("WACryptoUtils").uint8ArraysEqual(f,i.remote.pubKey))){o.next=10;break}l("encryptContent: identity-mismatch");return o.abrupt("return",d("WAResultOrError").makeError("identity-mismatch"));case 10:o.next=12;return b("regeneratorRuntime").awrap(d("WASignalCipher").encryptMsg(i,e));case 12:j=o.sent;k=j[0];m=j[1];o.next=17;return b("regeneratorRuntime").awrap(h(c,k,k.remote.pubKey));case 17:n=o.sent,n.success?a=d("WAResultOrError").makeResult(babelHelpers["extends"]({},m,{baseKey:k.aliceBaseKey})):n.error;case 19:if(a==null){o.next=1;break}case 20:return o.abrupt("return",a);case 21:case"end":return o.stop()}},null,this)})}function f(a,c,e,f,g){var h=a.loadSession,j=a.handleNewSession,k=a.loadSignedPreKey,m=a.loadOneTimePreKey;l("decryptContent");return i.lock([d("WAJids").extractUserJid(e)],function(){var a,i,o,p,q,r,s,t,u,v,w,x;return b("regeneratorRuntime").async(function(y){while(1)switch(y.prev=y.next){case 0:a=!1;y.next=3;return b("regeneratorRuntime").awrap(h(e,"decryptContent"));case 3:i=y.sent;if(!(f.type==="pkmsg")){y.next=18;break}p=d("WASignalCipher").deserializePkMsg(f.ciphertext);if(p.success){y.next=9;break}l("decryptContent: errCryptoDeserialization");return y.abrupt("return",d("WAResultOrError").makeError("errCryptoDeserialization"));case 9:q=p.value;y.next=12;return b("regeneratorRuntime").awrap(n({loadSignedPreKey:k,loadOneTimePreKey:m},c,q,i));case 12:r=y.sent;if(r.success){y.next=15;break}return y.abrupt("return",r);case 15:o=r.value;y.next=30;break;case 18:f.type;s=d("WASignalCipher").deserializeMsg(f.ciphertext);if(s.success){y.next=23;break}l("decryptContent: errCryptoDeserialization");return y.abrupt("return",d("WAResultOrError").makeError("errCryptoDeserialization"));case 23:t=s.value;y.next=26;return b("regeneratorRuntime").awrap(d("WASignalCipher").decryptMsg(i,t));case 26:u=y.sent;if(u.success){y.next=29;break}return y.abrupt("return",u);case 29:o=u.value;case 30:v=o,w=v.newSessionInfo;if(!(w&&(w.newIdentity!=null||w.usedPreKey!=null))){y.next=34;break}y.next=34;return b("regeneratorRuntime").awrap(j(e,w.baseSession,w.newIdentity,w.usedPreKey));case 34:if(a){y.next=39;break}x=w==null?void 0:w.baseSession.remote.pubKey;y.next=38;return b("regeneratorRuntime").awrap(g(new Uint8Array(o.plaintext),x));case 38:a=!0;case 39:y.next=41;return b("regeneratorRuntime").awrap(j(e,o.updatedSession,o.updatedSession.remote.pubKey));case 41:return y.abrupt("return",d("WAResultOrError").makeResult());case 42:case"end":return y.stop()}},null,this)})}function n(a,c,e,f){var g,h,i,j,k,m,n,o,p,q,r,s,t,u,v,w;return b("regeneratorRuntime").async(function(x){while(1)switch(x.prev=x.next){case 0:g=a.loadSignedPreKey,h=a.loadOneTimePreKey;l("decryptPkMsg");i=f&&d("WASignalCipher").findMatchingSession(f,e.sessionBaseKey);if(!i){x.next=13;break}x.next=6;return b("regeneratorRuntime").awrap(d("WASignalCipher").decryptMsgFromSession(i,e));case 6:j=x.sent;if(j.success){x.next=9;break}return x.abrupt("return",j);case 9:k=j.value,m=k[0],n=k[1];return x.abrupt("return",d("WAResultOrError").makeResult({newSessionInfo:null,updatedSession:m,plaintext:n}));case 13:o=e.localOneTimeKeyId;x.next=16;return b("regeneratorRuntime").awrap(g(e.localSignedPreKeyId));case 16:p=x.sent;if(!(o==null)){x.next=21;break}x.t0=null;x.next=24;break;case 21:x.next=23;return b("regeneratorRuntime").awrap(h(o));case 23:x.t0=x.sent;case 24:q=x.t0;x.next=27;return b("regeneratorRuntime").awrap(d("WASignalCipher").decryptPkMsgWithNewSession(c,f,e,{localSignedPreKey:p,localOneTimeKey:q}));case 27:r=x.sent;if(r.success){x.next=30;break}return x.abrupt("return",r);case 30:s=r.value,t=s.newIdentity,u=s.baseSession,v=s.updatedSession,w=s.plaintext;return x.abrupt("return",d("WAResultOrError").makeResult({newSessionInfo:{newIdentity:t,baseSession:u,usedPreKey:o},updatedSession:v,plaintext:w}));case 32:case"end":return x.stop()}},null,this)}function o(c,e,f,g){var h=c.loadSenderKeySession,a=c.saveSenderKeySession;l("encryptGroupContent");return i.lock([e,d("WAJids").extractUserJid(f)],function(){var c,i,j,k,m,n,o,p;return b("regeneratorRuntime").async(function(q){while(1)switch(q.prev=q.next){case 0:c=null;case 1:q.next=3;return b("regeneratorRuntime").awrap(h(e,f));case 3:i=q.sent;if(i.success){q.next=6;break}return q.abrupt("return",d("WAResultOrError").makeError(i.error));case 6:j=i.value;q.next=9;return b("regeneratorRuntime").awrap(d("WASignalGroupCipher").encryptSenderKeyMsgWithSession(j,g));case 9:k=q.sent;if(!k.success){q.next=18;break}m=k.value,n=m[0],o=m[1];q.next=14;return b("regeneratorRuntime").awrap(a(e,f,n));case 14:p=j.senderKeyStates[j.senderKeyStates.length-1];c=d("WAResultOrError").makeResult({ciphertext:{ciphertext:o,type:"skmsg"},senderKeyId:p.senderKeyId,senderKeyDistributionProto:d("WASignalGroupCipher").createSenderKeyDistributionProto(d("WASignalGroupSession").convertFromRawToSenderKeyState(p))});q.next=20;break;case 18:l("encryptGroupContent: sender-key-no-session");return q.abrupt("return",d("WAResultOrError").makeError("sender-key-no-session"));case 20:if(c==null){q.next=1;break}case 21:return q.abrupt("return",c);case 22:case"end":return q.stop()}},null,this)})}function p(c,e,f,g,h){var j=c.loadSenderKeySession,a=c.saveSenderKeySession;l("decryptGroupContent");return i.lock([e,d("WAJids").extractUserJid(f)],function(){var c,i,k,m,n,o,p,q;return b("regeneratorRuntime").async(function(r){while(1)switch(r.prev=r.next){case 0:c=!1;r.next=3;return b("regeneratorRuntime").awrap(j(e,f));case 3:i=r.sent;if(i.success){r.next=6;break}return r.abrupt("return",d("WAResultOrError").makeError(i.error));case 6:k=d("WASignalGroupCipher").deserializeSenderKeyMsg(g);if(k.success){r.next=10;break}l("decryptGroupContent: errCryptoDeserialization");return r.abrupt("return",d("WAResultOrError").makeError("errCryptoDeserialization"));case 10:m=i.value;r.next=13;return b("regeneratorRuntime").awrap(d("WASignalGroupCipher").decryptSenderKeyMsgFromSession(m,k.value));case 13:n=r.sent;if(n.success){r.next=16;break}return r.abrupt("return",n);case 16:o=n.value,p=o[0],q=o[1];if(c){r.next=21;break}r.next=20;return b("regeneratorRuntime").awrap(h(new Uint8Array(q)));case 20:c=!0;case 21:r.next=23;return b("regeneratorRuntime").awrap(a(e,f,p));case 23:return r.abrupt("return",d("WAResultOrError").makeResult());case 24:case"end":return r.stop()}},null,this)})}function q(c,e,f,g){var h=c.loadSenderKeySession,a=c.saveSenderKeySession;l("saveSenderKeySession");return i.lock([e,d("WAJids").extractUserJid(f)],function(){var c,i,j,k;return b("regeneratorRuntime").async(function(l){while(1)switch(l.prev=l.next){case 0:c=null;if(!h){l.next=6;break}l.next=4;return b("regeneratorRuntime").awrap(h(e,f));case 4:i=l.sent,c=i.success?i.value:null;case 6:l.next=8;return b("regeneratorRuntime").awrap(d("WASignalGroupCipher").processSenderKeyDistributionMsg(g,c));case 8:j=l.sent;if(j.success){l.next=11;break}return l.abrupt("return",j);case 11:k=j.value;l.next=14;return b("regeneratorRuntime").awrap(a(e,f,k));case 14:return l.abrupt("return",d("WAResultOrError").makeResult());case 15:case"end":return l.stop()}},null,this)})}function r(c,e,f,g){var a=c.saveSenderKeySession;l("rotateGroupSenderKey");return i.lock([e,d("WAJids").extractUserJid(f)],function(){var c,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:i.next=2;return b("regeneratorRuntime").awrap(d("WASignalWhitepaper").initiateSenderKeySessionOutgoing(g));case 2:c=i.sent;h=c.senderKeyStates[0].senderKeyId;i.next=6;return b("regeneratorRuntime").awrap(a(e,f,c));case 6:return i.abrupt("return",{senderKeyId:h});case 7:case"end":return i.stop()}},null,this)})}function s(c,e,f){var g,a,h,i,j,k;return b("regeneratorRuntime").async(function(m){while(1)switch(m.prev=m.next){case 0:g=c.loadSenderKeySession,a=c.saveSenderKeySession;l("createSenderKeyDistributionMsg");m.next=4;return b("regeneratorRuntime").awrap(g(e,f));case 4:h=m.sent;i=h.error;if(!(!h.success&&i==="errLoadSenderKeySession")){m.next=15;break}m.next=9;return b("regeneratorRuntime").awrap(d("WASignalKeys").makeKeyPair());case 9:j=m.sent;m.next=12;return b("regeneratorRuntime").awrap(r({saveSenderKeySession:a},e,f,j));case 12:m.next=14;return b("regeneratorRuntime").awrap(g(e,f));case 14:h=m.sent;case 15:if(!h.success){m.next=19;break}k=h.value.senderKeyStates.slice(-1);if(!(k.length>0)){m.next=19;break}return m.abrupt("return",d("WAResultOrError").makeResult(d("WASignalGroupCipher").createSenderKeyDistributionProto(d("WASignalGroupSession").convertFromRawToSenderKeyState(k[0]))));case 19:l("createSenderKeyDistributionMsg: errGetSenderKeyProto");return m.abrupt("return",d("WAResultOrError").makeError("errGetSenderKeyProto"));case 21:case"end":return m.stop()}},null,this)}function t(a){var b=a.regId,c=a.identity,e=a.signedKey;a=a.oneTimeKey;l("sanitizeInitialSessionInfo");var f=d("WASignalKeys").castToSerializedPubKey(e.publicKey);return{regId:d("WASignalOther").castRegistrationId(b),identity:d("WASignalKeys").castToSerializedPubKey(c),signedKey:{id:d("WASignalKeys").castToSignedPreKeyId(e.id),publicKey:f,signature:d("WASignalOther").ensureSize(e.signature,64)},oneTimeKey:a&&{id:d("WASignalKeys").castToPreKeyId(a.id),publicKey:d("WASignalKeys").castToSerializedPubKey(a.publicKey)},ratchetKey:f}}g.publishLogs=a;g.createOutgoingSession=m;g.establishOutgoingSession=c;g.encryptContent=e;g.decryptContent=f;g.encryptGroupContent=o;g.decryptGroupContent=p;g.saveSenderKeySession=q;g.rotateGroupSenderKey=r;g.createSenderKeyDistributionMsg=s}),98);
__d("WACryptoManager",["MAWLoggerUtils","Promise","WACryptoLibrary","WACryptoUtils","WAErr","WAGlobals","WAJids","WALogger","WANullthrows","WAPromiseQueue","WAResultOrError","WASignalCipher","WASignalGroupSession","WASignalKeys","WASignalLocalStorageProtocol.pb","WASignalOther","WASignalSessions","WASignalSignatures","WATagsLogger","WATimeUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to generate signed prekey with id: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to deserialize signed prekey: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to generate signed prekey ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendMessage] start encryption"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendMessage] sendWrittenMsg bulkEncryptContent"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[sessions] Failed to create a session"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[sessions] Received keys ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[sessions] Removing session "," due to ratchet key"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[sessions] fail during key requesting"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[sessions] Missing sessions: ",". Requesting keys"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["[sessions] No need to establish outgoing sessions"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["[sessions] Establish outgoing sessions"]);t=function(){return a};return a}var u=d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.CryptoManager]),v={type:"default"};function a(a){return{flush:function(){return a.storage.savePendingToDatabase().then(function(){})}}}function e(a){return{regInfo:a.regInfo,network:a.network,storage:a.storage}}function w(a,c,e,f,g){var h,i,j,k,l;return b("regeneratorRuntime").async(function(m){while(1)switch(m.prev=m.next){case 0:m.next=2;return b("regeneratorRuntime").awrap(f(c,g));case 2:h=m.sent;if(!(h!=null&&e.type!=="requestNewSession")){m.next=13;break}i=h;if(!(e.type==="default")){m.next=9;break}return m.abrupt("return",d("WAResultOrError").makeResult(i));case 9:if(!(i.aliceBaseKey!=null&&e.session.baseKey!=null)){m.next=13;break}e.type;if(d("WACryptoUtils").uint8ArraysEqual(e.session.baseKey,i.aliceBaseKey)){m.next=13;break}return m.abrupt("return",d("WAResultOrError").makeResult(i));case 13:if(!(e.type==="useSession")){m.next=17;break}j=e.session.keys;m.next=25;break;case 17:e.type;m.next=20;return b("regeneratorRuntime").awrap(a.network.requestKeys(c));case 20:k=m.sent;if(k.success){m.next=23;break}return m.abrupt("return",k);case 23:j=k.value.keys,e.type==="compareTSAndUseSession"&&e.session.timestamp>=k.value.timestamp&&(j=e.session.keys);case 25:m.next=27;return b("regeneratorRuntime").awrap(d("WACryptoLibrary").createOutgoingSession(a.regInfo,j));case 27:l=m.sent;if(l.success){m.next=30;break}return m.abrupt("return",l);case 30:return m.abrupt("return",d("WAResultOrError").makeResult(l.value));case 31:case"end":return m.stop()}},null,this)}function f(a,b,c,e){return d("WACryptoLibrary").establishOutgoingSession({handleNewSession:a.storage.handleNewSession},a.regInfo,b,c,e)}function x(a,c){var e,f,g,h,i,j,k,l,m,u,v,w;return b("regeneratorRuntime").async(function(x){while(1)switch(x.prev=x.next){case 0:d("WALogger").DEV(t());x.next=3;return b("regeneratorRuntime").awrap(a.storage.loadSessions(c));case 3:e=x.sent;f=c.filter(function(a){return!e.has(a)});if(!(f.length===0)){x.next=8;break}d("WALogger").DEV(s());return x.abrupt("return",e);case 8:d("WALogger").DEV(r(),f.length);x.next=11;return b("regeneratorRuntime").awrap(a.network.bulkRequestKeys(f));case 11:g=x.sent;if(g.success){x.next=15;break}d("WALogger").ERROR(q());return x.abrupt("return",e);case 15:if(!d("WAGlobals").getConfig().useLongSessionDrop()){x.next=33;break}h=e.entries(),i=Array.isArray(h),j=0,h=i?h:h[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();case 17:if(!i){x.next=23;break}if(!(j>=h.length)){x.next=20;break}return x.abrupt("break",33);case 20:k=h[j++];x.next=27;break;case 23:j=h.next();if(!j.done){x.next=26;break}return x.abrupt("break",33);case 26:k=j.value;case 27:l=k,m=l[0],u=l[1],u.sendChain.nextMsgIndex>=d("WAGlobals").getConfig().sessionDropIfTooOld()&&(d("WALogger").DEV(p(),m),e["delete"](m));case 31:x.next=17;break;case 33:v=g.value;d("WALogger").DEV(o(),v.size);w=new(d("WAPromiseQueue").PromiseQueue)();v.forEach(function(c,b){w.enqueue(function(){return d("WACryptoLibrary").createOutgoingSession(a.regInfo,c.keys).then(function(a){a.success===!1?d("WALogger").ERROR(n()):e.set(b,a.value)})})});x.next=39;return b("regeneratorRuntime").awrap(w.wait());case 39:return x.abrupt("return",e);case 40:case"end":return x.stop()}},null,this)}function y(a,e){var f,g,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:f=Array.from(e.keys());d("WALogger").LOG(m());j.next=4;return b("regeneratorRuntime").awrap(x(a,f));case 4:g=j.sent;i=new Map();d("WALogger").DEV(l());return j.abrupt("return",(h||(h=b("Promise"))).all(Array.from(g.entries()).map(function(f){var g,h,j,k,l,m;return b("regeneratorRuntime").async(function(n){while(1)switch(n.prev=n.next){case 0:h=f[0],j=f[1];n.next=3;return b("regeneratorRuntime").awrap(d("WASignalCipher").encryptMsg(j,c("WANullthrows")((g=e.get(h))==null?void 0:g.plaintext)));case 3:k=n.sent;l=k[0];m=k[1];i.set(h,babelHelpers["extends"]({},m,{baseKey:null}));return n.abrupt("return",a.storage.handleNewSession(h,l,l.remote.pubKey));case 8:case"end":return n.stop()}},null,this)})).then(function(){return d("WAResultOrError").makeResult(i)}));case 8:case"end":return j.stop()}},null,this)}function z(a,b,c,e,f){return d("WACryptoLibrary").encryptContent({loadSession:function(b){return w(a,b,e,a.storage.loadSession,"cryptoManagerEncryptContent").then(function(a){if(a.success===!0)return a.value;else return null})},handleNewSession:a.storage.handleNewSession},b,c,f)}function A(a,b,c,e){return d("WACryptoLibrary").decryptContent({loadSession:a.storage.loadSession,handleNewSession:a.storage.handleNewSession,loadSignedPreKey:a.storage.loadSignedPreKey,loadOneTimePreKey:a.storage.loadOneTimePreKey},a.regInfo,b,c,e)}function B(a,c){var d;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(a.storage.loadSession(c,"getParticipantInfo"));case 2:d=e.sent;return e.abrupt("return",d==null?void 0:d.remote);case 4:case"end":return e.stop()}},null,this)}function C(a){var e,f,g,h,i,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:k.next=2;return b("regeneratorRuntime").awrap(a.storage.getLastPreKeyGenerationId());case 2:g=k.sent;h=((e=g==null?void 0:g.lastPreKeyId)!=null?e:0)+1;i=d("WASignalKeys").makePreKeys(h,1)[0];k.next=7;return b("regeneratorRuntime").awrap(a.storage.saveOneTimePreKey({keyId:i.plainObject.id,encoded:i.record}));case 7:j=k.sent;if(!j.success){k.next=10;break}return k.abrupt("return",i.plainObject);case 10:throw c("WAErr")("Cannot save one time prekey: "+j.error+", LastPreKeyId: "+((f=g==null?void 0:g.lastPreKeyId)!=null?f:0));case 11:case"end":return k.stop()}},null,this)}function D(a,c){var e,f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:c===void 0&&(c=d("WAGlobals").getConfig().maxPrekeysToUpload());h.next=3;return b("regeneratorRuntime").awrap(a.storage.getLastPreKeyGenerationId());case 3:f=h.sent;g=d("WASignalKeys").makePreKeys(((e=f==null?void 0:f.lastPreKeyId)!=null?e:0)+1,c);return h.abrupt("return",a.storage.savePreKeysGeneration(g.map(function(a){var b=a.plainObject;a=a.record;return{keyId:b.id,encoded:a}})));case 6:case"end":return h.stop()}},null,this)}function E(a){return a.storage.loadLatestSignedPreKey().then(function(b){if(b.success===!1){var e;u.TAGS([d("MAWLoggerUtils").Tag.SignedPrekey]).ERROR(k(),b==null?void 0:(e=b.payload)==null?void 0:e.toString());throw c("WAErr")("Failed to generate signed prekey: "+((e=b==null?void 0:(e=b.payload)==null?void 0:e.message)!=null?e:""))}e=b.value;e=d("WASignalSignatures").deserializeSignedPreKey(e);if(e==null){u.TAGS([d("MAWLoggerUtils").Tag.SignedPrekey]).ERROR(j(),b);throw c("WAErr")("failed to deserialize signed prekey")}return F(a,e.id+1)})}function F(a,b){var e=d("WASignalSignatures").makeSignedPreKey(b,d("WATimeUtils").unixTimeMs(),a.regInfo.staticKeyPair);b=d("WASignalSignatures").serializeSignedPreKeyForPrivateStorage(e);return a.storage.saveSignedPreKeyIfNew(e.id,b).then(function(a){if(a.type==="success")return d("WAResultOrError").makeResult(e);else{a.type;return d("WAResultOrError").makeResult(a.key)}}).then(function(a){if(!a.success){var b;u.TAGS([d("MAWLoggerUtils").Tag.SignedPrekey]).ERROR(i(),a);throw c("WAErr")("Unexpected error when generateSignedPreKeyWithId: "+((b=a==null?void 0:(b=a.payload)==null?void 0:b.message)!=null?b:a.error))}return a.value})}function G(a,b,c,e){return d("WACryptoLibrary").encryptGroupContent({loadSenderKeySession:a.storage.loadSenderKeySession,saveSenderKeySession:a.storage.saveSenderKeySession},b,c,e)}function H(a,b,c,e,f){return d("WACryptoLibrary").decryptGroupContent({loadSenderKeySession:a.storage.loadSenderKeySession,saveSenderKeySession:a.storage.saveSenderKeySession},b,c,e,f)}function I(a,b,c,e){return d("WACryptoLibrary").saveSenderKeySession({loadSenderKeySession:d("WAGlobals").getConfig().useUpdatedSenderKeySession()?a.storage.loadSenderKeySession:void 0,saveSenderKeySession:a.storage.saveSenderKeySession},b,c,e)}function J(a,c,e){var f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:g.next=2;return b("regeneratorRuntime").awrap(C(a));case 2:f=g.sent;return g.abrupt("return",d("WACryptoLibrary").rotateGroupSenderKey({saveSenderKeySession:a.storage.saveSenderKeySession},c,e,f.keyPair));case 4:case"end":return g.stop()}},null,this)}function K(a){return(h||(h=b("Promise"))).resolve().then(function(){return{regId:d("WASignalOther").makeRegistrationId(a),staticKeyPair:d("WASignalKeys").makeKeyPair(),authKeyPair:d("WASignalKeys").makeKeyPair()}})}function L(a){return d("WASignalOther").encodeSignalProto(d("WASignalLocalStorageProtocol.pb").RecordStructureSpec,d("WASignalSessions").serializeSession(a))}function M(a){return d("WASignalOther").decodeSignalProto(d("WASignalLocalStorageProtocol.pb").RecordStructureSpec,a,d("WASignalSessions").parseSessionFromRecord)}function N(a){return d("WASignalOther").encodeSignalProto(d("WASignalLocalStorageProtocol.pb").SenderKeyRecordStructureSpec,d("WASignalGroupSession").serializeSession(a))}function O(a){return d("WASignalOther").decodeSignalProto(d("WASignalLocalStorageProtocol.pb").SenderKeyRecordStructureSpec,a,d("WASignalGroupSession").parseSessionFromRecord)}function P(a){return a}function Q(a,b){return a+"|"+b}function R(a){a=a.split("|");if(a.length!==2)throw c("WAErr")("Incorrect ComplexSenderKey");return{groupId:d("WAJids").unsafeCoerceToGroupJid(a[0]),deviceId:d("WAJids").unsafeCoerceToDeviceJid(a[1])}}g.DEFAULT_SESSION_REQUEST=v;g.cryptoManagerFlushable=a;g.initCryptoManager=e;g.getSessionForRecipient=w;g.establishOutgoingSession=f;g.ensureSessionsExists=x;g.bulkEncryptContent=y;g.encryptContent=z;g.decryptContent=A;g.getParticipantInfo=B;g.generateOneTimePreKey=C;g.generatePreKeys=D;g.generateSignedPreKey=E;g.generateSignedPreKeyWithId=F;g.encryptGroupContent=G;g.decryptGroupContent=H;g.saveSenderKeySession=I;g.rotateGroupSenderKey=J;g.generateRegistrationInfo=K;g.encodeSession=L;g.decodeSession=M;g.encodeSenderKeySession=N;g.decodeSenderKeySession=O;g.castToPreKeyGenerationId=P;g.encodeSenderKey=Q;g.decodeSenderKey=R}),98);
__d("WAHandleFailureUtils",["WABridge","WAGlobals"],(function(a,b,c,d,e,f,g){"use strict";c={GENERIC_FAILURE:"400",NOT_AUTHORIZED:"401",TEMP_BANNED:"402",BANNED:"403",CAT_EXPIRED:"413",CAT_INVALID:"414",NOT_FOUND:"415",INTERNAL_ERROR:"500",SERVER_UNAVAILABLE:"503"};function h(){return d("WAGlobals").getDbImpls().clearSignalAndTempStores()}function a(){return h().then(function(){d("WABridge").getBridge().fireAndForget("event","logout",{})})}function b(){return h().then(function(){d("WABridge").getBridge().fireAndForget("event","reregisterDevice",{})})}g.FAILURE_CODES=c;g.clearRegistrationAndTempData=h;g.deregisterPhone=a;g.reregisterPhone=b}),98);
__d("WASignalEntityStoreV2",["$InternalEnum","regeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";var g=b("$InternalEnum").Mirrored(["NOT_PERSISTED","PERSIST_IN_PROGRESS","PERSISTED"]);a=function(){function a(){this.$1=new Map()}var c=a.prototype;c.TEST_ONLY_LOAD_FROM_MEMORY=function(a){return this.$2(a)};c.$2=function(a){a=this.$1.get(a);return a!=null?{entity:a.entity,deleted:a.deleted}:null};c.load=function(a,c){var d,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:d=this.$2(a);if(!(d==null?void 0:d.deleted)){f.next=3;break}return f.abrupt("return",null);case 3:if(!(d!=null&&d.entity!=null)){f.next=5;break}return f.abrupt("return",d.entity);case 5:f.next=7;return b("regeneratorRuntime").awrap(c(a));case 7:e=f.sent;this.$3(a,e);return f.abrupt("return",e);case 10:case"end":return f.stop()}},null,this)};c.bulkLoad=function(a,c){var d,e,f,g,h,i,j,k,l,m,n,o,p;return b("regeneratorRuntime").async(function(q){while(1)switch(q.prev=q.next){case 0:d=[],e=new Map(),f=0;case 3:if(!(f<a.length)){q.next=15;break}g=a[f];h=this.$2(g);if(!(h==null)){q.next=9;break}d.push(g);return q.abrupt("continue",12);case 9:if(!h.deleted){q.next=11;break}return q.abrupt("continue",12);case 11:h.entity!=null?e.set(g,h.entity):d.push(g);case 12:f++;q.next=3;break;case 15:q.next=17;return b("regeneratorRuntime").awrap(c(d));case 17:i=q.sent,(j=i.entries(),k=Array.isArray(j),l=0,j=k?j:j[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]());case 19:if(!k){q.next=25;break}if(!(l>=j.length)){q.next=22;break}return q.abrupt("break",36);case 22:m=j[l++];q.next=29;break;case 25:l=j.next();if(!l.done){q.next=28;break}return q.abrupt("break",36);case 28:m=l.value;case 29:n=m,o=n[0],p=n[1],e.set(o,p),this.$3(o,p);case 34:q.next=19;break;case 36:return q.abrupt("return",e);case 37:case"end":return q.stop()}},null,this)};c.$3=function(a,b){this.$1.set(a,{entity:b,status:g.PERSISTED,deleted:!1})};c.store=function(a,b){this.$1.set(a,{entity:b,status:g.NOT_PERSISTED,deleted:!1})};c.remove=function(a){this.$1.set(a,{entity:null,status:g.NOT_PERSISTED,deleted:!0})};c.pureSnapshot=function(){var a=[],b=Array.from(this.$1.entries()).filter(function(a){a[0];a=a[1];return a.status===g.NOT_PERSISTED}).filter(function(b){var c=b[0];b=b[1];b.deleted&&a.push({id:c});return!b.deleted}).filter(function(a){a[0];a=a[1];return a.entity!=null}).map(function(a){var b=a[0];a=a[1];return{id:b,cachedEntity:a.entity}});return{update:b,remove:a}};c.snapshot=function(){var a=this,b=this.pureSnapshot();b.remove.forEach(function(b){b=b.id;b=a.$1.get(b);b&&(b.status=g.PERSIST_IN_PROGRESS)});b.update.forEach(function(b){b=b.id;b=a.$1.get(b);b&&(b.status=g.PERSIST_IN_PROGRESS)});return b};c.markSnapshotAsCommitted=function(){this.$1.forEach(function(a){a.status===g.PERSIST_IN_PROGRESS&&(a.status=g.PERSISTED)})};c.markSnapshotAsFailed=function(){this.$1.forEach(function(a){a.status===g.PERSIST_IN_PROGRESS&&(a.status=g.NOT_PERSISTED)})};c.clear=function(){this.$1=new Map()};return a}();f.PersistStatus=g;f.SignalEntityStore=a}),66);
__d("WASignalIdentityStore",["Promise","WAJids","WALogger","WASignalEntityStoreV2","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[WASignalIdentityStore] This should never happen."]);i=function(){return a};return a}a=function(){function a(){this.$1=new Map(),this.$2=new(d("WASignalEntityStoreV2").SignalEntityStore)()}var c=a.prototype;c.bulkLoadIdentities=function(a){var c=this,d,e,f,g,i,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:d=function(){var a,d,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:if(!f){k.next=6;break}if(!(g>=e.length)){k.next=3;break}return k.abrupt("return","break");case 3:i=e[g++];k.next=10;break;case 6:g=e.next();if(!g.done){k.next=9;break}return k.abrupt("return","break");case 9:i=g.value;case 10:a=i;d=a[0];j=a[1];k.next=15;return b("regeneratorRuntime").awrap(c.loadIdentitiesByUser(d,function(){return(h||(h=b("Promise"))).resolve(j)}));case 15:case"end":return k.stop()}},null,this)},(e=a,f=Array.isArray(e),g=0,e=f?e:e[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]());case 2:k.next=4;return b("regeneratorRuntime").awrap(d());case 4:j=k.sent;if(!(j==="break")){k.next=7;break}return k.abrupt("break",9);case 7:k.next=2;break;case 9:return k.abrupt("return",a);case 10:case"end":return k.stop()}},null,this)};c.loadIdentitiesByUser=function(a,c){var e,f,g;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:e=this.$1.get(a);if(!(e==null)){j.next=13;break}j.t0=this;j.t1=a;j.next=6;return b("regeneratorRuntime").awrap(c(a));case 6:j.t2=j.sent;f=j.t0.$3.call(j.t0,j.t1,j.t2);g=Array.from(f.keys());this.$1.set(a,new Set(g));return j.abrupt("return",this.$2.bulkLoad(g,function(){return(h||(h=b("Promise"))).resolve(f)}));case 13:return j.abrupt("return",this.$2.bulkLoad(Array.from(e),function(a){a.length>0&&d("WALogger").ERROR(i());return(h||(h=b("Promise"))).resolve(new Map())}));case 14:case"end":return j.stop()}},null,this)};c.$3=function(a,b){b=new Map(b);var c=this.$2.pureSnapshot(),e=c.remove;c=c.update;for(var e=e,f=Array.isArray(e),g=0,e=f?e:e[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var h;if(f){if(g>=e.length)break;h=e[g++]}else{g=e.next();if(g.done)break;h=g.value}h=h;h=h.id;b["delete"](h)}for(h=c,g=Array.isArray(h),f=0,h=g?h:h[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(g){if(f>=h.length)break;e=h[f++]}else{f=h.next();if(f.done)break;e=f.value}c=e;e=c.id;c=c.cachedEntity;c!=null&&d("WAJids").extractUserJid(e)===a&&b.set(e,c)}return b};c.store=function(a,b){this.$2.store(a,b);b=d("WAJids").extractUserJid(a);b=this.$1.get(b);b!=null&&b.add(a)};c.remove=function(a){this.$2.remove(a);var b=d("WAJids").extractUserJid(a);b=this.$1.get(b);b!=null&&b["delete"](a)};c.clear=function(){this.$2.clear(),this.$1=new Map()};c.load=function(a,b){return this.$2.load(a,b)};c.bulkLoad=function(a,b){return this.$2.bulkLoad(a,b)};c.snapshot=function(){return this.$2.snapshot()};c.pureSnapshot=function(){return this.pureSnapshot()};c.markSnapshotAsCommitted=function(){this.$2.markSnapshotAsCommitted()};c.markSnapshotAsFailed=function(){this.$2.markSnapshotAsFailed()};return a}();g.SignalIdentityStore=a}),98);
__d("WAInMemorySignalStore",["Promise","WACryptoManager","WACryptoUtils","WAGlobals","WAICDCUtils","WAIdentityUtils","WAJids","WAJobDefinitions","WAJobOrchestratorTypes","WAJobs","WAPromiseQueue","WAProtocolQueue","WAProtocolQueueState","WAResultOrError","WASignalEntityStoreV2","WASignalIdentityStore","WATagsLogger","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Users with unknown devices: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Snapshot save: end"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Snapshot save: start"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Snapshot: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Removing old identity: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Removing my device identity. This should not happen"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Device notification of one user cannot remove identity the other one "]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Removing session dur to identity mismatch: ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Device notification of one user cannot remove session the other one"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["Receiving an identity for my device but it is different from original one"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["Update user devices: userJid: ","; new identities: ","; previous identities: ","}"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);t=function(){return a};return a}var u=d("WATagsLogger").TAGS(["CryptoManager","InMemorySignalStore"]);a=function(){function a(a,c){var e=this;this.$10=new(d("WAPromiseQueue").PromiseQueue)();this.loadSession=function(a,b){return e.$1.load(a,function(a){return e.$9.loadSession(a,b)})};this.loadSessions=function(a){return e.$1.bulkLoad(a,function(a){return e.$9.loadSessions(a).then(function(a){return new Map(Array.from(a.entries()).map(function(a){return[a[0],a[1]]}))})}).then(function(a){return new Map(Array.from(a.entries()).map(function(a){return[a[0],a[1]]}))})};this.loadSignedPreKey=function(a){return e.$7.load(a,function(){return e.$9.loadSignedPreKey(a)})};this.bulkLoadIdentities=function(a){return e.$9.bulkLoadIdentities(a).then(function(a){return e.$5.bulkLoadIdentities(a)})};this.loadIdentities=function(a){return e.$5.loadIdentitiesByUser(a,function(){return e.$9.loadIdentities(a)})};this.saveIdentity=function(a,c){return(h||(h=b("Promise"))).resolve(e.storeIdentity(a,c))};this.loadOneTimePreKey=function(a){return e.$6.load(a,function(){return e.$9.loadOneTimePreKey(a)})};this.saveSenderKeySession=function(a,c,d){e.storeSenderKeySession(a,c,d);return(h||(h=b("Promise"))).resolve()};this.saveSignedPreKeyIfNew=function(a,b){return e.$9.saveSignedPreKeyIfNew(a,b)};this.loadSenderKeySession=function(a,c){var f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:g.next=2;return b("regeneratorRuntime").awrap(e.$8.load(d("WACryptoManager").encodeSenderKey(a,c),function(){var d;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:f.next=2;return b("regeneratorRuntime").awrap(e.$9.loadSenderKeySession(a,c));case 2:d=f.sent;return f.abrupt("return",d.success?d.value:null);case 4:case"end":return f.stop()}},null,this)}));case 2:f=g.sent;if(!(f==null)){g.next=5;break}return g.abrupt("return",d("WAResultOrError").makeError("errLoadSenderKeySession"));case 5:return g.abrupt("return",d("WAResultOrError").makeResult(f));case 6:case"end":return g.stop()}},null,this)};this.handleNewSession=function(a,c,f,g,i){e.storeSession(a,c);f!=null&&e.storeIdentity(a,f);g!=null&&e.removeOneTimePreKey(g);return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult())};this.saveICDC=function(a,c){e.$3.store(a,c);return(h||(h=b("Promise"))).resolve()};this.loadICDC=function(a){return e.$3.load(a,function(){return e.$9.loadICDC(a)})};this.saveDhash=function(a,c){e.$2.store(a,c);return(h||(h=b("Promise"))).resolve()};this.getLastPreKeyGenerationId=function(){return e.$9.getLastPreKeyGenerationId()};this.savePreKeysGeneration=function(a){return e.$9.savePreKeysGeneration(a)};this.getPreKeyGenerationsTimestamps=function(){return e.$9.getPreKeyGenerationsTimestamps()};this.deletePreKeyGenerations=function(a){return e.$9.deletePreKeyGenerations(a)};this.saveOneTimePreKey=function(a){return e.$9.saveOneTimePreKey(a)};this.loadPreKeys=function(a){return e.$9.loadPreKeys(a)};this.loadLatestSignedPreKey=function(){return e.$9.loadLatestSignedPreKey()};this.calculateICDC=function(a){if(a.length===0)return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeError("missing_participants"));var c=new Set();return(h||(h=b("Promise"))).all(a.map(function(a){var f,g,h,i,j,k,l,m,n,o,p;return b("regeneratorRuntime").async(function(q){while(1)switch(q.prev=q.next){case 0:q.next=2;return b("regeneratorRuntime").awrap(e.loadIdentities(a));case 2:f=q.sent;q.next=5;return b("regeneratorRuntime").awrap(e.loadICDC(a));case 5:g=q.sent;q.next=8;return b("regeneratorRuntime").awrap(e.$9.loadLastSyncTs(a));case 8:h=q.sent;d("WAICDCUtils").isLastSyncTsExpired(h)&&c.add(a);i=new Map(Array.from(f.entries()).map(function(a){var b=a[0];a=a[1];return[d("WAIdentityUtils").removeKeyTypeIfNeeded(a).toString(),b]}));if(!(g==null||d("WAICDCUtils").isICDCIndexInvalid(g))){q.next=14;break}c.add(a);return q.abrupt("return",null);case 14:j=[],(k=g.devices,l=Array.isArray(k),m=0,k=l?k:k[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]());case 16:if(!l){q.next=22;break}if(!(m>=k.length)){q.next=19;break}return q.abrupt("break",34);case 19:n=k[m++];q.next=26;break;case 22:m=k.next();if(!m.done){q.next=25;break}return q.abrupt("break",34);case 25:n=m.value;case 26:o=n;p=i.get(d("WAIdentityUtils").removeKeyTypeIfNeeded(o).toString());if(!(p==null)){q.next=31;break}c.add(a);return q.abrupt("continue",32);case 31:j.push({id:d("WAJids").extractDeviceId(p),identity:d("WAIdentityUtils").removeKeyTypeIfNeeded(o)});case 32:q.next=16;break;case 34:return q.abrupt("return",{devices:j,sequence:g.sequence,signingDeviceIndex:g.signingDeviceIndex,timestamp:g.timestamp,user:a});case 35:case"end":return q.stop()}},null,this)})).then(function(a){var b=a.filter(Boolean);return b.length===0?d("WAResultOrError").makeError("invalid_icdc_info"):d("WAResultOrError").makeResult({icdcInfo:a.filter(Boolean),usersWithMissingICDC:c})})["catch"](function(a){u.ERROR(t(),a);return d("WAResultOrError").makeError("invalid_icdc_info")})};this.$9=a;this.$11=c;this.$5=new(d("WASignalIdentityStore").SignalIdentityStore)();this.$1=new((a=d("WASignalEntityStoreV2")).SignalEntityStore)();this.$2=new a.SignalEntityStore();this.$3=new a.SignalEntityStore();this.$4=new a.SignalEntityStore();this.$6=new a.SignalEntityStore();this.$7=new a.SignalEntityStore();this.$8=new a.SignalEntityStore()}var c=a.prototype;c.storeSession=function(a,b){this.$1.store(a,b)};c.storeIdentity=function(a,b){if(!b)return;this.$5.store(a,b)};c.removeOneTimePreKey=function(a){this.$6.remove(a)};c.storeSenderKeySession=function(a,b,c){this.$8.store(d("WACryptoManager").encodeSenderKey(a,b),c)};c.updateUserDevicesInfo=function(a){var c=this;return(h||(h=b("Promise"))).all(a.map(function(a){var e,f,g,i,j,k,l,t,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N;return b("regeneratorRuntime").async(function(O){while(1)switch(O.prev=O.next){case 0:O.next=2;return b("regeneratorRuntime").awrap(c.loadIdentities(a.jid));case 2:e=O.sent,(f=a.devices,g=a.jid,i=a.notificationTs,j=a.dhash,k=a.icdcInfo),u.DEV(s(),g,f.map(function(b){b=b.id;return d("WAJids").toDeviceJid(a.jid,b)}).join(","),Array.from(e.keys()).join(",")),l=new Set(e.keys()),t=[],v=[],(w=f,x=Array.isArray(w),y=0,w=x?w:w[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]());case 9:if(!x){O.next=15;break}if(!(y>=w.length)){O.next=12;break}return O.abrupt("break",41);case 12:z=w[y++];O.next=19;break;case 15:y=w.next();if(!y.done){O.next=18;break}return O.abrupt("break",41);case 18:z=y.value;case 19:A=z;B=A.id;C=A.identity;D=A.model;E=A.platform;F=d("WAJids").toDeviceJid(a.jid,B);G=e.get(F);d("WAGlobals").getMyDeviceJid()===F&&(H=d("WACryptoUtils").uint8ArraysEqual(d("WAIdentityUtils").removeKeyTypeIfNeeded(c.$11.staticKeyPair.publicKey),d("WAIdentityUtils").removeKeyTypeIfNeeded(C)),H||u.ERROR(r()));l["delete"](F);if(!(G==null)){O.next=32;break}v.push({instruction:"identityAdded",consumerRetries:0,jid:d("WAJids").extractUserJid(F),type:"instruction",device:F,identity:C,model:D,platform:E,notificationTs:i,priority:d("WAGlobals").getConfig().isIdleOQM1()?d("WAProtocolQueue").WAProtocolQueuePriorityLow:d("WAProtocolQueue").WAProtocolQueuePriorityHigh});O.next=39;break;case 32:if(d("WACryptoUtils").uint8ArraysEqual(G,C)){O.next=39;break}if(!(d("WAJids").extractUserJid(F)!==g)){O.next=36;break}u.ERROR(q());return O.abrupt("continue",39);case 36:t.push(F),u.DEV(p(),F),v.push({instruction:"identityChanged",consumerRetries:0,jid:d("WAJids").extractUserJid(F),type:"instruction",device:F,identity:C,model:D,platform:E,notificationTs:i,priority:d("WAGlobals").getConfig().isIdleOQM1()?d("WAProtocolQueue").WAProtocolQueuePriorityLow:d("WAProtocolQueue").WAProtocolQueuePriorityHigh});case 39:O.next=9;break;case 41:I=[],(J=l,K=Array.isArray(J),L=0,J=K?J:J[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]());case 43:if(!K){O.next=49;break}if(!(L>=J.length)){O.next=46;break}return O.abrupt("break",63);case 46:M=J[L++];O.next=53;break;case 49:L=J.next();if(!L.done){O.next=52;break}return O.abrupt("break",63);case 52:M=L.value;case 53:N=M;if(!(d("WAJids").extractUserJid(N)!==g)){O.next=57;break}u.ERROR(o());return O.abrupt("continue",61);case 57:I.push(N),d("WAGlobals").getMyDeviceJid()===N&&u.ERROR(n()),u.DEV(m(),N),v.push({instruction:"identityRemoved",consumerRetries:0,jid:d("WAJids").extractUserJid(N),type:"instruction",device:N,notificationTs:i,priority:d("WAGlobals").getConfig().isIdleOQM1()?d("WAProtocolQueue").WAProtocolQueuePriorityLow:d("WAProtocolQueue").WAProtocolQueuePriorityHigh});case 61:O.next=43;break;case 63:return O.abrupt("return",(h||(h=b("Promise"))).all([j!=null?c.saveDhash(g,j):(h||(h=b("Promise"))).resolve(),k!=null?c.saveICDC(g,k):(h||(h=b("Promise"))).resolve()].concat(Array.from(I).map(function(a){return c.deleteIdentity(a)}),[I.concat(t).map(function(a){return c.$12(a)})],f.map(function(b){var a=b.id;b=b.identity;return c.saveIdentity(d("WAJids").toDeviceJid(g,a),b)}))).then(function(){return d("WAResultOrError").makeResult(v)}));case 64:case"end":return O.stop()}},null,this)})).then(function(a){a=a.flatMap(function(a){return a.success?a.value:[]});if(a.length>0)return d("WAProtocolQueueState").persistStanzas(a)}).then(function(){})};c.savePendingToDatabase=function(){var a=this,c=this.$13();if(c==null)return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult([]));u.DEV(l(),c);u.LOG(k());return this.$9.bulkSaveSignalData(c).then(function(b){u.LOG(j());a.$14();return b},function(c){a.$15();return(h||(h=b("Promise"))).reject(c)})};c.clear=function(){this.$1.clear(),this.$5.clear(),this.$6.clear(),this.$7.clear(),this.$8.clear(),this.$2.clear(),this.$3.clear()};c.$16=function(a){if(a.length===0)return;u.DEV(i(),a);d("WAJobs").getJobManager().fireAndForget(d("WAJobDefinitions").createStartJobInfo("getDevices",{ignoreDhash:!0,reason:"UnknownDevice",scheduleConfig:{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW},users:new Set(a)}))};c.deleteIdentity=function(a){this.$5.remove(a);return(h||(h=b("Promise"))).resolve()};c.$12=function(a){this.$1.remove(a);return(h||(h=b("Promise"))).resolve()};c.$14=function(){this.$1.markSnapshotAsCommitted(),this.$2.markSnapshotAsCommitted(),this.$3.markSnapshotAsCommitted(),this.$5.markSnapshotAsCommitted(),this.$6.markSnapshotAsCommitted(),this.$7.markSnapshotAsCommitted(),this.$8.markSnapshotAsCommitted()};c.$15=function(){this.$1.markSnapshotAsFailed(),this.$2.markSnapshotAsFailed(),this.$3.markSnapshotAsFailed(),this.$5.markSnapshotAsFailed(),this.$6.markSnapshotAsFailed(),this.$7.markSnapshotAsFailed(),this.$8.markSnapshotAsFailed()};c.$13=function(){var a=this.$1.snapshot(),b=[],c=a.remove.map(function(a){return a.id});a.update.forEach(function(a){var c=a.id;a=a.cachedEntity;if(a==null)return;b.push({id:c,updated:a})});var e=[];this.$8.snapshot().update.forEach(function(a){var b=d("WACryptoManager").decodeSenderKey(a.id),c=b.groupId;b=b.deviceId;a.cachedEntity!=null&&c&&b&&e.push({groupId:c,author:b,updated:a.cachedEntity})});a=this.$5.snapshot();var f=a.remove.map(function(a){return a.id}),g=[];a.update.forEach(function(a){var b=a.id;a=a.cachedEntity;if(a==null)return;g.push({id:b,identity:a})});a=this.$6.snapshot().remove;var h=this.$2.snapshot(),i=[];for(var h=h.update,j=Array.isArray(h),k=0,h=j?h:h[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var l;if(j){if(k>=h.length)break;l=h[k++]}else{k=h.next();if(k.done)break;l=k.value}l=l;var m=l.cachedEntity;l=l.id;m!=null&&i.push({id:l,dhash:m})}l=this.$3.snapshot();m=[];for(k=l.update,j=Array.isArray(k),h=0,k=j?k:k[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(j){if(h>=k.length)break;l=k[h++]}else{h=k.next();if(h.done)break;l=h.value}l=l;var n=l.cachedEntity;l=l.id;n!=null&&m.push({id:l,icdc:n})}return b.length===0&&c.length===0&&g.length===0&&e.length===0&&a.length===0&&m.length===0&&i.length===0&&f.length===0?null:{dhashUpdate:i,icdcUpdate:m,identityRemove:f,identityUpdate:g,preKeyRemove:a,senderKeySessionUpdate:e,sessionRemove:c,sessionUpdate:b}};c.warmCache=function(a){var c,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:f.next=2;return b("regeneratorRuntime").awrap(this.bulkLoadIdentities(a.map(d("WAJids").interpretAsUserJid).filter(Boolean)));case 2:c=f.sent;e=Array.from(c.values()).reduce(function(a,b){return a.concat(Array.from(b.keys()))},[]);f.next=6;return b("regeneratorRuntime").awrap(this.loadSessions(e));case 6:case"end":return f.stop()}},null,this)};return a}();g.InMemorySignalStoreImpl=a}),98);
__d("WARequestKeysBatcher",["WAResolvable"],(function(a,b,c,d,e,f,g){"use strict";var h={delayMs:50,maxSize:100};function a(a,b){b=b===void 0?h:b;var c=b.delayMs,e=b.maxSize,f=null;function g(b){f&&f.args===b&&(f=null);return a(b)}return function(a){if(f!=null)f.args.push(a);else{var b=[a],h=new(d("WAResolvable").Resolvable)();a=h.promise.then(g);var i=function(){return void h.resolve(b)},j=setTimeout(i,c);f={args:b,batchPromise:a,run:i,timer:j}}a=f;i=a.args;j=a.batchPromise;var k=i.length-1;if(i.length>=e){clearTimeout((a=f)==null?void 0:a.timer);f.run();f=null}return j.then(function(a){return a[k]})}}g.makeSimpleBatcher=a}),98);
__d("WARequestKeys",["WABulkRequestKeys","WAPromiseManagement","WARequestKeysBatcher","WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=d("WARequestKeysBatcher").makeSimpleBatcher(function(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(d("WABulkRequestKeys").bulkRequestKeys(a));case 2:c=e.sent;if(!(c.success===!1)){e.next=5;break}return e.abrupt("return",a.map(function(){return c}));case 5:return e.abrupt("return",a.map(function(a){a=c.value.get(a);return a?d("WAResultOrError").makeResult(a):d("WAResultOrError").makeError("errRequestKeysNoKeys")}));case 6:case"end":return e.stop()}},null,this)});c=d("WAPromiseManagement").cacheWhilePending(function(a){return a},a);g.requestKeys=c}),98);
__d("WACryptoManagerUtils",["MAWLoggerUtils","Promise","WABulkRequestKeys","WACryptoManager","WAErr","WAGlobals","WAHandleFailureUtils","WAInMemorySignalStore","WALogger","WAPREList","WAPREMetrics","WARequestKeys","WAResultOrError","WASignalKeys","WASignalSignatures","WATagsLogger","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendMessage] Fail encrypt messages"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot generate one time prekey"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot deserialize signed prekey"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["No signed prekey: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["DecryptMsg error: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["DecryptMsg error: ",""]);n=function(){return a};return a}var o=d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.SignedPrekey]);function a(a){var b=new(d("WAInMemorySignalStore").InMemorySignalStoreImpl)(a.db,a.regInfo),c=p();return{manager:d("WACryptoManager").initCryptoManager({regInfo:a.regInfo,storage:b,network:c}),storage:b}}function p(){return{requestKeys:d("WARequestKeys").requestKeys,bulkRequestKeys:d("WABulkRequestKeys").bulkRequestKeys}}function q(a,b){if(b.success)a==null?void 0:a.endSuccess();else{var c,e=b.error;d("WALogger").WARN(n(),e);switch(e){case"errDuplicateMsg":a==null?void 0:a.addPoint(e);a==null?void 0:a.endSuccess();return;case"errCryptoDeserialization":case"errSignalNoSession":case"errSignalInvalidMsg":case"errInvalidMac":case"errSignalInvalidSignedPreKey":case"errSignalSignedPreKeyIdMismatch":case"errSignalSignedPreKeyDeserialization":case"errSignalInvalidOneTimeKey":case"errSignalOneTimeKeyMismatch":case"errSignalOneTimeKeyDeserialization":case"errSignalInvalidKey":case"errSignalDecryptionFailed":case"errSignalDeserializeInvalidProtoFormat":case"errSignalDeserializeRatchetKeyBadFormat":case"errSignalDeserializePkInvalidProtoFormat":case"errSignalDeserializePkKeyBadFormat":case"errSignalTooManyMessagesInFuture":case"errSignalEmptyVersionContentSuffix":case"errSignalContentExceededExpectedLength":case"errSignalGrpInvalidProtoFormat":case"errSignalGrpInvalidKeyFormat":case"errSignalGrpVersionContentEmpty":case"errSignalGrpInvalidVersionContentLength":case"errSignalGrpSenderKeyInvalidProtoFormat":case"errSignalGrpSenderKeyProtoError":case"errSignalGrpTooManyMessagesInFuture":c=e;break;default:typeof e==="string"?c=e:(d("WALogger").ERROR(m(),b),c="fail");break}a==null?void 0:a.endFail(c)}}function e(a,c,e,f,g){var i=null;return d("WACryptoManager").decryptContent(f.cryptoManager,c,{ciphertext:e,type:a},function(a,c){i={plaintext:a,remoteIdentity:c};return(h||(h=b("Promise"))).resolve()}).then(function(a){q(g,a);if(a.success)return d("WAResultOrError").makeResult(i);else return a})}function f(a,c,e,f,g){var i=null;return d("WACryptoManager").decryptGroupContent(f.cryptoManager,a,c,e,function(a){i={plaintext:a};return(h||(h=b("Promise"))).resolve()}).then(function(a){q(g,a);if(a.success)return d("WAResultOrError").makeResult(i);else return a})}function r(a,b){return d("WACryptoManager").getParticipantInfo(b,a)}function s(a){return a.storage.getPreKeyGenerationsTimestamps()}function t(a,b){return b.storage.deletePreKeyGenerations(a)}function u(a,b,c,e){return d("WACryptoManager").saveSenderKeySession(e.cryptoManager,a,b,c)}function v(a){var e,f,g,i,m,n,p,q,r;return b("regeneratorRuntime").async(function(s){while(1)switch(s.prev=s.next){case 0:s.next=2;return b("regeneratorRuntime").awrap(a.storage.loadLatestSignedPreKey());case 2:e=s.sent;if(!(e.success===!1)){s.next=10;break}o.EXPECTED_ERROR(l(),(f=(g=e.payload)==null?void 0:g.toString())!=null?f:"");d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.WA_NO_SIGNED_PRE_KEY).endFail("missing-signed-prekey");if(!(e.error==="missing-last-signed-prekey-id")){s.next=9;break}s.next=9;return b("regeneratorRuntime").awrap(d("WAHandleFailureUtils").reregisterPhone());case 9:throw(i=e.payload)!=null?i:c("WAErr")("No signed prekey");case 10:m=d("WASignalSignatures").deserializeSignedPreKey(e.value);if(!(m==null)){s.next=14;break}o.ERROR(k());throw c("WAErr")("Cannot deserialize signed prekey");case 14:s.next=16;return b("regeneratorRuntime").awrap(d("WACryptoManager").generateOneTimePreKey(a));case 16:n=s.sent;if(!(n==null)){s.next=20;break}d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.OneTimePrekey]).ERROR(j());throw c("WAErr")("Cannot generate one time prekey");case 20:p=a.regInfo,q=p.regId,r=p.staticKeyPair;return s.abrupt("return",(h||(h=b("Promise"))).resolve({regId:q,keyType:d("WASignalKeys").KEY_TYPE,publicKey:r.publicKey,signedPreKey:m,preKey:n}));case 22:case"end":return s.stop()}},null,this)}function w(a,b,c){var e=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MESSAGE_ENCRYPTION,{string:{chat:"group",jid:a},bool:{useLongSessionDrop:d("WAGlobals").getConfig().useLongSessionDrop()}},void 0);return d("WACryptoManager").encryptGroupContent(c.cryptoManager,a,d("WAGlobals").getMyDeviceJid(),b).then(function(a){if(a.success)e.endSuccess();else{var b=a.error;switch(b){case"identity-mismatch":break;default:break}e.endFail(b)}return a})}function x(a,b,c){var e=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MESSAGE_ENCRYPTION,{string:{chat:"1:1",jid:c},bool:{useLongSessionDrop:d("WAGlobals").getConfig().useLongSessionDrop()}},void 0);return d("WACryptoManager").bulkEncryptContent(b.cryptoManager,a).then(function(a){if(a.success)e.endSuccess();else{var b=a.error;switch(b){case"missing":case"mismatch":case"runtime-exception":break;default:break}e.endFail(b)}return a})}function y(a,b,c,e,f,g){var h=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MESSAGE_ENCRYPTION,{string:{chat:"1:1",jid:g},bool:{useLongSessionDrop:d("WAGlobals").getConfig().useLongSessionDrop()}},void 0);return d("WACryptoManager").encryptContent(c.cryptoManager,a,b,e||d("WACryptoManager").DEFAULT_SESSION_REQUEST,f).then(function(a){if(a.success)h.endSuccess();else{var b=a.error;switch(b){case"identity-mismatch":case"errSignalInvalidKey":break;default:break}h.endFail(b)}return a})}function z(a,b){return d("WACryptoManager").bulkEncryptContent(b.cryptoManager,a).then(function(a){if(a.success===!1){d("WALogger").ERROR(i());return new Map()}return a.value})}function A(a,c){var e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:f.next=2;return b("regeneratorRuntime").awrap(d("WACryptoManager").ensureSessionsExists(c.cryptoManager,a));case 2:e=f.sent;f.next=5;return b("regeneratorRuntime").awrap((h||(h=b("Promise"))).all(Array.from(e.entries()).map(function(a){var b=a[0];a=a[1];return c.cryptoManager.storage.handleNewSession(b,a,a.remote.pubKey)})));case 5:case"end":return f.stop()}},null,this)}g.createCryptoManager=a;g.decryptMsg=e;g.decryptGroupMsg=f;g.getParticipantInfo=r;g.getPreKeyGenerationsTimestamps=s;g.deletePreKeyGenerations=t;g.saveSenderKeySession=u;g.getSignalInfoForRetry=v;g.encryptGroupContentWithMetrics=w;g.bulkEncryptMsgWithMetrics=x;g.encryptMsgWithMetrics=y;g.bulkEncrypt=z;g.bulkPreEstablishOutgoingSession=A}),98);
__d("WAScheduleAfterOfflineResume",["Promise","WAGlobals","WALogger","WAOfflineUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["AfterOfflineResume, flush: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["AfterOfflineResume: ",""]);j=function(){return a};return a}function a(){return(h||(h=b("Promise"))).resolve()}var k=new Map();function l(a){setTimeout(function(){return a()["catch"](function(a){return d("WALogger").ERROR(j(),a)})},0)}function c(a){var b=a.code,c=a.id,e=a.combine;a=a.useFirstCallback;var f=d("WAGlobals").getWaOneQueue();if(!f){l(b);return}if(f.getMode()===d("WAOfflineUtils").ServerRPCMode.ONLINE&&!k.has(c)){l(b);return}f=b;if(e===!0&&k.has(c)){b=k.get(c)||[];b.push(f);k.set(c,b);return}if(a!==!0){k.set(c,[f]);return}if(k.has(c))return;else k.set(c,[f])}function e(){var a=k.entries();k=new Map();for(var a=a,b=Array.isArray(a),c=0,a=b?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(b){if(c>=a.length)break;e=a[c++]}else{c=a.next();if(c.done)break;e=c.value}e=e;e[0];e=e[1];for(var f=0;f<e.length;f++){var g=e[f];g()["catch"](function(a){return d("WALogger").ERROR(i(),a)})}}}g.noopAction=a;g.scheduleAfterOfflineResume=c;g.flushPostponedActions=e}),98);
__d("WAProtocolQueueLogger",["WAServerRPCLogger"],(function(a,b,c,d,e,f,g){"use strict";a=d("WAServerRPCLogger").logger.TAGS(["ProtocolQueue"]);g.logger=a}),98);
__d("MAWProtocolQueueUtils",["MAWGetStorageQplAnnotations","MAWIncomingMsg","WAHashStringToNumber","WAPREList","WAPREMetrics","WAProtocolQueue","WAProtocolQueueLogger","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot remove acked stanzas ",""]);h=function(){return a};return a}var i=50;function a(a){return function(b){b.success&&c("promiseDone")(a(b.value.toAck));return b}}function j(a){var b=a.stanza,e=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.RECEIVE_MESSAGE,d("MAWIncomingMsg").prepareAnnotationsForIncomingMessage({consumerRetries:b.consumerRetries,msg:b.message.details,queueType:b.message.details.offline!=null?"offline":"online",retryCount:b.message.details.retryCount}),d("WAHashStringToNumber").hashStringToNumber(b.stanzaId.toString()));c("promiseDone")(d("MAWGetStorageQplAnnotations").getStorageQplAnnotations().then(function(a){e.addAnnotations(a)}));e.addPoint("consumer_handle_message_stanza_start");return babelHelpers["extends"]({},a,{receiveFlow:e})}function k(a){return j({decodedMsg:void 0,stanza:a})}function b(a){var b=!1;return d("WAProtocolQueue").protocolQueue().failAck(a,function(a){var c=a.consumerRetries+1;if(c>=i){if(a.type==="message"){var e=k(d("WAProtocolQueue").mapProcolQueueMessageV2toV1(a));e.receiveFlow.endFail("consumer_retries_exceed_limit",{"int":{consumerRetries:a.consumerRetries}})}b=!0;return}return babelHelpers["extends"]({},a,{consumerRetries:c})}).then(function(){return b})["catch"](function(a){d("WAProtocolQueueLogger").logger.ERROR(h(),a);return!1})}g.makeAckResult=a;g.addMetricToMessage=j;g.addMetricToProtocolMessage=k;g.failAck=b}),98);
__d("WAFrankingNode",["Promise","WAFranking","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Can't handle franking version ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Franking key is missing"]);j=function(){return a};return a}function a(a,c,e){if(c==null){d("WALogger").ERROR(j());return(h||(h=b("Promise"))).resolve(null)}if(e!=null&&e!==0){d("WALogger").ERROR(i(),e);return(h||(h=b("Promise"))).resolve(null)}return d("WAFranking").genFrankingTag(c,a)}g.genFrankingTagFromMessageApplicationEncode=a}),98);
__d("WAGenReportingMeta",["WAByteArray","WAFranking","WAFrankingNode","WAGlobals","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,c,e){var f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:if(!d("WAGlobals").getConfig().isFrankingEnabled()){g.next=7;break}g.next=3;return b("regeneratorRuntime").awrap(d("WAFrankingNode").genFrankingTagFromMessageApplicationEncode(a,c,e));case 3:f=g.sent;return g.abrupt("return",{frankingKey:c,frankingTag:f,frankingVersion:d("WAFranking").getFrankingVersion(e),reportingContent:d("WAByteArray").uint8ArrayToBuffer(a),reportingTag:null});case 7:return g.abrupt("return",{frankingKey:c,frankingTag:null,frankingVersion:d("WAFranking").getFrankingVersion(e),reportingContent:null,reportingTag:null});case 8:case"end":return g.stop()}},null,this)}g.genReportingMeta=a}),98);
__d("WACryptoPkcs7",["WACryptoDependencies","WAErr"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=new Uint8Array(1);do d("WACryptoDependencies").getCrypto().getRandomValues(b);while(b[0]===0);h(a,b[0])}function b(a){var b=new Uint8Array(1);d("WACryptoDependencies").getCrypto().getRandomValues(b);h(a,(b[0]&15)+1)}function h(a,b){for(var c=0;c<b;c++)a.writeUint8(b)}function e(a){if(a.length===0)throw c("WAErr")("unpadPkcs7 given empty bytes");var b=a[a.length-1];if(b>a.length)throw c("WAErr")("unpadPkcs7 given "+a.length+" bytes, but pad is "+b);return new Uint8Array(a.buffer,a.byteOffset,a.length-b)}g.writeRandomPad=a;g.writeRandomPadMax16=b;g.writePad=h;g.unpadPkcs7=e}),98);
__d("WAAsMessageTransport",["WABinary","WACryptoPkcs7"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e,f){f===void 0&&(f=2);var g;b!=null&&(g={destinationJid:b});var h;a!=null&&(h={applicationPayload:{payload:a,version:f}});b=new(d("WABinary").Binary)();d("WACryptoPkcs7").writeRandomPadMax16(b);return{payload:h,protocol:{integral:{padding:b.readBuffer(),dsm:g},ancillary:{skdm:c==null?void 0:c,icdc:e==null?void 0:e}}}}g.asMessageTransport=a}),98);
__d("WAMapUtils",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return new Map(Array.from(a.entries()).map(function(a){return[a[0],b(a[1],a[0])]}))}f.mapValues=a}),66);
__d("WAMsgTransport.pb",["WACommon.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){var h;a={NOOP:0,UPSERT:1,DELETE:2,UPSERT_AND_DELETE:3};b={};c={};e={};f={};var i={},j={},k={},l={},m={},n={},o={};b.internalSpec={payload:[1,(h=d("WAProtoConst")).TYPES.MESSAGE,c],protocol:[2,h.TYPES.MESSAGE,e]};c.internalSpec={applicationPayload:[1,h.TYPES.MESSAGE,d("WACommon.pb").SubProtocolSpec],futureProof:[3,h.TYPES.ENUM,d("WACommon.pb").FUTURE_PROOF_BEHAVIOR]};e.internalSpec={integral:[1,h.TYPES.MESSAGE,m],ancillary:[2,h.TYPES.MESSAGE,f]};f.internalSpec={skdm:[2,h.TYPES.MESSAGE,l],deviceListMetadata:[3,h.TYPES.MESSAGE,o],icdc:[4,h.TYPES.MESSAGE,j],backupDirective:[5,h.TYPES.MESSAGE,i]};i.internalSpec={messageId:[1,h.TYPES.STRING],actionType:[2,h.TYPES.ENUM,a],supplementalKey:[3,h.TYPES.STRING]};j.internalSpec={senderIdentity:[1,h.TYPES.MESSAGE,k],recipientIdentities:[2,h.FLAGS.REPEATED|h.TYPES.MESSAGE,k],recipientUserJids:[3,h.FLAGS.REPEATED|h.TYPES.STRING]};k.internalSpec={seq:[1,h.TYPES.INT32],signingDevice:[2,h.TYPES.BYTES],unknownDevices:[3,h.FLAGS.REPEATED|h.TYPES.BYTES],unknownDeviceIds:[4,h.FLAGS.REPEATED|h.TYPES.INT32]};l.internalSpec={groupId:[1,h.TYPES.STRING],axolotlSenderKeyDistributionMessage:[2,h.TYPES.BYTES]};m.internalSpec={padding:[1,h.TYPES.BYTES],dsm:[2,h.TYPES.MESSAGE,n]};n.internalSpec={destinationJid:[1,h.TYPES.STRING],phash:[2,h.TYPES.STRING]};o.internalSpec={senderKeyHash:[1,h.TYPES.BYTES],senderTimestamp:[2,h.TYPES.UINT64],recipientKeyHash:[8,h.TYPES.BYTES],recipientTimestamp:[9,h.TYPES.UINT64]};g.MESSAGE_TRANSPORT_PROTOCOL_ANCILLARY_BACKUP_DIRECTIVE_ACTION_TYPE=a;g.MessageTransportSpec=b;g.MessageTransport$PayloadSpec=c;g.MessageTransport$ProtocolSpec=e;g.MessageTransport$Protocol$AncillarySpec=f;g.MessageTransport$Protocol$Ancillary$BackupDirectiveSpec=i;g.MessageTransport$Protocol$Ancillary$ICDCParticipantDevicesSpec=j;g.MessageTransport$Protocol$Ancillary$ICDCParticipantDevices$ICDCIdentityListDescriptionSpec=k;g.MessageTransport$Protocol$Ancillary$SenderKeyDistributionMessageSpec=l;g.MessageTransport$Protocol$IntegralSpec=m;g.MessageTransport$Protocol$Integral$DeviceSentMessageSpec=n;g.DeviceListMetadataSpec=o}),98);
__d("WAProtocolMediaType",[],(function(a,b,c,d,e,f){"use strict";function a(a){switch(a){case"image":case"sticker":case"gif":case"video":case"ptt":case"audio":case"document":case"product":return a;case"xma-image":return"document";default:return null}}f.castToProtocolMediaType=a}),66);
__d("WAEncNode",["WAAsMessageTransport","WACryptoManagerUtils","WAErr","WAGlobals","WALogger","WAMapUtils","WAMsgTransport.pb","WANullthrows","WAProtocolMediaType","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg failed to encrypt message: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg failed to encrypt message: ",""]);i=function(){return a};return a}function a(a,b,e,f){var g=d("WAMapUtils").mapValues(a,function(a,b){var c=a.params;a=a.icdc;var d;switch(c.type){case"message":d=j({messageBytes:c.messageBytes,to:b,icdc:a,chat:c.chat,applicationPayloadVersion:c.applicationPayloadVersion});break;case"appdata":d=k({messageBytes:c.messageBytes});break;default:c.type,d=l({skdm:c.skdm,icdc:a})}return{plaintext:d}});return d("WACryptoManagerUtils").bulkEncryptMsgWithMetrics(g,b,e).then(function(b){if(!b.success){d("WALogger").ERROR(i(),b.error);return null}return d("WAMapUtils").mapValues(b.value,function(b,e){var g,h=b.type,i=b.ciphertext;b=b.baseKey;g=c("WANullthrows")((g=a.get(e))==null?void 0:g.params);var j=g.type==="message"&&g.messageType.type==="media"?d("WAProtocolMediaType").castToProtocolMediaType(g.messageType.mediaType):null;return{encType:"device",to:e,v:((e=g.messageBytes)==null?void 0:e.version)==="v2"?"2":"3",type:h,mediaType:j,count:f,ciphertext:i,baseKey:b}})})}function b(a,b,c,e,f,g,i){var m;switch(b.type){case"message":m=j({messageBytes:b.messageBytes,to:a,icdc:i,chat:b.chat,applicationPayloadVersion:b.applicationPayloadVersion});break;case"appdata":m=k({messageBytes:b.messageBytes});break;default:b.type,m=l({skdm:b.skdm,icdc:i})}i=d("WACryptoManagerUtils").encryptMsgWithMetrics(a,m,c,f,g,b==null?void 0:b.chat);return i.then(function(c){var f;if(!c.success){d("WALogger").ERROR(h(),c.error);return null}var g=b.type==="message"&&b.messageType.type==="media"?d("WAProtocolMediaType").castToProtocolMediaType(b.messageType.mediaType):null,i=c.value,j=i.type;i=i.ciphertext;return{encType:"device",to:a,v:((f=b.messageBytes)==null?void 0:f.version)==="v2"?"2":"3",type:j,mediaType:g,count:e,ciphertext:i,baseKey:c.value.baseKey}})}function j(a){var b=a.messageBytes,c=a.to,e=a.icdc,f=a.chat;a=a.applicationPayloadVersion;if(b.version==="v3"){var g=null;d("WAGlobals").isPeerDevice(c)&&(g=f);f=d("WAAsMessageTransport").asMessageTransport(b.bytes,g,null,e,a);return d("encodeProtobuf").encodeProtobuf(d("WAMsgTransport.pb").MessageTransportSpec,f).readByteArray()}else if(d("WAGlobals").isPeerDevice(c))return b.bytesForPeer;else return b.bytes}function k(a){a=a.messageBytes;if(a.version==="v3"){a=d("WAAsMessageTransport").asMessageTransport(a.bytes);return d("encodeProtobuf").encodeProtobuf(d("WAMsgTransport.pb").MessageTransportSpec,a).readByteArray()}else throw c("WAErr")("Plaintext v2 not supported yet")}function l(a){var b=a.skdm;a=a.icdc;b=d("WAAsMessageTransport").asMessageTransport(null,null,b,a);return d("encodeProtobuf").encodeProtobuf(d("WAMsgTransport.pb").MessageTransportSpec,b).readByteArray()}g.getEncNodes=a;g.getEncNode=b}),98);
__d("WAPhash",["Promise","WABase64","WABinary","WACryptoDependencies","WALogger","WASortedLists"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Calculate pHash -- end"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Calculate pHash -- Start"]);j=function(){return a};return a}function a(a){d("WALogger").LOG(j());a=d("WASortedLists").sortAndDedupe(a);var c=new(d("WABinary").Binary)();for(var e=0;e<a.length;e++)c.writeString(a[e]);return(h||(h=b("Promise"))).resolve(d("WACryptoDependencies").getCrypto().subtle.digest("SHA-256",c.readByteArray()).then(function(a){d("WALogger").LOG(i());a=new Uint8Array(a,0,6);return"2:"+d("WABase64").encodeB64(a)}))}g.calculatePHash=a}),98);
__d("WAEncUserMsg",["Promise","WAEncNode","WAGlobals","WAICDCUtils","WAJids","WAPhash","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- getParticipantNodes -- receiverEncypted -- FALSE"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- encrypt - getParticipantNodes -- EMPTY DEVICE JIDS"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- encrypt -- getParticipantNodes -- START"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- getParticipantNodes -- EMPTY NODE"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptUserMsg -- user message -- DONE"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptUserMsg -- user message -- OTHER_RECIPENT_DEVICE_EMPTY"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptUserMsg -- user message -- ICDC"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- no other recipient"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- no recipient"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptUserMsg -- user message -- START"]);r=function(){return a};return a}var s=d("WATagsLogger").TAGS(["WAEncUserMsg"]);function a(a,c,e,f){s.LOG(r());a.length===0&&s.ERROR(q());var g=!1;a.length===1&&(g=a[0].user===d("WAGlobals").getMyUserJid());var i=a.find(function(a){return a.user===d("WAGlobals").getMyUserJid()});i==null&&(i={user:d("WAGlobals").getMyUserJid(),devicesInfo:[]});var j=a.filter(function(a){return a.user!==d("WAGlobals").getMyUserJid()});j.length===0&&c.type!=="appdata"&&!g&&s.ERROR(p());g=d("WAICDCUtils").computeICDCParticipantDevices(i,j,e);s.LOG(o());i=a.flatMap(function(a){return a.devicesInfo}).map(function(a){return a.jid});v(a)&&s.LOG(n());return(h||(h=b("Promise"))).all([t(i,c,f,g),d("WAPhash").calculatePHash(i.concat(d("WAGlobals").getMyDeviceJid()))]).then(function(a){var b=a[0];a=a[1];s.LOG(m());return{participants:b,phash:a}})}function c(a,b,c){return t(a,b,c)}function t(a,b,c,d){return u(a,b,c,d).then(function(a){if(a.length===0){s.WARN(l());return}return a})}function e(a,b,c,e,f,g){return d("WAEncNode").getEncNode(a,b,c,e,f,g)}function u(a,b,c,e){var f=!1;s.LOG(k());(b.type!=="message"||d("WAJids").interpretAsGroupJid(b.chat)!=null)&&(f=!0);a=d("WAEncNode").getEncNodes(new Map(a.map(function(a){return[a,{params:b,icdc:e}]})),c).then(function(a){if(a==null){s.WARN(j());return[]}b.type==="message"&&(f=f||Array.from(a.keys()).some(function(a){return d("WAJids").extractUserJid(a)===b.chat}));return Array.from(a==null?void 0:a.values())});return a.then(function(a){if(f)return a;else{s.ERROR(i());return[]}}).then(function(a){return a.filter(Boolean)})}function v(a){return a.filter(function(a){return a.user!==d("WAGlobals").getMyUserJid()}).flatMap(function(a){return a.devicesInfo}).length===0}g.encryptUserMsg=a;g.encryptGroupFanoutMsg=c;g.encryptDeviceJidMessage=e}),98);
__d("WASmaxMixinGroupExhaustiveError",[],(function(a,b,c,d,e,f){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.name="SmaxMixinGroupExhaustiveError",b)||babelHelpers.assertThisInitialized(c)}return b}(babelHelpers.wrapNativeSuper(Error));f.SmaxMixinGroupExhaustiveError=a}),66);
__d("WAGetUserDevices",["regeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";function a(a,c){var d;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(c.storage.bulkLoadIdentities(a));case 2:d=e.sent;return e.abrupt("return",Array.from(d).flatMap(function(a){a=a[1];return Array.from(a.keys())}));case 4:case"end":return e.stop()}},null,this)}f.getUserDevices=a}),66);
__d("WAEncGroupMsg",["WAAsMessageTransport","WACryptoManager","WACryptoManagerUtils","WAEncUserMsg","WAGetUserDevices","WAGlobals","WAHex","WALogger","WAMsgTransport.pb","WAPhash","WAPromiseQueue","WAProtocolMediaType","WASortedLists","WATimeUtils","encodeProtobuf","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptGroupMsg - end key distribution"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptGroupMsg - start key distribution"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptGroupMsg - Encrypt success"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptGroupMsg - Finish encrypt group content"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptGroupMsg - Finish group fanout msg "]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptGroupMsg - Finish rotate participant info "]);m=function(){return a};return a}var n=30*d("WATimeUtils").DAY_SECONDS,o=new(d("WAPromiseQueue").PromiseQueue)();function p(a,c,e,f){return o.enqueue(function(){var g,h,i,j,k,l,m,o,p,q;return b("regeneratorRuntime").async(function(r){while(1)switch(r.prev=r.next){case 0:r.next=2;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().getSenderKeyStatus(a));case 2:g=r.sent;h=g.ts,i=g.rotateSenderKey,j=g.hasSenderKey;k=g.senderKeyId;l=k==null||i||!d("WATimeUtils").happenedWithin(h,n);r.next=8;return b("regeneratorRuntime").awrap(d("WAGetUserDevices").getUserDevices(c,e.cryptoManager));case 8:m=r.sent;o=new Set(m);if(!(l||k==null)){r.next=20;break}r.next=13;return b("regeneratorRuntime").awrap(d("WACryptoManager").rotateGroupSenderKey(e.cryptoManager,a,d("WAGlobals").getMyDeviceJid()));case 13:p=r.sent;k=p.senderKeyId;r.next=17;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().markSenderKeyAsRotated(a,k,d("WATimeUtils").unixTime()));case 17:f==null?void 0:f.addPoint("finish_sk_rotation");r.next=23;break;case 20:q=new Set(m),(j||[]).forEach(function(a){return q["delete"](a)}),f==null?void 0:f.addPoint("no_sk_rotation",{"int":{noRotationNeedsSK:q.size}});case 23:return r.abrupt("return",{senderKeyId:k,needsSenderKey:o,groupParticipants:new Set(m)});case 24:case"end":return r.stop()}},null,this)})}function a(a,c,e,f,g,n){var o,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J;return b("regeneratorRuntime").async(function(K){while(1)switch(K.prev=K.next){case 0:n==null?void 0:n.addPoint("enc_group_start");K.next=3;return b("regeneratorRuntime").awrap(p(a,c.map(function(a){return a.user}),g,n));case 3:o=K.sent;r=o.senderKeyId;s=o.needsSenderKey;t=o.groupParticipants;d("WALogger").LOG(m());n==null?void 0:n.addPoint("rotated_participant_info");u=null;x=c.flatMap(function(a){return a.devicesInfo}).map(function(a){return a.jid});y=!d("WASortedLists").areEqual(d("WASortedLists").asSortedSet(t),d("WASortedLists").sortAndDedupe(x));z=f.type==="text"&&f.isRevoked;A=f.type==="media"?d("WAProtocolMediaType").castToProtocolMediaType(f.mediaType):null;if(!(y||z)){K.next=23;break}K.next=17;return b("regeneratorRuntime").awrap(d("WAEncUserMsg").encryptGroupFanoutMsg(x,{type:"message",messageBytes:e,messageType:f,chat:a},g));case 17:B=K.sent;B&&!(f.type==="text"&&f.isInvisible===!0)&&(v=B,w={encType:"group",to:a,v:e.version==="v3"?"3":"2",type:"skmsg",mediaType:A,ciphertext:null});d("WALogger").LOG(l());n==null?void 0:n.addPoint("finish_group_fanout_msg");K.next=45;break;case 23:e.version==="v3"?(D=d("WAAsMessageTransport").asMessageTransport(e.bytes),C=d("encodeProtobuf").encodeProtobuf(d("WAMsgTransport.pb").MessageTransportSpec,D).readByteArray()):C=e.bytes;K.next=26;return b("regeneratorRuntime").awrap(d("WACryptoManagerUtils").encryptGroupContentWithMetrics(a,C,g));case 26:E=K.sent;d("WALogger").LOG(k());n==null?void 0:n.addPoint("finish_encrypt_group_content");if(!E.success){K.next=45;break}d("WALogger").LOG(j());F=E.value;r!==F.senderKeyId&&t.forEach(function(a){return s.add(a)});if(!(s.size>0)){K.next=43;break}G={groupId:a,axolotlSenderKeyDistributionMessage:d("WAHex").bytesToBuffer(F.senderKeyDistributionProto)};d("WALogger").LOG(i());H=x.filter(function(a){return s.has(a)});K.next=39;return b("regeneratorRuntime").awrap(q(H,G,g));case 39:I=K.sent,d("WALogger").LOG(h()),n==null?void 0:n.addPoint("finish_skdm_enc_node"),I.length>0&&(v=I,u={group:a,senderKeyId:F.senderKeyId,knowsSenderKey:new Set(H)});case 43:w={encType:"group",to:a,v:e.version==="v2"?"2":"3",type:F.ciphertext.type,mediaType:A,ciphertext:F.ciphertext.ciphertext},f.type==="text"&&f.isInvisible===!0&&(w={encType:"group",to:a,v:e.version==="v2"?"2":"3",type:"skmsg",mediaType:null,ciphertext:null});case 45:K.next=47;return b("regeneratorRuntime").awrap(d("WAPhash").calculatePHash(x.concat(d("WAGlobals").getMyDeviceJid())));case 47:J=K.sent;n==null?void 0:n.addPoint("phash_finish");return K.abrupt("return",{phash:J,participants:v,encNode:w,senderKeyDistributionInfo:u});case 50:case"end":return K.stop()}},null,this)}function q(a,b,c){b=d("WAAsMessageTransport").asMessageTransport(null,null,b,null);var e=d("encodeProtobuf").encodeProtobuf(d("WAMsgTransport.pb").MessageTransportSpec,b).readByteArray();return d("WACryptoManagerUtils").bulkEncrypt(new Map(a.map(function(a){return[a,{plaintext:e}]})),c).then(function(a){var b=[];a.forEach(function(a,c){b.push({encType:"device",to:c,v:"3",type:a.type,ciphertext:a.ciphertext,mediaType:null,count:null,baseKey:null})});return b})}g.encryptGroupMsg=a}),98);
__d("WAGetDeviceIdentityMixin",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a!=null?{deviceIdentityElementValue:a}:null}f.getDeviceIdentityMixin=a}),66);
__d("WAParseFranking",["WAFranking","WAFrankingTypes"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b;if(a==null)return null;b=(b=a.maybeChild("franking_tag"))==null?void 0:b.contentBytes();return{frankingKey:null,frankingTag:b!=null?d("WAFrankingTypes").castToFrankingTag(b):null,reportingTag:(b=a.maybeChild("reporting_tag"))==null?void 0:b.contentBytes(),frankingVersion:d("WAFranking").getFrankingVersion(),reportingContent:null}}g.parseFrankingNode=a}),98);
__d("WASmaxInMessagePublishAckAdminEditMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"edit","3");return!b.success?b:d("WAResultOrError").makeResult({edit:b.value})}g.parseAckAdminEditMixin=a}),98);
__d("WASmaxInMessagePublishAckAdminRevokeMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"edit","8");return!b.success?b:d("WAResultOrError").makeResult({edit:b.value})}g.parseAckAdminRevokeMixin=a}),98);
__d("WASmaxInMessagePublishAckMessageEditMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"edit","1");return!b.success?b:d("WAResultOrError").makeResult({edit:b.value})}g.parseAckMessageEditMixin=a}),98);
__d("WASmaxInMessagePublishAckMessagePinMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"edit","2");return!b.success?b:d("WAResultOrError").makeResult({edit:b.value})}g.parseAckMessagePinMixin=a}),98);
__d("WASmaxInMessagePublishEnums",[],(function(a,b,c,d,e,f){a={CBP:"CBP",NBP:"NBP"};b={delivery:"delivery",no_optimization:"no_optimization"};c={"false":"false","true":"true"};d={lid:"lid",pn:"pn"};f.ENUM_CBP_NBP=a;f.ENUM_DELIVERY_NOOPTIMIZATION=b;f.ENUM_FALSE_TRUE=c;f.ENUM_LID_PN=d}),66);
__d("WASmaxInMessagePublishAckPaidConversationMixin",["WAResultOrError","WASmaxInMessagePublishEnums","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"delivery_context");if(!b.success)return b;b=d("WASmaxParseUtils").attrStringEnum(a,"optimization_goal",d("WASmaxInMessagePublishEnums").ENUM_DELIVERY_NOOPTIMIZATION);return!b.success?b:d("WAResultOrError").makeResult({optimizationGoal:b.value})}function i(a){var b=d("WASmaxParseUtils").assertTag(a,"source_url");if(!b.success)return b;b=d("WASmaxParseUtils").contentString(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function j(a){var b=d("WASmaxParseUtils").assertTag(a,"referral");if(!b.success)return b;b=d("WASmaxParseUtils").optionalChildWithTag(a,"source_url",i);if(!b.success)return b;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"source_type");return!a.success?a:d("WAResultOrError").makeResult({sourceType:a.value,sourceUrl:b.value})}function k(a){var b=d("WASmaxParseUtils").assertTag(a,"origin");if(!b.success)return b;b=d("WASmaxParseUtils").optionalChildWithTag(a,"referral",j);if(!b.success)return b;a=d("WASmaxParseUtils").attrString(a,"type");return!a.success?a:d("WAResultOrError").makeResult({type:a.value,referral:b.value})}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"biz");if(!b.success)return b;a=d("WASmaxParseUtils").optionalChildWithTag(b.value,"delivery_context",h);if(!a.success)return a;var c=d("WASmaxParseUtils").optionalChildWithTag(b.value,"origin",k);if(!c.success)return c;var e=d("WASmaxParseUtils").attrString(b.value,"paid_convo_id");if(!e.success)return e;var f=d("WASmaxParseUtils").attrStringEnum(b.value,"pricing_model",d("WASmaxInMessagePublishEnums").ENUM_CBP_NBP);if(!f.success)return f;var g=d("WASmaxParseUtils").attrStringEnum(b.value,"billable",d("WASmaxInMessagePublishEnums").ENUM_FALSE_TRUE);if(!g.success)return g;var i=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,b.value,"expiration_timestamp",0,void 0);if(!i.success)return i;b=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,b.value,"pricing_category");return!b.success?b:d("WAResultOrError").makeResult({bizPaidConvoId:e.value,bizPricingModel:f.value,bizBillable:g.value,bizExpirationTimestamp:i.value,bizPricingCategory:b.value,bizDeliveryContext:a.value,bizOrigin:c.value})}g.parseAckPaidConversationBizDeliveryContext=h;g.parseAckPaidConversationBizOriginReferralSourceUrl=i;g.parseAckPaidConversationBizOriginReferral=j;g.parseAckPaidConversationBizOrigin=k;g.parseAckPaidConversationMixin=a}),98);
__d("WASmaxInMessagePublishAckRevokeMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"edit","7");return!b.success?b:d("WAResultOrError").makeResult({edit:b.value})}g.parseAckRevokeMixin=a}),98);
__d("WASmaxInMessagePublishServerFrankingTagMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"franking");if(!a.success)return a;a=d("WASmaxParseUtils").flattenedChildWithTag(a.value,"reporting_tag");if(!a.success)return a;a=d("WASmaxParseUtils").contentBytesRange(a.value,16,128);return!a.success?a:d("WAResultOrError").makeResult({frankingReportingTagElementValue:a.value})}g.parseServerFrankingTagMixin=a}),98);
__d("WASmaxInMessagePublishAckMixin",["WAResultOrError","WASmaxInMessagePublishAckAdminEditMixin","WASmaxInMessagePublishAckAdminRevokeMixin","WASmaxInMessagePublishAckMessageEditMixin","WASmaxInMessagePublishAckMessagePinMixin","WASmaxInMessagePublishAckPaidConversationMixin","WASmaxInMessagePublishAckRevokeMixin","WASmaxInMessagePublishServerFrankingTagMixin","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"ack");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"class","message");if(!c.success)return c;b=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",b.value);if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"t",0,void 0);if(!b.success)return b;var e=d("WASmaxInMessagePublishAckMessageEditMixin").parseAckMessageEditMixin(a),f=d("WASmaxInMessagePublishAckAdminEditMixin").parseAckAdminEditMixin(a),g=d("WASmaxInMessagePublishAckMessagePinMixin").parseAckMessagePinMixin(a),h=d("WASmaxInMessagePublishAckAdminRevokeMixin").parseAckAdminRevokeMixin(a),i=d("WASmaxInMessagePublishAckRevokeMixin").parseAckRevokeMixin(a),j=d("WASmaxInMessagePublishAckPaidConversationMixin").parseAckPaidConversationMixin(a);a=d("WASmaxInMessagePublishServerFrankingTagMixin").parseServerFrankingTagMixin(a);return d("WAResultOrError").makeResult({"class":c.value,t:b.value,ackMessageEditMixin:e.success?e.value:null,ackAdminEditMixin:f.success?f.value:null,ackMessagePinMixin:g.success?g.value:null,ackAdminRevokeMixin:h.success?h.value:null,ackRevokeMixin:i.success?i.value:null,ackPaidConversationMixin:j.success?j.value:null,serverFrankingTagMixin:a.success?a.value:null})}g.parseAckMixin=a}),98);
__d("WASmaxInMessagePublishApplicationNegativeAckMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"application_error",0,void 0);return!b.success?b:d("WAResultOrError").makeResult({applicationError:b.value})}g.parseApplicationNegativeAckMixin=a}),98);
__d("WASmaxInMessagePublishMessageNackRetryAttributesMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"backoff",0,86400);return!b.success?b:d("WAResultOrError").makeResult({backoff:b.value})}g.parseMessageNackRetryAttributesMixin=a}),98);
__d("WASmaxInMessagePublishNegativeAckMixin",["WAResultOrError","WASmaxInMessagePublishAckMixin","WASmaxInMessagePublishApplicationNegativeAckMixin","WASmaxInMessagePublishMessageNackRetryAttributesMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"ack");if(!c.success)return c;c=d("WASmaxParseUtils").attrString(a,"error");if(!c.success)return c;b=d("WASmaxInMessagePublishAckMixin").parseAckMixin(a,b);if(!b.success)return b;var e=d("WASmaxInMessagePublishApplicationNegativeAckMixin").parseApplicationNegativeAckMixin(a);a=d("WASmaxInMessagePublishMessageNackRetryAttributesMixin").parseMessageNackRetryAttributesMixin(a);return d("WAResultOrError").makeResult(babelHelpers["extends"]({error:c.value},b.value,{applicationNegativeAckMixin:e.success?e.value:null,messageNackRetryAttributesMixin:a.success?a.value:null}))}g.parseNegativeAckMixin=a}),98);
__d("WASmaxInMessagePublishIndividualResponseNegative",["WAResultOrError","WASmaxInMessagePublishNegativeAckMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"ack");if(!c.success)return c;c=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrUserJid,a,"recipient");if(!c.success)return c;a=d("WASmaxInMessagePublishNegativeAckMixin").parseNegativeAckMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({recipient:c.value},a.value))}g.parseIndividualResponseNegative=a}),98);
__d("WASmaxInMessagePublishAckRcatMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"rcat");if(!b.success)return b;a=d("WASmaxParseUtils").contentBytes(b.value);return!a.success?a:d("WAResultOrError").makeResult({rcatElementValue:a.value})}g.parseAckRcatMixin=a}),98);
__d("WASmaxInMessagePublishDeviceListStaleMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"phash");return!b.success?b:d("WAResultOrError").makeResult({phash:b.value})}g.parseDeviceListStaleMixin=a}),98);
__d("WASmaxInMessagePublishIndividualResponseSuccess",["WAResultOrError","WASmaxInMessagePublishAckMixin","WASmaxInMessagePublishAckRcatMixin","WASmaxInMessagePublishDeviceListStaleMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"ack");if(!c.success)return c;c=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrUserJid,a,"recipient");if(!c.success)return c;var e=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrUserJid,a,"participant");if(!e.success)return e;b=d("WASmaxInMessagePublishAckMixin").parseAckMixin(a,b);if(!b.success)return b;var f=d("WASmaxInMessagePublishDeviceListStaleMixin").parseDeviceListStaleMixin(a);a=d("WASmaxInMessagePublishAckRcatMixin").parseAckRcatMixin(a);return d("WAResultOrError").makeResult(babelHelpers["extends"]({recipient:c.value,participant:e.value},b.value,{deviceListStaleMixin:f.success?f.value:null,ackRcatMixin:a.success?a.value:null}))}g.parseIndividualResponseSuccess=a}),98);
__d("WASmaxOutMessagePublishAutomatedMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("automated",null));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeAutomatedMixin=a}),98);
__d("WASmaxOutMessagePublishAuthMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.authVerificationTimestamp;a=a.authEnableRiskCheck;b=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",null,d("WASmaxJsx").smax("auth",{verification_timestamp:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,b),enable_risk_check:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)})));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeAuthMixin=a}),98);
__d("WASmaxOutMessagePublishBizAcceptTsMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.bizAcceptTs;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",{accept_ts:d("WAWap").INT(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBizAcceptTsMixin=a}),98);
__d("WASmaxOutMessagePublishBizAutoResponseMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.bizAutoResponse;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",{auto_response:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBizAutoResponseMixin=a}),98);
__d("WASmaxOutMessagePublishBizCampaignMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.bizCampaignId;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",{campaign_id:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBizCampaignMixin=a}),98);
__d("WASmaxOutMessagePublishBizMetadataMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c,e=a.metadataAppOwner,f=a.metadataCsidBm,g=a.metadataPaymentBm;a=a.metadataCustomerCategory;e=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",null,d("WASmaxJsx").smax("metadata",{app_owner:(b=d("WASmaxAttrs")).OPTIONAL((c=d("WAWap")).CUSTOM_STRING,e),csid_bm:b.OPTIONAL(c.CUSTOM_STRING,f),payment_bm:b.OPTIONAL(c.CUSTOM_STRING,g),customer_category:b.OPTIONAL(c.CUSTOM_STRING,a)})));return e}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBizMetadataMixin=a}),98);
__d("WASmaxOutMessagePublishBizRolesMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.bizHostStorage,c=a.bizActualActors;a=a.bizPrivacyModeTs;b=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",{host_storage:d("WAWap").INT(b),actual_actors:d("WAWap").INT(c),privacy_mode_ts:d("WAWap").INT(a)}));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBizRolesMixin=a}),98);
__d("WASmaxOutMessagePublishButtonsMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",null,d("WASmaxJsx").smax("buttons",null)));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeButtonsMixin=a}),98);
__d("WASmaxOutMessagePublishExtensionsMetadataMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.capabilityArgs;a=d("WASmaxJsx").smax("capabilities",null,d("WASmaxChildren").REPEATED_CHILD(i,a,1,50));return a}function i(a){a=a.capabilityName;a=d("WASmaxJsx").smax("capability",{name:d("WAWap").CUSTOM_STRING(a)});return a}function j(a){var b=a.capabilitiesArgs,c=a.extensionsMetadataWellVersion,e=a.extensionsMetadataDataApiVersion;a=a.extensionsMetadataFlowMessageVersion;c=d("WASmaxJsx").smax("native_flow",null,d("WASmaxJsx").smax("extensions_metadata",{well_version:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,c),data_api_version:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,e),flow_message_version:d("WAWap").INT(a)},d("WASmaxChildren").OPTIONAL_CHILD(h,b)));return c}function a(a,b){b=j(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeExtensionsMetadataExtensionsMetadataCapabilities=h;g.makeExtensionsMetadataExtensionsMetadataCapabilitiesCapability=i;g.mergeExtensionsMetadataMixin=a}),98);
__d("WASmaxOutMessagePublishNativeFlowMessageTypeMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishExtensionsMetadataMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.nativeFlowName,c=a.nativeFlowV;a=a.extensionsMetadataMixinArgs;b=d("WASmaxJsx").smax("interactive",{type:"native_flow"},d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishExtensionsMetadataMixin").mergeExtensionsMetadataMixin,d("WASmaxJsx").smax("native_flow",{name:d("WAWap").CUSTOM_STRING(b),v:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,c)}),a));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeNativeFlowMessageTypeMixin=a}),98);
__d("WASmaxOutMessagePublishInteractiveMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishNativeFlowMessageTypeMixin"],(function(a,b,c,d,e,f,g){function h(a){var b=a.hasInteractiveV1;a=a.nativeFlowMessageTypeMixinArgs;b=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",null,d("WASmaxOutMessagePublishNativeFlowMessageTypeMixin").mergeNativeFlowMessageTypeMixin(d("WASmaxJsx").smax("interactive",{v:d("WASmaxAttrs").OPTIONAL_LITERAL("1",b)}),a)));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeInteractiveMixin=a}),98);
__d("WASmaxOutMessagePublishNativeFlowMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.bizNativeFlowName;a=a.bizNativeFlowVersion;b=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",{native_flow_name:d("WAWap").CUSTOM_STRING(b),native_flow_version:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,a)}));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeNativeFlowMixin=a}),98);
__d("WASmaxOutMessagePublishButtonsOrNativeFlowOrInteractiveMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishButtonsMixin","WASmaxOutMessagePublishInteractiveMixin","WASmaxOutMessagePublishNativeFlowMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isButtons)return d("WASmaxOutMessagePublishButtonsMixin").mergeButtonsMixin(a);if(b.nativeFlow)return d("WASmaxOutMessagePublishNativeFlowMixin").mergeNativeFlowMixin(a,b.nativeFlow);if(b.interactive)return d("WASmaxOutMessagePublishInteractiveMixin").mergeInteractiveMixin(a,b.interactive);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeButtonsOrNativeFlowOrInteractiveMixinGroup=a}),98);
__d("WASmaxOutMessagePublishConversionRecipientStatusMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.conversionRecipientStatus;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("conversion",{recipient_status:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeConversionRecipientStatusMixin=a}),98);
__d("WASmaxOutMessagePublishClickToWhatsAppTypeMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.sourceUrlElementValue;a=d("WASmaxJsx").smax("source_url",null,a);return a}function i(a){var b,c,e=a.sourceUrlArgs,f=a.ctwaConversionSource,g=a.ctwaConversionData,i=a.ctwaSourceType,j=a.ctwaEntryPointConversionSource;a=a.ctwaEntryPointConversionApp;f=d("WASmaxJsx").smax("ctwa",{conversion_source:(b=d("WASmaxAttrs")).OPTIONAL((c=d("WAWap")).CUSTOM_STRING,f),conversion_data:b.OPTIONAL(c.CUSTOM_STRING,g),source_type:b.OPTIONAL(c.CUSTOM_STRING,i),entry_point_conversion_source:b.OPTIONAL(c.CUSTOM_STRING,j),entry_point_conversion_app:b.OPTIONAL(c.CUSTOM_STRING,a)},d("WASmaxChildren").OPTIONAL_CHILD(h,e));return f}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeClickToWhatsAppTypeSourceUrl=h;g.mergeClickToWhatsAppTypeMixin=a}),98);
__d("WASmaxOutMessagePublishCtwaConversionMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishClickToWhatsAppTypeMixin"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxOutMessagePublishClickToWhatsAppTypeMixin").mergeClickToWhatsAppTypeMixin(d("WASmaxJsx").smax("ctwa",null),a);return a}function i(a){a=a.ctwaArgs;a=d("WASmaxJsx").smax("message",null,d("WASmaxChildren").OPTIONAL_CHILD(h,a));return a}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeCtwaConversionCtwa=h;g.mergeCtwaConversionMixin=a}),98);
__d("WASmaxOutMessagePublishDeliveryContextMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c,e=a.deliveryContextHsmMaxBid,f=a.deliveryContextOptimizationGoal,g=a.deliveryContextTemplateId,h=a.deliveryContextCampaignId,i=a.deliveryContextSourceType,j=a.deliveryContextTierType,k=a.deliveryContextDeliveryType,l=a.deliveryContextClientToken;a=a.deliveryContextPrice;e=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",null,d("WASmaxJsx").smax("delivery_context",{hsm_max_bid:(b=d("WASmaxAttrs")).OPTIONAL((c=d("WAWap")).INT,e),optimization_goal:b.OPTIONAL(c.CUSTOM_STRING,f),template_id:b.OPTIONAL(c.CUSTOM_STRING,g),campaign_id:b.OPTIONAL(c.CUSTOM_STRING,h),source_type:b.OPTIONAL(c.CUSTOM_STRING,i),tier_type:b.OPTIONAL(c.CUSTOM_STRING,j),delivery_type:b.OPTIONAL(c.CUSTOM_STRING,k),client_token:b.OPTIONAL(c.CUSTOM_STRING,l),price:b.OPTIONAL(c.INT,a)})));return e}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeDeliveryContextMixin=a}),98);
__d("WASmaxOutMessagePublishCapabilitiesMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.hasFeatureV1;a=d("WASmaxJsx").smax("feature",{name:"full_catalog",v:d("WASmaxAttrs").OPTIONAL_LITERAL("1",a)});return a}function i(a){a=a.featureArgs;a=d("WASmaxJsx").smax("hsm",null,d("WASmaxJsx").smax("capabilities",null,d("WASmaxChildren").OPTIONAL_CHILD(h,a)));return a}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeCapabilitiesCapabilitiesFeature=h;g.mergeCapabilitiesMixin=a}),98);
__d("WASmaxOutMessagePublishHSMReviewMetadataMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c,e=a.anyCategory,f=a.anyTag,g=a.anyId;a=a.anySubTag;e=d("WASmaxJsx").smax("smax$any",{category:(b=d("WASmaxAttrs")).OPTIONAL((c=d("WAWap")).CUSTOM_STRING,e),tag:b.OPTIONAL(c.CUSTOM_STRING,f),id:b.OPTIONAL(c.CUSTOM_STRING,g),sub_tag:b.OPTIONAL(c.CUSTOM_STRING,a)});return e}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeHSMReviewMetadataMixin=a}),98);
__d("WASmaxOutMessagePublishHsmMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishCapabilitiesMixin","WASmaxOutMessagePublishHSMReviewMetadataMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.messageTtl,c=a.hasHsmV1,e=a.hasHsmButtons1,f=a.hSMReviewMetadataMixinArgs;a=a.capabilitiesMixinArgs;b=d("WASmaxJsx").smax("message",{ttl:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,b)},d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishCapabilitiesMixin").mergeCapabilitiesMixin,d("WASmaxOutMessagePublishHSMReviewMetadataMixin").mergeHSMReviewMetadataMixin(d("WASmaxJsx").smax("hsm",{v:d("WASmaxAttrs").OPTIONAL_LITERAL("1",c),buttons:d("WASmaxAttrs").OPTIONAL_LITERAL("1",e)}),f),a));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeHsmMixin=a}),98);
__d("WASmaxOutMessagePublishBizMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishAuthMixin","WASmaxOutMessagePublishBizAcceptTsMixin","WASmaxOutMessagePublishBizAutoResponseMixin","WASmaxOutMessagePublishBizCampaignMixin","WASmaxOutMessagePublishBizMetadataMixin","WASmaxOutMessagePublishBizRolesMixin","WASmaxOutMessagePublishButtonsOrNativeFlowOrInteractiveMixinGroup","WASmaxOutMessagePublishConversionRecipientStatusMixin","WASmaxOutMessagePublishCtwaConversionMixin","WASmaxOutMessagePublishDeliveryContextMixin","WASmaxOutMessagePublishHsmMixin"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.hsmMixinArgs,e=a.bizRolesMixinArgs,f=a.bizAutoResponseMixinArgs,g=a.bizAcceptTsMixinArgs,h=a.bizCampaignMixinArgs,i=a.deliveryContextMixinArgs,j=a.authMixinArgs,k=a.conversionRecipientStatusMixinArgs,l=a.ctwaConversionMixinArgs,m=a.bizMetadataMixinArgs;a=a.buttonsOrNativeFlowOrInteractiveMixinGroupArgs;b=(b=d("WASmaxMixins")).optionalMerge(d("WASmaxOutMessagePublishButtonsOrNativeFlowOrInteractiveMixinGroup").mergeButtonsOrNativeFlowOrInteractiveMixinGroup,b.optionalMerge(d("WASmaxOutMessagePublishBizMetadataMixin").mergeBizMetadataMixin,b.optionalMerge(d("WASmaxOutMessagePublishCtwaConversionMixin").mergeCtwaConversionMixin,b.optionalMerge(d("WASmaxOutMessagePublishConversionRecipientStatusMixin").mergeConversionRecipientStatusMixin,b.optionalMerge(d("WASmaxOutMessagePublishAuthMixin").mergeAuthMixin,b.optionalMerge(d("WASmaxOutMessagePublishDeliveryContextMixin").mergeDeliveryContextMixin,b.optionalMerge(d("WASmaxOutMessagePublishBizCampaignMixin").mergeBizCampaignMixin,b.optionalMerge(d("WASmaxOutMessagePublishBizAcceptTsMixin").mergeBizAcceptTsMixin,b.optionalMerge(d("WASmaxOutMessagePublishBizAutoResponseMixin").mergeBizAutoResponseMixin,b.optionalMerge(d("WASmaxOutMessagePublishBizRolesMixin").mergeBizRolesMixin,b.optionalMerge(d("WASmaxOutMessagePublishHsmMixin").mergeHsmMixin,d("WASmaxJsx").smax("message",null),c),e),f),g),h),i),j),k),l),m),a);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBizMixin=a}),98);
__d("WASmaxOutMessagePublishClientFrankingTagMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.frankingTagElementValue;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("franking",null,d("WASmaxJsx").smax("franking_tag",null,a)));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeClientFrankingTagMixin=a}),98);
__d("WASmaxOutMessagePublishClientReportingTokenMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.reportingTokenElementValue;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("reporting",null,d("WASmaxJsx").smax("reporting_token",null,a)));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeClientReportingTokenMixin=a}),98);
__d("WASmaxOutMessagePublishDeviceIdentityMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.deviceIdentityElementValue;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("device-identity",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeDeviceIdentityMixin=a}),98);
__d("WASmaxOutMessagePublishInternalTestMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.testConfig;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("test",{config:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeInternalTestMixin=a}),98);
__d("WASmaxOutMessagePublishLIDSessionDeprecationMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaDeprecatedLidSession;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{deprecated_lid_session:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeLIDSessionDeprecationMixin=a}),98);
__d("WASmaxOutMessagePublishMetaHideDecryptionPlaceholderMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("meta",{"decrypt-fail":"hide"}));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeMetaHideDecryptionPlaceholderMixin=a}),98);
__d("WASmaxOutMessagePublishMulticastMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("multicast",null));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeMulticastMixin=a}),98);
__d("WASmaxOutMessagePublishNoExtraFanoutMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{device_fanout:"false"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeNoExtraFanoutMixin=a}),98);
__d("WASmaxOutMessagePublishPreFilledNumberMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("url_number",null));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePreFilledNumberMixin=a}),98);
__d("WASmaxOutMessagePublishPreFilledTextMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("url_text",null));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePreFilledTextMixin=a}),98);
__d("WASmaxOutMessagePublishSenderIntentMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{sender_intent:"hosted"}));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeSenderIntentMixin=a}),98);
__d("WASmaxOutMessagePublishRequestIDMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.requestIdElementValue;a=d("WASmaxJsx").smax("trace",null,d("WASmaxJsx").smax("request_id",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeRequestIDMixin=a}),98);
__d("WASmaxOutMessagePublishTraceIDMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.edgeIdElementValue;a=d("WASmaxJsx").smax("edge_id",null,a);return a}function i(a){var b=a.edgeIdArgs;a=a.traceIdElementValue;a=d("WASmaxJsx").smax("trace",null,d("WASmaxJsx").smax("trace_id",null,a),d("WASmaxChildren").OPTIONAL_CHILD(h,b));return a}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeTraceIDEdgeId=h;g.mergeTraceIDMixin=a}),98);
__d("WASmaxOutMessagePublishRequestOrTraceIDMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishRequestIDMixin","WASmaxOutMessagePublishTraceIDMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.requestID)return d("WASmaxOutMessagePublishRequestIDMixin").mergeRequestIDMixin(a,b.requestID);if(b.traceID)return d("WASmaxOutMessagePublishTraceIDMixin").mergeTraceIDMixin(a,b.traceID);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeRequestOrTraceIDMixinGroup=a}),98);
__d("WASmaxOutMessagePublishTraceContextMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishRequestOrTraceIDMixinGroup"],(function(a,b,c,d,e,f,g){function h(a){a=a.requestOrTraceIDMixinGroupArgs;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxOutMessagePublishRequestOrTraceIDMixinGroup").mergeRequestOrTraceIDMixinGroup(d("WASmaxJsx").smax("trace",null),a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeTraceContextMixin=a}),98);
__d("WASmaxOutMessagePublishVerifiedNameNameMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.messageVerifiedName;a=d("WASmaxJsx").smax("message",{verified_name:d("WAWap").CUSTOM_STRING(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeVerifiedNameNameMixin=a}),98);
__d("WASmaxOutMessagePublishBaseMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishAutomatedMixin","WASmaxOutMessagePublishBizMixin","WASmaxOutMessagePublishClientFrankingTagMixin","WASmaxOutMessagePublishClientReportingTokenMixin","WASmaxOutMessagePublishDeviceIdentityMixin","WASmaxOutMessagePublishInternalTestMixin","WASmaxOutMessagePublishLIDSessionDeprecationMixin","WASmaxOutMessagePublishMetaHideDecryptionPlaceholderMixin","WASmaxOutMessagePublishMulticastMixin","WASmaxOutMessagePublishNoExtraFanoutMixin","WASmaxOutMessagePublishPreFilledNumberMixin","WASmaxOutMessagePublishPreFilledTextMixin","WASmaxOutMessagePublishSenderIntentMixin","WASmaxOutMessagePublishTraceContextMixin","WASmaxOutMessagePublishVerifiedNameNameMixin"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.deviceIdentityMixinArgs,e=a.hasNoExtraFanout,f=a.hasMulticast,g=a.hasPreFilledText,h=a.hasPreFilledNumber,i=a.hasAutomated,j=a.bizMixinArgs,k=a.verifiedNameNameMixinArgs,l=a.clientFrankingTagMixinArgs,m=a.clientReportingTokenMixinArgs,n=a.internalTestMixinArgs,o=a.hasMetaHideDecryptionPlaceholder,p=a.traceContextMixinArgs,q=a.hasSenderIntent;a=a.lIDSessionDeprecationMixinArgs;b=(b=d("WASmaxMixins")).optionalMerge(d("WASmaxOutMessagePublishLIDSessionDeprecationMixin").mergeLIDSessionDeprecationMixin,b.optionalMerge(d("WASmaxOutMessagePublishSenderIntentMixin").mergeSenderIntentMixin,b.optionalMerge(d("WASmaxOutMessagePublishTraceContextMixin").mergeTraceContextMixin,b.optionalMerge(d("WASmaxOutMessagePublishMetaHideDecryptionPlaceholderMixin").mergeMetaHideDecryptionPlaceholderMixin,b.optionalMerge(d("WASmaxOutMessagePublishInternalTestMixin").mergeInternalTestMixin,b.optionalMerge(d("WASmaxOutMessagePublishClientReportingTokenMixin").mergeClientReportingTokenMixin,b.optionalMerge(d("WASmaxOutMessagePublishClientFrankingTagMixin").mergeClientFrankingTagMixin,b.optionalMerge(d("WASmaxOutMessagePublishVerifiedNameNameMixin").mergeVerifiedNameNameMixin,b.optionalMerge(d("WASmaxOutMessagePublishBizMixin").mergeBizMixin,b.optionalMerge(d("WASmaxOutMessagePublishAutomatedMixin").mergeAutomatedMixin,b.optionalMerge(d("WASmaxOutMessagePublishPreFilledNumberMixin").mergePreFilledNumberMixin,b.optionalMerge(d("WASmaxOutMessagePublishPreFilledTextMixin").mergePreFilledTextMixin,b.optionalMerge(d("WASmaxOutMessagePublishMulticastMixin").mergeMulticastMixin,b.optionalMerge(d("WASmaxOutMessagePublishNoExtraFanoutMixin").mergeNoExtraFanoutMixin,b.optionalMerge(d("WASmaxOutMessagePublishDeviceIdentityMixin").mergeDeviceIdentityMixin,d("WASmaxJsx").smax("message",null),c),e),f),g),h),i),j),k),l),m),n),o),p),q),a);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseMixin=a}),98);
__d("WASmaxOutMessagePublishGroupInviteTargetMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaGroupInvite;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{group_invite:d("WAWap").GROUP_JID(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeGroupInviteTargetMixin=a}),98);
__d("WASmaxOutMessagePublishBotFeedbackMessageTypeMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("bot",{type:"feedback"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBotFeedbackMessageTypeMixin=a}),98);
__d("WASmaxOutMessagePublishEncRetryMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.encCount;a=d("WASmaxJsx").smax("enc",{count:d("WAWap").INT(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncRetryMixin=a}),98);
__d("WASmaxOutMessagePublishEncPayloadMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.encElementValue;a=d("WASmaxJsx").smax("enc",null,a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncPayloadMixin=a}),98);
__d("WASmaxOutMessagePublishEncTypeIndividualMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishEncPayloadMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.encType;b=d("WASmaxOutMessagePublishEncPayloadMixin").mergeEncPayloadMixin(d("WASmaxJsx").smax("enc",{type:d("WAWap").CUSTOM_STRING(b)}),a);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncTypeIndividualMixin=a}),98);
__d("WASmaxOutMessagePublishEncVersion2Mixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("enc",{v:"2"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncVersion2Mixin=a}),98);
__d("WASmaxOutMessagePublishEncVersionFutureproofMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.encV;a=d("WASmaxJsx").smax("enc",{v:d("WAWap").INT(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncVersionFutureproofMixin=a}),98);
__d("WASmaxOutMessagePublishEncVersion2OrFutureproofMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishEncVersion2Mixin","WASmaxOutMessagePublishEncVersionFutureproofMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isEncVersion2)return d("WASmaxOutMessagePublishEncVersion2Mixin").mergeEncVersion2Mixin(a);if(b.encVersionFutureproof)return d("WASmaxOutMessagePublishEncVersionFutureproofMixin").mergeEncVersionFutureproofMixin(a,b.encVersionFutureproof);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeEncVersion2OrFutureproofMixinGroup=a}),98);
__d("WASmaxOutMessagePublishMediaTypeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.encMediatype;a=d("WASmaxJsx").smax("enc",{mediatype:d("WAWap").CUSTOM_STRING(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeMediaTypeMixin=a}),98);
__d("WASmaxOutMessagePublishBotRequestMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishEncRetryMixin","WASmaxOutMessagePublishEncTypeIndividualMixin","WASmaxOutMessagePublishEncVersion2OrFutureproofMixinGroup","WASmaxOutMessagePublishMediaTypeMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.toJid,c=a.encRetryMixinArgs,e=a.encTypeIndividualMixinArgs,f=a.mediaTypeMixinArgs;a=a.encVersion2OrFutureproofMixinGroupArgs;b=d("WASmaxJsx").smax("to",{jid:d("WAWap").JID(b)},d("WASmaxOutMessagePublishEncVersion2OrFutureproofMixinGroup").mergeEncVersion2OrFutureproofMixinGroup(d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishMediaTypeMixin").mergeMediaTypeMixin,d("WASmaxOutMessagePublishEncTypeIndividualMixin").mergeEncTypeIndividualMixin(d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishEncRetryMixin").mergeEncRetryMixin,d("WASmaxJsx").smax("enc",null),c),e),f),a));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBotRequestMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeMediaMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{type:"media"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypeMediaMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeTextMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{type:"text"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypeTextMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeTextOrMediaMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishContentTypeTextMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isContentTypeText)return d("WASmaxOutMessagePublishContentTypeTextMixin").mergeContentTypeTextMixin(a);if(b.isContentTypeMedia)return d("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(a);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeContentTypeTextOrMediaMixinGroup=a}),98);
__d("WASmaxOutMessagePublishBotLocalAutomatedTypeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.botLocalAutomatedType;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("bot",{local_automated_type:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBotLocalAutomatedTypeMixin=a}),98);
__d("WASmaxOutMessagePublishBotMessageTypeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.botType;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("bot",{type:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBotMessageTypeMixin=a}),98);
__d("WASmaxOutMessagePublishBusinessBotMessageMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.botBizBot;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("bot",{biz_bot:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBusinessBotMessageMixin=a}),98);
__d("WASmaxOutMessagePublishProductListMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",null,d("WASmaxJsx").smax("list",{type:"product_list"})));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeProductListMixin=a}),98);
__d("WASmaxOutMessagePublishSingleSelectListMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.listV;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",null,d("WASmaxJsx").smax("list",{type:"single_select",v:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)})));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeSingleSelectListMixin=a}),98);
__d("WASmaxOutMessagePublishSingleSelectOrProductListMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishProductListMixin","WASmaxOutMessagePublishSingleSelectListMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.singleSelectList)return d("WASmaxOutMessagePublishSingleSelectListMixin").mergeSingleSelectListMixin(a,b.singleSelectList);if(b.isProductList)return d("WASmaxOutMessagePublishProductListMixin").mergeProductListMixin(a);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeSingleSelectOrProductListMixinGroup=a}),98);
__d("WASmaxOutMessagePublishContentTypeListFanoutMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishSingleSelectOrProductListMixinGroup"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("to",null,d("WASmaxJsx").smax("enc",{mediatype:"list"}));return a}function i(a){var b=a.toCount;a=a.singleSelectOrProductListMixinGroupArgs;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishSingleSelectOrProductListMixinGroup").mergeSingleSelectOrProductListMixinGroup,d("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("participants",null,d("WASmaxChildren").HOMOGENEOUS_CHILD_COUNT(h,b)))),a);return b}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeContentTypeListFanoutParticipantsTo=h;g.mergeContentTypeListFanoutMixin=a}),98);
__d("WASmaxOutMessagePublishLiveLocationModeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaLivelocMode;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{liveloc_mode:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeLiveLocationModeMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeLiveLocationFanoutDeprecatedMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishLiveLocationModeMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.encDuration;a=d("WASmaxJsx").smax("to",null,d("WASmaxJsx").smax("enc",{mediatype:"livelocation",duration:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,a)}));return a}function i(a){var b=a.toArgs;a=a.liveLocationModeMixinArgs;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishLiveLocationModeMixin").mergeLiveLocationModeMixin,d("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("participants",null,d("WASmaxChildren").HOMOGENEOUS_CHILD(h,b)))),a);return b}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeContentTypeLiveLocationFanoutDeprecatedParticipantsTo=h;g.mergeContentTypeLiveLocationFanoutDeprecatedMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeLiveLocationFanoutMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishLiveLocationModeMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.encDuration;a=d("WASmaxJsx").smax("to",null,d("WASmaxJsx").smax("enc",{mediatype:"livelocation",duration:d("WAWap").INT(a)}));return a}function i(a){var b=a.toArgs;a=a.liveLocationModeMixinArgs;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishLiveLocationModeMixin").mergeLiveLocationModeMixin,d("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("participants",null,d("WASmaxChildren").HOMOGENEOUS_CHILD(h,b)))),a);return b}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeContentTypeLiveLocationFanoutParticipantsTo=h;g.mergeContentTypeLiveLocationFanoutMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeMedianotifyMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{type:"medianotify"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypeMedianotifyMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishContentTypeMedianotifyMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isContentTypeMedia)return d("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(a);if(b.isContentTypeMedianotify)return d("WASmaxOutMessagePublishContentTypeMedianotifyMixin").mergeContentTypeMedianotifyMixin(a);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeContentTypeMediaOrMedianotifyMixinGroup=a}),98);
__d("WASmaxOutMessagePublishSenderContentBindingMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.senderContentBindingElementValue;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("sender_content_binding",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeSenderContentBindingMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeMediaFanoutDeprecatedMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup","WASmaxOutMessagePublishSenderContentBindingMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.encMediatype,c=a.hasEncStickerTypeAvatar;a=a.encNativeFlowName;b=d("WASmaxJsx").smax("to",null,d("WASmaxJsx").smax("enc",{mediatype:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,b),sticker_type:d("WASmaxAttrs").OPTIONAL_LITERAL("avatar",c),native_flow_name:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)}));return b}function i(a){var b=a.toArgs,c=a.senderContentBindingMixinArgs;a=a.contentTypeMediaOrMedianotifyMixinGroupArgs;b=d("WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup").mergeContentTypeMediaOrMedianotifyMixinGroup(d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishSenderContentBindingMixin").mergeSenderContentBindingMixin,d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("participants",null,d("WASmaxChildren").HOMOGENEOUS_CHILD(h,b))),c),a);return b}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeContentTypeMediaFanoutDeprecatedParticipantsTo=h;g.mergeContentTypeMediaFanoutDeprecatedMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeMediaFanoutMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup","WASmaxOutMessagePublishSenderContentBindingMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.encMediatype,c=a.hasEncStickerTypeAvatar;a=a.encNativeFlowName;b=d("WASmaxJsx").smax("to",null,d("WASmaxJsx").smax("enc",{mediatype:d("WAWap").CUSTOM_STRING(b),sticker_type:d("WASmaxAttrs").OPTIONAL_LITERAL("avatar",c),native_flow_name:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)}));return b}function i(a){var b=a.toArgs,c=a.senderContentBindingMixinArgs;a=a.contentTypeMediaOrMedianotifyMixinGroupArgs;b=d("WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup").mergeContentTypeMediaOrMedianotifyMixinGroup(d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishSenderContentBindingMixin").mergeSenderContentBindingMixin,d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("participants",null,d("WASmaxChildren").HOMOGENEOUS_CHILD(h,b))),c),a);return b}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeContentTypeMediaFanoutParticipantsTo=h;g.mergeContentTypeMediaFanoutMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypePollCreationMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{type:"poll"},d("WASmaxJsx").smax("meta",{polltype:"creation"}));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypePollCreationMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypePollVoteMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{type:"poll"},d("WASmaxJsx").smax("meta",{polltype:"vote"}));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypePollVoteMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeReactionMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{type:"reaction"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypeReactionMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypePayMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{type:"pay"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypePayMixin=a}),98);
__d("WASmaxOutMessagePublishPayNodeTypeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.payType;a=d("WASmaxJsx").smax("pay",{type:d("WAWap").CUSTOM_STRING(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePayNodeTypeMixin=a}),98);
__d("WASmaxOutMessagePublishBasePayNodeMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishPayNodeTypeMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.payCountry,c=a.payVersion,e=a.payIsFirstSend;b=d("WASmaxOutMessagePublishPayNodeTypeMixin").mergePayNodeTypeMixin(d("WASmaxJsx").smax("pay",{country:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,b),version:d("WAWap").INT(c),is_first_send:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,e)}),a);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBasePayNodeMixin=a}),98);
__d("WASmaxOutMessagePublishLegacyAmountMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.payCurrency;a=a.payAmount;b=d("WASmaxJsx").smax("pay",{currency:d("WAWap").CUSTOM_STRING(b),amount:d("WAWap").CUSTOM_STRING(a)});return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeLegacyAmountMixin=a}),98);
__d("WASmaxOutMessagePublishMoneyMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.moneyValue,c=a.moneyOffset;a=a.moneyCurrency;b=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("money",{value:d("WAWap").CUSTOM_STRING(b),offset:d("WAWap").CUSTOM_STRING(c),currency:d("WAWap").CUSTOM_STRING(a)}));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeMoneyMixin=a}),98);
__d("WASmaxOutMessagePublishBaseIndividualPublishSendPayNodeMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBasePayNodeMixin","WASmaxOutMessagePublishLegacyAmountMixin","WASmaxOutMessagePublishMoneyMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxOutMessagePublishMoneyMixin").mergeMoneyMixin(d("WASmaxJsx").smax("amount",null),a);return a}function i(a){var b=a.amountArgs,c=a.payCredentialId,e=a.payDeviceId,f=a.payRequestId,g=a.legacyAmountMixinArgs;c=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishLegacyAmountMixin").mergeLegacyAmountMixin,d("WASmaxOutMessagePublishBasePayNodeMixin").mergeBasePayNodeMixin(d("WASmaxJsx").smax("pay",{"credential-id":d("WAWap").CUSTOM_STRING(c),"device-id":d("WAWap").CUSTOM_STRING(e),"request-id":d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,f)},d("WASmaxChildren").OPTIONAL_CHILD(h,b)),a),g);return c}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeBaseIndividualPublishSendPayNodeAmount=h;g.mergeBaseIndividualPublishSendPayNodeMixin=a}),98);
__d("WASmaxOutMessagePublishInstallmentMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishMoneyMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxOutMessagePublishMoneyMixin").mergeMoneyMixin(d("WASmaxJsx").smax("due_amount",null),a);return a}function i(a){a=d("WASmaxOutMessagePublishMoneyMixin").mergeMoneyMixin(d("WASmaxJsx").smax("interest",null),a);return a}function j(a){var b=a.dueAmountArgs,c=a.interestArgs,e=a.installmentMaxCount;a=a.installmentSelectedCount;e=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("installment",{max_count:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,e),selected_count:d("WAWap").INT(a)},d("WASmaxChildren").OPTIONAL_CHILD(h,b),d("WASmaxChildren").OPTIONAL_CHILD(i,c)));return e}function a(a,b){b=j(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeInstallmentInstallmentDueAmount=h;g.makeInstallmentInstallmentInterest=i;g.mergeInstallmentMixin=a}),98);
__d("WASmaxOutMessagePublishBeneficiaryMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.beneficiaryName,e=a.beneficiaryAddressLine1,f=a.beneficiaryAddressLine2,g=a.beneficiaryCity,h=a.beneficiaryState,i=a.beneficiaryCountry;a=a.beneficiaryPostalCode;c=d("WASmaxJsx").smax("beneficiary",{name:(b=d("WAWap")).CUSTOM_STRING(c),address_line1:b.CUSTOM_STRING(e),address_line2:d("WASmaxAttrs").OPTIONAL(b.CUSTOM_STRING,f),city:d("WASmaxAttrs").OPTIONAL(b.CUSTOM_STRING,g),state:d("WASmaxAttrs").OPTIONAL(b.CUSTOM_STRING,h),country:b.CUSTOM_STRING(i),postal_code:b.CUSTOM_STRING(a)});return c}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBeneficiaryMixin=a}),98);
__d("WASmaxOutMessagePublishBeneficiariesMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBeneficiaryMixin"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxOutMessagePublishBeneficiaryMixin").mergeBeneficiaryMixin(d("WASmaxJsx").smax("beneficiary",null),a);return a}function i(a){a=a.beneficiaryArgs;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxChildren").REPEATED_CHILD(h,a,1,5));return a}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeBeneficiariesBeneficiary=h;g.mergeBeneficiariesMixin=a}),98);
__d("WASmaxOutMessagePublishOrderInPaymentMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBeneficiariesMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxOutMessagePublishBeneficiariesMixin").mergeBeneficiariesMixin(d("WASmaxJsx").smax("beneficiaries",null),a);return a}function i(a){var b,c=a.beneficiariesArgs,e=a.orderId,f=a.orderMessageId,g=a.orderPaymentConfigId;a=a.orderType;e=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("order",{id:(b=d("WAWap")).CUSTOM_STRING(e),message_id:d("WASmaxAttrs").OPTIONAL(b.STANZA_ID,f),payment_config_id:d("WASmaxAttrs").OPTIONAL(b.CUSTOM_STRING,g),type:d("WASmaxAttrs").OPTIONAL(b.CUSTOM_STRING,a)},d("WASmaxChildren").OPTIONAL_CHILD(h,c)));return e}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeOrderInPaymentOrderBeneficiaries=h;g.mergeOrderInPaymentMixin=a}),98);
__d("WASmaxOutMessagePublishPaymentInitiatorMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.anyPaymentInitiator;a=d("WASmaxJsx").smax("smax$any",{payment_initiator:d("WAWap").CUSTOM_STRING(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePaymentInitiatorMixin=a}),98);
__d("WASmaxOutMessagePublishBRPublishSendPayNodeP2MMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishInstallmentMixin","WASmaxOutMessagePublishOrderInPaymentMixin","WASmaxOutMessagePublishPaymentInitiatorMixin"],(function(a,b,c,d,e,f,g){function h(a){var b=a.orderInPaymentMixinArgs,c=a.paymentInitiatorMixinArgs;a=a.installmentMixinArgs;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishInstallmentMixin").mergeInstallmentMixin,d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishPaymentInitiatorMixin").mergePaymentInitiatorMixin,d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishOrderInPaymentMixin").mergeOrderInPaymentMixin,d("WASmaxJsx").smax("pay",{"transaction-type":"p2m"}),b),c),a);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBRPublishSendPayNodeP2MMixin=a}),98);
__d("WASmaxOutMessagePublishBRPublishSendPayNodeP2PMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("pay",{"transaction-type":"p2p"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBRPublishSendPayNodeP2PMixin=a}),98);
__d("WASmaxOutMessagePublishBRPublishSendPayNodeP2POrMMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishBRPublishSendPayNodeP2MMixin","WASmaxOutMessagePublishBRPublishSendPayNodeP2PMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isBRPublishSendPayNodeP2P)return d("WASmaxOutMessagePublishBRPublishSendPayNodeP2PMixin").mergeBRPublishSendPayNodeP2PMixin(a);if(b.bRPublishSendPayNodeP2M)return d("WASmaxOutMessagePublishBRPublishSendPayNodeP2MMixin").mergeBRPublishSendPayNodeP2MMixin(a,b.bRPublishSendPayNodeP2M);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeBRPublishSendPayNodeP2POrMMixinGroup=a}),98);
__d("WASmaxOutMessagePublishBRSendPayEloNodeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.eloDeviceSignature,e=a.eloWalletSignature,f=a.eloChallengeId;a=a.eloCardholderVerificationMethod;c=d("WASmaxJsx").smax("pay",null,d("WASmaxJsx").smax("elo",{device_signature:(b=d("WAWap")).CUSTOM_STRING(c),wallet_signature:b.CUSTOM_STRING(e),challenge_id:b.CUSTOM_STRING(f),cardholder_verification_method:b.CUSTOM_STRING(a)}));return c}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBRSendPayEloNodeMixin=a}),98);
__d("WASmaxOutMessagePublishBRPublishSendPayNodeDeprecatedMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBRPublishSendPayNodeP2POrMMixinGroup","WASmaxOutMessagePublishBRSendPayEloNodeMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.payId,e=a.payPaymentRails,f=a.payTrustedDeviceInfo,g=a.payNonce,h=a.bRSendPayEloNodeMixinArgs;a=a.bRPublishSendPayNodeP2POrMMixinGroupArgs;c=d("WASmaxOutMessagePublishBRPublishSendPayNodeP2POrMMixinGroup").mergeBRPublishSendPayNodeP2POrMMixinGroup(d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishBRSendPayEloNodeMixin").mergeBRSendPayEloNodeMixin,d("WASmaxJsx").smax("pay",{id:(b=d("WAWap")).CUSTOM_STRING(c),"payment-rails":d("WASmaxAttrs").OPTIONAL(b.CUSTOM_STRING,e),"trusted-device-info":d("WASmaxAttrs").OPTIONAL(b.CUSTOM_STRING,f),nonce:b.CUSTOM_STRING(g)}),h),a);return c}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBRPublishSendPayNodeDeprecatedMixin=a}),98);
__d("WASmaxOutMessagePublishBRPublishSendPayNodeMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBRPublishSendPayNodeP2POrMMixinGroup","WASmaxOutMessagePublishBRSendPayEloNodeMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.payId,e=a.payPaymentRails,f=a.payTrustedDeviceInfo,g=a.payNonce,h=a.bRSendPayEloNodeMixinArgs;a=a.bRPublishSendPayNodeP2POrMMixinGroupArgs;c=d("WASmaxOutMessagePublishBRPublishSendPayNodeP2POrMMixinGroup").mergeBRPublishSendPayNodeP2POrMMixinGroup(d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishBRSendPayEloNodeMixin").mergeBRSendPayEloNodeMixin,d("WASmaxJsx").smax("pay",{id:(b=d("WAWap")).CUSTOM_STRING(c),"payment-rails":b.CUSTOM_STRING(e),"trusted-device-info":b.CUSTOM_STRING(f),nonce:b.CUSTOM_STRING(g)}),h),a);return c}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBRPublishSendPayNodeMixin=a}),98);
__d("WASmaxOutMessagePublishOrderMessageMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.orderOrderId,e=a.orderOrderMessageId,f=a.orderExpiryTs,g=a.orderOrderType;a=a.orderDiscountProgramName;e=d("WASmaxJsx").smax("order",{"order-id":(b=d("WAWap")).CUSTOM_STRING(c),"order-message-id":(c=d("WASmaxAttrs")).OPTIONAL(b.CUSTOM_STRING,e),"expiry-ts":c.OPTIONAL(b.INT,f),"order-type":c.OPTIONAL(b.CUSTOM_STRING,g),"discount-program-name":c.OPTIONAL(b.CUSTOM_STRING,a)});return e}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeOrderMessageMixin=a}),98);
__d("WASmaxOutMessagePublishUPIPublishSendPayNodeP2MMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishOrderMessageMixin","WASmaxOutMessagePublishPaymentInitiatorMixin"],(function(a,b,c,d,e,f,g){function h(a){a=a.orderArgs;a=d("WASmaxJsx").smax("upi",null,d("WASmaxChildren").OPTIONAL_CHILD(i,a));return a}function i(a){a=d("WASmaxOutMessagePublishOrderMessageMixin").mergeOrderMessageMixin(d("WASmaxJsx").smax("order",null),a);return a}function j(a){var b=a.upiArgs;a=a.paymentInitiatorMixinArgs;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishPaymentInitiatorMixin").mergePaymentInitiatorMixin,d("WASmaxJsx").smax("pay",{"transaction-type":"p2m"},d("WASmaxChildren").OPTIONAL_CHILD(h,b)),a);return b}function a(a,b){b=j(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeUPIPublishSendPayNodeP2MUpi=h;g.makeUPIPublishSendPayNodeP2MUpiOrder=i;g.mergeUPIPublishSendPayNodeP2MMixin=a}),98);
__d("WASmaxOutMessagePublishUPIPublishSendPayNodeP2PMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.hasPayTransactionTypeP2P;a=d("WASmaxJsx").smax("pay",{"transaction-type":d("WASmaxAttrs").OPTIONAL_LITERAL("p2p",a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeUPIPublishSendPayNodeP2PMixin=a}),98);
__d("WASmaxOutMessagePublishUPIPublishSendPayNodeP2POrMMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishUPIPublishSendPayNodeP2MMixin","WASmaxOutMessagePublishUPIPublishSendPayNodeP2PMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.uPIPublishSendPayNodeP2P)return d("WASmaxOutMessagePublishUPIPublishSendPayNodeP2PMixin").mergeUPIPublishSendPayNodeP2PMixin(a,b.uPIPublishSendPayNodeP2P);if(b.uPIPublishSendPayNodeP2M)return d("WASmaxOutMessagePublishUPIPublishSendPayNodeP2MMixin").mergeUPIPublishSendPayNodeP2MMixin(a,b.uPIPublishSendPayNodeP2M);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeUPIPublishSendPayNodeP2POrMMixinGroup=a}),98);
__d("WASmaxOutMessagePublishUPIPublishSendPayNodeMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishUPIPublishSendPayNodeP2POrMMixinGroup","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.upiToken;a=d("WASmaxJsx").smax("upi",{token:d("WAWap").CUSTOM_STRING(a)});return a}function i(a){var b,c,e=a.upiArgs,f=a.payId,g=a.payMpin,i=a.payReceiverVpa,j=a.payReceiverVpaId,k=a.paySenderVpa,l=a.paySenderVpaId,m=a.paySeqNo,n=a.payUpiBankInfo,o=a.payMode,p=a.payPurposeCode,q=a.payMcc,r=a.payRefId;a=a.uPIPublishSendPayNodeP2POrMMixinGroupArgs;f=d("WASmaxOutMessagePublishUPIPublishSendPayNodeP2POrMMixinGroup").mergeUPIPublishSendPayNodeP2POrMMixinGroup(d("WASmaxJsx").smax("pay",{id:(b=d("WASmaxAttrs")).OPTIONAL((c=d("WAWap")).CUSTOM_STRING,f),mpin:b.OPTIONAL(c.CUSTOM_STRING,g),"receiver-vpa":c.CUSTOM_STRING(i),"receiver-vpa-id":b.OPTIONAL(c.CUSTOM_STRING,j),"sender-vpa":c.CUSTOM_STRING(k),"sender-vpa-id":b.OPTIONAL(c.CUSTOM_STRING,l),"seq-no":c.CUSTOM_STRING(m),"upi-bank-info":c.CUSTOM_STRING(n),mode:b.OPTIONAL(c.CUSTOM_STRING,o),"purpose-code":b.OPTIONAL(c.CUSTOM_STRING,p),mcc:b.OPTIONAL(c.CUSTOM_STRING,q),"ref-id":b.OPTIONAL(c.CUSTOM_STRING,r)},d("WASmaxChildren").OPTIONAL_CHILD(h,e)),a);return f}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeUPIPublishSendPayNodeUpi=h;g.mergeUPIPublishSendPayNodeMixin=a}),98);
__d("WASmaxOutMessagePublishBRPublishSendPayNodeOrBRPublishSendPayNodeDeprecatedOrUPIPublishSendPayNodeMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishBRPublishSendPayNodeDeprecatedMixin","WASmaxOutMessagePublishBRPublishSendPayNodeMixin","WASmaxOutMessagePublishUPIPublishSendPayNodeMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.bRPublishSendPayNode)return d("WASmaxOutMessagePublishBRPublishSendPayNodeMixin").mergeBRPublishSendPayNodeMixin(a,b.bRPublishSendPayNode);if(b.bRPublishSendPayNodeDeprecated)return d("WASmaxOutMessagePublishBRPublishSendPayNodeDeprecatedMixin").mergeBRPublishSendPayNodeDeprecatedMixin(a,b.bRPublishSendPayNodeDeprecated);if(b.uPIPublishSendPayNode)return d("WASmaxOutMessagePublishUPIPublishSendPayNodeMixin").mergeUPIPublishSendPayNodeMixin(a,b.uPIPublishSendPayNode);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeBRPublishSendPayNodeOrBRPublishSendPayNodeDeprecatedOrUPIPublishSendPayNodeMixinGroup=a}),98);
__d("WASmaxOutMessagePublishIntegrationPublishPayNodeMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBRPublishSendPayNodeOrBRPublishSendPayNodeDeprecatedOrUPIPublishSendPayNodeMixinGroup"],(function(a,b,c,d,e,f,g){function h(a){a=a.bRPublishSendPayNodeOrBRPublishSendPayNodeDeprecatedOrUPIPublishSendPayNodeMixinGroupArgs;a=d("WASmaxOutMessagePublishBRPublishSendPayNodeOrBRPublishSendPayNodeDeprecatedOrUPIPublishSendPayNodeMixinGroup").mergeBRPublishSendPayNodeOrBRPublishSendPayNodeDeprecatedOrUPIPublishSendPayNodeMixinGroup(d("WASmaxJsx").smax("pay",null),a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIntegrationPublishPayNodeMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualNonNoviPublishSendPayNodeMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBaseIndividualPublishSendPayNodeMixin","WASmaxOutMessagePublishIntegrationPublishPayNodeMixin"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxOutMessagePublishIntegrationPublishPayNodeMixin").mergeIntegrationPublishPayNodeMixin(d("WASmaxOutMessagePublishBaseIndividualPublishSendPayNodeMixin").mergeBaseIndividualPublishSendPayNodeMixin(d("WASmaxJsx").smax("pay",null),a),a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualNonNoviPublishSendPayNodeMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualPublishSendPayNodeMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishIndividualNonNoviPublishSendPayNodeMixin"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxOutMessagePublishIndividualNonNoviPublishSendPayNodeMixin").mergeIndividualNonNoviPublishSendPayNodeMixin(d("WASmaxJsx").smax("pay",null),a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualPublishSendPayNodeMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualRequestPayNodeMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBasePayNodeMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.payExpiryTs,c=a.payRequestId;b=d("WASmaxOutMessagePublishBasePayNodeMixin").mergeBasePayNodeMixin(d("WASmaxJsx").smax("pay",{"expiry-ts":d("WAWap").CUSTOM_STRING(b),"request-id":d("WAWap").CUSTOM_STRING(c)}),a);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualRequestPayNodeMixin=a}),98);
__d("WASmaxOutMessagePublishPayInviteNodeMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.payService;a=d("WASmaxJsx").smax("pay",{type:"invite",service:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePayInviteNodeMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualPublishSendPayOrIndividualRequestPayOrPayInviteNodeMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishIndividualPublishSendPayNodeMixin","WASmaxOutMessagePublishIndividualRequestPayNodeMixin","WASmaxOutMessagePublishPayInviteNodeMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.individualPublishSendPayNode)return d("WASmaxOutMessagePublishIndividualPublishSendPayNodeMixin").mergeIndividualPublishSendPayNodeMixin(a,b.individualPublishSendPayNode);if(b.individualRequestPayNode)return d("WASmaxOutMessagePublishIndividualRequestPayNodeMixin").mergeIndividualRequestPayNodeMixin(a,b.individualRequestPayNode);if(b.payInviteNode)return d("WASmaxOutMessagePublishPayInviteNodeMixin").mergePayInviteNodeMixin(a,b.payInviteNode);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeIndividualPublishSendPayOrIndividualRequestPayOrPayInviteNodeMixinGroup=a}),98);
__d("WASmaxOutMessagePublishIndividualPublishPayNodeMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishIndividualPublishSendPayOrIndividualRequestPayOrPayInviteNodeMixinGroup"],(function(a,b,c,d,e,f,g){function h(a){a=a.individualPublishSendPayOrIndividualRequestPayOrPayInviteNodeMixinGroupArgs;a=d("WASmaxOutMessagePublishIndividualPublishSendPayOrIndividualRequestPayOrPayInviteNodeMixinGroup").mergeIndividualPublishSendPayOrIndividualRequestPayOrPayInviteNodeMixinGroup(d("WASmaxJsx").smax("pay",null),a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualPublishPayNodeMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualIndividualPublishPayNodeMessageMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishIndividualPublishPayNodeMixin"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxJsx").smax("message",null,d("WASmaxOutMessagePublishIndividualPublishPayNodeMixin").mergeIndividualPublishPayNodeMixin(d("WASmaxJsx").smax("pay",null),a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualIndividualPublishPayNodeMessageMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualContentTypePayIndividualMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypePayMixin","WASmaxOutMessagePublishIndividualIndividualPublishPayNodeMessageMixin"],(function(a,b,c,d,e,f,g){function h(a){a=a.individualIndividualPublishPayNodeMessageMixinArgs;a=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishIndividualIndividualPublishPayNodeMessageMixin").mergeIndividualIndividualPublishPayNodeMessageMixin,d("WASmaxOutMessagePublishContentTypePayMixin").mergeContentTypePayMixin(d("WASmaxJsx").smax("message",null)),a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualContentTypePayIndividualMixin=a}),98);
__d("WASmaxOutMessagePublishContentFanoutMixins",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishContentTypeListFanoutMixin","WASmaxOutMessagePublishContentTypeLiveLocationFanoutDeprecatedMixin","WASmaxOutMessagePublishContentTypeLiveLocationFanoutMixin","WASmaxOutMessagePublishContentTypeMediaFanoutDeprecatedMixin","WASmaxOutMessagePublishContentTypeMediaFanoutMixin","WASmaxOutMessagePublishContentTypeMedianotifyMixin","WASmaxOutMessagePublishContentTypePollCreationMixin","WASmaxOutMessagePublishContentTypePollVoteMixin","WASmaxOutMessagePublishContentTypeReactionMixin","WASmaxOutMessagePublishContentTypeTextMixin","WASmaxOutMessagePublishIndividualContentTypePayIndividualMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isContentTypeText)return d("WASmaxOutMessagePublishContentTypeTextMixin").mergeContentTypeTextMixin(a);if(b.contentTypeMediaFanout)return d("WASmaxOutMessagePublishContentTypeMediaFanoutMixin").mergeContentTypeMediaFanoutMixin(a,b.contentTypeMediaFanout);if(b.contentTypeMediaFanoutDeprecated)return d("WASmaxOutMessagePublishContentTypeMediaFanoutDeprecatedMixin").mergeContentTypeMediaFanoutDeprecatedMixin(a,b.contentTypeMediaFanoutDeprecated);if(b.contentTypeLiveLocationFanout)return d("WASmaxOutMessagePublishContentTypeLiveLocationFanoutMixin").mergeContentTypeLiveLocationFanoutMixin(a,b.contentTypeLiveLocationFanout);if(b.contentTypeLiveLocationFanoutDeprecated)return d("WASmaxOutMessagePublishContentTypeLiveLocationFanoutDeprecatedMixin").mergeContentTypeLiveLocationFanoutDeprecatedMixin(a,b.contentTypeLiveLocationFanoutDeprecated);if(b.individualContentTypePayIndividual)return d("WASmaxOutMessagePublishIndividualContentTypePayIndividualMixin").mergeIndividualContentTypePayIndividualMixin(a,b.individualContentTypePayIndividual);if(b.contentTypeListFanout)return d("WASmaxOutMessagePublishContentTypeListFanoutMixin").mergeContentTypeListFanoutMixin(a,b.contentTypeListFanout);if(b.isContentTypeReaction)return d("WASmaxOutMessagePublishContentTypeReactionMixin").mergeContentTypeReactionMixin(a);if(b.isContentTypePollCreation)return d("WASmaxOutMessagePublishContentTypePollCreationMixin").mergeContentTypePollCreationMixin(a);if(b.isContentTypePollVote)return d("WASmaxOutMessagePublishContentTypePollVoteMixin").mergeContentTypePollVoteMixin(a);if(b.isContentTypeMedianotify)return d("WASmaxOutMessagePublishContentTypeMedianotifyMixin").mergeContentTypeMedianotifyMixin(a);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeContentFanoutMixins=a}),98);
__d("WASmaxOutMessagePublishLidChatOriginMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.metaOrigin;a=a.metaSharePn;b=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{origin:d("WAWap").CUSTOM_STRING(b),share_pn:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)}));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeLidChatOriginMixin=a}),98);
__d("WASmaxOutMessagePublishTDeprecatedMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.messageT;a=d("WASmaxJsx").smax("message",{t:d("WAWap").INT(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeTDeprecatedMixin=a}),98);
__d("WASmaxOutMessagePublishToContentBindingMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.toJid;a=a.contentBindingElementValue;b=d("WASmaxJsx").smax("to",{jid:d("WAWap").DEVICE_JID(b)},d("WASmaxJsx").smax("content_binding",null,a));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeToContentBindingMixin=a}),98);
__d("WASmaxOutMessagePublishAvatarStickerTypeMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("enc",{sticker_type:"avatar"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeAvatarStickerTypeMixin=a}),98);
__d("WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishAvatarStickerTypeMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.encMediatype,c=a.encNativeFlowName;a=a.hasAvatarStickerType;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishAvatarStickerTypeMixin").mergeAvatarStickerTypeMixin,d("WASmaxJsx").smax("enc",{mediatype:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,b),native_flow_name:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,c)}),a);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncMediaTypeDeprecatedMixin=a}),98);
__d("WASmaxOutMessagePublishEncVersion3Mixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("enc",{v:"3"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncVersion3Mixin=a}),98);
__d("WASmaxOutMessagePublishEncVersion2Or3MixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishEncVersion2Mixin","WASmaxOutMessagePublishEncVersion3Mixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isEncVersion2)return d("WASmaxOutMessagePublishEncVersion2Mixin").mergeEncVersion2Mixin(a);if(b.isEncVersion3)return d("WASmaxOutMessagePublishEncVersion3Mixin").mergeEncVersion3Mixin(a);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeEncVersion2Or3MixinGroup=a}),98);
__d("WASmaxOutMessagePublishToDeviceMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin","WASmaxOutMessagePublishEncTypeIndividualMixin","WASmaxOutMessagePublishEncVersion2Or3MixinGroup","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.toJid,c=a.encTypeIndividualMixinArgs,e=a.encMediaTypeDeprecatedMixinArgs;a=a.encVersion2Or3MixinGroupArgs;b=d("WASmaxJsx").smax("to",{jid:d("WAWap").JID(b)},d("WASmaxOutMessagePublishEncVersion2Or3MixinGroup").mergeEncVersion2Or3MixinGroup(d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin").mergeEncMediaTypeDeprecatedMixin,d("WASmaxOutMessagePublishEncTypeIndividualMixin").mergeEncTypeIndividualMixin(d("WASmaxJsx").smax("enc",null),c),e),a));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeToDeviceMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualIndividualFanoutMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBotLocalAutomatedTypeMixin","WASmaxOutMessagePublishBotMessageTypeMixin","WASmaxOutMessagePublishBusinessBotMessageMixin","WASmaxOutMessagePublishContentFanoutMixins","WASmaxOutMessagePublishLidChatOriginMixin","WASmaxOutMessagePublishTDeprecatedMixin","WASmaxOutMessagePublishToContentBindingMixin","WASmaxOutMessagePublishToDeviceMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.toContentBindingMixinArgs;a=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishToContentBindingMixin").mergeToContentBindingMixin,d("WASmaxOutMessagePublishToDeviceMixin").mergeToDeviceMixin(d("WASmaxJsx").smax("to",null),a),b);return a}function a(){var a=d("WASmaxJsx").smax("enc",null);return a}function i(a){var b,c=a.toArgs,e=a.messageTo,f=a.tDeprecatedMixinArgs,g=a.botMessageTypeMixinArgs,i=a.businessBotMessageMixinArgs,j=a.lidChatOriginMixinArgs,k=a.botLocalAutomatedTypeMixinArgs;a=a.contentFanoutMixinsArgs;b=d("WASmaxOutMessagePublishContentFanoutMixins").mergeContentFanoutMixins((b=d("WASmaxMixins")).optionalMerge(d("WASmaxOutMessagePublishBotLocalAutomatedTypeMixin").mergeBotLocalAutomatedTypeMixin,b.optionalMerge(d("WASmaxOutMessagePublishLidChatOriginMixin").mergeLidChatOriginMixin,b.optionalMerge(d("WASmaxOutMessagePublishBusinessBotMessageMixin").mergeBusinessBotMessageMixin,b.optionalMerge(d("WASmaxOutMessagePublishBotMessageTypeMixin").mergeBotMessageTypeMixin,b.optionalMerge(d("WASmaxOutMessagePublishTDeprecatedMixin").mergeTDeprecatedMixin,d("WASmaxJsx").smax("message",{to:d("WAWap").JID(e)},d("WASmaxJsx").smax("participants",null,d("WASmaxChildren").REPEATED_CHILD(h,c,1,1997))),f),g),i),j),k),a);return b}function b(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeIndividualIndividualFanoutParticipantsTo=h;g.makeIndividualIndividualFanoutEnc=a;g.mergeIndividualIndividualFanoutMixin=b}),98);
__d("WASmaxOutMessagePublishEncListMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("enc",{mediatype:"list"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncListMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeListMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishEncListMixin","WASmaxOutMessagePublishSingleSelectOrProductListMixinGroup"],(function(a,b,c,d,e,f,g){function h(a){a=a.singleSelectOrProductListMixinGroupArgs;a=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishSingleSelectOrProductListMixinGroup").mergeSingleSelectOrProductListMixinGroup,d("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(d("WASmaxJsx").smax("message",null,d("WASmaxOutMessagePublishEncListMixin").mergeEncListMixin(d("WASmaxJsx").smax("enc",null)))),a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypeListMixin=a}),98);
__d("WASmaxOutMessagePublishEncLiveLocationDeprecatedMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.encDuration;a=d("WASmaxJsx").smax("enc",{mediatype:"livelocation",duration:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncLiveLocationDeprecatedMixin=a}),98);
__d("WASmaxOutMessagePublishEncLiveLocationMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.encDuration;a=d("WASmaxJsx").smax("enc",{mediatype:"livelocation",duration:d("WAWap").INT(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncLiveLocationMixin=a}),98);
__d("WASmaxOutMessagePublishEncLiveLocationEncLiveLocationOrEncLiveLocationDeprecatedMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishEncLiveLocationDeprecatedMixin","WASmaxOutMessagePublishEncLiveLocationMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.encLiveLocation)return d("WASmaxOutMessagePublishEncLiveLocationMixin").mergeEncLiveLocationMixin(a,b.encLiveLocation);if(b.encLiveLocationDeprecated)return d("WASmaxOutMessagePublishEncLiveLocationDeprecatedMixin").mergeEncLiveLocationDeprecatedMixin(a,b.encLiveLocationDeprecated);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeEncLiveLocationEncLiveLocationOrEncLiveLocationDeprecatedMixinGroup=a}),98);
__d("WASmaxOutMessagePublishContentTypeLiveLocationSingleMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishEncLiveLocationEncLiveLocationOrEncLiveLocationDeprecatedMixinGroup","WASmaxOutMessagePublishLiveLocationModeMixin"],(function(a,b,c,d,e,f,g){function h(a){var b=a.liveLocationModeMixinArgs;a=a.encLiveLocationEncLiveLocationOrEncLiveLocationDeprecatedMixinGroupArgs;a=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishLiveLocationModeMixin").mergeLiveLocationModeMixin,d("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(d("WASmaxJsx").smax("message",null,d("WASmaxOutMessagePublishEncLiveLocationEncLiveLocationOrEncLiveLocationDeprecatedMixinGroup").mergeEncLiveLocationEncLiveLocationOrEncLiveLocationDeprecatedMixinGroup(d("WASmaxJsx").smax("enc",null),a))),b);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypeLiveLocationSingleMixin=a}),98);
__d("WASmaxOutMessagePublishEncMediaTypeMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishAvatarStickerTypeMixin","WASmaxOutMessagePublishMediaTypeMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.encNativeFlowName,c=a.hasAvatarStickerType;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishAvatarStickerTypeMixin").mergeAvatarStickerTypeMixin,d("WASmaxOutMessagePublishMediaTypeMixin").mergeMediaTypeMixin(d("WASmaxJsx").smax("enc",{native_flow_name:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,b)}),a),c);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncMediaTypeMixin=a}),98);
__d("WASmaxOutMessagePublishEncMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin","WASmaxOutMessagePublishEncMediaTypeMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.encMediaType)return d("WASmaxOutMessagePublishEncMediaTypeMixin").mergeEncMediaTypeMixin(a,b.encMediaType);if(b.encMediaTypeDeprecated)return d("WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin").mergeEncMediaTypeDeprecatedMixin(a,b.encMediaTypeDeprecated);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeEncMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroup=a}),98);
__d("WASmaxOutMessagePublishContentTypeMediaSingleMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup","WASmaxOutMessagePublishEncMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroup","WASmaxOutMessagePublishSenderContentBindingMixin"],(function(a,b,c,d,e,f,g){function h(a){var b=a.senderContentBindingMixinArgs,c=a.contentTypeMediaOrMedianotifyMixinGroupArgs;a=a.encMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroupArgs;a=d("WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup").mergeContentTypeMediaOrMedianotifyMixinGroup(d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishSenderContentBindingMixin").mergeSenderContentBindingMixin,d("WASmaxJsx").smax("message",null,d("WASmaxOutMessagePublishEncMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroup").mergeEncMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroup(d("WASmaxJsx").smax("enc",null),a)),b),c);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypeMediaSingleMixin=a}),98);
__d("WASmaxOutMessagePublishContentMixins",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishContentTypeListMixin","WASmaxOutMessagePublishContentTypeLiveLocationSingleMixin","WASmaxOutMessagePublishContentTypeMediaSingleMixin","WASmaxOutMessagePublishContentTypePollCreationMixin","WASmaxOutMessagePublishContentTypePollVoteMixin","WASmaxOutMessagePublishContentTypeReactionMixin","WASmaxOutMessagePublishContentTypeTextMixin","WASmaxOutMessagePublishIndividualContentTypePayIndividualMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isContentTypeText)return d("WASmaxOutMessagePublishContentTypeTextMixin").mergeContentTypeTextMixin(a);if(b.contentTypeMediaSingle)return d("WASmaxOutMessagePublishContentTypeMediaSingleMixin").mergeContentTypeMediaSingleMixin(a,b.contentTypeMediaSingle);if(b.contentTypeLiveLocationSingle)return d("WASmaxOutMessagePublishContentTypeLiveLocationSingleMixin").mergeContentTypeLiveLocationSingleMixin(a,b.contentTypeLiveLocationSingle);if(b.individualContentTypePayIndividual)return d("WASmaxOutMessagePublishIndividualContentTypePayIndividualMixin").mergeIndividualContentTypePayIndividualMixin(a,b.individualContentTypePayIndividual);if(b.contentTypeList)return d("WASmaxOutMessagePublishContentTypeListMixin").mergeContentTypeListMixin(a,b.contentTypeList);if(b.isContentTypeReaction)return d("WASmaxOutMessagePublishContentTypeReactionMixin").mergeContentTypeReactionMixin(a);if(b.isContentTypePollCreation)return d("WASmaxOutMessagePublishContentTypePollCreationMixin").mergeContentTypePollCreationMixin(a);if(b.isContentTypePollVote)return d("WASmaxOutMessagePublishContentTypePollVoteMixin").mergeContentTypePollVoteMixin(a);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeContentMixins=a}),98);
__d("WASmaxOutMessagePublishIndividualIndividualRetryToPeerMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.messageRecipient;a=d("WASmaxJsx").smax("message",{recipient:d("WAWap").USER_JID(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualIndividualRetryToPeerMixin=a}),98);
__d("WASmaxOutMessagePublishRetryMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishEncRetryMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.messageT;a=a.encRetryMixinArgs;b=d("WASmaxJsx").smax("message",{t:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,b)},d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishEncRetryMixin").mergeEncRetryMixin,d("WASmaxJsx").smax("enc",null),a));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeRetryMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualIndividualRetryMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishIndividualIndividualRetryToPeerMixin","WASmaxOutMessagePublishRetryMixin"],(function(a,b,c,d,e,f,g){function h(a){var b=a.individualIndividualRetryToPeerMixinArgs;a=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishIndividualIndividualRetryToPeerMixin").mergeIndividualIndividualRetryToPeerMixin,d("WASmaxOutMessagePublishRetryMixin").mergeRetryMixin(d("WASmaxJsx").smax("message",null),a),b);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualIndividualRetryMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualIndividualSingleContentBindingMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.contentBindingElementValue;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("content_binding",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualIndividualSingleContentBindingMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualIndividualSingleMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBotLocalAutomatedTypeMixin","WASmaxOutMessagePublishBotMessageTypeMixin","WASmaxOutMessagePublishBusinessBotMessageMixin","WASmaxOutMessagePublishContentMixins","WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin","WASmaxOutMessagePublishEncTypeIndividualMixin","WASmaxOutMessagePublishEncVersion2Or3MixinGroup","WASmaxOutMessagePublishIndividualIndividualRetryMixin","WASmaxOutMessagePublishIndividualIndividualSingleContentBindingMixin","WASmaxOutMessagePublishLidChatOriginMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.messageTo,e=a.individualIndividualRetryMixinArgs,f=a.individualIndividualSingleContentBindingMixinArgs,g=a.botMessageTypeMixinArgs,h=a.businessBotMessageMixinArgs,i=a.lidChatOriginMixinArgs,j=a.botLocalAutomatedTypeMixinArgs,k=a.contentMixinsArgs,l=a.encTypeIndividualMixinArgs,m=a.encMediaTypeDeprecatedMixinArgs;a=a.encVersion2Or3MixinGroupArgs;c=d("WASmaxOutMessagePublishContentMixins").mergeContentMixins((b=d("WASmaxMixins")).optionalMerge(d("WASmaxOutMessagePublishBotLocalAutomatedTypeMixin").mergeBotLocalAutomatedTypeMixin,b.optionalMerge(d("WASmaxOutMessagePublishLidChatOriginMixin").mergeLidChatOriginMixin,b.optionalMerge(d("WASmaxOutMessagePublishBusinessBotMessageMixin").mergeBusinessBotMessageMixin,b.optionalMerge(d("WASmaxOutMessagePublishBotMessageTypeMixin").mergeBotMessageTypeMixin,b.optionalMerge(d("WASmaxOutMessagePublishIndividualIndividualSingleContentBindingMixin").mergeIndividualIndividualSingleContentBindingMixin,b.optionalMerge(d("WASmaxOutMessagePublishIndividualIndividualRetryMixin").mergeIndividualIndividualRetryMixin,d("WASmaxJsx").smax("message",{to:d("WAWap").JID(c)},d("WASmaxOutMessagePublishEncVersion2Or3MixinGroup").mergeEncVersion2Or3MixinGroup(b.optionalMerge(d("WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin").mergeEncMediaTypeDeprecatedMixin,d("WASmaxOutMessagePublishEncTypeIndividualMixin").mergeEncTypeIndividualMixin(d("WASmaxJsx").smax("enc",null),l),m),a)),e),f),g),h),i),j),k);return c}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualIndividualSingleMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualIndividualSingleOrIndividualFanoutMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishIndividualIndividualFanoutMixin","WASmaxOutMessagePublishIndividualIndividualSingleMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.individualIndividualSingle)return d("WASmaxOutMessagePublishIndividualIndividualSingleMixin").mergeIndividualIndividualSingleMixin(a,b.individualIndividualSingle);if(b.individualIndividualFanout)return d("WASmaxOutMessagePublishIndividualIndividualFanoutMixin").mergeIndividualIndividualFanoutMixin(a,b.individualIndividualFanout);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeIndividualIndividualSingleOrIndividualFanoutMixinGroup=a}),98);
__d("WASmaxOutMessagePublishIndividualBotRequestMessageMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBotFeedbackMessageTypeMixin","WASmaxOutMessagePublishBotRequestMixin","WASmaxOutMessagePublishContentTypeTextOrMediaMixinGroup","WASmaxOutMessagePublishIndividualIndividualSingleOrIndividualFanoutMixinGroup","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.messageTo,c=a.contentTypeTextOrMediaMixinGroupArgs,e=a.individualIndividualSingleOrIndividualFanoutMixinGroupArgs,f=a.hasBotFeedbackMessageType;a=a.botRequestMixinArgs;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishIndividualIndividualSingleOrIndividualFanoutMixinGroup").mergeIndividualIndividualSingleOrIndividualFanoutMixinGroup,d("WASmaxOutMessagePublishContentTypeTextOrMediaMixinGroup").mergeContentTypeTextOrMediaMixinGroup(d("WASmaxJsx").smax("message",{to:d("WAWap").USER_JID(b)},d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishBotFeedbackMessageTypeMixin").mergeBotFeedbackMessageTypeMixin,d("WASmaxJsx").smax("bot",null,d("WASmaxOutMessagePublishBotRequestMixin").mergeBotRequestMixin(d("WASmaxJsx").smax("to",null),a)),f)),c),e);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualBotRequestMessageMixin=a}),98);
__d("WASmaxOutMessagePublishBotResponseMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.botEditTargetId,c=a.botSenderTimestampMs;a=a.botEdit;b=d("WASmaxJsx").smax("bot",{edit_target_id:d("WASmaxAttrs").OPTIONAL(d("WAWap").STANZA_ID,b),sender_timestamp_ms:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,c),edit:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)});return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBotResponseMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualContentTypeBotResponseMediaFanoutMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaMixin"],(function(a,b,c,d,e,f,g){function h(a){a=a.toCount;a=d("WASmaxJsx").smax("participants",null,d("WASmaxChildren").REPEATED_CHILD_COUNT(i,a,2,2));return a}function i(){var a=d("WASmaxJsx").smax("to",null,d("WASmaxJsx").smax("enc",{mediatype:"image"}));return a}function j(a){a=a.participantsArgs;a=d("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(d("WASmaxJsx").smax("message",null,d("WASmaxChildren").OPTIONAL_CHILD(h,a)));return a}function a(a,b){b=j(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeIndividualContentTypeBotResponseMediaFanoutParticipants=h;g.makeIndividualContentTypeBotResponseMediaFanoutParticipantsTo=i;g.mergeIndividualContentTypeBotResponseMediaFanoutMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeTextOrIndividualBotResponseMediaFanoutMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishContentTypeTextMixin","WASmaxOutMessagePublishIndividualContentTypeBotResponseMediaFanoutMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isContentTypeText)return d("WASmaxOutMessagePublishContentTypeTextMixin").mergeContentTypeTextMixin(a);if(b.individualContentTypeBotResponseMediaFanout)return d("WASmaxOutMessagePublishIndividualContentTypeBotResponseMediaFanoutMixin").mergeIndividualContentTypeBotResponseMediaFanoutMixin(a,b.individualContentTypeBotResponseMediaFanout);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeContentTypeTextOrIndividualBotResponseMediaFanoutMixinGroup=a}),98);
__d("WASmaxOutMessagePublishEncTypeMessageSecretMessageMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishEncPayloadMixin"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxOutMessagePublishEncPayloadMixin").mergeEncPayloadMixin(d("WASmaxJsx").smax("enc",{type:"msmsg"}),a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncTypeMessageSecretMessageMixin=a}),98);
__d("WASmaxOutMessagePublishFromProxyAccountMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.botActualFrom;a=d("WASmaxJsx").smax("bot",{actual_from:d("WAWap").JID(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeFromProxyAccountMixin=a}),98);
__d("WASmaxOutMessagePublishMessageTargetMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.metaTargetId,c=a.metaTargetSenderJid;a=a.metaTargetChatJid;b=d("WASmaxJsx").smax("meta",{target_id:d("WAWap").STANZA_ID(b),target_sender_jid:d("WASmaxAttrs").OPTIONAL(d("WAWap").USER_JID,c),target_chat_jid:d("WASmaxAttrs").OPTIONAL(d("WAWap").JID,a)});return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeMessageTargetMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualBotResponseFanoutMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBotResponseMixin","WASmaxOutMessagePublishContentTypeTextOrIndividualBotResponseMediaFanoutMixinGroup","WASmaxOutMessagePublishEncTypeMessageSecretMessageMixin","WASmaxOutMessagePublishEncVersion2OrFutureproofMixinGroup","WASmaxOutMessagePublishFromProxyAccountMixin","WASmaxOutMessagePublishMessageTargetMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.toArgs;a=d("WASmaxJsx").smax("participants",null,d("WASmaxChildren").REPEATED_CHILD(i,a,2,2));return a}function i(a){a=a.toJid;a=d("WASmaxJsx").smax("to",{jid:d("WAWap").USER_JID(a)});return a}function j(a){var b,c=a.participantsArgs,e=a.messageTo,f=a.contentTypeTextOrIndividualBotResponseMediaFanoutMixinGroupArgs,g=a.botResponseMixinArgs,i=a.fromProxyAccountMixinArgs,j=a.messageTargetMixinArgs,k=a.encTypeMessageSecretMessageMixinArgs;a=a.encVersion2OrFutureproofMixinGroupArgs;e=d("WASmaxOutMessagePublishContentTypeTextOrIndividualBotResponseMediaFanoutMixinGroup").mergeContentTypeTextOrIndividualBotResponseMediaFanoutMixinGroup((b=d("WASmaxJsx")).smax("message",{to:d("WAWap").USER_JID(e)},d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishFromProxyAccountMixin").mergeFromProxyAccountMixin,d("WASmaxOutMessagePublishBotResponseMixin").mergeBotResponseMixin(b.smax("bot",null),g),i),d("WASmaxOutMessagePublishMessageTargetMixin").mergeMessageTargetMixin(b.smax("meta",null),j),d("WASmaxOutMessagePublishEncVersion2OrFutureproofMixinGroup").mergeEncVersion2OrFutureproofMixinGroup(d("WASmaxOutMessagePublishEncTypeMessageSecretMessageMixin").mergeEncTypeMessageSecretMessageMixin(b.smax("enc",null),k),a),d("WASmaxChildren").OPTIONAL_CHILD(h,c)),f);return e}function a(a,b){b=j(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeIndividualBotResponseFanoutParticipants=h;g.makeIndividualBotResponseFanoutParticipantsTo=i;g.mergeIndividualBotResponseFanoutMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishIndividualBotRequestMessageMixin","WASmaxOutMessagePublishIndividualBotResponseFanoutMixin","WASmaxOutMessagePublishIndividualIndividualFanoutMixin","WASmaxOutMessagePublishIndividualIndividualSingleMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.individualBotResponseFanout)return d("WASmaxOutMessagePublishIndividualBotResponseFanoutMixin").mergeIndividualBotResponseFanoutMixin(a,b.individualBotResponseFanout);if(b.individualBotRequestMessage)return d("WASmaxOutMessagePublishIndividualBotRequestMessageMixin").mergeIndividualBotRequestMessageMixin(a,b.individualBotRequestMessage);if(b.individualIndividualSingle)return d("WASmaxOutMessagePublishIndividualIndividualSingleMixin").mergeIndividualIndividualSingleMixin(a,b.individualIndividualSingle);if(b.individualIndividualFanout)return d("WASmaxOutMessagePublishIndividualIndividualFanoutMixin").mergeIndividualIndividualFanoutMixin(a,b.individualIndividualFanout);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeIndividualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroup=a}),98);
__d("WASmaxOutMessagePublishIndividualRecipientDeprecaredMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.messageRecipient;a=d("WASmaxJsx").smax("message",{recipient:d("WAWap").USER_JID(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualRecipientDeprecaredMixin=a}),98);
__d("WASmaxOutMessagePublishMessageEditMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{edit:"1"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeMessageEditMixin=a}),98);
__d("WASmaxOutMessagePublishMessagePinMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{edit:"2"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeMessagePinMixin=a}),98);
__d("WASmaxOutMessagePublishRevokeMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{edit:"7"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeRevokeMixin=a}),98);
__d("WASmaxOutMessagePublishMessageEditOrMessagePinOrRevokeMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishMessageEditMixin","WASmaxOutMessagePublishMessagePinMixin","WASmaxOutMessagePublishRevokeMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isMessageEdit)return d("WASmaxOutMessagePublishMessageEditMixin").mergeMessageEditMixin(a);if(b.isMessagePin)return d("WASmaxOutMessagePublishMessagePinMixin").mergeMessagePinMixin(a);if(b.isRevoke)return d("WASmaxOutMessagePublishRevokeMixin").mergeRevokeMixin(a);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeMessageEditOrMessagePinOrRevokeMixinGroup=a}),98);
__d("WASmaxOutMessagePublishRecipientPNMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.messageRecipientPn;a=d("WASmaxJsx").smax("message",{recipient_pn:d("WAWap").USER_JID(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeRecipientPNMixin=a}),98);
__d("WASmaxOutMessagePublishRecipientUsernameMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.messageRecipientUsername;a=d("WASmaxJsx").smax("message",{recipient_username:d("WAWap").CUSTOM_STRING(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeRecipientUsernameMixin=a}),98);
__d("WASmaxOutMessagePublishRecipientPNOrUsernameMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishRecipientPNMixin","WASmaxOutMessagePublishRecipientUsernameMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.recipientPN)return d("WASmaxOutMessagePublishRecipientPNMixin").mergeRecipientPNMixin(a,b.recipientPN);if(b.recipientUsername)return d("WASmaxOutMessagePublishRecipientUsernameMixin").mergeRecipientUsernameMixin(a,b.recipientUsername);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeRecipientPNOrUsernameMixinGroup=a}),98);
__d("WASmaxOutMessagePublishThreadTypeTagEnumMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaThreadType;a=d("WASmaxJsx").smax("meta",{thread_type:d("WAWap").INT(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeThreadTypeTagEnumMixin=a}),98);
__d("WASmaxOutMessagePublishThreadTypeTagLegacyMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaThreadType;a=d("WASmaxJsx").smax("meta",{thread_type:d("WAWap").CUSTOM_STRING(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeThreadTypeTagLegacyMixin=a}),98);
__d("WASmaxOutMessagePublishThreadTypeTagEnumOrLegacyMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishThreadTypeTagEnumMixin","WASmaxOutMessagePublishThreadTypeTagLegacyMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.threadTypeTagEnum)return d("WASmaxOutMessagePublishThreadTypeTagEnumMixin").mergeThreadTypeTagEnumMixin(a,b.threadTypeTagEnum);if(b.threadTypeTagLegacy)return d("WASmaxOutMessagePublishThreadTypeTagLegacyMixin").mergeThreadTypeTagLegacyMixin(a,b.threadTypeTagLegacy);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeThreadTypeTagEnumOrLegacyMixinGroup=a}),98);
__d("WASmaxOutMessagePublishThreadTypeTagMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishThreadTypeTagEnumOrLegacyMixinGroup"],(function(a,b,c,d,e,f,g){function h(a){a=a.threadTypeTagEnumOrLegacyMixinGroupArgs;a=d("WASmaxJsx").smax("message",null,d("WASmaxOutMessagePublishThreadTypeTagEnumOrLegacyMixinGroup").mergeThreadTypeTagEnumOrLegacyMixinGroup(d("WASmaxJsx").smax("meta",null),a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeThreadTypeTagMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualRequest",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBaseMixin","WASmaxOutMessagePublishGroupInviteTargetMixin","WASmaxOutMessagePublishIndividualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroup","WASmaxOutMessagePublishIndividualRecipientDeprecaredMixin","WASmaxOutMessagePublishMessageEditOrMessagePinOrRevokeMixinGroup","WASmaxOutMessagePublishRecipientPNOrUsernameMixinGroup","WASmaxOutMessagePublishThreadTypeTagMixin","WAWap"],(function(a,b,c,d,e,f,g){function a(a){var b,c=a.messageId,e=a.groupInviteTargetMixinArgs,f=a.threadTypeTagMixinArgs,g=a.individualRecipientDeprecaredMixinArgs,h=a.individualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroupArgs,i=a.messageEditOrMessagePinOrRevokeMixinGroupArgs,j=a.recipientPNOrUsernameMixinGroupArgs;b=(b=d("WASmaxMixins")).optionalMerge(d("WASmaxOutMessagePublishRecipientPNOrUsernameMixinGroup").mergeRecipientPNOrUsernameMixinGroup,b.optionalMerge(d("WASmaxOutMessagePublishMessageEditOrMessagePinOrRevokeMixinGroup").mergeMessageEditOrMessagePinOrRevokeMixinGroup,d("WASmaxOutMessagePublishIndividualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroup").mergeIndividualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroup(b.optionalMerge(d("WASmaxOutMessagePublishIndividualRecipientDeprecaredMixin").mergeIndividualRecipientDeprecaredMixin,b.optionalMerge(d("WASmaxOutMessagePublishThreadTypeTagMixin").mergeThreadTypeTagMixin,b.optionalMerge(d("WASmaxOutMessagePublishGroupInviteTargetMixin").mergeGroupInviteTargetMixin,d("WASmaxOutMessagePublishBaseMixin").mergeBaseMixin(d("WASmaxJsx").smax("message",{id:d("WAWap").STANZA_ID(c)}),a),e),f),g),h),i),j);return b}g.makeIndividualRequest=a}),98);
__d("WASmaxMessagePublishIndividualRPC",["WAComms","WASmaxInMessagePublishIndividualResponseNegative","WASmaxInMessagePublishIndividualResponseSuccess","WASmaxOutMessagePublishIndividualRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:e=d("WASmaxOutMessagePublishIndividualRequest").makeIndividualRequest(a);i.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=i.sent;g=d("WASmaxInMessagePublishIndividualResponseNegative").parseIndividualResponseNegative(f,e);if(!g.success){i.next=7;break}return i.abrupt("return",{name:"IndividualResponseNegative",value:g.value});case 7:h=d("WASmaxInMessagePublishIndividualResponseSuccess").parseIndividualResponseSuccess(f,e);if(!h.success){i.next=10;break}return i.abrupt("return",{name:"IndividualResponseSuccess",value:h.value});case 10:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("Individual",{Negative:g,Success:h}));case 11:case"end":return i.stop()}},null,this)}g.sendIndividualRPC=a}),98);
__d("WASendMsgRPC",["WADeprecatedSendIq","WADeprecatedWapParser","WAGetDeviceIdentityMixin","WAJids","WALogger","WAParseFranking","WASmaxMessagePublishIndividualRPC","WATimeUtils","WAWap","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["WASendMsgRPC: Wrong media type: ",""]);h=function(){return a};return a}function a(a,c,e,f){var g,h,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S;return b("regeneratorRuntime").async(function(T){while(1)switch(T.prev=T.next){case 0:f===void 0&&(f=!1);g=d("WAJids").interpretAsGroupJid(a.protocolMsgId.chat);h=a.messageType.type==="text"&&a.messageType.invitedParticipantUserJid!=null;if(!(c.type==="direct_user")){T.next=17;break}p={individualIndividualSingle:{messageTo:c.message.to,individualIndividualRetryMixinArgs:l(a.count,c.recipient),contentMixinsArgs:k(a,c.message),encTypeIndividualMixinArgs:m(c.message),encVersion2Or3MixinGroupArgs:n(c.message)}};q={messageId:a.externalId,deviceIdentityMixinArgs:d("WAGetDeviceIdentityMixin").getDeviceIdentityMixin(a.deviceIdentity),hasNoExtraFanout:a.messageType.isInvisible===!0?!0:null,messageEditOrMessagePinOrRevokeMixinGroupArgs:o(a.messageType),clientFrankingTagMixinArgs:(e==null?void 0:e.frankingTag)?{frankingTagElementValue:e.frankingTag}:null,hasMetaHideDecryptionPlaceholder:a.messageType.isInvisible===!0?!0:null,groupInviteTargetMixinArgs:h&&g!=null?{metaGroupInvite:g}:null,individualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroupArgs:p,internalTestMixinArgs:f?{testConfig:"armadillo_express"}:null};T.next=8;return b("regeneratorRuntime").awrap(d("WASmaxMessagePublishIndividualRPC").sendIndividualRPC(q));case 8:r=T.sent;if(!(r.name==="IndividualResponseSuccess")){T.next=15;break}t=((s=r.value.deviceListStaleMixin)==null?void 0:s.phash)!=null?{type:"mismatch",local:null,server:r.value.deviceListStaleMixin.phash}:{type:"ok"};u=r.value.serverFrankingTagMixin!=null&&e!=null?babelHelpers["extends"]({},e,{reportingTag:r.value.serverFrankingTagMixin.frankingReportingTagElementValue}):null;return T.abrupt("return",{type:"success",ts:d("WATimeUtils").castToUnixTime(r.value.t),phash:t,count:null,reportingMeta:u});case 15:r.name;return T.abrupt("return",{type:"error",errorCode:parseInt(r.value.error,10),applicationError:(v=r.value.applicationNegativeAckMixin)==null?void 0:v.applicationError});case 17:w=a.messageType.isInvisible===!0?"false":d("WAWap").DROP_ATTR;x=c.participant!=null?d("WAWap").JID(c.participant):d("WAWap").DROP_ATTR;y=c.phash!=null&&c.type==="group"?d("WAWap").CUSTOM_STRING(c.phash):d("WAWap").DROP_ATTR;z=a.messageType.type==="text"&&a.messageType.isRevoked?d("WAWap").CUSTOM_STRING("7"):d("WAWap").DROP_ATTR;A=!h||g==null?null:d("WAWap").wap("meta",{group_invite:d("WAWap").CUSTOM_STRING(g)});B=f?d("WAWap").wap("test",{config:d("WAWap").CUSTOM_STRING("armadillo_express")}):null;C=a.messageType.isInvisible===!0?d("WAWap").wap("meta",{"decrypt-fail":"hide"}):null;D=a.deviceIdentity!=null?d("WAWap").wap("device-identity",null,a.deviceIdentity):null;E=(e==null?void 0:e.frankingTag)!=null?d("WAWap").wap("franking",null,d("WAWap").wap("franking_tag",null,e.frankingTag)):null;F=null;c.participants!=null&&(F=d("WAWap").wap("participants",null,c.participants.map(function(a){return i(a)})));G=null;c.message!=null&&(G=i(c.message,!0));H=d("WAWap").wap("message",{device_fanout:w,edit:z,id:d("WAWap").CUSTOM_STRING(a.externalId),participant:x,phash:y,to:d("WAWap").JID(c.messageTo),type:d("WAWap").CUSTOM_STRING(a.messageType.type)},A,E,F,G,C,D,B);T.next=33;return b("regeneratorRuntime").awrap(d("WADeprecatedSendIq").deprecatedSendStanzaAndReturnAck(H,{id:a.externalId,"class":"message",from:c.messageTo,participant:c.participant!=null?c.participant:null}));case 33:I=T.sent;J=j.parse(I);if(!J.success){T.next=46;break}K=J.success,L=K.errorCode,M=K.applicationError;if(!(L==null)){T.next=43;break}O=J.success,P=O.ts,Q=O.phash,R=O.count;S=e!=null?babelHelpers["extends"]({},e,{reportingTag:(N=J.success.reportingMeta)==null?void 0:N.reportingTag}):null;return T.abrupt("return",{type:"success",ts:P,phash:Q==null||Q===c.phash?{type:"ok"}:{type:"mismatch",local:c.phash,server:Q},count:R,reportingMeta:S});case 43:return T.abrupt("return",{type:"error",errorCode:L,applicationError:M});case 44:T.next=47;break;case 46:return T.abrupt("return",{type:"parsing_error"});case 47:case"end":return T.stop()}},null,this)}function i(a,b){b===void 0&&(b=!1);var c=d("WAWap").wap("enc",{count:a.count!=null?d("WAWap").INT(a.count):d("WAWap").DROP_ATTR,mediatype:a.mediaType!=null?d("WAWap").CUSTOM_STRING(a.mediaType):d("WAWap").DROP_ATTR,type:d("WAWap").CUSTOM_STRING(a.type),v:d("WAWap").CUSTOM_STRING(a.v)},a.ciphertext);if(b||a.encType==="group")return c;else return d("WAWap").wap("to",{jid:d("WAWap").DEVICE_JID(a.to)},c)}var j=new(c("WADeprecatedWapParser"))("sendMsgAck",function(a){a.assertTag("ack");return{count:a.maybeAttrInt("count"),errorCode:a.maybeAttrInt("error"),phash:a.maybeAttrString("phash"),applicationError:a.maybeAttrInt("application_error"),ts:a.attrTime("t"),reportingMeta:d("WAParseFranking").parseFrankingNode(a.maybeChild("franking"))}});function k(a,b){if(a.messageType.type==="reaction")return{isContentTypeReaction:!0};if(a.messageType.type==="text")return{isContentTypeText:!0};a.messageType.type;if(b.mediaType!=null){b={contentTypeMediaOrMedianotifyMixinGroupArgs:{isContentTypeMedia:!0},encMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroupArgs:{encMediaType:{encMediatype:b.mediaType}}};return{contentTypeMediaSingle:b}}d("WALogger").ERROR(h(),a.messageType.mediaType);return{isContentTypeText:!0}}function l(a,b){a=a!=null?{encCount:a}:null;b=b!=null?{messageRecipient:b}:null;return{encRetryMixinArgs:a,individualIndividualRetryToPeerMixinArgs:b}}function m(a){return{encType:a.type,encElementValue:a.ciphertext}}function n(a){return a.v==="2"?{isEncVersion2:!0}:{isEncVersion3:!0}}function o(a){return a.type==="text"&&a.isRevoked?{isRevoke:!0}:null}g.sendStanza=a;g.createEncWapNode=i}),98);
__d("WASendMsgUtil",["Promise","WABridge","WADevicesState","WAEncGroupMsg","WAEncUserMsg","WAGlobals","WAJids","WAJobDefinitions","WAJobs","WALogger","WAMsgType","WAOdsEnums","WAResultOrError","WASendMsgRPC","WAServerMediaType","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendMessage ack success is true, error: ",", chatType:",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendMessage ack success is false, chatType:",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Got phash mismatch, local[","] server[","]"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptChatMessage -- finish encrypt group message"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptChatMessage -- group message"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error during send message post-processing. Err: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWSendMsg Failed to encrypt message for "," message"]);o=function(){return a};return a}var p=10002;function a(a,c,e){var f,g,i,j,k,l,m,q,r,z,A,B,C;return b("regeneratorRuntime").async(function(D){while(1)switch(D.prev=D.next){case 0:e===void 0&&(e=!1);w(a,c);m=e?3:2;q=function(b){return a.type==="chat"?t(a,c,m,{cryptoManager:b}):s(a,{cryptoManager:b},m)};D.next=6;return b("regeneratorRuntime").awrap(d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return q(a)},{operationType:"encrypt",flush:!0}));case 6:r=D.sent;z=r.success?r.value.type:r.error;x(z,c);if(!(r.success===!1)){D.next=13;break}c==null?void 0:c.endFail("fail_encrypt");d("WALogger").ERROR(o(),z);return D.abrupt("return",d("WAResultOrError").makeError("encryption-error"));case 13:A=r.value;c==null?void 0:c.addPoint("sending_stanza",{"int":{ciphertextByteLength:(f=(g=(i=A.message)==null?void 0:(j=i.ciphertext)==null?void 0:j.length)!=null?g:(k=A.participants)==null?void 0:(l=k[0].ciphertext)==null?void 0:l.length)!=null?f:0}});D.next=17;return b("regeneratorRuntime").awrap(d("WASendMsgRPC").sendStanza(a,A,a.reportingMeta,e));case 17:B=D.sent;c==null?void 0:c.addPoint("ack_returned");if(!(B.type==="success")){D.next=30;break}D.prev=20;D.next=23;return b("regeneratorRuntime").awrap((h||(h=b("Promise"))).all([u(a,A,B,c),v(A,c)]));case 23:return D.abrupt("return",d("WAResultOrError").makeResult({baseKey:(C=A.message)==null?void 0:C.baseKey,reportingMeta:null,serverTs:B.ts}));case 26:D.prev=26;D.t0=D["catch"](20);d("WALogger").ERROR(n(),D.t0.message);return D.abrupt("return",d("WAResultOrError").makeError("unknown-error"));case 30:B.type;y(B,z,c);if(!(B.applicationError===p)){D.next=35;break}D.next=35;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().handleReachabilityErrorAdminMsg(a.chat));case 35:return D.abrupt("return",d("WAResultOrError").makeError("unknown-error"));case 36:case"end":return D.stop()}},null,this,[[20,26]])}function q(a){return d("WADevicesState").getDevicesState().reset([a]).then(function(){return d("WADevicesState").getDevicesState().waitForUserDevices([a],"SendMsgUtil_recoverUser",!0)})}function r(a){return d("WAJids").switchOnChatJidType(a,{interopUser:q,msgrUser:q,lidUser:q,phoneUser:q,group:function(a){return d("WAJobs").getJobManager().waitUntilPersisted(d("WAJobDefinitions").createStartJobInfo("queryGroups",{type:"array",groups:[a]}))}})}function s(a,c,e){var f,g,h,i,j,k,l,m;return b("regeneratorRuntime").async(function(n){while(1)switch(n.prev=n.next){case 0:f=a.chat,g=a.to,h=a.messageBytes,i=a.messageType,j=a.count,k=a.sessionInfo,l=a.identityKey;n.next=3;return b("regeneratorRuntime").awrap(d("WAEncUserMsg").encryptDeviceJidMessage(g,{type:"message",chat:f,messageBytes:h,messageType:i,applicationPayloadVersion:e},c,j,k,l));case 3:m=n.sent;return n.abrupt("return",d("WAJids").switchOnUserChatJidType(f,{user:function(b){return m!=null?d("WAResultOrError").makeResult({type:"direct_user",messageTo:a.to,message:m,recipient:d("WAGlobals").isPeerDevice(a.to)?b:null}):d("WAResultOrError").makeError("direct_user")},group:function(b){return m!=null?d("WAResultOrError").makeResult({type:"direct_group",messageTo:b,participant:a.to,message:m}):d("WAResultOrError").makeError("direct_group")}}));case 5:case"end":return n.stop()}},null,this)}function t(a,c,e,f){var g=a.recipients,h=a.messageBytes,i=a.messageType,j=a.chat,k=a.icdcInfo;return d("WAJids").switchOnUserChatJidType(j,{user:function(a){var c,j;return b("regeneratorRuntime").async(function(l){while(1)switch(l.prev=l.next){case 0:l.next=2;return b("regeneratorRuntime").awrap(d("WAEncUserMsg").encryptUserMsg(g,{type:"message",messageBytes:h,messageType:i,chat:a,applicationPayloadVersion:e},k,f));case 2:c=l.sent;j=c.participants;if(!(j!=null&&j.length>0)){l.next=6;break}return l.abrupt("return",d("WAResultOrError").makeResult({type:"user",messageTo:a,participants:j,phash:c.phash}));case 6:return l.abrupt("return",d("WAResultOrError").makeError("user"));case 7:case"end":return l.stop()}},null,this)},group:function(a){var e,j,k;return b("regeneratorRuntime").async(function(n){while(1)switch(n.prev=n.next){case 0:d("WALogger").LOG(m());n.next=3;return b("regeneratorRuntime").awrap(d("WAEncGroupMsg").encryptGroupMsg(a,g,h,i,f,c));case 3:e=n.sent;d("WALogger").LOG(l());j=e.participants,k=e.encNode;if(!(j==null&&k==null)){n.next=8;break}return n.abrupt("return",d("WAResultOrError").makeError("group"));case 8:return n.abrupt("return",d("WAResultOrError").makeResult({type:"group",messageTo:a,participants:j,message:k,senderKeyDistributionInfo:e.senderKeyDistributionInfo,phash:e.phash}));case 9:case"end":return n.stop()}},null,this)}})}function c(a){var b=d("WAServerMediaType").getMediaType(a),c=a===d("WAMsgType").MSG_TYPE.REVOKED;if(b!=null)return{mediaType:b,type:"media"};else if(a===d("WAMsgType").MSG_TYPE.SK_DISTRIBUTION)return{isInvisible:!0,isRevoked:!1,type:"text"};else return{isRevoked:c,type:"text"}}function u(a,c,e,f){var g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:if(!(e.type!=="success")){i.next=2;break}return i.abrupt("return");case 2:g=e.phash;if(!(g.type==="mismatch")){i.next=11;break}i.next=6;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().writeDebugMsg(a.chat,"Outgoing msg "+a.externalId+" got a phash mismatch: local["+((h=g.local)!=null?h:"undefined")+"] server["+g.server+"]"));case 6:d("WALogger").LOG(k(),g.local,g.server);d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.PHASH_MISMATCH,key:c.type});i.next=10;return b("regeneratorRuntime").awrap(r(a.chat));case 10:f==null?void 0:f.addPoint("participant_recovery_finished");case 11:case"end":return i.stop()}},null,this)}function v(a,c){var e,f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:if(!(a.senderKeyDistributionInfo!=null)){i.next=5;break}e=a.senderKeyDistributionInfo,f=e.group,g=e.senderKeyId,h=e.knowsSenderKey;i.next=4;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().markSenderKeyAsSent(f,g,h));case 4:c==null?void 0:c.addPoint("mark_sender_key_sent");case 5:case"end":return i.stop()}},null,this)}function w(a,b){var c=0;a.type==="chat"&&(c=a.recipients.reduce(function(a,b){return a+b.devicesInfo.length},0));var d=a.messageType.type==="text"&&a.messageType.isRevoked;d=d?"revoke":a.messageType.type;b==null?void 0:b.addPoint("start_encrypt",{string:{sentMessageType:d},"int":{numDevices:c},bool:{isInvisibleMsg:a.messageType.type==="text"&&a.messageType.isInvisible===!0}})}function x(a,b){b==null?void 0:b.addPoint("finish_encrypt",{string:{chatType:a}})}function y(a,b,c){if(a.type==="success")return;a.type==="parsing_error"&&(d("WALogger").ERROR(j(),b),c==null?void 0:c.addPoint("ack_parse_fail"));var e=a.errorCode;a=a.applicationError;a===p&&(c==null?void 0:c.addPoint("reachability_error_code"));d("WALogger").ERROR(i(),e,b);e!=null&&(c==null?void 0:c.addPoint("ack_success_error_"+e));c==null?void 0:c.endFail("failed")}g.sendMessage=a;g.getMessageTypeFromMsg=c}),98);
__d("WASentBytesCache",["WAErr","WAGlobals","WAJids","WAMsg","WAScheduleAfterOfflineResume","WATagsLogger","WATimeUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["EB Upload Queue is already initialized"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["It fails to bulkLoadIdentities: ",""]);i=function(){return a};return a}var j=d("WATagsLogger").TAGS(["SentBytesCache"]),k=30*24*60*60,l=function(){function a(a){var b=this;this.$1=a;d("WAScheduleAfterOfflineResume").scheduleAfterOfflineResume({code:function(){return b.$2()},combine:!0,id:"pruneSentBytesCache"})}var c=a.prototype;c.loadSentBytes=function(a){return this.$1.loadSentBytes(a)};c.getMsgsForRetry=function(a){var c,e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:c=Array.from(new Set(a.map(function(a){a=a.deviceJid;return d("WAJids").extractUserJid(a)})));e=new Map();g.prev=2;g.next=5;return b("regeneratorRuntime").awrap(d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return a.storage.bulkLoadIdentities(c)},{operationType:"retries_load_identities",flush:!1,afterInit:!0}));case 5:e=g.sent;g.next=11;break;case 8:g.prev=8,g.t0=g["catch"](2),j.ERROR(i(),g.t0.toString());case 11:g.next=13;return b("regeneratorRuntime").awrap(this.loadSentBytes(a.map(function(a){a=a.protocolMsgId;return d("WAMsg").craftWAMsgIdString({author:a.author,chat:a.chat,externalId:a.externalId})})));case 13:f=g.sent;return g.abrupt("return",a.map(function(a){var b=a.deviceJid,c=a.protocolMsgId,g=d("WAMsg").craftWAMsgIdString({author:c.author,chat:c.chat,externalId:c.externalId});c=(c=e.get(d("WAJids").extractUserJid(b)))==null?void 0:c.get(b);if(c==null)return{type:"unauthorized"};b=f.find(function(a){return a.waMsgId===g});if(b==null)return{type:"missing"};else if(!d("WATimeUtils").happenedWithin(b.ts,k))return{type:"unauthorized"};return{frankingKey:b.frankingKey,frankingVersion:b.frankingVersion,messageBytes:b.messageBytes,messageType:b.messageType,protocolMsgId:b.protocolMsgId,retryCount:a.retryCount+1,type:"unacked"}}));case 15:case"end":return g.stop()}},null,this,[[2,8]])};c.saveSentBytes=function(a){return this.$1.saveSentBytes(a)};c.$2=function(){var a=this;return this.$1.loadExpired(d("WATimeUtils").pastUnixTime(k)).then(function(b){return a.$1.deleteSentBytes(b)})};return a}(),m=null;function a(){if(m==null)throw c("WAErr")("SentBytesCache is not initialized");return m}function e(a){m!=null&&j.ERROR(h());a=new l(a);m=a;return a}g.SentBytesCache=l;g.sentBytesCache=a;g.initSentBytesCache=e}),98);
__d("WACryptoCurve25519Dependencies",["Promise","WACryptoPrimitives","WASignalKeys","WASignalOther"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){return(h||(h=b("Promise"))).resolve().then(function(){return d("WASignalKeys").makeKeyPair()})}function c(a,c){return(h||(h=b("Promise"))).resolve().then(function(){return d("WACryptoPrimitives").scalarMult(d("WASignalOther").ensureSize(c,32),d("WASignalOther").ensureSize(a,32)).buffer})}e={generateIdentityKeyPair:a,calculateAgreement:c};g.calculateAgreement=c;g.CURVE25519_SIGNAL_DEPENDENCIES=e}),98);
__d("WACryptoSha256",["Promise","WABase64","WACryptoDependencies"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){return(h||(h=b("Promise"))).resolve(d("WACryptoDependencies").getCrypto().subtle.digest({name:"SHA-256"},a))}function j(a){return(h||(h=b("Promise"))).resolve(i(a).then(d("WABase64").encodeB64))}function a(a){return j(k(a))}function k(a){var b=new ArrayBuffer(a.length),c=new Uint8Array(b);for(var d=0,e=a.length;d<e;d++)c[d]=a.charCodeAt(d);return b}g.sha256=i;g.sha256Base64=j;g.sha256Str=a}),98);
__d("WATypedArraysConcat",[],(function(a,b,c,d,e,f){"use strict";function a(a,b,c){c===void 0&&(c=0);c=b.reduce(function(a,b){return a+b.length},c);var d=new a(c),e=0;b.forEach(function(a){d.set(a,e),e+=a.length});return d}f.concatTypedArrays=a}),66);
__d("WACryptoAesCbc",["Promise","WABinary","WACryptoDependencies","WAErr","WATypedArraysCast","WATypedArraysConcat","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=16,j=1024,k=16,l=1024*1024,m=i*l;l=function(){function a(a,b,c,e){this.$4=null;this.$6=!1;this.$1=a;this.$2=b;this.$3=c;var f={name:"AES-CBC",iv:e};this.$5=d("WACryptoDependencies").getCrypto().subtle.importKey("raw",c,"AES-CBC",!1,[b]).then(function(a){return{algo:f,key:a}})}var b=a.prototype;b.append=function(a){var b=this;this.$7("append");var c=this.$4;if(c){c.writeByteArray(a);if(c.size()>j){var e=c.size()%i;e=c.readByteArray(c.size()-e);c.size()||(this.$4=null)}else e=null}else if(a.length>j){c=a.length%i;!c?e=a:(this.$4=new(d("WABinary").Binary)(a),e=this.$4.readByteArray(a.length-c))}else this.$4=new(d("WABinary").Binary)(a),e=null;var f=e;f&&(this.$5=this.$5.then(function(a){var c=a.key;a=a.algo;if(b.$2==="encrypt")return d("WACryptoDependencies").getCrypto().subtle.encrypt(a,c,f).then(function(a){b.$1.writeByteArray(new Uint8Array(a,0,a.byteLength-i));return new Uint8Array(a,a.byteLength-2*i,i)});else{var e=f.slice(-i);return d("WACryptoDependencies").getCrypto().subtle.decrypt(a,c,f).then(function(a){b.$1.writeBuffer(a);return e})}}).then(function(a){var c={name:"AES-CBC",iv:a};return d("WACryptoDependencies").getCrypto().subtle.importKey("raw",b.$3,"AES-CBC",!1,[b.$2]).then(function(a){return{algo:c,key:a}})}));return this.$5.then(function(){})};b.finalize=function(a){var b=this;this.$7("finalize");var c;if(this.$4){var e=this.$4;a&&e.writeByteArray(a);c=e.readByteArray();this.$4=null}else a&&(c=a);if(c){var f=c;return this.$5.then(function(a){var c=a.algo;a=a.key;if(b.$2==="encrypt")return d("WACryptoDependencies").getCrypto().subtle.encrypt(c,a,f);else return d("WACryptoDependencies").getCrypto().subtle.decrypt(c,a,f)}).then(function(a){b.$1.writeBuffer(a)})}else return this.$5.then(function(){})};b.$7=function(a){if(this.$6)throw c("WAErr")("AesCbcStream."+a+" called after finalize")};return a}();function n(a){return{name:"AES-CBC",iv:d("WATypedArraysCast").castTypedArrays(Uint8Array,a)}}function o(a){return d("WACryptoDependencies").getCrypto().subtle.importKey("raw",d("WATypedArraysCast").castTypedArrays(Uint8Array,a),"AES-CBC",!1,["encrypt"])}function p(a){if(a)return d("WATypedArraysCast").castTypedArrays(Uint8Array,a);a=new Uint8Array(k);d("WACryptoDependencies").getCrypto().getRandomValues(a);return a}function q(a){a=a.byteLength;var b=i-a%i;return Number.isNaN(b)?a:a+b}function r(a,c,e){var f=n(c);return(h||(h=b("Promise"))).resolve(d("WACryptoDependencies").getCrypto().subtle.importKey("raw",d("WATypedArraysCast").castTypedArrays(Uint8Array,a),"AES-CBC",!1,["decrypt"])).then(function(a){return d("WACryptoDependencies").getCrypto().subtle.decrypt(f,a,e)})}function a(a,c){return(h||(h=b("Promise"))).resolve().then(function(){var b=c.slice(0,k),d=c.slice(k);return r(a,b,d)})}function e(a,c,e){return(h||(h=b("Promise"))).resolve().then(function(){var f=p(e),g=n(f);return(h||(h=b("Promise"))).resolve(o(a)).then(function(a){return d("WACryptoDependencies").getCrypto().subtle.encrypt(g,a,c)}).then(function(a){return d("WATypedArraysConcat").concatTypedArrays(Uint8Array,[f,new Uint8Array(a)]).buffer})})}function f(a,d,e,f){var g,h,j,k,l,n,r,t,u,v,w,x,y;return b("regeneratorRuntime").async(function(z){while(1)switch(z.prev=z.next){case 0:f===void 0&&(f=m);if(!(f%i!==0)){z.next=3;break}throw c("WAErr")("chunkSize must be a multiple of "+i+", "+f+" received");case 3:z.next=5;return b("regeneratorRuntime").awrap(o(a));case 5:g=z.sent,h=new Uint8Array(d),j=Math.ceil(h.byteLength/f),k=p(e),l=new Uint8Array(q(h)+k.byteLength),l.set(k),(n=0,r=k);case 12:if(!(n<j)){z.next=26;break}u=n===j-1;v=n*f;t=h.subarray(v,v+f);z.next=18;return b("regeneratorRuntime").awrap(s(u,t,r,g));case 18:w=z.sent,x=w.encryptedChunk,y=w.nextIv,l.set(x,k.byteLength+n*f),r=y;case 23:n++;z.next=12;break;case 26:return z.abrupt("return",l.buffer);case 27:case"end":return z.stop()}},null,this)}function s(a,c,e,f){var g,h;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:j.next=2;return b("regeneratorRuntime").awrap(d("WACryptoDependencies").getCrypto().subtle.encrypt(n(e),f,c).then(function(b){return a?new Uint8Array(b):new Uint8Array(b).subarray(0,-i)}));case 2:g=j.sent;h=g.slice(-i);return j.abrupt("return",{encryptedChunk:g,nextIv:h});case 5:case"end":return j.stop()}},null,this)}g.AES_CBC_BLOCK_SIZE=i;g.AesCbcStream=l;g.importRawKey=o;g.getIv=p;g.aesCbcDecrypt=r;g.aesCbcDecryptSplit=a;g.aesCbcEncrypt=e;g.aesCbcEncryptWithChunking=f;g.aesCbcEncryptChunk=s}),98);
__d("WAMemoizeCache",[],(function(a,b,c,d,e,f){"use strict";var g=[];function a(){g.forEach(function(a){return a.clear()})}function h(){var a=new Map();g.push(a);return a}function b(a,b){var c;return function(){c||(c=h());var d=b.apply(void 0,arguments),e=c.get(d);e==null&&(e=a.apply(void 0,arguments),c.set(d,e));return e}}f.clearAllMemoizeCache=a;f.MemoizeCache=h;f.memoizeWithArgs=b}),66);
__d("WAGetKeysForUpload",["MAWLoggerUtils","WAResultOrError","WASignalKeys","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to deserialize prekey received from the db"]);h=function(){return a};return a}var i=d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.PrekeyGenerateAndUpload,d("MAWLoggerUtils").Tag.SignedPrekey]);function a(a,b){return a.storage.loadPreKeys(b).then(function(b){var c=b.preKeys;b=b.signedPreKey;var e=[];c.forEach(function(a){a=d("WASignalKeys").deserializePreKey(a);a==null?i.ERROR(h()):e.push(a)});return d("WAResultOrError").makeResult({regInfo:a.regInfo,keyType:d("WASignalKeys").KEY_TYPE,preKeys:e,signedPreKey:b})})}g.getKeysForUpload=a}),98);
__d("MAWComms",["MAWCommsConfig","MAWMockServerShell","MAWODSProxy","MAWQplProxy","MAWServerRPC","WAComms","WAGzip","WAInitAndGetAuthKeyPair","WAOdsEnums","WAResolvable","WASendPresenceStatusProtocol","WATagsLogger","asyncToGeneratorRuntime","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["openChatSocket retried"]);h=function(){return a};return a}function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=!1,f=new(d("WAResolvable").Resolvable)();void d("MAWQplProxy").measurePerfInQPL(c("qpl")._(1056839232,"112"),"wai_connection",function(){return f.promise});a=(yield d("WAInitAndGetAuthKeyPair").initAndGetAuthKeyPair(a));a=(yield d("MAWCommsConfig").getCommsConfig({authKeyPair:a,handleConnectionChange:function(a){a==="in_handshake"?e===!1?(e=!0,d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(1056839232,"112"),"wai_in_handshake")):d("WATagsLogger").TAGS(["backend"]).LOG(h()):a==="connected"?(void b.newConnection(),f.resolve(),d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.WA_CONNECTIVITY,key:"success"}),e=!1):a==="disconnected"&&(void b.connectionDropped(),d("MAWQplProxy").sendQPLBoolAnnotationThroughBridge(c("qpl")._(1056839232,"112"),"didWAIConnectionDisconnect",!0),e=!1,d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.WA_CONNECTIVITY,key:"disconnected"}))},handleOptimisticConnectionChange:function(a){a==="connected"?c("promiseDone")(d("WASendPresenceStatusProtocol").sendPresenceStatusProtocol({status:"available"})):a==="disconnected"&&c("promiseDone")(d("WASendPresenceStatusProtocol").sendPresenceStatusProtocol({status:"unavailable"}))}}));d("WAComms").startComms(d("MAWServerRPC").makeServerRPC().handleStanza,a,d("WAGzip").gzipInflate,!d("MAWMockServerShell").isMockServerMode);d("MAWMockServerShell").isMockServerMode&&d("MAWMockServerShell").getMockServer!=null&&(yield d("MAWMockServerShell").getMockServer().waitForInit(),void b.newConnection(),f.resolve())});return i.apply(this,arguments)}g.startComms=a}),98);
__d("WAMediaHkdfInfo",["WAErr"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(a){case"document":return"WhatsApp Document Keys";case"image":case"sticker":case"xma-image":return"WhatsApp Image Keys";case"video":case"gif":return"WhatsApp Video Keys";case"audio":case"ptt":return"WhatsApp Audio Keys";case"md-app-state":return"WhatsApp App State Keys";case"md-msg-hist":return"WhatsApp History Keys";default:throw c("WAErr")("getMediaHkdfInfo: unexpected media type "+a)}}function b(){return"Messenger Preview Keys"}g.getMediaHkdfInfo=a;g.getPreviewMediaHkdfInfo=b}),98);
__d("WAMediaCrypto",["Promise","WABase64","WABinary","WACryptoAesCbc","WACryptoDependencies","WACryptoHkdf","WACryptoHmac","WACryptoSha256","WACryptoUtils","WACustomError","WAErr","WALogger","WAMediaCryptoSidecar","WAMediaHkdfInfo","WAMediaUtils","WAPREList","WAPREMetrics","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAMediaCrypto::downloadAndDecrypt"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Processing scan ",""]);j=function(){return a};return a}var k=d("WACustomError").customError("HmacValidationError",!1);function l(a,b){return d("WACryptoHkdf").extractAndExpand(new Uint8Array(a),b,112).then(function(a){return{iv:new Uint8Array(a,0,16),cipherKey:new Uint8Array(a,16,32),hmacKey:new Uint8Array(a,48,32),refKey:new Uint8Array(a,80,32)}})}function m(a,b){b=d("WAMediaHkdfInfo").getMediaHkdfInfo(b);return l(a,b)}function n(a){var b=d("WAMediaHkdfInfo").getPreviewMediaHkdfInfo();return l(a,b)}function a(a){var c,d,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:c=new Map();f.next=3;return b("regeneratorRuntime").awrap(n(a));case 3:d=f.sent;c.set("preview",d);e=["document","image","video","audio","md-app-state","md-msg-hist"];f.next=8;return b("regeneratorRuntime").awrap((h||(h=b("Promise"))).all(e.map(function(b){return m(a,b).then(function(a){c.set(b,a)})})));case 8:return f.abrupt("return",c);case 9:case"end":return f.stop()}},null,this)}function e(a){switch(a){case"image":case"video":return a;default:throw c("WAErr")("Unsupported PreviewMediaType: "+a)}}var o=16,p=16,q=10,r=64*1024;function s(a,c,e,f,g){var i,j,k,l,m,n,s,t,u,v,w,x,y,z,A;return b("regeneratorRuntime").async(function(B){while(1)switch(B.prev=B.next){case 0:i=new(d("WABinary").Binary)(),i.ensureCapacity(p+f.size+o+q),i.writeByteArray(c),j=new(d("WACryptoAesCbc").AesCbcStream)(i,"encrypt",a,c),k=0,l=k+r;case 6:if(!(l<f.size)){B.next=17;break}m=f.slice(k,l);B.next=10;return b("regeneratorRuntime").awrap(d("WAMediaUtils").blobToArrayBuffer(m));case 10:n=B.sent;B.next=13;return b("regeneratorRuntime").awrap(j.append(new Uint8Array(n)));case 13:k=l;l+=r;B.next=6;break;case 17:B.next=19;return b("regeneratorRuntime").awrap(d("WAMediaUtils").blobToArrayBuffer(f.slice(k)));case 19:s=B.sent;B.next=22;return b("regeneratorRuntime").awrap(j.finalize(new Uint8Array(s)));case 22:t=i.peek(function(a){return a.readByteArray()});B.next=25;return b("regeneratorRuntime").awrap(d("WACryptoHmac").encodeKeySha256(e));case 25:u=B.sent;B.next=28;return b("regeneratorRuntime").awrap(d("WACryptoHmac").sign(u,t));case 28:v=B.sent;i.writeByteArray(new Uint8Array(v,0,q));w=i.readByteArray();x=w.subarray(p);B.next=34;return b("regeneratorRuntime").awrap((h||(h=b("Promise"))).all([d("WACryptoDependencies").getCrypto().subtle.digest("SHA-256",x),d("WAMediaCryptoSidecar").shouldHaveStreamingSidecar(g)?d("WAMediaCryptoSidecar").calculateStreamingSidecar(u,w):void 0]));case 34:y=B.sent;z=y[0];A=y[1];return B.abrupt("return",{ciphertext:x,ciphertextHash:z,sidecar:A,ivCiphertext:t});case 38:case"end":return B.stop()}},null,this)}function f(a,c,e){var f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:h.next=2;return b("regeneratorRuntime").awrap(d("WACryptoHmac").encodeKeySha256(a));case 2:f=h.sent;g=d("WABinary").Binary.build(c,e).readByteArray();return h.abrupt("return",d("WACryptoHmac").sign(f,g));case 5:case"end":return h.stop()}},null,this)}function t(a,c,e,f,g){var h,i,j,l,m;return b("regeneratorRuntime").async(function(n){while(1)switch(n.prev=n.next){case 0:if(10<=g.length&&g.length<=32){n.next=2;break}throw new k("Bad hmac size "+g.length);case 2:h=d("WABinary").Binary.build(c,e).readByteArray();n.next=5;return b("regeneratorRuntime").awrap(d("WACryptoHmac").hmacSha256(f,h).then(function(a){return new Uint8Array(a)}));case 5:i=n.sent;j=i.slice(0,g.length);if(w(j,g)){n.next=9;break}throw new k("hmacAndDecrypt hmac mismatch");case 9:n.next=11;return b("regeneratorRuntime").awrap(d("WACryptoAesCbc").aesCbcDecrypt(a,c,e));case 11:l=n.sent;n.next=14;return b("regeneratorRuntime").awrap(d("WACryptoDependencies").getCrypto().subtle.digest("SHA-256",l));case 14:m=n.sent;return n.abrupt("return",{plaintextHash:d("WABase64").encodeB64UrlSafe(new Uint8Array(m)),plaintext:l});case 16:case"end":return n.stop()}},null,this)}function u(a,b,c,e,f){if(!(10<=f.length&&f.length<=32))throw new k("Bad hmac size "+f.length);var g=c.subarray(0,c.byteLength-o);g=d("WABinary").Binary.build(b,g).readByteArray();e=d("WACryptoHmac").hmacSha256(e,g).then(function(a){return new Uint8Array(a)});return e.then(function(a){a=a.slice(0,f.length);if(!d("WACryptoUtils").uint8ArraysEqual(a,f))throw new k("hmacAndDecrypt hmac mismatch")}).then(function(){return d("WACryptoAesCbc").aesCbcDecrypt(a,b,c)}).then(function(a){return new Uint8Array(a)}).then(function(a){var b=a.subarray(0,a.byteLength-2);return d("WACryptoSha256").sha256(b).then(function(a){return{plaintext:b,plaintextHash:d("WABase64").encodeB64UrlSafe(new Uint8Array(a))}})})}function v(a,c,e,f,g,h){var i,k,l,m,n,p,q,r,t,v,w,x,y,z,A,B,C,D;return b("regeneratorRuntime").async(function(E){while(1)switch(E.prev=E.next){case 0:i=new(d("WABinary").Binary)();k=[];for(l=0;l<g;l++)k.push(new Uint8Array(h.sidecar.slice(l*10,(l+1)*10)));m=0;n=c;p=0;q=0;case 7:if(!(q<g)){E.next=30;break}d("WALogger").DEV(j(),q);r=h.alignedScanLengths[q];t=m+r;v=e.slice(m,t);w=new Uint8Array(v.slice(r-o,r));E.next=15;return b("regeneratorRuntime").awrap(s(a,w,f,new Blob([2,2]),"image"));case 15:x=E.sent;y=new(d("WABinary").Binary)(v);y.writeByteArray(x.ciphertext.slice(0,o));z=y.readByteArray();E.next=21;return b("regeneratorRuntime").awrap(u(a,n,z,f,k[q]));case 21:A=E.sent,B=A.plaintext,i.write(B),m+=r,n=w,p+=h.scanLengths[q];case 27:q++;E.next=7;break;case 30:C=i.readBuffer(p);E.next=33;return b("regeneratorRuntime").awrap(d("WACryptoSha256").sha256(C));case 33:D=E.sent;return E.abrupt("return",{plaintextHash:d("WABase64").encodeB64UrlSafe(new Uint8Array(D)),plaintext:C});case 35:case"end":return E.stop()}},null,this)}function w(a,b){if(a.length!==b.length)return!1;var c=1,d=a.length;for(var e=0;e<d;e++)c&=a[e]===b[e]?1:0;return c!==0}function x(a,e,f,g,j,k,l){var m,n,o,p,q,r,s,u,v,w,x;return b("regeneratorRuntime").async(function(y){while(1)switch(y.prev=y.next){case 0:d("WALogger").DEV(i());m=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.DOWNLOAD_AND_DECRYPT);y.prev=2;m.addPoint("download_start");y.next=6;return b("regeneratorRuntime").awrap(fetch(a));case 6:n=y.sent;m.addPoint("download_end");y.next=15;break;case 10:y.prev=10;y.t0=y["catch"](2);m.addPoint("download_end");m.endFail("download_error");throw c("WAErr")("download_error");case 15:if(!(n.status!==200)){y.next=18;break}m.endFail("http_status_"+n.status);throw c("WAErr")("http_status="+n.status);case 18:m.endSuccess();y.next=21;return b("regeneratorRuntime").awrap(n.arrayBuffer());case 21:o=y.sent;if(!(o.byteLength<j+k)){y.next=25;break}m.endFail("bad_ciphertext_size");throw c("WAErr")("bad_ciphertext_size");case 25:p=o.byteLength-k;q=new Uint8Array(o,p);r=q.slice(0,k);s=new Uint8Array(o,0,p);y.next=31;return b("regeneratorRuntime").awrap(t(f,e,s,g,q));case 31:u=y.sent;v=u.plaintext;w=u.plaintextHash;l(new Uint8Array(v));x=new Uint8Array(d("WABase64").decodeB64UrlSafe(w));return y.abrupt("return",(h||(h=b("Promise"))).resolve({tail:r,plaintextHash:x,hmac:q}));case 37:case"end":return y.stop()}},null,this,[[2,10]])}g.HmacValidationError=k;g.computeMediaKeys=m;g.computeMediaKeysForPreview=n;g.deprecated_getAllCommonComputedMediaKeys=a;g.convertServerMediaTypeToPreviewMediaType=e;g.IV_LENGTH=p;g.HMAC_LENGTH=q;g.encryptAndHmac=s;g.hmacCiphertext=f;g.hmacAndDecrypt=t;g.decryptPartialChunks=v;g.downloadAndDecrypt=x}),98);
__d("WAAlignChunkLengthsToMultipleOfAesBlockSize",[],(function(a,b,c,d,e,f){"use strict";function g(a){return parseInt((a+15)/16,10)*16}function a(a,b){var c=[],d=0,e=0,f=0;for(var h=0;h<a.length;++h){d+=a[h];if(h===a.length-1&&b!=null){d>e?c.push(b-e):(c.pop(),c.push(b-f));break}else if(d>e){var i=g(d-e);f=e;c.push(i);e+=i}}return c}f.alignChunkSizeToMultipleAesBlockSize=g;f.alignChunkLengthsToMultipleOfAesBlockSize=a}),66);
__d("WAProgressiveJpegAlignScanLengths",["WAAlignChunkLengthsToMultipleOfAesBlockSize"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("WAAlignChunkLengthsToMultipleOfAesBlockSize").alignChunkLengthsToMultipleOfAesBlockSize(a.map(function(a){return a}),b).map(function(a){return a})}function b(a){return a}g.progressiveJpegAlignChunkLengthsToMultipleOfAesBlockSize=a;g.toProgressiveJpegAlignedScanLength=b}),98);
__d("WAProgressiveJpegGetPJpegDetails",["WAMediaCrypto","WAProgressiveJpegAlignScanLengths","WAProgressiveJpegGetScanLengths","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,c,e){var f,g,i,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:f=c.byteLength-d("WAMediaCrypto").IV_LENGTH;g=d("WAProgressiveJpegGetScanLengths").getProgressiveJpegScanLengths(a);i=d("WAProgressiveJpegAlignScanLengths").progressiveJpegAlignChunkLengthsToMultipleOfAesBlockSize(g,f);k.next=5;return b("regeneratorRuntime").awrap(h(i,c,e));case 5:j=k.sent;return k.abrupt("return",{scanLengths:g,sidecar:j});case 7:case"end":return k.stop()}},null,this)}function h(a,c,e){var f,g,h,i,j,k,l,m,n;return b("regeneratorRuntime").async(function(o){while(1)switch(o.prev=o.next){case 0:f=new Uint8Array(a.length*10),g=0,h=0,i=c.slice(0,16),j=c.slice(16),k=0;case 6:if(!(k<a.length)){o.next=19;break}l=a[k];h=g+l;m=j.subarray(g,h);o.next=12;return b("regeneratorRuntime").awrap(d("WAMediaCrypto").hmacCiphertext(e,i,m));case 12:n=o.sent.slice(0,10),f.set(new Uint8Array(n),k*10),i=m.slice(m.length-16,m.length),g=h;case 16:k++;o.next=6;break;case 19:return o.abrupt("return",f.buffer);case 20:case"end":return o.stop()}},null,this)}function i(a){if(a.scanLengths.length===0)return!1;return a.scanLengths.length*10!==a.sidecar.byteLength?!1:!0}function c(a,b){var c=0;if(b===0)return 0;for(var d=0;d<b;d++){var e=a[d];e!=null&&(c+=e)}return c}function e(a){if(a.progressiveJpegDetails==null)return null;return!i(a.progressiveJpegDetails)?null:{scanLengths:a.progressiveJpegDetails.scanLengths,sidecar:a.progressiveJpegDetails.sidecar}}g.getProgressiveJpegDetails=a;g.isValidProgressiveJpegDetails=i;g.getTotalByteSizeForScan=c;g.maybeGetProgressiveJpegDetailsUsingMediaEntry=e}),98);
__d("WADecimalStringMod",["WAErr","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(['"','" is over 64 bits']);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(['"','" is not a valid decimal string']);i=function(){return a};return a}function a(a,b){if(!/^\d+$/.test(a)){d("WALogger").ERROR(i(),a);throw c("WAErr")("decimalStringMod is given an invalid decimal string")}var e=a.length;if(e<16||e===16&&a<="9007199254740991")return Number(a)%b;if(e>20||e===20&&a>"18446744073709551615"){d("WALogger").ERROR(h(),a);throw c("WAErr")("decimalStringMod is given value over 64 bits")}e=0;for(var f=0;f<a.length;f++){var g=Number(a[f]);e=(e*10+g)%b}return e}g.decimalStringMod=a}),98);
__d("WACreateGetVcaEnabledBucket",["WAArrayBufferUtils","WADecimalStringMod","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["mediaRouteSelection: can't get fbId from mediaDirectPath"]);h=function(){return a};return a}function a(a,b){return function(){return b==null?null:d("WAArrayBufferUtils").arrayBufferMod(a,b)+100}}function b(a,b){return function(){if(b==null)return null;var c=a.split("/");c=c[c.length-1];c=c.split("_")[1];if(!/^\d+$/.test(c))return null;if(c==null){d("WALogger").ERROR(h());return null}else return d("WADecimalStringMod").decimalStringMod(c,b)+100}}g.createGetVcaEnabledBucket=a;g.msgrCreateGetVcaEnabledBucket=b}),98);
__d("WAExtractNcHotTimestamp",["WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){if(a==null)return null;a=h(a);if(a.has("_nc_hot")){a=parseInt(a.get("_nc_hot"),10);return Number.isInteger(a)?d("WATimeUtils").castToUnixTime(a):null}else return null}function h(a){a=a.split("?");return new URLSearchParams(a.length===2?a[1]:"")}g.extractNcHotTimestamp=a}),98);
__d("WAMediaConnParser",["WADeprecatedWapParser","WAServerMediaType"],(function(a,b,c,d,e,f,g){"use strict";a=new(c("WADeprecatedWapParser"))("mediaConnParser",function(a){a=a.child("media_conn");var b=j(a);return{hosts:b,authToken:a.attrString("auth"),authTokenExpiryTs:a.attrFutureTime("auth_ttl"),routesExpiryTs:a.attrFutureTime("ttl"),maxBuckets:a.attrInt("max_buckets"),maxManualRetry:(b=a.maybeAttrInt("max_manual_retry",0,4))!=null?b:3,maxAutoDownloadRetry:(b=a.maybeAttrInt("max_auto_download_retry",0,4))!=null?b:3}});function h(a){var b;return!a.hasAttr("fallback_hostname")?void 0:{domain:a.attrString("fallback_hostname"),"class":a.maybeAttrString("fallback_class"),ip4:(b=a.maybeAttrString("fallback_ip4"))!=null?b:void 0,ip6:(b=a.maybeAttrString("fallback_ip6"))!=null?b:void 0}}function i(a){var b;return{domain:a.attrString("hostname"),fallback:h(a),uploadable:k(a,"upload"),downloadable:k(a,"download"),isFallback:a.maybeAttrString("type")==="fallback",downloadBuckets:(b=(b=a.maybeChild("download_buckets"))==null?void 0:b.mapChildren(function(a){return parseInt(a.tag(),10)}))!=null?b:[],"class":a.maybeAttrString("class"),ip4:(b=a.maybeAttrString("ip4"))!=null?b:void 0,ip6:(b=a.maybeAttrString("ip6"))!=null?b:void 0}}function j(a){return a.mapChildrenWithTag("host",i)}function k(a,b){if(a.hasChild(b))return a.child(b).mapChildren(function(a){a=a.tag();return d("WAServerMediaType").castToServerMediaType(a)}).filter(Boolean);else return d("WAServerMediaType").SERVER_MEDIA}g.mediaConnParser=a}),98);
__d("WAGatherMediaInfo",["WADeprecatedSendIq","WAErrors","WALogger","WAMediaConnParser","WAPromiseManagement","WAPromiseRetryLoop","WAResultOrError","WAWap"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["gatherMediaInfo error ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["gatherMediaInfo got "," hosts"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["gatherMediaInfo got client error: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["gatherMediaInfo got "," seconds backoff"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["gatherMediaInfo failure ",""]);l=function(){return a};return a}var m=507;b=d("WAPromiseManagement").cacheWhilePending(function(){return"gatherMediaInfo"},a);function a(){var a=new(d("WAPromiseRetryLoop").PromiseRetryLoop)({name:"gatherMediaInfo",timer:{jitter:.25,max:987e3,algo:{type:"fibonacci",first:6e3,second:12e3},relativeDelay:!0},code:o});a.start();return a.promise()}var n=60;function o(a){var b;b=(b=d("WAWap")).wap("iq",{to:b.S_WHATSAPP_NET,xmlns:"w:m",type:"set",id:b.generateId()},b.wap("media_conn",null));return d("WADeprecatedSendIq").deprecatedSendIqIfConnectedWithin(b,d("WAMediaConnParser").mediaConnParser,n).then(function(b){if(!b.success){d("WALogger").LOG(l(),b);if(b.errorCode===m){var c=b.errorBackoff;d("WALogger").LOG(k(),c);a(d("WAResultOrError").makeError({type:"backoff",backoffMs:c*1e3}))}else b.errorCode<500&&(d("WALogger").LOG(j(),b.errorCode),a(d("WAResultOrError").makeError({type:"client-error",code:b.errorCode,text:b.errorText})))}else d("WALogger").LOG(i(),b.result.hosts.length),a(d("WAResultOrError").makeResult(b.result))})["catch"](function(b){b instanceof d("WAErrors").Disconnected?a(d("WAResultOrError").makeError("disconnected")):d("WALogger").ERROR(h(),b)})}g.gatherMediaInfo=b}),98);
__d("WAMediaRouteSelection",["WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=null,c=null,e=null,f=a.hosts,g=a.operation,h=a.mediaType;if(a.operation==="download"){var i=a.catHotTimespan,j=a.ncHot;a=a.getVcaEnabledBucket;var k=new Map();f.forEach(function(a){a.downloadBuckets.forEach(function(b){k.set(b,a)})});var l=k.get(0);i>0&&j!=null&&d("WATimeUtils").happenedWithin(d("WATimeUtils").castToUnixTime(j),i)?b=1:a&&(b=a());j=null;b!=null&&(j=k.get(b));((i=j)==null?void 0:i.downloadable.includes(h))?c=j:(l==null?void 0:l.downloadable.includes(h))&&(c=l)}for(a=0;a<f.length;a++){i=f[a];g==="upload"&&i.uploadable.includes(h)?c==null?c=i:i.isFallback&&e==null&&(e=i):g==="download"&&i.downloadable.includes(h)&&(c==null?c=i:i.isFallback&&e==null&&(e=i));if(c!=null&&e!=null)break}return{selectedHost:c,fallbackHost:e,bucket:b}}g.mediaRouteSelection=a}),98);
__d("WAGetMediaRoute",["$InternalEnum","Promise","WACreateGetVcaEnabledBucket","WAExtractNcHotTimestamp","WAGatherMediaInfo","WAMediaRouteSelection","WAPromiseManagement","WAResultOrError","WATagsLogger","WATimeUtils","WAWorkerGlobalScope","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error occurred on gather after backoff expiry: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Can not get mediaAccess: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["mediaAccess has gone, gather a new one"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["mediaAccess has gone, but we are still locked by backoff"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error occurred during authTTL automatic refresh: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["AuthTTL approaching expiry, refreshing MediaAccess routes"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error: no media host"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to get mediaAccess: ",""]);p=function(){return a};return a}var q=d("WATagsLogger").TAGS(["GetMediaRoute"]),r=!0,s=86400,t=b("$InternalEnum")({Fresh:"fresh",Cached:"cached",Stale:"stale"}),u=null,v=!1,w=null;function a(a,c){var e,f,g,h,i,j,k,l,m;return b("regeneratorRuntime").async(function(n){while(1)switch(n.prev=n.next){case 0:n.next=2;return b("regeneratorRuntime").awrap(A());case 2:e=n.sent;if(e.success){n.next=7;break}q.ERROR(p(),e.error);c==null?void 0:c.addPoint("get_media_access_failed",{string:{mediaAccessStatus:e.error}});return n.abrupt("return",e);case 7:c==null?void 0:c.addAnnotations({string:{mediaAccessStatus:e.value.state}});f=e.value.mediaAccess,g=f.authToken,h=f.hosts,i=f.maxBuckets;j=a.operation==="upload"?d("WAMediaRouteSelection").mediaRouteSelection({operation:"upload",mediaType:a.serverMediaType,hosts:h}):d("WAMediaRouteSelection").mediaRouteSelection({operation:"download",mediaType:a.serverMediaType,hosts:h,catHotTimespan:s,ncHot:d("WAExtractNcHotTimestamp").extractNcHotTimestamp(a.directPath),getVcaEnabledBucket:r?d("WACreateGetVcaEnabledBucket").msgrCreateGetVcaEnabledBucket(a.directPath,i):void 0}),k=j.selectedHost,l=j.fallbackHost,m=j.bucket;if(!(k==null)){n.next=13;break}q.ERROR(o());return n.abrupt("return",d("WAResultOrError").makeError("no-host"));case 13:return n.abrupt("return",d("WAResultOrError").makeResult({authToken:g,selectedHost:k,fallbackHost:l,bucket:m}));case 14:case"end":return n.stop()}},null,this)}function x(){var a=w;a!=null&&(d("WAWorkerGlobalScope").workerGlobalScope.clearTimeout(a),w=null)}function y(a){x();var b=Math.max(a.authTokenExpiryTs-d("WATimeUtils").unixTime(),0);if(b<=5*60)return;var c=d("WATimeUtils").pastUnixTime(5*60,a.authTokenExpiryTs);b=d("WATimeUtils").pastUnixTime(Math.floor(b*.2),a.authTokenExpiryTs);a=c<b?c:b;c=d("WATimeUtils").cappedMillisecondsUntil(a);b=Math.floor(Math.random()*d("WATimeUtils").MINUTE_MILLISECONDS);a=d("WAWorkerGlobalScope").workerGlobalScope.setTimeout(function(){q.LOG(n()),z()["catch"](function(a){q.ERROR(m(),a)})},c+b);w=a}var z=d("WAPromiseManagement").cacheWhilePending(function(){return"all"},function(){var a,c,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:if(!v){f.next=3;break}q.LOG(l());return f.abrupt("return",d("WAResultOrError").makeError("backoff"));case 3:q.LOG(k());x();f.next=7;return b("regeneratorRuntime").awrap(d("WAGatherMediaInfo").gatherMediaInfo());case 7:a=f.sent;if(!a.success){f.next=14;break}u=a.value;y(a.value);return f.abrupt("return",d("WAResultOrError").makeResult({mediaAccess:a.value,state:t.Fresh}));case 14:c=a.error;e=c==="disconnected"?"disconnected":c.type;q.WARN(j(),e);if(!(c==="disconnected"||c.type==="client-error")){f.next=21;break}return f.abrupt("return",d("WAResultOrError").makeError("disconnected"));case 21:c.type;v=!0;d("WAWorkerGlobalScope").workerGlobalScope.setTimeout(function(){v=!1,z()["catch"](function(a){q.ERROR(i(),a)})},c.backoffMs);return f.abrupt("return",d("WAResultOrError").makeError("backoff"));case 25:case"end":return f.stop()}},null,this)}),A=function(){var a=u;if(a==null)return z();if(d("WATimeUtils").isInFuture(a.routesExpiryTs))return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult({mediaAccess:a,state:t.Cached}));var c=z();return d("WATimeUtils").isInFuture(a.authTokenExpiryTs)?(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult({mediaAccess:a,state:t.Stale})):c};function c(){u=null,v=!1,x()}g.getMediaRoute=a;g.clearCachedMediaAccessForTest=c}),98);
__d("WAMediaQplHelper",[],(function(a,b,c,d,e,f){"use strict";function a(a){if(a==null||a<0||a>100*1024*1024)return"invalid_size";else if(a<=1*1024)return"size lower than 1 KB";else if(a<=100*1024)return"size between 1 KB and 100 KB";else if(a<=1*1024*1024)return"size between 100 KB and 1 MB";else if(a<=10*1024*1024)return"size between 1 and 10 MB";else if(a<=50*1024*1024)return"size between 10 and 50 MB";else return"size above 50 MB"}f.convertIntegerSizeToStringBucket=a}),66);
__d("WAMediaOperationsRetrier",["WALogger","WAPromiseBackoffs","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["MediaOperationsRetrier:"," wait for internet, attempt = ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Running retrier"]);i=function(){return a};return a}var j=4,k={algo:{type:"constant",delay:1e3},jitter:0};a=function(){function a(a,b,c){this.$1=a,this.routesInfo=b,this.$2=d("WAPromiseBackoffs").createPromiseTimer(k),this.$3=0,this.$4=!1,this.$5=c}var c=a.prototype;c.run=function(a,c){var e,f,g,k;return b("regeneratorRuntime").async(function(l){while(1)switch(l.prev=l.next){case 0:if(!(this.$3<j)){l.next=29;break}d("WALogger").DEV(i());l.next=4;return b("regeneratorRuntime").awrap(this.$2());case 4:e=void 0;if(!(this.$3>0)){l.next=12;break}e=this.$3>=j-2&&!this.$4;d("WALogger").LOG(h(),this.$1,this.$3);l.next=10;return b("regeneratorRuntime").awrap(this.$5==null?void 0:this.$5());case 10:l.next=13;break;case 12:e=!1;case 13:f=this.routesInfo;if(f){l.next=16;break}return l.abrupt("return",null);case 16:g=f.host;e&&f.fallbackHost&&(g=f.fallbackHost);l.next=20;return b("regeneratorRuntime").awrap(a(g,f.authToken,this.$3,c));case 20:k=l.sent;if(!k.success){l.next=25;break}return l.abrupt("return",k.value);case 25:++this.$3,this.$4=k.error.progressMade;case 27:l.next=0;break;case 29:return l.abrupt("return",null);case 30:case"end":return l.stop()}},null,this)};return a}();g.MAX_ATTEMPTS=j;g.BACKOFF_OPTIONS=k;g.MediaOperationsRetrier=a}),98);
__d("WAHttpUtils",["WAErr"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,d){if(!/^https:\/\/[-\w.]+\.\w+$/.test(a))throw c("WAErr")('buildUrl given invalid host "'+a+'"');if(!b.startsWith("/"))throw c("WAErr")('buildUrl given invalid path "'+b+'"');var e=d;d=""+a+b;if(!e)return d;a=Object.keys(e).map(function(a){var b=e[a];b instanceof ArrayBuffer&&(b=new Uint8Array(b));b=b instanceof Uint8Array?Array.prototype.slice.call(b).map(function(a){return"%"+a.toString(16)}).join(""):encodeURIComponent(b.toString());return encodeURIComponent(a)+"="+b});if(a.length>0){b=a.join("&");return d.includes("?")?d+"&"+b:d+"?"+b}else return d}g.buildUrl=a}),98);
__d("WAMediaUrl",["WABase64","WAGlobals","WAHttpUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=1;function a(a,b,c,e,f,g,i){var j=d("WAGlobals").getConfig().mediaUploadRoot();c=d("WABase64").encodeB64UrlSafe(c);b=d("WABase64").encodeB64UrlSafe(b);f={auth:f,token:b};g&&(f.resume=h);i!=null&&i>0&&(f.bytestart=i);return d("WAHttpUtils").buildUrl("https://"+e,j+"/"+a+"/"+c,f)}function b(a,b,c,e,f,g,h){b=d("WABase64").encodeB64UrlSafe(b);b={hash:b,mode:e};f!=null&&(b._nc_cat=f);g!=null&&g>=0&&(b.bytestart=g);h!=null&&h>0&&(b.byteend=h);return d("WAHttpUtils").buildUrl("https://"+c,a,b)}g.RESUME_PARAM=h;g.buildUploadUrl=a;g.buildDownloadUrl=b}),98);
__d("MAWHandleMediaDownloadApi",["MAWBridgeTypesCreators","MAWDbChunkTxns","MAWDbMediaTxns","MAWDbMsg","MAWDbMsgTxns","MAWDbXMATxns","MAWDexieTable","MAWIndexedDb","MAWLoggerUtils","MAWMediaDownloadManager","MAWMediaUtils","MAWMsgType","MAWTransactionMode","Promise","WAArmadilloXMA.pb","WAResultOrError","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Media is null when storing downloaded blob"]);i=function(){return a};return a}var j=d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.MediaDownload,d("MAWLoggerUtils").Tag.MessageReceive]);c=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READWRITE,media:a.READWRITE,messages:a.READONLY,threads:a.READONLY,xma:a.READONLY},"handleMediaDownload",function(a){return function(c,e,f,g){var l=d("MAWMediaUtils").genHMACPlaintextHash(c);return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,g),a.media.where("hashedPlaintextHash").equals(l).first(),d("MAWDbChunkTxns").getOrCreateMediaChunk(a,c,f,e)]).then(function(c){var g=c[0],l=c[1];c[2];if(l==null){j.ERROR(i());return d("WAResultOrError").makeError("missing-media-on-save")}c=d("MAWMediaDownloadManager").getFromMediaDownloadManager(l.mediaId);c!=null&&(c((h||(h=b("Promise"))).resolve(new Blob([f],{type:e}))),d("MAWMediaDownloadManager").removeFromMediaDownloadManager(l.mediaId));return k(a,g).then(function(b){if(!b){b=l.msgIds.map(d("MAWDbMsg").getThreadIdFromMsgId);return a.threads.bulkGet(b).then(function(a){a.forEach(function(a){a!=null&&d("MAWIndexedDb").afterTransaction({tag:"NewMedia",value:d("MAWBridgeTypesCreators").createBridgeMedia(a.chatId,a.jid,l,!0,g==null?void 0:g.sortOrderMs)})})})}else return d("MAWDbMediaTxns").updateMedia(a,l,{size:f.byteLength})}).then(function(){return d("WAResultOrError").makeResult()})})}});function k(a,b){var c;if(b==null)return d("MAWDexieTable").dexieResolve(!1);return b.type===d("MAWMsgType").MSG_TYPE.XMA||((c=b.quote)==null?void 0:c.content.xmaMessageType)===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY?d("MAWDexieTable").dexieResolve(!0):d("MAWDbXMATxns").maybeGetXMAFromAssociatedMsgId(a,b.msgId).then(function(a){return a!=null})}g.handleMediaDownload=c}),98);
__d("MAWMediaRetryInfo",[],(function(a,b,c,d,e,f){"use strict";var g=new Map();function a(a,b){g.set(a,b)}function b(a){return g.get(a)}function c(a){g.has(a)&&g["delete"](a)}f.setRetriedMediaInfo=a;f.getRetriedMediaInfo=b;f.clearRetriedMediaInfo=c}),66);
__d("MAWHandleEchoMediaMsgsRestoreV2",["EchoMessage","EchoMessageMediaFieldUtils","LSDataTraceCheckPoint","LSDataTraceType","LSIntEnum","MAWAsConsumerApplication","MAWBridge","MAWBridgeTypesCreators","MAWCastToMsgrServerMediaType","MAWDbChunkTxns","MAWDbMediaTxns","MAWDownloadMedia","MAWEBBackendQPLUtils","MAWFrontendMediaUtils","MAWGlobals","MAWHandleMediaDownloadApi","MAWIndexedDb","MAWJids","MAWMediaManagementTxns","MAWMediaRetryInfo","MAWMediaUtils","MAWQplProxy","MAWSupportedDocumentTypes","MAWTraceUtils","MAWTransactionMode","Promise","WABase64","WAHashStringToNumber","WAJids","WALogger","WAMediaUtils","WAPREList","WAPREMetrics","WATagsLogger","WATimeUtils","WebStorageEstimator","asyncToGeneratorRuntime","gkx","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Cannot find the media entry for message with mediaKey ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Cannot find the media entry for message with mediaKey ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] media for message: "," is already downloaded on the device"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Unable to construct downloadableThumbnail from previewMediaData: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Encrypted hash cannot be null for non-XMA attachments"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Cannot download media - document extension is disallowed"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Cannot download media - media content type null"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] media entry is missing from index db. It is required to retry download by resigning cdn url"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["isPointRestore: ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] media download failed with error: "," "," when downloading. Message timestamp: ",""]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Retry download media as signature has expired and should be renewed"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] media download complete"]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] downloading media from MI directly"]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] start media download from whatsapp infra"]);w=function(){return a};return a}function x(){var a=babelHelpers.taggedTemplateLiteralLoose(["Encrypted hash is null - unable to download thumbnail"]);x=function(){return a};return a}var y="media_restore";function z(a){var c=D(a);return c.then(function(c){var d=new Map();a.forEach(function(a){var b=c.get(a);b=b==null?void 0:b.blobData;d.set(a,b)});return(i||(i=b("Promise"))).resolve(d)})}function A(a){switch(a){case d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.IMAGE_JPEG:return"image/jpeg";case d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.IMAGE_PNG:return"image/png";case d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.STICKER:return"image/webp";case d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.GIF:return"image/gif";case d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.AUDIO_MP4:return"audio/mp4";case d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.AUDIO_WAV:return"audio/wav";case d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.XMA:return"xma"}}function a(a,b,c,d){return B.apply(this,arguments)}function B(){B=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g){if(a.length===0)return(i||(i=b("Promise"))).resolve();var q=[],r=[],s=new Map(),t=new Map();a.map(function(a){var c=a.mediaData,e=a.messageTimestamp,f=E(c.plaintextHash),g=c.attachmentObjectId,h=c.attachmentType,j=c.backupEntFbid,k=c.directPath,l=c.filename,u=c.height,v=c.mediaContentType,w=c.mediaKeyTimestamp,x=c.mediaPlayableDuration,y=c.previewContentHeight,z=c.previewContentType,B=c.previewContentWidth,C=c.size;c=c.width;var D=d("WAMediaUtils").stringToPlaintextHash(f),I=d("MAWMediaUtils").genHMACPlaintextHash(D);r.push(I);v=v!=null?d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(v,a.isXMA):z!=null?d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(A(z)):null;if(v==null){d("WALogger").ERROR(p());return(i||(i=b("Promise"))).resolve()}if(h===d("EchoMessageMediaFieldUtils").AttachmentType.DOCUMENT&&!d("MAWSupportedDocumentTypes").isAllowedType(l)){d("WALogger").ERROR(o());return(i||(i=b("Promise"))).resolve()}z=a.mediaData.encryptedHash;if(z==null&&!a.isXMA){d("WALogger").ERROR(n());return(i||(i=b("Promise"))).resolve()}h=v.mediaType;v=v.serverMediaType;g=d("WAMediaUtils").stringToDeliveryObjectId(g);j=j!=null?d("WAMediaUtils").stringToBackupEntFbid(j):void 0;var J=a.threadJId,K=F({filename:l,height:u,mediaPlayableDuration:x,mediaType:h,previewContentHeight:y,previewContentWidth:B,width:c});t.set(g,{filename:l,height:u,mediaPlayableDuration:x,mediaType:h,messageTimestamp:e,plaintextHash:D,previewContentHeight:y,previewContentWidth:B,serverMediaType:v,threadJId:J,width:c});u=null;if(a.previewMediaData!=null)try{u=H(a.previewMediaData)}catch(a){d("WALogger").ERROR(m(),a)}if(z!=null){x=G(f,z,a.mediaData.mediaKey,k,w,v,l,j,g,u);q.push({entry:x,fbId:j,hashedPlaintextHash:I,isXMAShare:a.isXMA,mediaInfo:K,mediaType:h,msgId:a.msgId,objectId:g,plaintextHash:D,size:(e=C)!=null?e:0})}B=(y=s.get(I))!=null?y:[];B.push(a);s.set(I,B)});var u=(yield C(q,e,f));a=(yield z(r));a.forEach(function(a,b){var e=s.get(b);e==null?void 0:e.forEach(function(e){if(e==null)return;if(a!=null){d("WALogger").LOG(l(),e.externalId);var f=u.find(function(a){return a.plaintextHash===e.mediaData.plaintextHash});if(f==null){d("WALogger").LOG(k(),e.mediaData.mediaKey);return}d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"NewMedia",value:d("MAWBridgeTypesCreators").createBridgeMedia(e.chatId,e.threadJId,f,!0)}]});return}f=d("MAWTraceUtils").startNewTrace((h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceType").ENCRYPTED_BACKUPS_MEDIA_RESTORE),y);d("MAWTraceUtils").recordCheckpointForTrace(f,h.ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_MEDIA_RESTORE_START),[],!1);var i=t.get(d("WAMediaUtils").stringToDeliveryObjectId(e.mediaData.attachmentObjectId));if(e==null||i==null)return;var m=i.filename,n=i.height,o=i.mediaPlayableDuration,p=i.mediaType,r=i.messageTimestamp,s=i.plaintextHash,v=i.previewContentHeight,w=i.previewContentWidth,x=i.serverMediaType,z=i.threadJId;i=i.width;var A=d("WAJids").extractUserId(d("MAWJids").toUserJid(e.threadJId));x=d("MAWCastToMsgrServerMediaType").castToMsgrServerMediaType(x,e.isXMA);if(x!=null){x={attachmentFbId:e.mediaData.backupEntFbid,attachmentObjectId:d("WAMediaUtils").stringToDeliveryObjectId(e.mediaData.attachmentObjectId),chatId:e.chatId,mediaType:x,messageId:e.externalId,messageTimeStamp:e.messageTimestamp,productType:d("MAWGlobals").getConfig().productTypeForEBAttachments,threadId:A,threadJid:z};A=q.find(function(a){return a.hashedPlaintextHash===b});A=A==null?void 0:A.entry;if(A==null){d("WALogger").ERROR(j(),e.mediaData.mediaKey);return}void I({author:e.author,directPath:e.mediaData.directPath,echoMsg:e.echoMsg,externalId:e.externalId,filename:m,hashedPlaintextHash:b,height:n,isXMA:e.isXMA,mediaPlayableDuration:o,mediaType:p,messageTimestamp:r,plaintextHash:s,previewContentHeight:v,previewContentWidth:w,threadJId:z,width:i},f,x,void 0,d("WAMediaUtils").decodeMediaEntryData(A),g)}})})});return B.apply(this,arguments)}var C=(e=d("MAWIndexedDb")).makeMsgrTransactor({media:(f=d("MAWTransactionMode")).READWRITE,mediaBackup:f.READWRITE,messages:f.READWRITE},"restoreLinkMedias",function(a){return function(b,c,e){return d("MAWMediaManagementTxns").bulkLinkMedia(a,b,c,e)}}),D=e.makeMsgrTransactor({chunk:f.READONLY},"getChunksByHash",function(a){return function(b){return d("MAWDbChunkTxns").maybeBulkGetChunksFromHash(a,b)}});function E(a){if(a.endsWith("=")){var b="";for(var c=0;c<a.length;c++){var d=a.charAt(c);if(d==="=")return b;b+=d}}return a}function F(a){var b=a.height,c=a.mediaType,e=a.width,f=a.previewContentHeight,g=a.previewContentWidth,h=a.mediaPlayableDuration;a=a.filename;return{validatedAudioInfo:c==="Ptt"&&h!=null?{duration:h,mimetype:d("MAWAsConsumerApplication").AUDIO_MIME_TYPE,played:!1}:null,validatedDocumentFileInfo:c==="DocumentFile"?{filename:a,mimetype:d("MAWAsConsumerApplication").FILE_MIME_TYPE}:null,validatedImageInfo:c==="Image"?{height:b,jpegThumbnailHeight:f,jpegThumbnailWidth:g,width:e}:c==="Gif"||c==="Sticker"?{height:b,jpegThumbnailHeight:b,jpegThumbnailWidth:e,width:e}:null,validatedVideoInfo:c==="Video"?{height:b,jpegThumbnailHeight:f,jpegThumbnailWidth:g,mimetype:d("MAWAsConsumerApplication").VIDEO_MIME_TYPE,width:e}:null}}function G(a,b,c,e,f,g,h,i,j,k){a=d("WABase64").decodeB64UrlSafe(a,!0);b=d("WABase64").decodeB64UrlSafe(b,!0);c=d("WABase64").decodeB64UrlSafe(c,!0);return d("WAMediaUtils").rawDataToMediaEntry(a,b,c,e,d("WATimeUtils").castToUnixTime(f),g,j!=null?j:void 0,i!=null?i:void 0,k!=null?k:void 0,h)}function H(a){var b=a.attachmentObjectId,c=a.directPath,e=a.encryptedHash,f=a.mediaKey,g=a.mediaKeyTimestamp;a=a.plaintextHash;if(e==null){d("WALogger").ERROR(x());return}else{g=d("WATimeUtils").castToUnixTime(g);f=d("WAMediaUtils").castToMediaKey(d("WABase64").decodeB64UrlSafe(f,!0));a=d("WABase64").decodeB64UrlSafe(a,!0);e=d("WABase64").decodeB64UrlSafe(e,!0);return{directPath:c,fileEncSha256:e,fileSha256:a,mediaKey:f,mediaKeyTimestamp:g,objectId:b}}}var I=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,i){var j,k;d("WALogger").LOG(w());var l=a.author,m=a.externalId,n=a.filename,o=a.hashedPlaintextHash,p=a.height,q=a.mediaPlayableDuration,r=a.mediaType,x=a.messageTimestamp,y=a.plaintextHash,z=a.previewContentHeight,A=a.previewContentWidth,B=a.threadJId,C=a.width,D=d("WAJids").switchOnMsgrChatJidType(B,{group:function(a){return"group"},user:function(a){return"user"}});j=((j=(j=d("MAWMediaRetryInfo").getRetriedMediaInfo(m))==null?void 0:j.isXMA)!=null?j:!1)||((j=a==null?void 0:a.isXMA)!=null?j:!1);k=((k=d("MAWMediaRetryInfo").getRetriedMediaInfo(m))==null?void 0:(k=k.echoMsg)==null?void 0:k.serializationOrigin)||(a==null?void 0:(k=a.echoMsg)==null?void 0:k.serializationOrigin)||d("EchoMessage").EchoSerializationOriginType.UNKNOWN;var E=(yield d("WebStorageEstimator").estimateStorage());D=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MEDIA_DOWNLOAD,{bool:{isRetryFromMI:e==null,isXMA:j,pathMismatch:f!==g.directPath},"int":{storageQuota:(E==null?void 0:E.quota)||0,storageUsage:(E==null?void 0:E.usage)||0},string:{chat_type:D,downloadEntry:"handleEchoMediaMsgsRestore",oldDirectPath:(j=a==null?void 0:a.oldDirectPath)!=null?j:"",origin:k,restorationCdnUrl:(E=f)!=null?E:""}});if(e!=null&&c("gkx")("23960")){d("WALogger").LOG(v());d("MAWMediaRetryInfo").setRetriedMediaInfo(m,a);return J(m,e,b)}j={author:l,chat:B,externalId:m};k=(yield d("MAWDownloadMedia").downloadMedia({downloadMediaMetric:D,hash:y,mediaEntry:g,protocolMsgId:j}));if(k.success){f=k.value;E=f.mimeType;l=f.plaintext;yield d("MAWHandleMediaDownloadApi").handleMediaDownload(y,E,l,j);D.endSuccess();d("MAWMediaRetryInfo").clearRetriedMediaInfo(m);B=F({filename:n,height:p,mediaPlayableDuration:q,mediaType:r,previewContentHeight:z,previewContentWidth:A,width:C});yield K(o,B);d("WALogger").LOG(u());d("MAWTraceUtils").recordSuccessAndFlushForTraceId(b,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_MEDIA_RESTORE_SUCCESS),[]);e==null&&b!=null&&d("MAWQplProxy").sendQPLSuccessThroughBridge(c("qpl")._(521485815,"2166"),void 0,d("WAHashStringToNumber").hashStringToNumber(b))}else{g=k.error;L(g)&&e?(D.addPoint("eb_resign_requested"),D.endSuccess(),d("WALogger").WARN(t()),d("MAWMediaRetryInfo").setRetriedMediaInfo(m,a),yield J(m,e,b,i)):(D.endFail(g),d("WALogger").ERROR(s(),m,g,x),d("MAWMediaRetryInfo").clearRetriedMediaInfo(m),d("MAWTraceUtils").recordFailureAndFlushForTraceId(b,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_MEDIA_RESTORE_FAILURE),[],"media download failed with error: "+g),d("MAWEBBackendQPLUtils").logMediaRestoreFromMIQPLEndFailure(b,"media_download_failure"))}});return function(b,c,d,e,f,g){return a.apply(this,arguments)}}(),J=e.makeMsgrTransactor({media:f.READONLY,mediaBackup:f.READONLY},"invokeRestoreAccessCheckSprocToDownloadAttachment",function(a){return function(b,e,f,g){var i=d("WAMediaUtils").stringToDeliveryObjectId(e.attachmentObjectId);return d("MAWDbMediaTxns").maybeGetMediaFromObjectId(a,i).then(function(a){if(a){var i;if(f!=null&&e!=null){var j;a=d("WAHashStringToNumber").hashStringToNumber(f);j={bool:{isPointRestore:(j=g)!=null?j:!1},string:{mediaType:e.mediaType}};i=d("MAWQplProxy").startQplUserFlow(c("qpl")._(521485815,"2166"),j,a)}d("WATagsLogger").TAGS(["labyrinth_web","media_restore",(j=f)!=null?j:""]).LOG(r(),g);g===!0?i!=null&&i.endSuccess():d("MAWIndexedDb").afterTransaction({tag:"ResignAttachmentCDNUrl",value:{backupEntFbid:e.attachmentFbId,chatId:e.chatId.toString(),deliveryObjectId:e.attachmentObjectId,mediaType:e.mediaType,messageId:b,productType:d("MAWGlobals").getConfig().productTypeForEBAttachments,sortOrder:e.messageTimeStamp,threadId:e.threadId,threadJid:e.threadJid,traceId:f}})}else d("WALogger").ERROR(q()),d("MAWTraceUtils").recordFailureAndFlushForTraceId(f,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_MEDIA_RESTORE_FAILURE),[],"media entry is missing from index db. It is required to retry download by resigning cdn url")})}}),K=e.makeMsgrTransactor({media:f.READWRITE,messages:f.READWRITE},"updateMediaWithDownloadedChunkBlob",function(a){return function(b,c){return d("MAWMediaManagementTxns").updateMediaEntryWithValidatedMediaInfo(a,b,c)}}),L=function(a){switch(a){case"signature-expired":case"signature-expired-and-resign-failed-no-ids":case"signature-expired-and-resign-failed-cdn-url":return!0;case"hash-mismatch":case"ciphertext-hash-mismatch":case"enc-hash-mismatch":case"decryption-error":case"max-attempts-exceeded":case"request-error":case"download-throttled":case"media-not-found":case"media-entry-invalid":case"no-media-entry-no-message":case"no-media-entry-missing-messages":case"no-media-entry-by-plaintext-hash":case"no-host":case"backoff":case"disconnected":case"missing-media-on-save":case"runtime-error":return!1;default:a;return!0}};g.downloadMediaAndWriteToMediaStore=a;g.handleDownloadMedia=I;g.invokeRestoreAccessCheckSprocToDownloadAttachment=J;g.isResignCDNError=L}),98);
__d("MAWAcceptGroupInvite",["MAWDbChatId","MAWGlobals","MAWJids","WADeprecatedSendIq","WADeprecatedWapParser","WAJids","WALogger","WAPersistedJobManager","WATimeUtils","WAWap","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["acceptGroupInvite failed to get group invite info ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["acceptGroupInvite failed to get group jid for ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["acceptGroupInvite failed to get thread jid for ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["acceptGroupInvite called"]);k=function(){return a};return a}var l=new(c("WADeprecatedWapParser"))("getAcceptGroupInviteResponse",function(a){a.assertTag("iq"),a.assertAttr("type","result")});a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("saveAndPassOff",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").LOG(k());var b=a.chatId,c=a.inviteCode,e=a.invitedParticipantUserId,f=a.inviteExpirationTs;a=a.inviterUserId;b=d("MAWDbChatId").unsafeCoerceToChatId(b);a=d("MAWJids").toUserJid(a);e=d("MAWJids").toUserJid(e);var g=(yield d("MAWGlobals").getDbImpls().getThreadJidByChatId(b)),m;if(c!=null&&f!=null){if(g==null){d("WALogger").DEV(j(),b);return!1}m=d("WAJids").interpretAsGroupJid(g);if(m==null){d("WALogger").DEV(i(),g);return!1}c=c;f=f}else{b=(yield d("MAWGlobals").getDbImpls().getGroupInvite(b,a,e));if(!b.success){d("WALogger").DEV(h(),b.error);return!1}m=b.value.groupJid;c=b.value.groupInvite.inviteCode;f=b.value.groupInvite.inviteExpirationTs}b=d("WAWap").wap("iq",{id:d("WAWap").generateId(),to:d("WAWap").GROUP_JID(m),type:"set",xmlns:"w:g2"},d("WAWap").wap("accept",{admin:d("WAWap").USER_JID(a),code:d("WAWap").CUSTOM_STRING(c),expiration:d("WAWap").LONG_INT(f)}));m=(yield d("WADeprecatedSendIq").deprecatedSendIq(b,l));if(!m.success){a=m.errorCode.toString().startsWith("5");if(a)throw new(d("WAPersistedJobManager").RetryOnBackoff)({algo:{first:d("WATimeUtils").HOUR_MILLISECONDS/60,type:"exponential"},jitter:.1});return!1}g!=null&&(yield d("MAWGlobals").getDbImpls().removeGroupInvites(g,e));return!0});return function(b){return a.apply(this,arguments)}}()).end();g.acceptGroupInvite=a}),98);
__d("WAGetDevices",["Promise","WADevicesState","WAJobs","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["fetchAndSaveDevices: ",""]);i=function(){return a};return a}function j(a,c,e){e===void 0&&(e=!1);d("WALogger").LOG(i(),c);return(h||(h=b("Promise"))).resolve().then(function(){if(e)return d("WADevicesState").getDevicesState().reset(Array.from(a))}).then(function(){return d("WADevicesState").getDevicesState().waitForUserDevices(Array.from(a),"getDevices job: "+c,e)})}a=d("WAJobs").getPersistedJobsApi().definePersistedJob().finalStep("getDevices",function(a){var b=a.users,c=a.reason;a=a.ignoreDhash;return j(b,c,a)}).end();g.fetchAndSaveDevices=j;g.getDevices=a}),98);
__d("MAWCreateGroupInvitesStep",["MAWGlobals","MAWJobDefinitions","WAAddGroupParticipantsApi","WAGetDevices","WAJids","asyncToGeneratorRuntime","isGroupInvitesEnabled"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,d){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){f===void 0&&(f=!0);if(!c("isGroupInvitesEnabled")()||e.length===0)return[];var g=e.map(function(a){return a.user}),h=e.map(function(a){return{addressable:!0,type:"invitedParticipant",user:a.user}});yield d("WAGetDevices").fetchAndSaveDevices(new Set(g),"create-group-invite");f||(yield d("WAAddGroupParticipantsApi").addGroupParticipants(null,a,d("WAJids").AUTHOR_ME,h,!0));e.forEach(function(c){var e=c.user,f=c.inviteCode;c=c.expiration;d("MAWGlobals").getJobManager().fireAndForget(d("MAWJobDefinitions").jobSerializers.sendGroupInviteMsg({expiration:c,groupJid:a,inviteCode:f,invitedParticipantUserJid:e,inviterUserJid:b}))});return h});return h.apply(this,arguments)}g.createGroupInvitesStep=a}),98);
__d("WASmaxInGroupsIQErrorBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","bad-request");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",400);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorBadRequestMixin=a}),98);
__d("WASmaxInGroupsIQErrorFallbackClientMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"text");if(!b.success)return b;a=d("WASmaxParseUtils").attrIntRange(a,"code",400,499);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorFallbackClientMixin=a}),98);
__d("WASmaxInGroupsIQErrorForbiddenMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","forbidden");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",403);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorForbiddenMixin=a}),98);
__d("WASmaxInGroupsIQErrorItemNotFoundMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","item-not-found");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",404);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorItemNotFoundMixin=a}),98);
__d("WASmaxInGroupsIQErrorLockedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","locked");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",423);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorLockedMixin=a}),98);
__d("WASmaxInGroupsIQErrorNotAllowedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","not-allowed");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",405);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorNotAllowedMixin=a}),98);
__d("WASmaxInGroupsIQErrorNotAuthorizedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","not-authorized");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",401);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorNotAuthorizedMixin=a}),98);
__d("WASmaxInGroupsIQErrorRateOverlimitMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","rate-overlimit");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",429);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorRateOverlimitMixin=a}),98);
__d("WASmaxInGroupsAddParticipantsClientErrors",["WAResultOrError","WASmaxInGroupsIQErrorBadRequestMixin","WASmaxInGroupsIQErrorFallbackClientMixin","WASmaxInGroupsIQErrorForbiddenMixin","WASmaxInGroupsIQErrorItemNotFoundMixin","WASmaxInGroupsIQErrorLockedMixin","WASmaxInGroupsIQErrorNotAllowedMixin","WASmaxInGroupsIQErrorNotAuthorizedMixin","WASmaxInGroupsIQErrorRateOverlimitMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:b.value});var c=d("WASmaxInGroupsIQErrorItemNotFoundMixin").parseIQErrorItemNotFoundMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorItemNotFound",value:c.value});var e=d("WASmaxInGroupsIQErrorNotAuthorizedMixin").parseIQErrorNotAuthorizedMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"IQErrorNotAuthorized",value:e.value});var f=d("WASmaxInGroupsIQErrorForbiddenMixin").parseIQErrorForbiddenMixin(a);if(f.success)return d("WAResultOrError").makeResult({name:"IQErrorForbidden",value:f.value});var g=d("WASmaxInGroupsIQErrorRateOverlimitMixin").parseIQErrorRateOverlimitMixin(a);if(g.success)return d("WAResultOrError").makeResult({name:"IQErrorRateOverlimit",value:g.value});var h=d("WASmaxInGroupsIQErrorNotAllowedMixin").parseIQErrorNotAllowedMixin(a);if(h.success)return d("WAResultOrError").makeResult({name:"IQErrorNotAllowed",value:h.value});var i=d("WASmaxInGroupsIQErrorLockedMixin").parseIQErrorLockedMixin(a);if(i.success)return d("WAResultOrError").makeResult({name:"IQErrorLocked",value:i.value});var j=d("WASmaxInGroupsIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(a);return j.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackClient",value:j.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorBadRequest","IQErrorItemNotFound","IQErrorNotAuthorized","IQErrorForbidden","IQErrorRateOverlimit","IQErrorNotAllowed","IQErrorLocked","IQErrorFallbackClient"],[b,c,e,f,g,h,i,j])}g.parseAddParticipantsClientErrors=a}),98);
__d("WASmaxInGroupsIQErrorResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","error");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQErrorResponseMixin=a}),98);
__d("WASmaxInGroupsAddParticipantsResponseClientError",["WAResultOrError","WASmaxInGroupsAddParticipantsClientErrors","WASmaxInGroupsIQErrorResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInGroupsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInGroupsAddParticipantsClientErrors").parseAddParticipantsClientErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorAddParticipantsClientErrors:b.value}))}g.parseAddParticipantsResponseClientError=a}),98);
__d("WASmaxInGroupsIQErrorFallbackServerMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"text");if(!b.success)return b;a=d("WASmaxParseUtils").attrIntRange(a,"code",500,599);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorFallbackServerMixin=a}),98);
__d("WASmaxInGroupsIQErrorInternalServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","internal-server-error");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",500);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorInternalServerErrorMixin=a}),98);
__d("WASmaxInGroupsIQErrorPartialServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","partial-server-error");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",530);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorPartialServerErrorMixin=a}),98);
__d("WASmaxInGroupsIQErrorServiceUnavailableMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","service-unavailable");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",503);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorServiceUnavailableMixin=a}),98);
__d("WASmaxInGroupsServerErrors",["WAResultOrError","WASmaxInGroupsIQErrorFallbackServerMixin","WASmaxInGroupsIQErrorInternalServerErrorMixin","WASmaxInGroupsIQErrorPartialServerErrorMixin","WASmaxInGroupsIQErrorServiceUnavailableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsIQErrorInternalServerErrorMixin").parseIQErrorInternalServerErrorMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorInternalServerError",value:b.value});var c=d("WASmaxInGroupsIQErrorServiceUnavailableMixin").parseIQErrorServiceUnavailableMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorServiceUnavailable",value:c.value});var e=d("WASmaxInGroupsIQErrorPartialServerErrorMixin").parseIQErrorPartialServerErrorMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"IQErrorPartialServerError",value:e.value});var f=d("WASmaxInGroupsIQErrorFallbackServerMixin").parseIQErrorFallbackServerMixin(a);return f.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackServer",value:f.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorInternalServerError","IQErrorServiceUnavailable","IQErrorPartialServerError","IQErrorFallbackServer"],[b,c,e,f])}g.parseServerErrors=a}),98);
__d("WASmaxInGroupsBaseServerErrorMixin",["WAResultOrError","WASmaxInGroupsIQErrorResponseMixin","WASmaxInGroupsServerErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInGroupsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInGroupsServerErrors").parseServerErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorServerErrors:b.value}))}g.parseBaseServerErrorMixin=a}),98);
__d("WASmaxInGroupsAddParticipantsResponseServerError",["WASmaxInGroupsBaseServerErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInGroupsBaseServerErrorMixin").parseBaseServerErrorMixin(a,b);return!c.success?c:c}g.parseAddParticipantsResponseServerError=a}),98);
__d("WASmaxInGroupsParticipantConflictMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","409");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseParticipantConflictMixin=a}),98);
__d("WASmaxInGroupsParticipantGroupJoinRequestMixin",["WAResultOrError","WASmaxInGroupsEnums","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"membership_approval_request");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","421");if(!a.success)return a;b=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrStringEnum,b.value,"error",d("WASmaxInGroupsEnums").ENUM_304_419);return!b.success?b:d("WAResultOrError").makeResult({error:a.value,membershipApprovalRequestError:b.value})}g.parseParticipantGroupJoinRequestMixin=a}),98);
__d("WASmaxInGroupsParticipantHasInvalidPNMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","404");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseParticipantHasInvalidPNMixin=a}),98);
__d("WASmaxInGroupsParticipantInBanListMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","402");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseParticipantInBanListMixin=a}),98);
__d("WASmaxInGroupsParticipantNotAcceptableMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","406");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseParticipantNotAcceptableMixin=a}),98);
__d("WASmaxInGroupsParticipantNotAuthorizedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","401");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseParticipantNotAuthorizedMixin=a}),98);
__d("WASmaxInGroupsParticipantRequestCodeCanBeSentMixin",["WAResultOrError","WASmaxInGroupsParticipantNotAddressableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"add_request");if(!b.success)return b;var c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","403");if(!c.success)return c;var e=d("WASmaxParseUtils").attrString(b.value,"code");if(!e.success)return e;b=d("WASmaxParseUtils").attrIntRange(b.value,"expiration",0,void 0);if(!b.success)return b;a=d("WASmaxInGroupsParticipantNotAddressableMixin").parseParticipantNotAddressableMixin(a);return d("WAResultOrError").makeResult({error:c.value,addRequestCode:e.value,addRequestExpiration:b.value,participantNotAddressableMixin:a.success?a.value:null})}g.parseParticipantRequestCodeCanBeSentMixin=a}),98);
__d("WASmaxInGroupsParticipantRequestCodeCannotBeCreatedForLegalConcernsMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","451");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseParticipantRequestCodeCannotBeCreatedForLegalConcernsMixin=a}),98);
__d("WASmaxInGroupsParticipantResourceConstraintMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","500");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseParticipantResourceConstraintMixin=a}),98);
__d("WASmaxInGroupsParticipantResourceLimitMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","419");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseParticipantResourceLimitMixin=a}),98);
__d("WASmaxInGroupsParticipantTemporarilyBlockedFromDefaultSubGroupMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","417");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseParticipantTemporarilyBlockedFromDefaultSubGroupMixin=a}),98);
__d("WASmaxInGroupsParticipantTemporarilyBlockedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","408");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseParticipantTemporarilyBlockedMixin=a}),98);
__d("WASmaxInGroupsAddParticipantsParticipantMixins",["WAResultOrError","WASmaxInGroupsParticipantConflictMixin","WASmaxInGroupsParticipantGroupJoinRequestMixin","WASmaxInGroupsParticipantHasInvalidPNMixin","WASmaxInGroupsParticipantInBanListMixin","WASmaxInGroupsParticipantNotAcceptableMixin","WASmaxInGroupsParticipantNotAddressableMixin","WASmaxInGroupsParticipantNotAuthorizedMixin","WASmaxInGroupsParticipantRequestCodeCanBeSentMixin","WASmaxInGroupsParticipantRequestCodeCannotBeCreatedForLegalConcernsMixin","WASmaxInGroupsParticipantResourceConstraintMixin","WASmaxInGroupsParticipantResourceLimitMixin","WASmaxInGroupsParticipantTemporarilyBlockedFromDefaultSubGroupMixin","WASmaxInGroupsParticipantTemporarilyBlockedMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsParticipantGroupJoinRequestMixin").parseParticipantGroupJoinRequestMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"ParticipantGroupJoinRequest",value:b.value});var c=d("WASmaxInGroupsParticipantNotAuthorizedMixin").parseParticipantNotAuthorizedMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"ParticipantNotAuthorized",value:c.value});var e=d("WASmaxInGroupsParticipantInBanListMixin").parseParticipantInBanListMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"ParticipantInBanList",value:e.value});var f=d("WASmaxInGroupsParticipantRequestCodeCanBeSentMixin").parseParticipantRequestCodeCanBeSentMixin(a);if(f.success)return d("WAResultOrError").makeResult({name:"ParticipantRequestCodeCanBeSent",value:f.value});var g=d("WASmaxInGroupsParticipantRequestCodeCannotBeCreatedForLegalConcernsMixin").parseParticipantRequestCodeCannotBeCreatedForLegalConcernsMixin(a);if(g.success)return d("WAResultOrError").makeResult({name:"ParticipantRequestCodeCannotBeCreatedForLegalConcerns",value:g.value});var h=d("WASmaxInGroupsParticipantHasInvalidPNMixin").parseParticipantHasInvalidPNMixin(a);if(h.success)return d("WAResultOrError").makeResult({name:"ParticipantHasInvalidPN",value:h.value});var i=d("WASmaxInGroupsParticipantTemporarilyBlockedMixin").parseParticipantTemporarilyBlockedMixin(a);if(i.success)return d("WAResultOrError").makeResult({name:"ParticipantTemporarilyBlocked",value:i.value});var j=d("WASmaxInGroupsParticipantConflictMixin").parseParticipantConflictMixin(a);if(j.success)return d("WAResultOrError").makeResult({name:"ParticipantConflict",value:j.value});var k=d("WASmaxInGroupsParticipantResourceLimitMixin").parseParticipantResourceLimitMixin(a);if(k.success)return d("WAResultOrError").makeResult({name:"ParticipantResourceLimit",value:k.value});var l=d("WASmaxInGroupsParticipantResourceConstraintMixin").parseParticipantResourceConstraintMixin(a);if(l.success)return d("WAResultOrError").makeResult({name:"ParticipantResourceConstraint",value:l.value});var m=d("WASmaxInGroupsParticipantNotAcceptableMixin").parseParticipantNotAcceptableMixin(a);if(m.success)return d("WAResultOrError").makeResult({name:"ParticipantNotAcceptable",value:m.value});var n=d("WASmaxInGroupsParticipantNotAddressableMixin").parseParticipantNotAddressableMixin(a);if(n.success)return d("WAResultOrError").makeResult({name:"ParticipantNotAddressable",value:n.value});var o=d("WASmaxInGroupsParticipantTemporarilyBlockedFromDefaultSubGroupMixin").parseParticipantTemporarilyBlockedFromDefaultSubGroupMixin(a);return o.success?d("WAResultOrError").makeResult({name:"ParticipantTemporarilyBlockedFromDefaultSubGroup",value:o.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["ParticipantGroupJoinRequest","ParticipantNotAuthorized","ParticipantInBanList","ParticipantRequestCodeCanBeSent","ParticipantRequestCodeCannotBeCreatedForLegalConcerns","ParticipantHasInvalidPN","ParticipantTemporarilyBlocked","ParticipantConflict","ParticipantResourceLimit","ParticipantResourceConstraint","ParticipantNotAcceptable","ParticipantNotAddressable","ParticipantTemporarilyBlockedFromDefaultSubGroup"],[b,c,e,f,g,h,i,j,k,l,m,n,o])}g.parseAddParticipantsParticipantMixins=a}),98);
__d("WASmaxInGroupsAddParticipantsParticipantAddedResponseMixin",["WAResultOrError","WASmaxInGroupsAddParticipantsParticipantMixins","WASmaxInGroupsPhoneNumberMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseJid").attrUserJid(a,"jid");if(!b.success)return b;var c=d("WASmaxInGroupsPhoneNumberMixin").parsePhoneNumberMixin(a);a=d("WASmaxInGroupsAddParticipantsParticipantMixins").parseAddParticipantsParticipantMixins(a);return d("WAResultOrError").makeResult({jid:b.value,phoneNumberMixin:c.success?c.value:null,addParticipantsParticipantMixins:a.success?a.value:null})}g.parseAddParticipantsParticipantAddedResponseMixin=a}),98);
__d("WASmaxInGroupsParticipantRequestCodeCanBeSentOrRequestCodeCannotBeCreatedForLegalConcernsOrHasInvalidPNMixinGroup",["WAResultOrError","WASmaxInGroupsParticipantHasInvalidPNMixin","WASmaxInGroupsParticipantRequestCodeCanBeSentMixin","WASmaxInGroupsParticipantRequestCodeCannotBeCreatedForLegalConcernsMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsParticipantRequestCodeCanBeSentMixin").parseParticipantRequestCodeCanBeSentMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"ParticipantRequestCodeCanBeSent",value:b.value});var c=d("WASmaxInGroupsParticipantRequestCodeCannotBeCreatedForLegalConcernsMixin").parseParticipantRequestCodeCannotBeCreatedForLegalConcernsMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"ParticipantRequestCodeCannotBeCreatedForLegalConcerns",value:c.value});var e=d("WASmaxInGroupsParticipantHasInvalidPNMixin").parseParticipantHasInvalidPNMixin(a);return e.success?d("WAResultOrError").makeResult({name:"ParticipantHasInvalidPN",value:e.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["ParticipantRequestCodeCanBeSent","ParticipantRequestCodeCannotBeCreatedForLegalConcerns","ParticipantHasInvalidPN"],[b,c,e])}g.parseParticipantRequestCodeCanBeSentOrRequestCodeCannotBeCreatedForLegalConcernsOrHasInvalidPNMixinGroup=a}),98);
__d("WASmaxInGroupsNonRegisteredWaUserParticipantErrorLidResponseMixin",["WAResultOrError","WASmaxInGroupsParticipantRequestCodeCanBeSentOrRequestCodeCannotBeCreatedForLegalConcernsOrHasInvalidPNMixinGroup","WASmaxInGroupsPhoneNumberMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxInGroupsPhoneNumberMixin").parsePhoneNumberMixin(a);if(!b.success)return b;a=d("WASmaxInGroupsParticipantRequestCodeCanBeSentOrRequestCodeCannotBeCreatedForLegalConcernsOrHasInvalidPNMixinGroup").parseParticipantRequestCodeCanBeSentOrRequestCodeCannotBeCreatedForLegalConcernsOrHasInvalidPNMixinGroup(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({},b.value,{participantRequestCodeCanBeSentOrRequestCodeCannotBeCreatedForLegalConcernsOrHasInvalidPNMixinGroup:a.value}))}g.parseNonRegisteredWaUserParticipantErrorLidResponseMixin=a}),98);
__d("WASmaxInGroupsAddParticipantsParticipantAddedOrNonRegisteredWaUserParticipantErrorLidResponseMixinGroup",["WAResultOrError","WASmaxInGroupsAddParticipantsParticipantAddedResponseMixin","WASmaxInGroupsNonRegisteredWaUserParticipantErrorLidResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsAddParticipantsParticipantAddedResponseMixin").parseAddParticipantsParticipantAddedResponseMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"AddParticipantsParticipantAddedResponse",value:b.value});var c=d("WASmaxInGroupsNonRegisteredWaUserParticipantErrorLidResponseMixin").parseNonRegisteredWaUserParticipantErrorLidResponseMixin(a);return c.success?d("WAResultOrError").makeResult({name:"NonRegisteredWaUserParticipantErrorLidResponse",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["ParticipantAddedResponse","NonRegisteredWaUserParticipantErrorLidResponse"],[b,c])}g.parseAddParticipantsParticipantAddedOrNonRegisteredWaUserParticipantErrorLidResponseMixinGroup=a}),98);
__d("WASmaxInGroupsAddParticipantsResponseSuccess",["WAResultOrError","WASmaxInGroupsAddParticipantsParticipantAddedOrNonRegisteredWaUserParticipantErrorLidResponseMixinGroup","WASmaxInGroupsGroupAddressingModeMixin","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxInGroupsAddParticipantsParticipantAddedOrNonRegisteredWaUserParticipantErrorLidResponseMixinGroup").parseAddParticipantsParticipantAddedOrNonRegisteredWaUserParticipantErrorLidResponseMixinGroup(a);return!b.success?b:d("WAResultOrError").makeResult({addParticipantsParticipantAddedOrNonRegisteredWaUserParticipantErrorLidResponseMixinGroup:b.value})}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"add");if(!c.success)return c;var e=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!e.success)return e;e=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",e.value);if(!e.success)return e;e=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");if(!e.success)return e;b=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",b.value);if(!b.success)return b;b=d("WASmaxInGroupsGroupAddressingModeMixin").parseGroupAddressingModeMixin(a);a=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"participant",1,19999,h);return!a.success?a:d("WAResultOrError").makeResult({type:e.value,groupAddressingModeMixin:b.success?b.value:null,addParticipant:a.value})}g.parseAddParticipantsResponseSuccessAddParticipant=h;g.parseAddParticipantsResponseSuccess=a}),98);
__d("WASmaxOutGroupsBaseIQSetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),type:"set"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseIQSetRequestMixin=a}),98);
__d("WASmaxOutGroupsBaseSetGroupMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutGroupsBaseIQSetRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.iqTo;a=d("WASmaxOutGroupsBaseIQSetRequestMixin").mergeBaseIQSetRequestMixin(d("WASmaxJsx").smax("iq",{to:d("WAWap").GROUP_JID(a),xmlns:"w:g2"}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseSetGroupMixin=a}),98);
__d("WASmaxOutGroupsPhoneNumberMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.anyPhoneNumber;a=d("WASmaxJsx").smax("smax$any",{phone_number:d("WAWap").USER_JID(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePhoneNumberMixin=a}),98);
__d("WASmaxOutGroupsAddParticipantsRequest",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutGroupsBaseSetGroupMixin","WASmaxOutGroupsPhoneNumberMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.participantJid;a=a.phoneNumberMixinArgs;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutGroupsPhoneNumberMixin").mergePhoneNumberMixin,d("WASmaxJsx").smax("participant",{jid:d("WAWap").USER_JID(b)}),a);return b}function a(a){var b=a.participantArgs;b=d("WASmaxOutGroupsBaseSetGroupMixin").mergeBaseSetGroupMixin(d("WASmaxJsx").smax("iq",null,d("WASmaxJsx").smax("add",null,d("WASmaxChildren").REPEATED_CHILD(h,b,1,1024))),a);return b}g.makeAddParticipantsRequestAddParticipant=h;g.makeAddParticipantsRequest=a}),98);
__d("WASmaxGroupsAddParticipantsRPC",["WAComms","WASmaxInGroupsAddParticipantsResponseClientError","WASmaxInGroupsAddParticipantsResponseServerError","WASmaxInGroupsAddParticipantsResponseSuccess","WASmaxOutGroupsAddParticipantsRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:e=d("WASmaxOutGroupsAddParticipantsRequest").makeAddParticipantsRequest(a);j.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=j.sent;g=d("WASmaxInGroupsAddParticipantsResponseSuccess").parseAddParticipantsResponseSuccess(f,e);if(!g.success){j.next=7;break}return j.abrupt("return",{name:"AddParticipantsResponseSuccess",value:g.value});case 7:h=d("WASmaxInGroupsAddParticipantsResponseClientError").parseAddParticipantsResponseClientError(f,e);if(!h.success){j.next=10;break}return j.abrupt("return",{name:"AddParticipantsResponseClientError",value:h.value});case 10:i=d("WASmaxInGroupsAddParticipantsResponseServerError").parseAddParticipantsResponseServerError(f,e);if(!i.success){j.next=13;break}return j.abrupt("return",{name:"AddParticipantsResponseServerError",value:i.value});case 13:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("AddParticipants",{Success:g,ClientError:h,ServerError:i}));case 14:case"end":return j.stop()}},null,this)}g.sendAddParticipantsRPC=a}),98);
__d("MAWAddGroupParticipants",["MAWCreateGroupInvitesStep","MAWGlobals","MAWODSProxy","WAAddGroupParticipantsApi","WAGlobals","WAGroupInviteUtils","WAJids","WALogger","WAOdsEnums","WAResultOrError","WASmaxGroupsAddParticipantsRPC","WATimeUtils","asyncToGeneratorRuntime","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to add participant: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to add participant: ",""]);i=function(){return a};return a}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("addGroupParticipants",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.group;a=a.users;var e=d("WAGlobals").getJidUtilsApi(),f=e.toUserJid;e=a.map(function(a){return f(a)});if(e.length===0)return d("WAResultOrError").makeResult({groupJid:b,participants:[]});a=(yield d("WASmaxGroupsAddParticipantsRPC").sendAddParticipantsRPC({iqTo:b,participantArgs:e.map(function(a){return{participantJid:a}})}));d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.GROUP_ADD_PARTICIPANT,key:a.name==="AddParticipantsResponseSuccess"?"success":"fail"});if(a.name==="AddParticipantsResponseClientError"){e=a.value.errorAddParticipantsClientErrors.name;d("WALogger").ERROR(i(),e);return d("WAResultOrError").makeError(e)}if(a.name==="AddParticipantsResponseServerError"){e=a.value.errorServerErrors.name;d("WALogger").ERROR(h(),e);return d("WAResultOrError").makeError(e)}a.name;e=a.value.addParticipant.filter(function(a){a=a.addParticipantsParticipantAddedOrNonRegisteredWaUserParticipantErrorLidResponseMixinGroup;a=a.value.addParticipantsParticipantMixins;return(a==null?void 0:a.value.error)==null}).map(function(a){a=a.addParticipantsParticipantAddedOrNonRegisteredWaUserParticipantErrorLidResponseMixinGroup;a=a.value;var b=a.addParticipantsParticipantMixins;a=a.jid;a=c("nullthrows")(a);return{addressable:(b==null?void 0:b.name)!=="ParticipantNotAddressable",type:"participant",user:a}});yield d("WAAddGroupParticipantsApi").addGroupParticipants(null,b,d("WAJids").AUTHOR_ME,e,!0);a=(yield d("MAWCreateGroupInvitesStep").createGroupInvitesStep(b,d("WAGlobals").getMyUserJid(),a.value.addParticipant.map(function(a){a=a.addParticipantsParticipantAddedOrNonRegisteredWaUserParticipantErrorLidResponseMixinGroup;a=a.value;var b=a.addParticipantsParticipantMixins;a=a.jid;a=c("nullthrows")(a);return(b==null?void 0:b.name)==="ParticipantRequestCodeCanBeSent"?{expiration:d("WATimeUtils").castToUnixTime(b.value.addRequestExpiration),inviteCode:d("WAGroupInviteUtils").toInviteCode(b.value.addRequestCode),user:a}:void 0}).filter(Boolean),!1));e=[].concat(e,a);a=(yield d("MAWGlobals").getJobResultConvertersImpls().convertAddGroupParticipantsResult==null?void 0:d("MAWGlobals").getJobResultConvertersImpls().convertAddGroupParticipantsResult(b,e));return a?d("WAResultOrError").makeResult(a):d("WAResultOrError").makeResult({groupJid:b,participants:e})});return function(b){return a.apply(this,arguments)}}()).end();g.addGroupParticipants=a}),98);
__d("MAWBackupMessageWithMedia",["LSDataTraceCheckPoint","LSIntEnum","MAWDbMsgTxns","MAWEBSwitch","MAWEBUploadTrackingUtils","MAWGetMediaByObjectId","MAWGlobals","MAWIndexedDb","MAWTraceUtils","MAWTransactionMode","MAWUploadMessagesBackup","WALogger","WASortedLists","asyncToGeneratorRuntime","err","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] No affected messages for media"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] No mediaBackup entry found for fbid: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] No media entry found for fbid: ",""]);k=function(){return a};return a}var l=d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY},"getMsgsByMsgIds",function(a){return function(){for(var b=arguments.length,c=new Array(b),e=0;e<b;e++)c[e]=arguments[e];return d("MAWDbMsgTxns").getMsgsByMsgIds.apply(void 0,[a].concat(c))}});function m(a,b,c){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){if(!c("MAWEBSwitch").isEnabled())return;var f=null;if(!c("gkx")("23919")){var g=(yield d("MAWGetMediaByObjectId").getMediaByObjectId(b));if(!g.success){d("WALogger").ERROR(k(),a);d("MAWTraceUtils").recordFailureAndFlushForTraceId(e,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_MEDIA_BACKUP_FAILURE),[],"No media entry found");throw c("err")("No media entry found")}f=g.value.msgIds}else{g=(yield d("MAWGetMediaByObjectId").getMediaBackupByObjectId(b));if(!g.success){d("WALogger").ERROR(j(),a);d("MAWTraceUtils").recordFailureAndFlushForTraceId(e,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_MEDIA_BACKUP_FAILURE),[],"No media entry found");throw c("err")("No mediaBackup entry found")}g.value.msgId!=null&&(f=d("WASortedLists").asSortedSet(new Set([g.value.msgId])))}if(f==null||f.length===0){d("WALogger").ERROR(i());d("MAWTraceUtils").recordFailureAndFlushForTraceId(e,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_MEDIA_BACKUP_FAILURE),[],"No affected messages for media");throw c("err")("No affected messages for media")}b=(yield l(f));var m=new Map();b.forEach(function(a){if(d("MAWEBUploadTrackingUtils").isUploadSupported(a)){var b=d("MAWEBUploadTrackingUtils").genInstanceKeyOnly();m.set(a.externalId,b);d("MAWEBUploadTrackingUtils").startUploadTracking(a.externalId,a.type,"media",b)}});yield d("MAWUploadMessagesBackup").uploadUniqueMessage(b,void 0,void 0,void 0,m);d("MAWTraceUtils").recordCheckpointForTrace(e,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_MEDIA_BACKUP_SUCCESS),[],!1);d("MAWTraceUtils").recordCheckpointForTrace(e,h.ofNumber(c("LSDataTraceCheckPoint").FLOW_END_AND_FLUSH),[],!0)});return n.apply(this,arguments)}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("backup",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.backupEntFbid,c=a.deliveryObjectId;a=a.traceId;yield m(b,c,a)});return function(b){return a.apply(this,arguments)}}()).end();g.processUpload=m;g.backupMessageWithMedia=a}),98);
__d("MAWCreateGroupStep",["MAWCreateGroupInvitesStep","MAWSendSenderKeyDistributionMsg","WADeprecatedSendIq","WADeprecatedWapParser","WAGlobals","WAGroupParserUtils","WAJobDefinitions","WAJobOrchestratorTypes","WAJobs","WALogger","WAPREList","WAPREMetrics","WAResultOrError","WAScheduleAfterOfflineResume","WATimeUtils","WAWap","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to create group: ",""]);h=function(){return a};return a}var i=new(c("WADeprecatedWapParser"))("createGroupResponse",function(a){a.assertTag("iq");return d("WAGroupParserUtils").parseGroupNode(a.child("group"))});function a(a,b,c,d){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){var f=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.CREATE_GROUP,{"int":{users:c.length}}),g=d("WAGlobals").getJidUtilsApi(),h=g.toUserJid;g=c.map(function(a){return h(a)});c=(yield k(a,b,g,f,e==null?void 0:e.deduplicationKey));f.addPoint("finish_send_create_group_stanza");if(!c.success)return c;var i=c.value.group;f.addPoint("start_create_group");yield d("WAGlobals").getDbImpls().createGroup(i,"added",d("WATimeUtils").unixTime(),null,a,e);f.addPoint("finish_create_group");d("WAScheduleAfterOfflineResume").scheduleAfterOfflineResume({code:function(){return d("MAWSendSenderKeyDistributionMsg").maybePreEstablishSessionsAndSendSenderKeyDistributionMsg(i.jid,i.participants.map(function(a){return a.success?a.value.user:null}).filter(Boolean))},id:i.jid+"-e2e-session"});b=i.participants.map(function(a){return a.success?a.value.user:void 0}).filter(Boolean);yield d("WAJobs").getJobManager().waitUntilPersisted(d("WAJobDefinitions").createStartJobInfo("getDevices",{ignoreDhash:!1,reason:"create-group",scheduleConfig:{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW},users:new Set(b)}));f.addPoint("persist_get_devices_create_group");yield d("MAWCreateGroupInvitesStep").createGroupInvitesStep(i.jid,(g=i.creator)!=null?g:d("WAGlobals").getMyUserJid(),i.participants.map(function(a){return!a.success&&a.error.errorCode===403?{expiration:a.error.expiration,inviteCode:a.error.code,user:a.error.user}:void 0}).filter(Boolean));f.addPoint("finish_create_group_invites_step");c=d("WAJobs").getJobResultConvertersImpls().convertCreateGroupResult;a=c?yield c(i):{group:i,type:"default"};f.endSuccess();return d("WAResultOrError").makeResult(a)});return j.apply(this,arguments)}function k(a,b,c,e,f){var g;c=c.map(function(a){return d("WAWap").wap("participant",{jid:d("WAWap").USER_JID(a)})});g=(g=d("WAWap")).wap("iq",{id:g.generateId(),to:g.G_US,type:"set",xmlns:"w:g2"},g.wap("create",{id:a!=null?d("WAWap").CUSTOM_STRING(a):d("WAWap").DROP_ATTR,key:f!=null?d("WAWap").CUSTOM_STRING(f):d("WAWap").DROP_ATTR,subject:b!=null?d("WAWap").CUSTOM_STRING(b):d("WAWap").DROP_ATTR},c));return d("WADeprecatedSendIq").deprecatedSendIq(g,i).then(function(a){if(!a.success){d("WALogger").ERROR(h(),a.errorCode);e.endFail("fail_send_create_group_stanza",{"int":{errorCode:a.errorCode}});return d("WAResultOrError").makeError(a.errorText)}return d("WAResultOrError").makeResult({group:a.result,type:"default"})})}g.createGroupStep=a}),98);
__d("MAWCreateGroup",["MAWCreateGroupStep","MAWGlobals"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("createGroup",function(a){var b=a.extras,c=a.key,e=a.subject;a=a.users;return d("MAWCreateGroupStep").createGroupStep(c,e,a,b)}).end();g.createGroup=a}),98);
__d("MAWDeleteGroups",["MAWDeleteGroup","MAWGlobals","WAJids","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("deleteGroups",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.groups;yield c("MAWDeleteGroup")(d("WAJids").AUTHOR_ME,a)});return function(b){return a.apply(this,arguments)}}()).end();g.deleteGroups=a}),98);
__d("MAWDeleteMsgsForMe",["MAWGlobals","MAWJobDefinitions","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["deleteMsgsForMe: ",""]);h=function(){return a};return a}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("saveAndPassOff",function(a){a=a.msgIds;d("WALogger").DEV(h(),a);a=a.map(function(a){return{protocolMsgId:a,type:"delete_for_me"}});a=a.map(function(a){return{messageAction:a}});a={actions:a,type:"meta_sync"};return d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendAppData({contents:a})).then(function(){return void 0})}).end();g.deleteMsgsForMe=a}),98);
__d("MAWDeleteThread",["MAWDbChatId","MAWGlobals","MAWJobDefinitions","WALogger","WAPREList","WAPREMetrics","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["deleteThread job: ",""]);h=function(){return a};return a}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("saveAndPassOff",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.chatId;d("WALogger").DEV(h(),a);var b=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.DELETE_THREAD,void 0,a);a=d("MAWDbChatId").unsafeCoerceToChatId(a);a=(yield d("MAWGlobals").getDbImpls().getThreadInfoForDeletion(a));var c=a.newestMsgTs!=null?d("WATimeUtils").futureUnixTime(1,a.newestMsgTs):void 0;a={chatJid:a.chatJid,messageRange:{lastMessageTimestamp:c,messages:[]},type:"chat_delete"};c={actions:[{chatAction:a}],type:"meta_sync"};return d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendAppData({contents:c})).then(function(){b.endSuccess()})["catch"](function(){b.endFail("delete_thread_failed")})});return function(b){return a.apply(this,arguments)}}()).end();g.deleteThread=a}),98);
__d("WASmaxInGroupsIQErrorBlockedIntegrityEnforcementMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","blocked-integrity-enforcement");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",486);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorBlockedIntegrityEnforcementMixin=a}),98);
__d("WASmaxInGroupsPromoteDemoteClientErrors",["WAResultOrError","WASmaxInGroupsIQErrorBadRequestMixin","WASmaxInGroupsIQErrorBlockedIntegrityEnforcementMixin","WASmaxInGroupsIQErrorFallbackClientMixin","WASmaxInGroupsIQErrorForbiddenMixin","WASmaxInGroupsIQErrorItemNotFoundMixin","WASmaxInGroupsIQErrorLockedMixin","WASmaxInGroupsIQErrorNotAuthorizedMixin","WASmaxInGroupsIQErrorRateOverlimitMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsIQErrorRateOverlimitMixin").parseIQErrorRateOverlimitMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorRateOverlimit",value:b.value});var c=d("WASmaxInGroupsIQErrorBlockedIntegrityEnforcementMixin").parseIQErrorBlockedIntegrityEnforcementMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorBlockedIntegrityEnforcement",value:c.value});var e=d("WASmaxInGroupsIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:e.value});var f=d("WASmaxInGroupsIQErrorItemNotFoundMixin").parseIQErrorItemNotFoundMixin(a);if(f.success)return d("WAResultOrError").makeResult({name:"IQErrorItemNotFound",value:f.value});var g=d("WASmaxInGroupsIQErrorNotAuthorizedMixin").parseIQErrorNotAuthorizedMixin(a);if(g.success)return d("WAResultOrError").makeResult({name:"IQErrorNotAuthorized",value:g.value});var h=d("WASmaxInGroupsIQErrorForbiddenMixin").parseIQErrorForbiddenMixin(a);if(h.success)return d("WAResultOrError").makeResult({name:"IQErrorForbidden",value:h.value});var i=d("WASmaxInGroupsIQErrorLockedMixin").parseIQErrorLockedMixin(a);if(i.success)return d("WAResultOrError").makeResult({name:"IQErrorLocked",value:i.value});var j=d("WASmaxInGroupsIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(a);return j.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackClient",value:j.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorRateOverlimit","IQErrorBlockedIntegrityEnforcement","IQErrorBadRequest","IQErrorItemNotFound","IQErrorNotAuthorized","IQErrorForbidden","IQErrorLocked","IQErrorFallbackClient"],[b,c,e,f,g,h,i,j])}g.parsePromoteDemoteClientErrors=a}),98);
__d("WASmaxInGroupsPromoteDemoteResponseClientError",["WAResultOrError","WASmaxInGroupsIQErrorResponseMixin","WASmaxInGroupsPromoteDemoteClientErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInGroupsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInGroupsPromoteDemoteClientErrors").parsePromoteDemoteClientErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorPromoteDemoteClientErrors:b.value}))}g.parsePromoteDemoteResponseClientError=a}),98);
__d("WASmaxInGroupsPromoteDemoteResponseServerError",["WASmaxInGroupsBaseServerErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInGroupsBaseServerErrorMixin").parseBaseServerErrorMixin(a,b);return!c.success?c:c}g.parsePromoteDemoteResponseServerError=a}),98);
__d("WASmaxInGroupsIQResultResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQResultResponseMixin=a}),98);
__d("WASmaxInGroupsPromoteDemoteResponseSuccessDemote",["WAResultOrError","WASmaxInGroupsEnums","WASmaxInGroupsGroupAddressingModeMixin","WASmaxInGroupsIQResultResponseMixin","WASmaxInGroupsPhoneNumberMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseJid").attrUserJid(a,"jid");if(!b.success)return b;var c=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrStringEnum,a,"error",d("WASmaxInGroupsEnums").ENUM_404_406);if(!c.success)return c;a=d("WASmaxInGroupsPhoneNumberMixin").parsePhoneNumberMixin(a);return d("WAResultOrError").makeResult({jid:b.value,error:c.value,phoneNumberMixin:a.success?a.value:null})}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"demote");if(!c.success)return c;b=d("WASmaxInGroupsIQResultResponseMixin").parseIQResultResponseMixin(a,b);if(!b.success)return b;a=d("WASmaxInGroupsGroupAddressingModeMixin").parseGroupAddressingModeMixin(a);c=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"participant",0,1024,h);return!c.success?c:d("WAResultOrError").makeResult(babelHelpers["extends"]({},b.value,{groupAddressingModeMixin:a.success?a.value:null,demoteParticipant:c.value}))}g.parsePromoteDemoteResponseSuccessDemoteDemoteParticipant=h;g.parsePromoteDemoteResponseSuccessDemote=a}),98);
__d("WASmaxInGroupsPromoteDemoteResponseSuccessPromote",["WAResultOrError","WASmaxInGroupsEnums","WASmaxInGroupsGroupAddressingModeMixin","WASmaxInGroupsIQResultResponseMixin","WASmaxInGroupsPhoneNumberMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseJid").attrUserJid(a,"jid");if(!b.success)return b;var c=d("WASmaxParseUtils").optionalLiteral(d("WASmaxParseUtils").attrString,a,"type","admin");if(!c.success)return c;var e=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrStringEnum,a,"error",d("WASmaxInGroupsEnums").ENUM_404_419);if(!e.success)return e;a=d("WASmaxInGroupsPhoneNumberMixin").parsePhoneNumberMixin(a);return d("WAResultOrError").makeResult({jid:b.value,type:c.value,error:e.value,phoneNumberMixin:a.success?a.value:null})}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"promote");if(!c.success)return c;b=d("WASmaxInGroupsIQResultResponseMixin").parseIQResultResponseMixin(a,b);if(!b.success)return b;a=d("WASmaxInGroupsGroupAddressingModeMixin").parseGroupAddressingModeMixin(a);c=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"participant",0,1024,h);return!c.success?c:d("WAResultOrError").makeResult(babelHelpers["extends"]({},b.value,{groupAddressingModeMixin:a.success?a.value:null,promoteParticipant:c.value}))}g.parsePromoteDemoteResponseSuccessPromotePromoteParticipant=h;g.parsePromoteDemoteResponseSuccessPromote=a}),98);
__d("WASmaxOutGroupsPromoteDemoteRequest",["WASmaxChildren","WASmaxJsx","WASmaxOutGroupsBaseSetGroupMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.participantJid;a=d("WASmaxJsx").smax("participant",{jid:d("WAWap").USER_JID(a)});return a}function i(a){a=a.participantArgs;a=d("WASmaxJsx").smax("promote",null,d("WASmaxChildren").REPEATED_CHILD(h,a,0,1024));return a}function j(a){a=a.participantJid;a=d("WASmaxJsx").smax("participant",{jid:d("WAWap").USER_JID(a)});return a}function k(a){a=a.participantArgs;a=d("WASmaxJsx").smax("demote",null,d("WASmaxChildren").REPEATED_CHILD(j,a,0,1024));return a}function a(a){var b=a.promoteArgs,c=a.demoteArgs;b=d("WASmaxOutGroupsBaseSetGroupMixin").mergeBaseSetGroupMixin(d("WASmaxJsx").smax("iq",null,d("WASmaxChildren").OPTIONAL_CHILD(i,b),d("WASmaxChildren").OPTIONAL_CHILD(k,c)),a);return b}g.makePromoteDemoteRequestPromoteParticipant=h;g.makePromoteDemoteRequestPromote=i;g.makePromoteDemoteRequestDemoteParticipant=j;g.makePromoteDemoteRequestDemote=k;g.makePromoteDemoteRequest=a}),98);
__d("WASmaxGroupsPromoteDemoteRPC",["WAComms","WASmaxInGroupsPromoteDemoteResponseClientError","WASmaxInGroupsPromoteDemoteResponseServerError","WASmaxInGroupsPromoteDemoteResponseSuccessDemote","WASmaxInGroupsPromoteDemoteResponseSuccessPromote","WASmaxOutGroupsPromoteDemoteRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:e=d("WASmaxOutGroupsPromoteDemoteRequest").makePromoteDemoteRequest(a);k.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=k.sent;g=d("WASmaxInGroupsPromoteDemoteResponseSuccessPromote").parsePromoteDemoteResponseSuccessPromote(f,e);if(!g.success){k.next=7;break}return k.abrupt("return",{name:"PromoteDemoteResponseSuccessPromote",value:g.value});case 7:h=d("WASmaxInGroupsPromoteDemoteResponseSuccessDemote").parsePromoteDemoteResponseSuccessDemote(f,e);if(!h.success){k.next=10;break}return k.abrupt("return",{name:"PromoteDemoteResponseSuccessDemote",value:h.value});case 10:i=d("WASmaxInGroupsPromoteDemoteResponseClientError").parsePromoteDemoteResponseClientError(f,e);if(!i.success){k.next=13;break}return k.abrupt("return",{name:"PromoteDemoteResponseClientError",value:i.value});case 13:j=d("WASmaxInGroupsPromoteDemoteResponseServerError").parsePromoteDemoteResponseServerError(f,e);if(!j.success){k.next=16;break}return k.abrupt("return",{name:"PromoteDemoteResponseServerError",value:j.value});case 16:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("PromoteDemote",{SuccessPromote:g,SuccessDemote:h,ClientError:i,ServerError:j}));case 17:case"end":return k.stop()}},null,this)}g.sendPromoteDemoteRPC=a}),98);
__d("WAPromoteDemoteGroupParticipantProtocol",["WAErr","WALogger","WAResultOrError","WASmaxGroupsPromoteDemoteRPC","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["error sending promote group participants iq: ",", ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["error sending promote group participants iq: ",", ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Demoting participants, but got promotion response"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Promoting participants, but got demotion response"]);k=function(){return a};return a}function a(a){var e,f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:e=a.group,f=a.participants;h.next=3;return b("regeneratorRuntime").awrap(l({group:e,demoteArgs:null,promoteArgs:{participantArgs:f.map(function(a){return{participantJid:a}})}}));case 3:g=h.sent;if(g.success){h.next=6;break}return h.abrupt("return",g);case 6:if(!(g.value.type==="promote")){h.next=8;break}return h.abrupt("return",d("WAResultOrError").makeResult(g.value));case 8:d("WALogger").ERROR(k());throw c("WAErr")("Promoting participants, but got demotion response");case 10:case"end":return h.stop()}},null,this)}function e(a){var e,f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:e=a.group,f=a.participants;h.next=3;return b("regeneratorRuntime").awrap(l({group:e,promoteArgs:null,demoteArgs:{participantArgs:f.map(function(a){return{participantJid:a}})}}));case 3:g=h.sent;if(g.success){h.next=6;break}return h.abrupt("return",g);case 6:if(!(g.value.type==="demote")){h.next=8;break}return h.abrupt("return",d("WAResultOrError").makeResult(g.value));case 8:d("WALogger").ERROR(j());throw c("WAErr")("Demoting participants, but got promotion response");case 10:case"end":return h.stop()}},null,this)}function l(a){var c,e,f,g,j,k,l,m,n,o,p,q;return b("regeneratorRuntime").async(function(r){while(1)switch(r.prev=r.next){case 0:c=a.group,e=a.promoteArgs,f=a.demoteArgs;r.next=3;return b("regeneratorRuntime").awrap(d("WASmaxGroupsPromoteDemoteRPC").sendPromoteDemoteRPC({promoteArgs:e,demoteArgs:f,iqTo:c}));case 3:g=r.sent;r.t0=g.name;r.next=r.t0==="PromoteDemoteResponseSuccessPromote"?7:r.t0==="PromoteDemoteResponseSuccessDemote"?9:r.t0==="PromoteDemoteResponseClientError"?11:14;break;case 7:j=g.value.promoteParticipant.map(function(a){var b=a.error;return{user:a.jid,result:b==null?d("WAResultOrError").makeResult():d("WAResultOrError").makeError(b)}});return r.abrupt("return",d("WAResultOrError").makeResult({type:"promote",participants:j}));case 9:k=g.value.demoteParticipant.map(function(a){var b=a.error;return{user:a.jid,result:b==null?d("WAResultOrError").makeResult():d("WAResultOrError").makeError(b)}});return r.abrupt("return",d("WAResultOrError").makeResult({type:"demote",participants:k}));case 11:l=g.value.errorPromoteDemoteClientErrors.value,m=l.code,n=l.text;d("WALogger").WARN(i(),m,n);return r.abrupt("return",d("WAResultOrError").makeError({type:"client-error",code:m}));case 14:g.name;o=g.value.errorServerErrors.value,p=o.code,q=o.text;d("WALogger").WARN(h(),p,q);return r.abrupt("return",d("WAResultOrError").makeError({type:"server-error",code:p}));case 18:case"end":return r.stop()}},null,this)}g.promoteGroupParticipantsProtocol=a;g.demoteGroupParticipantsProtocol=e}),98);
__d("MAWDemoteGroupParticipants",["MAWGlobals","MAWODSProxy","WAChangeGroupParticipantAdminStatusApi","WAGlobals","WAJids","WAOdsEnums","WAPromoteDemoteGroupParticipantProtocol","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("demoteGroupParticipants",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.group;a=a.users;var c=d("WAGlobals").getJidUtilsApi(),e=c.toUserJid;c=a.map(function(a){return e(a)});if(c.length===0)return d("WAResultOrError").makeResult({groupJid:b,participants:[],type:"default"});a=(yield d("WAPromoteDemoteGroupParticipantProtocol").demoteGroupParticipantsProtocol({group:b,participants:c}));if(!a.success){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.GROUP_DEMOTE_PARTICIPANT,key:"fail"});return d("WAResultOrError").makeError(a.error.type)}d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.GROUP_DEMOTE_PARTICIPANT,key:"success"});c=a.value.participants.filter(function(a){a=a.result;return a.success}).map(function(a){a=a.user;return{addressable:!1,type:"participant",user:a}})||[];yield d("WAChangeGroupParticipantAdminStatusApi").changeGroupParticipantAdminStatus(null,b,d("WAJids").AUTHOR_ME,c,"participant");a=(yield d("MAWGlobals").getJobResultConvertersImpls().convertDemoteGroupParticipantsResult==null?void 0:d("MAWGlobals").getJobResultConvertersImpls().convertDemoteGroupParticipantsResult(b,c));return a?d("WAResultOrError").makeResult(a):d("WAResultOrError").makeResult({groupJid:b,participants:c,type:"default"})});return function(b){return a.apply(this,arguments)}}()).end();g.demoteGroupParticipants=a}),98);
__d("MAWDeletedMsgApi",["MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({deletedMessages:d("MAWTransactionMode").READONLY},"getDeletedMsgByProtocolIdApi",function(a){return function(b){return a.deletedMessages.get(babelHelpers["extends"]({},b))}});g.getDeletedMsgByProtocolIdApi=a}),98);
__d("MAWGetDecodedMediaEntry",["MAWGetMediaKnownEntriesApi","WALogger","WAMediaUtils","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["No media entry: messages_number=",", numMsgsForMedia=",""]);h=function(){return a};return a}function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b=(yield d("MAWGetMediaKnownEntriesApi").getMediaKnownEntries(b));if(b.success===!1)return b;b=b.value;var c=b.missingMessages,e=b.msgMap;b=b.numEntries;a=e.get(a);if(a!=null)return d("WAResultOrError").makeResult(d("WAMediaUtils").decodeMediaEntryData(a));if(c.length>0)return d("WAResultOrError").makeError("no-media-entry-missing-messages");else{d("WALogger").ERROR(h(),e.values().length,b);return d("WAResultOrError").makeError("no-media-entry-no-message")}});return i.apply(this,arguments)}g.getDecodedMediaEntry=a}),98);
__d("MAWGetMostRescentDecodedMediaEntry",["MAWDbMediaTxns","MAWIndexedDb","MAWTransactionMode","WAMediaUtils","WAResultOrError","WATagsLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["No media entry"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["No existing media entry found for plaintextHash ",". Returning new MsgMap."]);i=function(){return a};return a}var j=d("WATagsLogger").TAGS(["getMostRecentDecodedMediaEntry"]),k=d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READONLY},"getMediaKnownEntries",function(a){return function(b){return d("MAWDbMediaTxns").maybeGetMediaFromPlaintextHash(a,b).then(function(a){if(!a){j.LOG(i(),b);return d("WAResultOrError").makeError("no-media-by-plaintext-hash")}a=Array.from(a.mediaEntries.values());return d("WAResultOrError").makeResult(a)})}});function a(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield k(a));if(a.success===!1)return a;var b=null;for(a of a.value){var c,e=d("WAMediaUtils").decodeMediaEntryData(a);(((c=b)==null?void 0:c.mediaKeyTimestamp)==null||e.mediaKeyTimestamp!=null&&e.mediaKeyTimestamp>b.mediaKeyTimestamp)&&(b=e)}if(b!=null)return d("WAResultOrError").makeResult(b);j.ERROR(h());return d("WAResultOrError").makeError("no-media-entry")});return l.apply(this,arguments)}g.getMostRecentDecodedMediaEntry=a}),98);
__d("MAWDownloadAndHandleMedia",["MAWAckLevel","MAWDbDeletedMessages","MAWDbMsgTxns","MAWDeletedMsgApi","MAWDownloadMedia","MAWExternalId","MAWGetDecodedMediaEntry","MAWGetMostRescentDecodedMediaEntry","MAWGetStorageQplAnnotations","MAWGlobals","MAWHandleMediaDownloadApi","MAWIndexedDb","MAWLoggerUtils","MAWTransactionMode","WAJids","WAMediaUtils","WAPREList","WAPREMetrics","WATagsLogger","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media for msg ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["downloadAndHandleMedia: Failed to get DecodedMediaEntry - reason: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["downloadAndHandleMedia: Missing msgId in Db - reason: "," msgType: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["DownloadAndHandleMedia: "," hash with "," msgId"]);l=function(){return a};return a}var m=d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.MediaDownload,d("MAWLoggerUtils").Tag.MessageReceive]);a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("downloadAndHandleMedia",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.hash,e=a.metricInstanceKeys,f=a.msgType,g=a.protocolMsgId;a=a.qplEntryPoint;var o=d("WAJids").switchOnMsgrChatJidType(g.chat,{group:function(){return"group"},user:function(){return"user"}});e=e==null?void 0:e.get(d("WAPREList").PRE_METRIC.RECEIVE_MESSAGE);var q=e!=null?d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.RECEIVE_MESSAGE,{},e):void 0;m.LOG(l(),b,g);q==null?void 0:q.addPoint("start_media_download");e=(yield d("MAWGlobals").getDbImpls().getMsgIdByProtocolMsgId(g));if(!e.success){if(c("gkx")("23965")&&(yield n(g))){q==null?void 0:q.endSuccess();return}q==null?void 0:q.endFail(e.error);m.ERROR(k(),e.error,f);return}var r=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MEDIA_DOWNLOAD,{bool:{isTransformStreamSupported:d("WAMediaUtils").isTransformStreamSupported()},string:{chat_type:o,downloadEntry:a,e2eePlatform:d("MAWExternalId").getPlatform(g.externalId),jid:g.chat,msgType:f}}),s={addAnnotations:function(a){r.addAnnotations(a),q==null?void 0:q.addAnnotations(a)},addPoint:function(a,b){r.addPoint(a,b),q==null?void 0:q.addPoint(a,b)},endFail:function(a,b){r.endFail(a,b),q==null?void 0:q.endFail(a,b)},endSuccess:function(a){r.endSuccess(a),q==null?void 0:q.endSuccess(a)}};void d("MAWGetStorageQplAnnotations").getStorageQplAnnotations().then(function(a){s.addAnnotations(a)});o=e.value;a=d("MAWGlobals").getConfig().useMostRecentMediaEntryForDownload()?yield d("MAWGetMostRescentDecodedMediaEntry").getMostRecentDecodedMediaEntry(b):yield d("MAWGetDecodedMediaEntry").getDecodedMediaEntry(g,b);if(!a.success){s.endFail(a.error);m.ERROR(j(),a.error);yield p(o);return}f=(yield d("MAWDownloadMedia").downloadMedia({downloadMediaMetric:s,hash:b,mediaEntry:a.value,protocolMsgId:g}));if(f.success){e=f.value;a=e.mimeType;e=e.plaintext;yield d("MAWHandleMediaDownloadApi").handleMediaDownload(b,a,e,g);s.endSuccess()}else s.endFail(f.error),m.LOG(i(),o),m.ERROR(h(),f.error),yield p(o)});return function(b){return a.apply(this,arguments)}}()).end();function n(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("MAWDeletedMsgApi").getDeletedMsgByProtocolIdApi(a));return!a?!1:a.reason===d("MAWDbDeletedMessages").DbDeletedMsgReasonEnum.ChatDelete||a.reason===d("MAWDbDeletedMessages").DbDeletedMsgReasonEnum.Revoke});return o.apply(this,arguments)}function p(a){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;yield d("MAWIndexedDb").makeMsgrTransactor({chunk:(b=d("MAWTransactionMode")).READONLY,media:b.READONLY,messages:b.READWRITE,xma:b.READONLY},"downloadMedia",function(a){return function(b,c){return d("MAWDbMsgTxns").updateSystemAck(a,b,c)}})(a,d("MAWAckLevel").ACK.failed)});return q.apply(this,arguments)}g.downloadAndHandleMedia=a}),98);
__d("MAWDownloadAndRestoreMedia",["LSDataTraceCheckPoint","LSIntEnum","MAWEBBackendQPLUtils","MAWGetMediaByObjectId","MAWGlobals","MAWHandleEchoMediaMsgsRestoreV2","MAWHandleMediaDownloadAndRestoreApi","MAWTraceUtils","WALogger","WAMediaUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] downloadAndRestoreMedia job completed"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] download metadata is missing"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] media not found in the media table"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] cdn url mismatch between media entry direct path and restoration cdn url"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] media entry is missing for msgId"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] downloadAndRestoreMedia job started"]);n=function(){return a};return a}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("downloadAndRestoreMedia",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.deliveryObjectId,e=a.restorationCdnUrl;a=a.traceId;d("WALogger").LOG(n());var f=(yield d("MAWHandleMediaDownloadAndRestoreApi").writeCdnUrlAndBakeDownloadPayload(b,e));if(f){var g=(yield d("MAWGetMediaByObjectId").getMediaBackupByObjectId(b));b=(yield d("MAWGetMediaByObjectId").getMediaByObjectId(b));if(b.success&&g.success){b=b.value.mediaEntries.get(g.value.msgId);if(!b){d("WALogger").ERROR(m());d("MAWTraceUtils").recordFailureAndFlushForTraceId(a,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_MEDIA_RESTORE_FAILURE),[],"Media entry data missing for deliveryObjectId");d("MAWEBBackendQPLUtils").logMediaRestoreFromMIQPLEndFailure(a,"media_entry_missing");return}else{g=d("WAMediaUtils").decodeMediaEntryData(b);b=g==null?void 0:g.directPath;b!==e&&d("WALogger").ERROR(l());d("MAWEBBackendQPLUtils").logMediaRestoreFromMIQPLPoint(a,"download_media_start");yield d("MAWHandleEchoMediaMsgsRestoreV2").handleDownloadMedia(f,a,void 0,e,g)}}else{d("WALogger").ERROR(k());d("MAWTraceUtils").recordFailureAndFlushForTraceId(a,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_MEDIA_RESTORE_FAILURE),[],"Media data missing for deliveryObjectId");return}}else d("WALogger").ERROR(j()),d("MAWTraceUtils").recordFailureAndFlushForTraceId(a,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_MEDIA_RESTORE_FAILURE),[],"Download metadata is missing"),d("MAWEBBackendQPLUtils").logMediaRestoreFromMIQPLEndFailure(a,"media_entry_missing");d("WALogger").LOG(i())});return function(b){return a.apply(this,arguments)}}()).end();g.downloadAndRestoreMedia=a}),98);
__d("MAWWriteForwardedMsgApi",["MAWAckLevel","MAWBridgeTypesCreators","MAWBridgeXMA","MAWDbMsg","MAWDbMsgTxns","MAWDbXMATxns","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWMediaManagementTxns","MAWMsgType","MAWTransactionMode","MAWWriteMsgTxns","MAWXMAManagementTxns","MAWXMAUtils","WAJids","err"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,groupInfo:a.READONLY,media:a.READWRITE,mediaBackup:a.READWRITE,messages:a.READWRITE,participants:a.READONLY,threads:a.READWRITE,xma:a.READWRITE},"writeForwardedMsg",function(a){return function(b,c,e,f,g,k,l,m){k===void 0&&(k=!1);return d("MAWDexieTable").dexieAll([a.threads.get({jid:c}),d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,e),a.messages.where("externalId").equals(b).toArray()]).then(function(c){var n=c[0],o=c[1];c=c[2];if(n==null)return{type:"missing_thread"};if(o==null)return{type:"missing_msg"};if(o.ephemeralSetting!=null&&o.ephemeralSetting.ephemeralExpirationInSec!==0)return{type:"forwarding_ephemeral_msg"};c=c.find(function(a){return a.thread===n.chatId&&a.author===d("WAJids").AUTHOR_ME});if(c!=null)return c.ack>=d("MAWAckLevel").ACK.sent?{msgId:c.msgId,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:n.jid,externalId:c.externalId},type:"already_sent"}:{msgId:c.msgId,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:n.jid,externalId:c.externalId},type:"not_sent"};else{c={ack:d("MAWAckLevel").ACK.clock,altIndex:void 0,author:d("WAJids").AUTHOR_ME,ephemeralSetting:g!=null?g:void 0,externalId:b,forwardingScore:((c=o.forwardingScore)!=null?c:0)+1,isForwarded:o.author!==d("WAJids").AUTHOR_ME,mediaId:o.mediaId,msgContent:o.type==="Text"?o.msgContent:void 0,specialTextSize:o.specialTextSize,thread:n.chatId,threadJid:n.jid,ts:f};var p=h(o.type,c,o.type==="Text"?o.msgContent:{content:""},o.xmaMessageType);return d("MAWWriteMsgTxns").writeMsg(a,p,n,{isFirstMsg:k,openMessageParticipantCount:l,participantCount:m}).then(function(b){return d("MAWDexieTable").dexieAll([j(a,e,b,o,n.chatId,n.jid),i(a,o.mediaId,b,o,n.chatId,n.jid)]).then(function(a){return{msgId:b.msgId,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:n.jid,externalId:p.externalId},type:"not_sent"}})})}})}});function h(a,b,e,f){switch(a){case"Text":return babelHelpers["extends"]({},b,{msgContent:e,type:d("MAWMsgType").MSG_TYPE.TEXT});case"Image":return babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.IMAGE});case"Video":return babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.VIDEO});case"Ptt":return babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.PTT});case"Gif":return babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.GIF});case"Sticker":return babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.STICKER});case"DocumentFile":return babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE});case"XMA":if(f==null)throw c("err")("XMA type is null in forward msg");return babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.XMA,xmaMessageType:f});default:throw c("err")("Should not be forwarding a message of type: "+a)}}function i(a,b,e,f,g,h){b=b!=null?a.media.get({mediaId:b}):d("MAWDexieTable").dexieResolve(null);return b.then(function(b){if(b==null&&d("MAWDbMsg").isMediaMsg(e))throw c("err")("Could not find media of forwarded message");return b!=null?d("MAWMediaManagementTxns").linkMedia(a,e,b.plaintextHash,b.mediaType,b.size,b.mediaEntries.get(f.msgId),{validatedAudioInfo:b.validatedAudioInfo,validatedDocumentFileInfo:b.validatedDocumentFileInfo,validatedImageInfo:b.validatedImageInfo,validatedVideoInfo:b.validatedVideoInfo},null,null,!1).then(function(a){a!=null&&d("MAWIndexedDb").afterTransaction({tag:"NewMedia",value:d("MAWBridgeTypesCreators").createBridgeMedia(g,h,a,!0)})}):d("MAWDexieTable").dexieResolve()})}function j(a,b,e,f,g,h){return!d("MAWXMAUtils").isXMAShare(f.xmaMessageType)?d("MAWDexieTable").dexieResolve():d("MAWDbXMATxns").maybeGetXMAFromProtocolMsgId(a,b).then(function(b){if(b==null)return;var i=b.defaultPreviewMediaId,j=b.faviconMediaId,k=b.headerMediaId,l=Array.from(new Set([i,j,k].filter(Boolean)));l=l.map(function(b){return a.media.get(b).then(function(a){if(a==null)throw c("err")("Could not find media of forwarded xma message");return a})});return d("MAWDexieTable").dexieAll(l).then(function(l){l=l.map(function(b){return d("MAWMediaManagementTxns").linkMedia(a,e,b.plaintextHash,b.mediaType,b.size,b.mediaEntries.get(f.msgId),{validatedAudioInfo:b.validatedAudioInfo,validatedDocumentFileInfo:null,validatedImageInfo:b.validatedImageInfo,validatedVideoInfo:b.validatedVideoInfo},void 0,void 0,!0)});return d("MAWDexieTable").dexieAll(l).then(function(l){l=l.reduce(function(a,b){return a.set(b.mediaId,b)},new Map());var m=i==null?void 0:l.get(i);if(i==null&&!d("MAWXMAUtils").isXMAExternalLinkShare(f.xmaMessageType))throw c("err")("Preview Media is missing");l=d("MAWJidUtils").maybeToProtocolMsgId(e.author,h,e.externalId);if(l==null)throw c("err")("ProtocolMsgId is null for forward XMA Share");return d("MAWXMAManagementTxns").saveXMA(a,i,k,j,b.targetType,e.msgId,void 0,l,{defaultCTA:b.defaultCTA,headerTitle:b.headerTitle,maxSubtitleNumOfLines:b.maxSubtitleNumOfLines,maxTitleNumOfLines:b.maxTitleNumOfLines,overlayDescription:b.overlayDescription,overlayIconGlyph:b.overlayIconGlyph,overlayTitle:b.overlayTitle,subtitleText:b.subtitleText,targetExpiringAtSec:b.targetExpiringAtSec,targetId:b.targetId,targetUsername:b.targetUsername,titleText:b.titleText,xmaLayoutType:b.xmaLayoutType}).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"NewXMA",value:d("MAWBridgeXMA").createBridgeXMA(g,m,a)})})})})})}g.writeForwardedMsg=b}),98);
__d("WASendMsgUtilV2",["Promise","WABaseGlobals","WADevicesState","WAErr","WAGenReportingMeta","WAGlobals","WAJids","WAJobDefinitions","WAJobOrchestratorTypes","WAJobs","WALogger","WAMsg","WAResultOrError","WASendMsgUtil","WASentBytesCache","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error loading current device identity ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg failed to save sent bytes to cache: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Triggering getDevices for users with missing icdc info."]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to calculate ICDC info for message with id ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Trying to send a message with no recipients"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Trying to send a message that does not have a receipt in db"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to save receipt for message with error ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error during get devices before sending: ",""]);p=function(){return a};return a}function q(a){return(h||(h=b("Promise"))).resolve()}function r(a,b){return d("WADevicesState").getDevicesState().waitForUserDevices(Array.from(new Set([a,d("WABaseGlobals").getMyUserJid()])),"GetDevicesBeforeSend: "+b)}function s(a,c){return d("WAJids").switchOnChatJidType(a,{group:function(a){return q(a)},interopUser:function(a){return r(a,c)},lidUser:function(a){return r(a,c)},msgrUser:function(a){return r(a,c)},phoneUser:function(a){return r(a,c)}})["catch"](function(a){d("WALogger").ERROR(p(),a);return(h||(h=b("Promise"))).resolve()})}function t(a,c){var e,f,g,h,i,j,k,l;return b("regeneratorRuntime").async(function(m){while(1)switch(m.prev=m.next){case 0:e=a.messagePayload;f={author:e.protocolMsgId.author,chat:e.protocolMsgId.chat,externalId:e.protocolMsgId.externalId};m.next=4;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().loadReceipt(f));case 4:g=m.sent;if(!g.success){m.next=7;break}return m.abrupt("return",g);case 7:c==null?void 0:c.addPoint("get_devices_before_send_start");m.next=10;return b("regeneratorRuntime").awrap(s(e.protocolMsgId.chat,"prepareReceipt"));case 10:c==null?void 0:c.addPoint("get_devices_before_send_end");m.next=13;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().loadThreadParticipants(e.protocolMsgId.chat));case 13:h=m.sent;m.next=16;return b("regeneratorRuntime").awrap(d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return a.storage.bulkLoadIdentities(h)},{flush:!1,afterInit:!0,operationType:"prepare_receipt_load_identities"}).then(function(a){var b=new Map();for(var a=a,c=Array.isArray(a),e=0,a=c?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(c){if(e>=a.length)break;f=a[e++]}else{e=a.next();if(e.done)break;f=e.value}f=f;f[0];f=f[1];for(var f=f,g=Array.isArray(f),h=0,f=g?f:f[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var i;if(g){if(h>=f.length)break;i=f[h++]}else{h=f.next();if(h.done)break;i=h.value}i=i;var j=i[0];i=i[1];if(j===d("WAGlobals").getMyDeviceJid())continue;b.set(j,{pubKey:i})}}return b}));case 16:i=m.sent;j=new Set();k=new Map();l={permittedIdentitiesPerDevice:i,recipientDevices:j,statusTsPerUser:k,id:f};m.next=22;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().saveReceipt(l)["catch"](function(a){d("WALogger").ERROR(o(),a);return d("WAResultOrError").makeError("missing-receipt")}));case 22:return m.abrupt("return",d("WAResultOrError").makeResult(l));case 23:case"end":return m.stop()}},null,this)}function a(a,c){var e,f,g,i,o,p,q,r,s,w,x,y,z,A,B,C,D,E,F,G,H,I;return b("regeneratorRuntime").async(function(J){while(1)switch(J.prev=J.next){case 0:e=a.messagePayload,f=a.sendIdentity,g=f===void 0?!1:f,i=a.isInstamadillo,o=i===void 0?!1:i;J.next=3;return b("regeneratorRuntime").awrap(t({messagePayload:e},c));case 3:p=J.sent;if(!(p.success===!1)){J.next=7;break}d("WALogger").ERROR(n());return J.abrupt("return",d("WAResultOrError").makeError("missing-receipt"));case 7:q=p.value;r=e.frankingKey,s=e.frankingVersion,w=e.messageBytes,x=e.messageType,y=e.protocolMsgId;z=u(q.permittedIdentitiesPerDevice);A=x.type==="text"&&x.invitedParticipantUserJid!=null?z.filter(function(a){return a.user===x.invitedParticipantUserJid||a.user===d("WABaseGlobals").getMyUserJid()}):z;c==null?void 0:c.addPoint("recipients-calculated",{"int":{recipientsCount:A.length},string:{msgType:x.type}});B=x.type==="text"&&x.invitedParticipantUserJid!=null?x.invitedParticipantUserJid:y.chat;if(!(A.length===0)){J.next=16;break}d("WALogger").ERROR(m());return J.abrupt("return",d("WAResultOrError").makeError("no-recipients"));case 16:J.next=18;return b("regeneratorRuntime").awrap(d("WAGlobals").getWaOneQueue().enqueue(function(d){var e,a,c;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:e=d.cryptoManager;f.next=3;return b("regeneratorRuntime").awrap(e.storage.calculateICDC(A.map(function(a){return a.user})));case 3:a=f.sent;if(!g){f.next=10;break}f.next=7;return b("regeneratorRuntime").awrap(v(e));case 7:f.t0=f.sent;f.next=11;break;case 10:f.t0=null;case 11:c=f.t0;return f.abrupt("return",{icdcInfoResult:a,deviceIdentity:c});case 13:case"end":return f.stop()}},null,this)},{operationType:"calc_icdc",flush:!0,afterInit:!0}));case 18:C=J.sent;D=C.icdcInfoResult;E=C.deviceIdentity;D.success===!1&&d("WALogger").ERROR(l(),y.externalId);F=D.success?D.value:{icdcInfo:[],usersWithMissingICDC:new Set()},G=F.icdcInfo,H=F.usersWithMissingICDC;if(!(H.size>0)){J.next=27;break}d("WALogger").LOG(k());J.next=27;return b("regeneratorRuntime").awrap(d("WAJobs").getJobManager().waitUntilPersisted(d("WAJobDefinitions").createStartJobInfo("getDevices",{ignoreDhash:!0,reason:"missing-icdc-info",scheduleConfig:{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH},users:H})));case 27:J.next=29;return b("regeneratorRuntime").awrap(x.isRevoked===!0?(h||(h=b("Promise"))).resolve(null):d("WAGenReportingMeta").genReportingMeta(w.bytes,r,s));case 29:I=J.sent;return J.abrupt("return",d("WASendMsgUtil").sendMessage({type:"chat",messageBytes:w,chat:B,deviceIdentity:E,messageType:x,protocolMsgId:y,externalId:y.externalId,icdcInfo:G,recipients:A,reportingMeta:I},c,o).then(function(a){if(a.success)return d("WASentBytesCache").sentBytesCache().saveSentBytes({ts:a.value.serverTs,frankingKey:r,frankingVersion:s,messageBytes:w,messageType:x,protocolMsgId:y,waMsgId:d("WAMsg").craftWAMsgIdString({author:y.author,chat:y.chat,externalId:y.externalId})})["catch"](function(a){d("WALogger").ERROR(j(),a)}).then(function(){return d("WAResultOrError").makeResult({baseKey:a.value.baseKey,reportingMeta:I,serverTs:a.value.serverTs})});else return a}));case 31:case"end":return J.stop()}},null,this)}function u(a){var b=new Map();a.forEach(function(a,c){a=a.pubKey;var e=d("WAJids").extractUserJid(c);a={identity:a,jid:c};c=b.get(e)||[];c.push(a);b.set(e,c)});return Array.from(b,function(a){var b=a[0];a=a[1];return{devicesInfo:a,user:b}})}function v(a){var e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:g.prev=0;g.next=3;return b("regeneratorRuntime").awrap(a.storage.loadIdentities(d("WABaseGlobals").getMyUserJid()));case 3:e=g.sent;f=e.get(d("WAGlobals").getMyDeviceJid());if(!(f!=null)){g.next=7;break}return g.abrupt("return",f);case 7:throw c("WAErr")("missing-identity");case 10:g.prev=10,g.t0=g["catch"](0),d("WALogger").ERROR(i(),g.t0);case 13:case"end":return g.stop()}},null,this,[[0,10]])}g.getDevicesBeforeSend=s;g.sendChatMessage=a}),98);
__d("MAWForwardMsg",["MAWGlobals","MAWJobDefinitions","MAWQplProxy","MAWWriteForwardedMsgApi","MWQPLMarkers","WAJobOrchestratorTypes","WALogger","WASendMsgUtilV2","asyncToGeneratorRuntime","qpl"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["forwardMsg cannot forward an ephemeral message"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["forwardMsg cannot forward a non-existent message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["forwardMsg cannot send to a non-existent thread"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["forwardMsg already sent message"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["forwardMsg: ",""]);l=function(){return a};return a}var m=function(a){return function(b){if(a==null)return;d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),b,{instanceKey:a})}};a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("saveAndPassOff",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e=a.chatJid,f=a.ephemeralSetting,g=a.externalId;a=a.protocolMsgId;b=b.args;d("WALogger").DEV(l(),e);var n=m(b==null?void 0:b.s2sInstanceKey);yield d("WASendMsgUtilV2").getDevicesBeforeSend(e,"ForwadMsg");g=(yield d("MAWWriteForwardedMsgApi").writeForwardedMsg(g,e,a,c.jobStartTime,f));if(g.type==="already_sent"){d("WALogger").LOG(k());return}else if(g.type==="missing_thread"){d("WALogger").LOG(j());return}else if(g.type==="missing_msg"){d("WALogger").LOG(i());return}else if(g.type==="forwarding_ephemeral_msg"){d("WALogger").LOG(h());return}n(d("MWQPLMarkers").MESSAGE_SEND_TO_SENT.FORWARDED_MESSAGE_WRITTEN);yield d("MAWGlobals").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").createStartJobInfo("sendWrittenMsg",{protocolMsgId:g.protocolMsgId,s2sInstanceKey:b==null?void 0:b.s2sInstanceKey,scheduleConfig:{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},type:"message"}))});return function(b,c,d){return a.apply(this,arguments)}}()).end();g.forwardMsg=a}),98);
__d("MAWGetSpams",["MAWGlobals","WADeprecatedSendIq","WADeprecatedWapParser","WALogger","WAPersistedJobManager","WATimeUtils","WAWap","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["getSpams result: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["getSpams called"]);i=function(){return a};return a}var j=new(c("WADeprecatedWapParser"))("getSpamsResponse",function(a){a.assertTag("iq"),a.assertFromServer(),a.assertAttr("type","result")});a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("getSpams",b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a;d("WALogger").LOG(i());a=(a=d("WAWap")).wap("iq",{id:a.generateId(),to:a.S_WHATSAPP_NET,type:"get",xmlns:"fbid:thread"},a.wap("spam_request",null));a=(yield d("WADeprecatedSendIq").deprecatedSendIq(a,j));d("WALogger").LOG(h(),a);if(!a.success){a=a.errorCode.toString().startsWith("5");if(a)throw new(d("WAPersistedJobManager").RetryOnBackoff)({algo:{first:d("WATimeUtils").HOUR_MILLISECONDS/60,type:"exponential"},jitter:.1});return!1}return!0})).end();g.getSpams=a}),98);
__d("MAWProcessFutureproofMsgApi",["MAWConvertFutureproofMsgTxns","MAWDbMsgTxns","MAWDbMsgTypeVersionTxns","MAWDbThreadTxns","MAWDexieTable","MAWIndexedDb","MAWMsgType","MAWTransactionMode","MAWUnstoredContentToUnstoredDbContentUtils","WAArrayZip","WADecodeIncomingMsg","WAJids","WALogger","WAParseV3Protocol"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["processFutureProofMsgs doesn't support system message for ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["processFutureProofMsgs called for instamadillo"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["processFutureProofMsgs called for ephemeral setting msg"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["processFutureProofMsgs called for skdm"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["processFutureProofMsgs tried to decode non plaintext v3 message ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["processFutureProofMsgs get a futureproof message for ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["processFutureProofMsgs got error for message ",", delete this message"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["processFutureProofMsgs thread for "," no longer exists"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["processFutureProofMsgs get a futureproof message for ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["processFutureProofMsgs got error for message ",", delete this message"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["processFutureProofMsgs thread for "," no longer exists"]);r=function(){return a};return a}var s=d("WAParseV3Protocol").createV3ProtocolParser();b=d("MAWIndexedDb").makeMsgrTransactor({appMeta:(a=d("MAWTransactionMode")).READWRITE,chunk:a.READONLY,groupInfo:a.READONLY,media:a.READWRITE,mediaBackup:a.READWRITE,messages:a.READWRITE,threads:a.READWRITE,xma:a.READONLY},"processFutureProofMsgs",function(a){return function(b){return d("MAWDbMsgTypeVersionTxns").getMsgTypeVersion(a).then(function(c){var e=[];if(c!=null&&c<b){d("MAWDbMsgTypeVersionTxns").updateMsgTypeVersion(a,b);return d("MAWDbMsgTxns").getFutureProofMsgs(a).then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){return d("MAWDbThreadTxns").getThread(a,b.thread).then(function(c){if(!c.success){d("WALogger").WARN(r(),b.thread);return}c=c.value;var f=t(b,c.jid);if(!f||d("WAJids").isAuthorSystem(f.author))return;if(f.msg.type==="error"){d("WALogger").WARN(q(),b.msgId);return d("MAWDbMsgTxns").deleteDbMsg(a,b.rowId).then(function(){})}f=s(f.msg,c.jid,f.externalId,f.author,f.ts);f=d("MAWUnstoredContentToUnstoredDbContentUtils").unstoredContentToUnstoredDbContent(babelHelpers["extends"]({unstoredXMA:null},f));var g=f.unstoredDbMedia;f=f.unstoredDbMsg;if(!f)return;if(f.type===d("MAWMsgType").MSG_TYPE.FUTUREPROOF){d("WALogger").WARN(p(),b.msgId);return}return d("MAWConvertFutureproofMsgTxns").convertFutureproofMsg(a,f,b,g,c).then(function(a){a!=null&&e.push(a)})})}))}).then(function(){return e})}else if(c==null)return d("MAWDbMsgTypeVersionTxns").addMsgTypeVersion(a,1).then(function(){return e});return e})}});c=d("MAWIndexedDb").makeMsgrTransactor({appMeta:a.READWRITE,chunk:a.READONLY,deletedMessages:a.READWRITE,groupInfo:a.READONLY,media:a.READWRITE,mediaBackup:a.READWRITE,messages:a.READWRITE,threads:a.READWRITE,xma:a.READONLY},"bulkProcessFutureProofMsgs",function(a){return function(b){return d("MAWDbMsgTypeVersionTxns").getMsgTypeVersion(a).then(function(c){if(c!=null&&c<b){d("MAWDbMsgTypeVersionTxns").updateMsgTypeVersion(a,b);var e=[],f=new Map();return d("MAWDbMsgTxns").getFutureProofMsgs(a).then(function(b){return d("MAWDbThreadTxns").getThreads(a,b.map(function(a){return a.thread})).then(function(a){d("WAArrayZip").zip(b,a).forEach(function(a){var b=a[0];a=a[1];if(a==null){d("WALogger").WARN(o(),b.thread);return}var c=t(b,a.jid);if(!c||d("WAJids").isAuthorSystem(c.author))return;if(c.msg.type==="error")d("WALogger").WARN(n(),b.msgId),e.push(b);else{c=s(c.msg,a.jid,c.externalId,c.author,c.ts);c=d("MAWUnstoredContentToUnstoredDbContentUtils").unstoredContentToUnstoredDbContent(babelHelpers["extends"]({unstoredXMA:null},c));var g=c.unstoredDbMedia;c=c.unstoredDbMsg;if(!c)return;if(c.type===d("MAWMsgType").MSG_TYPE.FUTUREPROOF){d("WALogger").WARN(m(),b.msgId);return}f.set(b.msgId,{dbMsg:b,thread:a,unstoredDbMedia:g,unstoredDbMsg:c})}})}).then(function(){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").deleteMessages(a,e),d("MAWConvertFutureproofMsgTxns").bulkConvertFutureproofMsgs(a,f)]).then(function(a){a[0];a=a[1];return a.filter(Boolean)})})})}else if(c==null)return d("MAWDbMsgTypeVersionTxns").addMsgTypeVersion(a,1).then(function(){return[]});return[]})}});function t(a,b){var c=d("WADecodeIncomingMsg").decodeIncomingMsg(new Uint8Array(a.msgContent.protobuf),"v3",a.author===d("WAJids").AUTHOR_ME?b:null);if(c.version!=="v3"){d("WALogger").WARN(l(),a.msgId);return null}else if(c.type==="skdm"||c.type==="msgWithSKDM"){d("WALogger").WARN(k());return null}else if(c.type==="ephemeral"){d("WALogger").WARN(j());return null}else if(c.type==="instamadillo"){d("WALogger").WARN(i());return null}var e=a.author;if(d("WAJids").isAuthorSystem(e)){d("WALogger").WARN(h(),a.msgId);return null}return{author:e,chat:b,externalId:a.externalId,msg:c,ts:a.ts}}g.processFutureProofMsgs=b;g.bulkProcessFutureProofMsgs=c}),98);
__d("MAWHandleFutureProofMsg",["MAWGlobals","MAWJobDefinitions","MAWProcessFutureproofMsgApi","Promise","asyncToGeneratorRuntime","promiseDone","qex"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=c("qex")._("401")?yield d("MAWProcessFutureproofMsgApi").bulkProcessFutureProofMsgs(d("MAWGlobals").getConfig().supportedTypesVersion()):yield d("MAWProcessFutureproofMsgApi").processFutureProofMsgs(d("MAWGlobals").getConfig().supportedTypesVersion()),e=[];a.forEach(function(a){e.push(d("MAWGlobals").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").jobSerializers.downloadAndHandleMedia(a.protocolMsgId,a.plaintextHash,"MAWHandleFutureproofMsg")))});c("promiseDone")((h||(h=b("Promise"))).all(e))});return function(){return a.apply(this,arguments)}}();e=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("checkMessageTypeUpdateAndHandleMsg",a).end();g.handleFutureproofMsg=e}),98);
__d("MAWHandleSpamMsg",["MAWGlobals","WALogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleSpamMsg processed spam msgs"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleSpamMsg starts processing spam msgs"]);i=function(){return a};return a}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("updateAndHandleMsg",b("asyncToGeneratorRuntime").asyncToGenerator(function*(){d("WALogger").DEV(i()),yield d("MAWGlobals").getDbImpls().processSpamMsgs(),d("WALogger").DEV(h())})).end();g.handleSpamMsg=a}),98);
__d("MAWDeletePersonalSenderKeyStatusApi",["MAWDbPersonalSenderKeyStatusTxns","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeSignalTransactor({personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE},"deletePersonalSenderKeyStatus",function(a){return function(b){return d("MAWDbPersonalSenderKeyStatusTxns").bulkDeletePersonalSenderKeyStatus(a,b)}});g.deletePersonalSenderKeyStatus=a}),98);
__d("MAWLeaveGroupsApi",["MAWDbGroupInfoTxns","MAWDbParticipantTxns","MAWDbThreadTxns","MAWDexieTable","MAWGlobals","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({groupInfo:d("MAWTransactionMode").READONLY,participants:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE},"leaveGroups",function(a){return function(){for(var b=arguments.length,c=new Array(b),d=0;d<b;d++)c[d]=arguments[d];return h.apply(void 0,[a].concat(c))}});function h(a,b){var c=b.groupJids;return d("MAWDbGroupInfoTxns").getGroupInfos(a,c).then(function(b){b=b.filter(Boolean);b=b.map(function(a){return a.threadId});var e=d("MAWGlobals").getMyUserJid();return d("MAWDexieTable").dexieAll([d("MAWDbParticipantTxns").bulkDeleteParticipantAcrossThreads(a,c,e),d("MAWDbThreadTxns").archiveThreads(a,b,!0)]).then(function(){})})}g.leaveGroups=a}),98);
__d("WASmaxInGroupsLeaveClientErrors",["WAResultOrError","WASmaxInGroupsIQErrorBadRequestMixin","WASmaxInGroupsIQErrorFallbackClientMixin","WASmaxInGroupsIQErrorForbiddenMixin","WASmaxInGroupsIQErrorItemNotFoundMixin","WASmaxInGroupsIQErrorLockedMixin","WASmaxInGroupsIQErrorNotAuthorizedMixin","WASmaxInGroupsIQErrorRateOverlimitMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsIQErrorRateOverlimitMixin").parseIQErrorRateOverlimitMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorRateOverlimit",value:b.value});var c=d("WASmaxInGroupsIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:c.value});var e=d("WASmaxInGroupsIQErrorItemNotFoundMixin").parseIQErrorItemNotFoundMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"IQErrorItemNotFound",value:e.value});var f=d("WASmaxInGroupsIQErrorNotAuthorizedMixin").parseIQErrorNotAuthorizedMixin(a);if(f.success)return d("WAResultOrError").makeResult({name:"IQErrorNotAuthorized",value:f.value});var g=d("WASmaxInGroupsIQErrorForbiddenMixin").parseIQErrorForbiddenMixin(a);if(g.success)return d("WAResultOrError").makeResult({name:"IQErrorForbidden",value:g.value});var h=d("WASmaxInGroupsIQErrorLockedMixin").parseIQErrorLockedMixin(a);if(h.success)return d("WAResultOrError").makeResult({name:"IQErrorLocked",value:h.value});var i=d("WASmaxInGroupsIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(a);return i.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackClient",value:i.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorRateOverlimit","IQErrorBadRequest","IQErrorItemNotFound","IQErrorNotAuthorized","IQErrorForbidden","IQErrorLocked","IQErrorFallbackClient"],[b,c,e,f,g,h,i])}g.parseLeaveClientErrors=a}),98);
__d("WASmaxInGroupsLeaveResponseClientError",["WAResultOrError","WASmaxInGroupsIQErrorResponseMixin","WASmaxInGroupsLeaveClientErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInGroupsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInGroupsLeaveClientErrors").parseLeaveClientErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorLeaveClientErrors:b.value}))}g.parseLeaveResponseClientError=a}),98);
__d("WASmaxInGroupsLeaveResponseServerError",["WASmaxInGroupsBaseServerErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInGroupsBaseServerErrorMixin").parseBaseServerErrorMixin(a,b);return!c.success?c:c}g.parseLeaveResponseServerError=a}),98);
__d("WASmaxInGroupsLeaveGroupNotAllowedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"group");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","405");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseLeaveGroupNotAllowedMixin=a}),98);
__d("WASmaxInGroupsLeaveGroupServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"group");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","500");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseLeaveGroupServerErrorMixin=a}),98);
__d("WASmaxInGroupsLeaveGroupNotAllowedOrServerErrorMixinGroup",["WAResultOrError","WASmaxInGroupsLeaveGroupNotAllowedMixin","WASmaxInGroupsLeaveGroupServerErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsLeaveGroupNotAllowedMixin").parseLeaveGroupNotAllowedMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"LeaveGroupNotAllowed",value:b.value});var c=d("WASmaxInGroupsLeaveGroupServerErrorMixin").parseLeaveGroupServerErrorMixin(a);return c.success?d("WAResultOrError").makeResult({name:"LeaveGroupServerError",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["LeaveGroupNotAllowed","LeaveGroupServerError"],[b,c])}g.parseLeaveGroupNotAllowedOrServerErrorMixinGroup=a}),98);
__d("WASmaxInGroupsLeaveLinkedGroupsBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"linked_groups");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","400");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseLeaveLinkedGroupsBadRequestMixin=a}),98);
__d("WASmaxInGroupsLeaveLinkedGroupsNotAllowedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"linked_groups");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","405");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseLeaveLinkedGroupsNotAllowedMixin=a}),98);
__d("WASmaxInGroupsLeaveLinkedGroupsServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"linked_groups");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","500");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseLeaveLinkedGroupsServerErrorMixin=a}),98);
__d("WASmaxInGroupsLeaveLinkedGroupsBadRequestOrNotAllowedOrServerErrorMixinGroup",["WAResultOrError","WASmaxInGroupsLeaveLinkedGroupsBadRequestMixin","WASmaxInGroupsLeaveLinkedGroupsNotAllowedMixin","WASmaxInGroupsLeaveLinkedGroupsServerErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsLeaveLinkedGroupsBadRequestMixin").parseLeaveLinkedGroupsBadRequestMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"LeaveLinkedGroupsBadRequest",value:b.value});var c=d("WASmaxInGroupsLeaveLinkedGroupsNotAllowedMixin").parseLeaveLinkedGroupsNotAllowedMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"LeaveLinkedGroupsNotAllowed",value:c.value});var e=d("WASmaxInGroupsLeaveLinkedGroupsServerErrorMixin").parseLeaveLinkedGroupsServerErrorMixin(a);return e.success?d("WAResultOrError").makeResult({name:"LeaveLinkedGroupsServerError",value:e.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["LeaveLinkedGroupsBadRequest","LeaveLinkedGroupsNotAllowed","LeaveLinkedGroupsServerError"],[b,c,e])}g.parseLeaveLinkedGroupsBadRequestOrNotAllowedOrServerErrorMixinGroup=a}),98);
__d("WASmaxInGroupsParentGroupMixin",["WAResultOrError","WASmaxParseJid"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseJid").attrGroupJid(a,"parent_group_jid");return!a.success?a:d("WAResultOrError").makeResult({parentGroupJid:a.value})}g.parseParentGroupMixin=a}),98);
__d("WASmaxInGroupsLeaveResponseSuccess",["WAResultOrError","WASmaxInGroupsIQResultResponseMixin","WASmaxInGroupsLeaveGroupNotAllowedOrServerErrorMixinGroup","WASmaxInGroupsLeaveLinkedGroupsBadRequestOrNotAllowedOrServerErrorMixinGroup","WASmaxInGroupsParentGroupMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"group");if(!b.success)return b;b=d("WASmaxParseJid").attrGroupJid(a,"id");if(!b.success)return b;a=d("WASmaxInGroupsLeaveGroupNotAllowedOrServerErrorMixinGroup").parseLeaveGroupNotAllowedOrServerErrorMixinGroup(a);return d("WAResultOrError").makeResult({id:b.value,leaveGroupNotAllowedOrServerErrorMixinGroup:a.success?a.value:null})}function i(a){var b=d("WASmaxParseUtils").assertTag(a,"linked_groups");if(!b.success)return b;b=d("WASmaxInGroupsParentGroupMixin").parseParentGroupMixin(a);if(!b.success)return b;a=d("WASmaxInGroupsLeaveLinkedGroupsBadRequestOrNotAllowedOrServerErrorMixinGroup").parseLeaveLinkedGroupsBadRequestOrNotAllowedOrServerErrorMixinGroup(a);return d("WAResultOrError").makeResult(babelHelpers["extends"]({},b.value,{leaveLinkedGroupsBadRequestOrNotAllowedOrServerErrorMixinGroup:a.success?a.value:null}))}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"leave");if(!c.success)return c;a=d("WASmaxInGroupsIQResultResponseMixin").parseIQResultResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"group",0,1024,h);if(!b.success)return b;c=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"linked_groups",0,1024,i);return!c.success?c:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{leaveGroup:b.value,leaveLinkedGroups:c.value}))}g.parseLeaveResponseSuccessLeaveGroup=h;g.parseLeaveResponseSuccessLeaveLinkedGroups=i;g.parseLeaveResponseSuccess=a}),98);
__d("WASmaxOutGroupsBaseSetServerMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutGroupsBaseIQSetRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxOutGroupsBaseIQSetRequestMixin").mergeBaseIQSetRequestMixin(d("WASmaxJsx").smax("iq",{to:d("WAWap").G_US,xmlns:"w:g2"}));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseSetServerMixin=a}),98);
__d("WASmaxOutGroupsParentGroupMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.anyParentGroupJid;a=d("WASmaxJsx").smax("smax$any",{parent_group_jid:d("WAWap").GROUP_JID(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeParentGroupMixin=a}),98);
__d("WASmaxOutGroupsLeaveLeaveGroupsRequestMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutGroupsParentGroupMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.groupId;a=d("WASmaxJsx").smax("group",{id:d("WAWap").GROUP_JID(a)});return a}function i(a){a=d("WASmaxOutGroupsParentGroupMixin").mergeParentGroupMixin(d("WASmaxJsx").smax("linked_groups",null),a);return a}function j(a){var b=a.groupArgs;a=a.linkedGroupsArgs;b=d("WASmaxJsx").smax("leave",null,[].concat(d("WASmaxChildren").REPEATED_CHILD(h,b,1,1024),d("WASmaxChildren").REPEATED_CHILD(i,a,0,1024)));return b}function a(a,b){b=j(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeLeaveLeaveGroupsRequestGroup=h;g.makeLeaveLeaveGroupsRequestLinkedGroups=i;g.mergeLeaveLeaveGroupsRequestMixin=a}),98);
__d("WASmaxOutGroupsLeaveLeaveLinkedGroupsRequestMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutGroupsParentGroupMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.groupId;a=d("WASmaxJsx").smax("group",{id:d("WAWap").GROUP_JID(a)});return a}function i(a){a=d("WASmaxOutGroupsParentGroupMixin").mergeParentGroupMixin(d("WASmaxJsx").smax("linked_groups",null),a);return a}function j(a){var b=a.groupArgs;a=a.linkedGroupsArgs;b=d("WASmaxJsx").smax("leave",null,[].concat(d("WASmaxChildren").REPEATED_CHILD(h,b,0,1024),d("WASmaxChildren").REPEATED_CHILD(i,a,1,1024)));return b}function a(a,b){b=j(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeLeaveLeaveLinkedGroupsRequestGroup=h;g.makeLeaveLeaveLinkedGroupsRequestLinkedGroups=i;g.mergeLeaveLeaveLinkedGroupsRequestMixin=a}),98);
__d("WASmaxOutGroupsLeaveLeaveLinkedOrLeaveGroupsRequestMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutGroupsLeaveLeaveGroupsRequestMixin","WASmaxOutGroupsLeaveLeaveLinkedGroupsRequestMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.leaveLeaveLinkedGroupsRequest)return d("WASmaxOutGroupsLeaveLeaveLinkedGroupsRequestMixin").mergeLeaveLeaveLinkedGroupsRequestMixin(a,b.leaveLeaveLinkedGroupsRequest);if(b.leaveLeaveGroupsRequest)return d("WASmaxOutGroupsLeaveLeaveGroupsRequestMixin").mergeLeaveLeaveGroupsRequestMixin(a,b.leaveLeaveGroupsRequest);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeLeaveLeaveLinkedOrLeaveGroupsRequestMixinGroup=a}),98);
__d("WASmaxOutGroupsLeaveRequest",["WASmaxJsx","WASmaxOutGroupsBaseSetServerMixin","WASmaxOutGroupsLeaveLeaveLinkedOrLeaveGroupsRequestMixinGroup"],(function(a,b,c,d,e,f,g){function a(a){a=a.leaveLeaveLinkedOrLeaveGroupsRequestMixinGroupArgs;a=d("WASmaxOutGroupsBaseSetServerMixin").mergeBaseSetServerMixin(d("WASmaxJsx").smax("iq",null,d("WASmaxOutGroupsLeaveLeaveLinkedOrLeaveGroupsRequestMixinGroup").mergeLeaveLeaveLinkedOrLeaveGroupsRequestMixinGroup(d("WASmaxJsx").smax("leave",null),a)));return a}g.makeLeaveRequest=a}),98);
__d("WASmaxGroupsLeaveRPC",["WAComms","WASmaxInGroupsLeaveResponseClientError","WASmaxInGroupsLeaveResponseServerError","WASmaxInGroupsLeaveResponseSuccess","WASmaxOutGroupsLeaveRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:e=d("WASmaxOutGroupsLeaveRequest").makeLeaveRequest(a);j.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=j.sent;g=d("WASmaxInGroupsLeaveResponseSuccess").parseLeaveResponseSuccess(f,e);if(!g.success){j.next=7;break}return j.abrupt("return",{name:"LeaveResponseSuccess",value:g.value});case 7:h=d("WASmaxInGroupsLeaveResponseServerError").parseLeaveResponseServerError(f,e);if(!h.success){j.next=10;break}return j.abrupt("return",{name:"LeaveResponseServerError",value:h.value});case 10:i=d("WASmaxInGroupsLeaveResponseClientError").parseLeaveResponseClientError(f,e);if(!i.success){j.next=13;break}return j.abrupt("return",{name:"LeaveResponseClientError",value:i.value});case 13:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("Leave",{Success:g,ServerError:h,ClientError:i}));case 14:case"end":return j.stop()}},null,this)}g.sendLeaveRPC=a}),98);
__d("MAWLeaveGroups",["MAWDeletePersonalSenderKeyStatusApi","MAWGlobals","MAWLeaveGroupsApi","MAWODSProxy","WAOdsEnums","WASmaxGroupsLeaveRPC","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.groups;if(a.length===0)return;a=(yield d("WASmaxGroupsLeaveRPC").sendLeaveRPC({leaveLeaveLinkedOrLeaveGroupsRequestMixinGroupArgs:{leaveLeaveGroupsRequest:{groupArgs:a.map(function(a){return{groupId:a}})}}}));if(a.name!=="LeaveResponseSuccess"){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.GROUP_LEAVE_PARTICIPANT,key:"fail"});throw c("err")("Failed to parse leaveGroups response")}d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.GROUP_LEAVE_PARTICIPANT,key:"success"});a=a.value;a=a.leaveGroup.map(function(a){return a.id});yield d("MAWLeaveGroupsApi").leaveGroups({groupJids:a});yield d("MAWDeletePersonalSenderKeyStatusApi").deletePersonalSenderKeyStatus(a)});return i.apply(this,arguments)}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("leaveGroups",function(a){a=a.groups;return h({groups:a})}).end();g.leaveGroupsStep=h;g.leaveGroups=a}),98);
__d("MAWMarkThreadAsRead",["MAWDbMsgTxns","MAWEphemeralGatingUtil","MAWGetUnreadMsgsApi","MAWGetUnreadMsgsApi__DONOTUSE","MAWGlobals","MAWMarkReadReceiptsSentUpToApi","MAWMarkThreadAsReadUpToApi","MAWMessageRequestUtils","MAWUpdateEphemeralityOnMarkMsgsFromOtherAsReadApi","Promise","WADeprecatedSendIq","WAJids","WALogger","WAPromiseQueue","WAWap","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["markThreadAsRead skips sending receipts for ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["markThreadAsRead skips sending receipts for ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["markThreadAsRead skips sending receipts for ",""]);k=function(){return a};return a}var l=256,m=new(d("WAPromiseQueue").PromiseQueueMap)();a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("markThreadAsRead",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){var f=a.chatJid;c=a.isReadReceiptsDisabled;var g=c===void 0?!1:c;c=a.relationship;a=a.upTo;var h=e.interruptJob,o=e.jobStartTime;e=(yield d("MAWMarkThreadAsReadUpToApi").markThreadAsReadUpTo(f,a));if(c!=null&&d("MAWMessageRequestUtils").isInboxRequest(e.folder,c)){d("WALogger").DEV(k(),f);return h()}if(e.type==="missing"){d("WALogger").DEV(j(),f);return h()}if(!e.isReadReceiptExpectedToBeSent){d("WALogger").DEV(i(),f);return h()}e.type;return m.enqueue(String(f),b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=!0;while(a){var b=d("MAWDbMsgTxns").IS_SORT_ORDER_COMPARISON_ENABLED?yield d("MAWGetUnreadMsgsApi").getUnreadMsgs(f,l,g):yield d("MAWGetUnreadMsgsApi__DONOTUSE").getUnreadMsgs__DONOTUSE(f,l,g);if(b.type!=="found"){b.type;break}var c=b.loadedUpTo,e=b.unreadMsgs;yield n(e,o);d("MAWEphemeralGatingUtil").isSendBasedDisappearingMessageEnabled()||(yield d("MAWUpdateEphemeralityOnMarkMsgsFromOtherAsReadApi").updateEphemeralityOnMarkMsgsFromOtherAsRead(e,o));yield d("MAWMarkReadReceiptsSentUpToApi").markReadReceiptsSentUpTo(f,c);a=b.maybeMore}}))});return function(b,c,d){return a.apply(this,arguments)}}()).end();function n(a,e){if(a.length===0)return(h||(h=b("Promise"))).resolve();var f=a[0].chat;return d("WAJids").switchOnChatJidType(f,{group:function(c){var g=d("WAWap").GROUP_JID(c),i=new Map();a.forEach(function(a){var b=a.author,c=i.get(b)||[];c.push(a.externalId);i.set(b,c)});var j=[];i.forEach(function(a,b){j.push(o(g,f,a,b,e))});return(h||(h=b("Promise"))).all(j)},interopUser:function(a){throw c("err")("InteropUserJid is not supported yet")},lidUser:function(a){throw c("err")("LidUserJid is not supported yet")},msgrUser:function(b){b=d("WAWap").USER_JID(b);var c=a.map(function(a){return a.externalId});return o(b,f,c,null,e)},phoneUser:function(a){throw c("err")("PhoneUserJid is not supported yet")}}).then(function(){})}function o(a,b,c,e,f){var g=null;c.length>1&&(g=d("WAWap").wap("list",null,c.slice(1).map(function(a){return d("WAWap").wap("item",{id:d("WAWap").CUSTOM_STRING(a)})})));c=c[0];f=d("WAWap").wap("receipt",{id:d("WAWap").CUSTOM_STRING(c),participant:e!=null?d("WAWap").USER_JID(e):d("WAWap").DROP_ATTR,t:d("WAWap").CUSTOM_STRING(String(f)),to:a,type:"read"},g);return d("WADeprecatedSendIq").deprecatedSendStanzaAndWaitForAck(f,{"class":"receipt",from:b,id:c,participant:e!=null?d("WAJids").defaultDeviceJidForUser(e):null,type:"read"})}g.markThreadAsRead=a}),98);
__d("MAWPromoteGroupParticipants",["MAWGlobals","MAWODSProxy","WAChangeGroupParticipantAdminStatusApi","WAGlobals","WAJids","WAOdsEnums","WAPromoteDemoteGroupParticipantProtocol","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("promoteGroupParticipants",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.group;a=a.users;var c=d("WAGlobals").getJidUtilsApi(),e=c.toUserJid;c=a.map(function(a){return e(a)});if(c.length===0)return d("WAResultOrError").makeResult({groupJid:b,participants:[],type:"default"});a=(yield d("WAPromoteDemoteGroupParticipantProtocol").promoteGroupParticipantsProtocol({group:b,participants:c}));if(!a.success){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.GROUP_PROMOTE_PARTICIPANT,key:"fail"});return d("WAResultOrError").makeError(a.error.type)}d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.GROUP_PROMOTE_PARTICIPANT,key:"success"});c=a.value.participants.filter(function(a){a=a.result;return a.success}).map(function(a){a=a.user;return{addressable:!0,type:"participant",user:a}})||[];yield d("WAChangeGroupParticipantAdminStatusApi").changeGroupParticipantAdminStatus(null,b,d("WAJids").AUTHOR_ME,c,"admin");a=(yield d("MAWGlobals").getJobResultConvertersImpls().convertPromoteGroupParticipantsResult==null?void 0:d("MAWGlobals").getJobResultConvertersImpls().convertPromoteGroupParticipantsResult(b,c));return a?d("WAResultOrError").makeResult(a):d("WAResultOrError").makeResult({groupJid:b,participants:c,type:"default"})});return function(b){return a.apply(this,arguments)}}()).end();g.promoteGroupParticipants=a}),98);
__d("WASmaxInGroupsIQErrorPayloadTooLargeMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","payload-too-large");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",413);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorPayloadTooLargeMixin=a}),98);
__d("WASmaxInGroupsRemoveParticipantsClientErrors",["WAResultOrError","WASmaxInGroupsIQErrorBadRequestMixin","WASmaxInGroupsIQErrorFallbackClientMixin","WASmaxInGroupsIQErrorForbiddenMixin","WASmaxInGroupsIQErrorItemNotFoundMixin","WASmaxInGroupsIQErrorLockedMixin","WASmaxInGroupsIQErrorNotAuthorizedMixin","WASmaxInGroupsIQErrorPayloadTooLargeMixin","WASmaxInGroupsIQErrorRateOverlimitMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsIQErrorRateOverlimitMixin").parseIQErrorRateOverlimitMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorRateOverlimit",value:b.value});var c=d("WASmaxInGroupsIQErrorPayloadTooLargeMixin").parseIQErrorPayloadTooLargeMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorPayloadTooLarge",value:c.value});var e=d("WASmaxInGroupsIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:e.value});var f=d("WASmaxInGroupsIQErrorItemNotFoundMixin").parseIQErrorItemNotFoundMixin(a);if(f.success)return d("WAResultOrError").makeResult({name:"IQErrorItemNotFound",value:f.value});var g=d("WASmaxInGroupsIQErrorNotAuthorizedMixin").parseIQErrorNotAuthorizedMixin(a);if(g.success)return d("WAResultOrError").makeResult({name:"IQErrorNotAuthorized",value:g.value});var h=d("WASmaxInGroupsIQErrorForbiddenMixin").parseIQErrorForbiddenMixin(a);if(h.success)return d("WAResultOrError").makeResult({name:"IQErrorForbidden",value:h.value});var i=d("WASmaxInGroupsIQErrorLockedMixin").parseIQErrorLockedMixin(a);if(i.success)return d("WAResultOrError").makeResult({name:"IQErrorLocked",value:i.value});var j=d("WASmaxInGroupsIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(a);return j.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackClient",value:j.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorRateOverlimit","IQErrorPayloadTooLarge","IQErrorBadRequest","IQErrorItemNotFound","IQErrorNotAuthorized","IQErrorForbidden","IQErrorLocked","IQErrorFallbackClient"],[b,c,e,f,g,h,i,j])}g.parseRemoveParticipantsClientErrors=a}),98);
__d("WASmaxInGroupsRemoveParticipantsResponseClientError",["WAResultOrError","WASmaxInGroupsIQErrorResponseMixin","WASmaxInGroupsRemoveParticipantsClientErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInGroupsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInGroupsRemoveParticipantsClientErrors").parseRemoveParticipantsClientErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRemoveParticipantsClientErrors:b.value}))}g.parseRemoveParticipantsResponseClientError=a}),98);
__d("WASmaxInGroupsRemoveParticipantsResponseServerError",["WASmaxInGroupsBaseServerErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInGroupsBaseServerErrorMixin").parseBaseServerErrorMixin(a,b);return!c.success?c:c}g.parseRemoveParticipantsResponseServerError=a}),98);
__d("WASmaxInGroupsParticipantNotAllowedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","405");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseParticipantNotAllowedMixin=a}),98);
__d("WASmaxInGroupsParticipantNotInGroupMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","404");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseParticipantNotInGroupMixin=a}),98);
__d("WASmaxInGroupsRemoveParticipantsLinkedGroupsServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","500");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseRemoveParticipantsLinkedGroupsServerErrorMixin=a}),98);
__d("WASmaxInGroupsParticipantNotInGroupOrParticipantNotAllowedOrParticipantNotAcceptableOrRemoveParticipantsLinkedGroupsServerErrorMixinGroup",["WAResultOrError","WASmaxInGroupsParticipantNotAcceptableMixin","WASmaxInGroupsParticipantNotAllowedMixin","WASmaxInGroupsParticipantNotInGroupMixin","WASmaxInGroupsRemoveParticipantsLinkedGroupsServerErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsParticipantNotInGroupMixin").parseParticipantNotInGroupMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"ParticipantNotInGroup",value:b.value});var c=d("WASmaxInGroupsParticipantNotAllowedMixin").parseParticipantNotAllowedMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"ParticipantNotAllowed",value:c.value});var e=d("WASmaxInGroupsParticipantNotAcceptableMixin").parseParticipantNotAcceptableMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"ParticipantNotAcceptable",value:e.value});var f=d("WASmaxInGroupsRemoveParticipantsLinkedGroupsServerErrorMixin").parseRemoveParticipantsLinkedGroupsServerErrorMixin(a);return f.success?d("WAResultOrError").makeResult({name:"RemoveParticipantsLinkedGroupsServerError",value:f.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["ParticipantNotInGroup","ParticipantNotAllowed","ParticipantNotAcceptable","RemoveParticipantsLinkedGroupsServerError"],[b,c,e,f])}g.parseParticipantNotInGroupOrParticipantNotAllowedOrParticipantNotAcceptableOrRemoveParticipantsLinkedGroupsServerErrorMixinGroup=a}),98);
__d("WASmaxInGroupsRemoveParticipantsResponseSuccess",["WAResultOrError","WASmaxInGroupsGroupAddressingModeMixin","WASmaxInGroupsParticipantNotInGroupOrParticipantNotAllowedOrParticipantNotAcceptableOrRemoveParticipantsLinkedGroupsServerErrorMixinGroup","WASmaxInGroupsPhoneNumberMixin","WASmaxParseJid","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseJid").attrUserJid(a,"jid");if(!b.success)return b;var c=d("WASmaxInGroupsPhoneNumberMixin").parsePhoneNumberMixin(a);a=d("WASmaxInGroupsParticipantNotInGroupOrParticipantNotAllowedOrParticipantNotAcceptableOrRemoveParticipantsLinkedGroupsServerErrorMixinGroup").parseParticipantNotInGroupOrParticipantNotAllowedOrParticipantNotAcceptableOrRemoveParticipantsLinkedGroupsServerErrorMixinGroup(a);return d("WAResultOrError").makeResult({jid:b.value,phoneNumberMixin:c.success?c.value:null,participantNotInGroupOrParticipantNotAllowedOrParticipantNotAcceptableOrRemoveParticipantsLinkedGroupsServerErrorMixinGroup:a.success?a.value:null})}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"remove");if(!c.success)return c;var e=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!e.success)return e;e=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",e.value);if(!e.success)return e;e=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");if(!e.success)return e;b=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",b.value);if(!b.success)return b;b=d("WASmaxParseUtils").optionalLiteral(d("WASmaxParseUtils").attrString,c.value,"linked_groups","true");if(!b.success)return b;a=d("WASmaxInGroupsGroupAddressingModeMixin").parseGroupAddressingModeMixin(a);c=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"participant",1,1024,h);return!c.success?c:d("WAResultOrError").makeResult({type:e.value,removeLinkedGroups:b.value,groupAddressingModeMixin:a.success?a.value:null,removeParticipant:c.value})}g.parseRemoveParticipantsResponseSuccessRemoveParticipant=h;g.parseRemoveParticipantsResponseSuccess=a}),98);
__d("WASmaxOutGroupsRemoveParticipantsRequest",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxOutGroupsBaseSetGroupMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.participantJid;a=d("WASmaxJsx").smax("participant",{jid:d("WAWap").USER_JID(a)});return a}function a(a){var b=a.participantArgs,c=a.hasRemoveLinkedGroupsTrue;c=d("WASmaxOutGroupsBaseSetGroupMixin").mergeBaseSetGroupMixin(d("WASmaxJsx").smax("iq",null,d("WASmaxJsx").smax("remove",{linked_groups:d("WASmaxAttrs").OPTIONAL_LITERAL("true",c)},d("WASmaxChildren").REPEATED_CHILD(h,b,1,1024))),a);return c}g.makeRemoveParticipantsRequestRemoveParticipant=h;g.makeRemoveParticipantsRequest=a}),98);
__d("WASmaxGroupsRemoveParticipantsRPC",["WAComms","WASmaxInGroupsRemoveParticipantsResponseClientError","WASmaxInGroupsRemoveParticipantsResponseServerError","WASmaxInGroupsRemoveParticipantsResponseSuccess","WASmaxOutGroupsRemoveParticipantsRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:e=d("WASmaxOutGroupsRemoveParticipantsRequest").makeRemoveParticipantsRequest(a);j.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=j.sent;g=d("WASmaxInGroupsRemoveParticipantsResponseSuccess").parseRemoveParticipantsResponseSuccess(f,e);if(!g.success){j.next=7;break}return j.abrupt("return",{name:"RemoveParticipantsResponseSuccess",value:g.value});case 7:h=d("WASmaxInGroupsRemoveParticipantsResponseClientError").parseRemoveParticipantsResponseClientError(f,e);if(!h.success){j.next=10;break}return j.abrupt("return",{name:"RemoveParticipantsResponseClientError",value:h.value});case 10:i=d("WASmaxInGroupsRemoveParticipantsResponseServerError").parseRemoveParticipantsResponseServerError(f,e);if(!i.success){j.next=13;break}return j.abrupt("return",{name:"RemoveParticipantsResponseServerError",value:i.value});case 13:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("RemoveParticipants",{Success:g,ClientError:h,ServerError:i}));case 14:case"end":return j.stop()}},null,this)}g.sendRemoveParticipantsRPC=a}),98);
__d("MAWRemoveGroupParticipants",["MAWGlobals","MAWODSProxy","WAGlobals","WAJids","WALogger","WAOdsEnums","WAPREList","WAPREMetrics","WARemoveGroupParticipantsApi","WAResultOrError","WASmaxGroupsRemoveParticipantsRPC","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to remove a participant: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to remove participants: ",""]);i=function(){return a};return a}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("sendIq",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){b=a.group;c=a.users;var e=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.REMOVE_PARTICIPANTS,{"int":{removedParticipants:c.length}});a=d("WAGlobals").getJidUtilsApi();var f=a.toUserJid;a=c.map(function(a){return f(a)});var g=[];if(a.length>0){c=function(a){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.GROUP_REMOVE_PARTICIPANT,key:"fail"}),d("WALogger").ERROR(i(),j.name),e.endFail("send_iq_fail "+a)};var j=(yield d("WASmaxGroupsRemoveParticipantsRPC").sendRemoveParticipantsRPC({hasRemoveLinkedGroupsTrue:!1,iqTo:b,participantArgs:a.map(function(a){return{participantJid:a}})}));e.addPoint("finish_send_iq");switch(j.name){case"RemoveParticipantsResponseClientError":a=j.value.errorRemoveParticipantsClientErrors.name;c(a);return d("WAResultOrError").makeError(a);case"RemoveParticipantsResponseServerError":a=j.value.errorServerErrors.name;c(a);return d("WAResultOrError").makeError(a);case"RemoveParticipantsResponseSuccess":d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.GROUP_REMOVE_PARTICIPANT,key:"success"}),j.value.removeParticipant.forEach(function(a){var b=a.jid;a=a.participantNotInGroupOrParticipantNotAllowedOrParticipantNotAcceptableOrRemoveParticipantsLinkedGroupsServerErrorMixinGroup;a==null?g.push({addressable:!0,type:"nonparticipant",user:b}):d("WALogger").ERROR(h(),a.name)})}}e.addPoint("start_remove_participant_txn");yield d("WARemoveGroupParticipantsApi").removeGroupParticipants(null,b,d("WAJids").AUTHOR_ME,g,!0);e.addPoint("finish_remove_participant_txn");c=(yield d("MAWGlobals").getJobResultConvertersImpls().convertRemoveGroupParticipantsResult==null?void 0:d("MAWGlobals").getJobResultConvertersImpls().convertRemoveGroupParticipantsResult(b,g));e.endSuccess();return c?d("WAResultOrError").makeResult(c):d("WAResultOrError").makeResult({groupJid:b,participants:g})});return function(b,c,d){return a.apply(this,arguments)}}()).end();g.removeGroupParticipants=a}),98);
__d("MAWReportUserSpam",["I64","MAWGlobals","MAWJids","MAWSpamReportUtils","WADeprecatedSendIq","WAGetGroupInfo","WAGlobals","WAJids","WAResultOrError","WAWap","asyncToGeneratorRuntime","err","isStringNullOrEmpty"],(function(a,b,c,d,e,f,g){"use strict";var h,i=30;a=["impersonation"];e=["ig_user_impersonation"];var j=Array.of.apply(Array,a.concat(e));f=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("reportUserSpam",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.chatJid,f=a.context,g=a.frxParams,h=a.frxTags,k=a.isIgd,o=a.openMsgs,p=a.reportedMessageId,q=a.spamFlow,r=a.userJid;a=(h==null?void 0:h.some(function(a){return j.includes(a)}))===!0;var s=a?[]:yield d("MAWGlobals").getDbImpls().getLastMsgsInChatForSpamReport(e,i);a=null;if(h!=null){if(h.length===0)throw c("err")("spam reasons should not be an empty array");a=d("WAWap").wap("tagset",null,h.map(function(a){return d("WAWap").wap("tag",{value:d("WAWap").CUSTOM_STRING(a)})}))}h=null;c("isStringNullOrEmpty")(g)||(h=d("WAWap").wap("parameters",null,g));g=null;f!=null&&(g=d("WAWap").wap("context",null,f));var t=null;(a!=null||g!=null||h!=null)&&(t=d("WAWap").wap("frx",null,a,g,h));var u=l(o,e,r);f=(yield d("WAJids").switchOnMsgrChatJidType(e,{group:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("WAWap").DROP_ATTR,c=d("WAWap").DROP_ATTR,e=(yield d("WAGetGroupInfo").getGroupInfo(a));e!=null&&e.subject!=null&&e.subject.content!=null&&(b=d("WAWap").CUSTOM_STRING(e.subject.content));e!=null&&e.inviter!=null&&(c=d("WAWap").USER_JID(e.inviter));return m(s,a,r,c,b,q,t,u,k,p)});function c(b){return a.apply(this,arguments)}return c}(),user:function(){return n(s,r,q,t,u,k,p)}}));d("WADeprecatedSendIq").deprecatedCastStanza(f);return d("WAResultOrError").makeResult()});return function(b){return a.apply(this,arguments)}}()).end();function k(a,b){var c=a.flat();if(a.length<i){var d;a=i-a.length;if(a<((d=b==null?void 0:b.length)!=null?d:0)){c=[].concat(((d=b)!=null?d:[]).slice(0,a),c)}else{c=[].concat((d=b)!=null?d:[],c)}}return c}function l(a,b,c){return((a=a)!=null?a:[]).map(function(a){var e=d("MAWJids").toUserJid((h||(h=d("I64"))).to_string(a.senderId));if(d("WAJids").interpretAsGroupJid(b)!=null)return d("MAWSpamReportUtils").formatLSDbMsgForSpamReport(a,null,d("WAJids").toGroupJid(b),e);else{var f=(h||(h=d("I64"))).equal(a.senderId,(h||(h=d("I64"))).of_string(d("WAJids").userIdFromJid(d("WAGlobals").getMyUserJid())))?c:d("WAGlobals").getMyUserJid();return d("MAWSpamReportUtils").formatLSDbMsgForSpamReport(a,f,null,e)}})}function m(a,b,c,e,f,g,h,i,j,l){a=a.map(function(a){return d("MAWSpamReportUtils").getformattedMsgsForSpamReport(a.msg,a.mediaInfo,a.editHistory,null,b,d("MAWSpamReportUtils").getAuthorAsJidForSpam(a.msg),j,l!=null&&((a=a.msg)==null?void 0:a.msgId)===l)});a=k(a,i);return(i=d("WAWap")).wap("iq",{id:i.generateId(),to:i.S_WHATSAPP_NET,type:"set",xmlns:"spam"},i.wap("spam_list",{jid:i.GROUP_JID(b),reportee:i.USER_JID(c),source:e,spam_flow:i.CUSTOM_STRING(g),subject:f},a),h)}function n(a,b,c,e,f,g,h){a=a.map(function(a){return d("MAWSpamReportUtils").getformattedMsgsForSpamReport(a.msg,a.mediaInfo,a.editHistory,d("MAWSpamReportUtils").getRecipientAsJidForSpam(a.msg,b),null,d("MAWSpamReportUtils").getAuthorAsJidForSpam(a.msg),g,h!=null&&((a=a.msg)==null?void 0:a.msgId)===h)}).filter(function(a){return a!=null});a=k(a,f);return(f=d("WAWap")).wap("iq",{id:f.generateId(),to:f.S_WHATSAPP_NET,type:"set",xmlns:"spam"},f.wap("spam_list",{jid:f.USER_JID(b),reportee:f.USER_JID(b),spam_flow:f.CUSTOM_STRING(c)},a),e)}g.reportUserSpam=f}),98);
__d("MAWRerevokePendingStanzas",["MAWBuildIncomingMsgs","MAWDbMsg","MAWDbMsgTxns","MAWDexieTable","MAWGlobals","MAWIndexedDb","MAWJidUtils","MAWMsgType","MAWRemoveExpiredUnsendMsgsContent","MAWTransactionMode","MAWWriteRevokeMessageTxns","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("echoSerialization",function(){return h()}).end();var h=d("MAWIndexedDb").makeMsgrTransactor({chunk:(b=d("MAWTransactionMode")).READWRITE,deletedMessages:b.READWRITE,editMsgHistory:b.READWRITE,groupInfo:b.READWRITE,media:b.READWRITE,mediaBackup:b.READWRITE,messages:b.READWRITE,pendingStanzas:b.READWRITE,reactions:b.READWRITE,threads:b.READWRITE,xma:b.READWRITE},"reRevokeMsgs",function(a){return function(){return a.pendingStanzas.toArray().then(function(b){b=b.map(function(b){var c;if(((c=b.pendingContent)==null?void 0:c.type)==="Revoked"){var e=b==null?void 0:(c=b.pendingContent)==null?void 0:c.content;c=d("MAWJidUtils").maybeToProtocolMsgId(e.author,e.threadJid,e.revokedExternalId);return c==null||e==null?d("MAWDexieTable").dexieResolve():d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,c),a.threads.get({jid:c.chat})]).then(function(c){var f=c[0];c=c[1];if(f==null||c==null)return d("MAWDexieTable").dexieResolve();var g=e.ts+d("WATimeUtils").castToUnixTime(d("MAWBuildIncomingMsgs").REVOKE_CONTENT_EXPIRATION_IN_SEC);g=babelHelpers["extends"]({},f,{externalId:e.externalId,msgContent:d("MAWDbMsg").getMsgContent(f),originalTs:f.ts,revokedExternalId:e.revokedExternalId,ts:e.ts,type:d("MAWMsgType").MSG_TYPE.REVOKED,unsendMsgContentDeleteTs:d("WATimeUtils").castToUnixTime(g)});return d("MAWDexieTable").dexieAll([d("MAWWriteRevokeMessageTxns").markExistingMsgRevoked(a,f,g,c,!0),a.pendingStanzas["delete"](b.rowId)])})}return d("MAWDexieTable").dexieResolve()});return d("MAWDexieTable").dexieAll(b).then(function(){return d("MAWRemoveExpiredUnsendMsgsContent").removeExpiredUnsendMsgsContentTxn(a)})})}});g.rerevokeMsgs=a;g.reRevokeMsgs=h}),98);
__d("MAWWriteOutgoingAppDataApi",["MAWAckLevel","MAWDexieTable","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({appData:d("MAWTransactionMode").READWRITE},"writeOutgoingAppData",function(a){return function(b){var c=b.args,e=b.externalId,f=b.permittedIdentitiesPerDevice,g=b.ts;return a.appData.get({externalId:e}).then(function(b){if(b!=null)if(b.ack>=d("MAWAckLevel").ACK.sent)return d("MAWDexieTable").dexieResolve({appDataExternalId:e,devices:Array.from(b.recipientDevices),type:"already_sent"});else return d("MAWDexieTable").dexieResolve({appDataExternalId:e,devices:Array.from(b.recipientDevices),type:"not_sent"});b=c.contents;return f.size===0?{type:"no_devices"}:a.appData.add({ack:d("MAWAckLevel").ACK.clock,contents:b,externalId:e,permittedIdentitiesPerDevice:f,recipientDevices:new Set(f.keys()),sendPartial:c.deviceJids!=null,ts:g}).then(function(){return{appDataExternalId:e,devices:Array.from(f.keys()),type:"not_sent"}})})}});g.writeOutgoingAppData=a}),98);
__d("MAWSendAppData",["MAWGlobals","MAWHandleMetaSyncAction","MAWJobDefinitions","MAWWriteOutgoingAppDataApi","WAGlobals","WALogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["no other devices"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendAppData already sent message"]);i=function(){return a};return a}function j(a){var b=a.recipients;return d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return a.storage.loadIdentities(d("WAGlobals").getMyUserJid()).then(function(a){var c=new Map(),e=b==="all"?new Set(a.keys()):new Set(b);for(a of a){var f=a[0],g=a[1];if(f===d("WAGlobals").getMyDeviceJid())continue;else if(!e.has(f))continue;c.set(f,{pubKey:g})}return c})},{flush:!1,operationType:"maw_load_identities"})}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("saveAndPassOff",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e;b=a.args;a=a.externalId;e=(yield j({recipients:(e=b.deviceJids)!=null?e:"all"}));a=(yield d("MAWWriteOutgoingAppDataApi").writeOutgoingAppData({args:b,externalId:a,permittedIdentitiesPerDevice:e,ts:c.jobStartTime}));b.contents.type==="meta_sync"&&(yield d("MAWHandleMetaSyncAction").handleMetaSyncActions(b.contents));if(a.type==="already_sent"){d("WALogger").LOG(i());return a}else if(a.type==="no_devices"){d("WALogger").LOG(h());return a}else{a.type;yield d("MAWGlobals").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").jobSerializers.sendWrittenAppData(a.appDataExternalId));return a}});return function(b,c,d){return a.apply(this,arguments)}}()).end();g.calculateAppDataPermittedIdentities=j;g.sendAppData=a}),98);
__d("WASendAppDataFanoutProtocol",["WAAsMessageApplication","WABridge","WAConvertAppData","WAEncUserMsg","WAErrorMessage","WAGetCurrentUserDeviceInfoApi","WAGlobals","WAMsgApplication.pb","WAOdsEnums","WAResultOrError","WASmaxAppdataPublishPeerRPC","WATagsLogger","encodeProtobuf","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to send appdata. Error: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Got phash mismatch on appdata, local[","] server[","]"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to fetch current device public identity key"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Attempting to send an appData stanza to more than the allowed "," devices"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Attempting to send an appData stanza to "," devices"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Sending appdata, externalId: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to send appdata to devices with error: ",""]);n=function(){return a};return a}var o=d("WATagsLogger").TAGS(["sendAppDataFanout"]);function a(a,b,c,e){e===void 0&&(e="checkPhash");return p(a,b,c,e)["catch"](function(a){a=d("WAErrorMessage").maybeGetMessageFromError(a);o.ERROR(n(),a);return d("WAResultOrError").makeError("runtime-error")})}function p(a,c,e,f){var g,n,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F;return b("regeneratorRuntime").async(function(G){while(1)switch(G.prev=G.next){case 0:f===void 0&&(f="checkPhash");o.LOG(m(),c);g=d("WAConvertAppData").convertAppData(a);n={bytes:d("WAAsMessageApplication").castToMessageApplicationBytes(d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,g).readByteArray()),version:"v3"};p=[];q=Array.from(e.entries()).map(function(a){var b=a[0];a=a[1];return{identity:a.pubKey,jid:b}});r=d("WAGlobals").getConfig().maxAppDataRecipients();q.length>r&&(o.WARN(l(),q.length),o.ERROR(k(),r),q=q.slice(0,r));s=[{devicesInfo:q,user:d("WAGlobals").getMyUserJid()}];G.next=11;return b("regeneratorRuntime").awrap(d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return d("WAEncUserMsg").encryptUserMsg(s,{messageBytes:n,type:"appdata"},[],{cryptoManager:a})},{operationType:"encrypt",flush:!0}));case 11:t=G.sent;u=t.phash;v=!1;t.participants!=null&&t.participants.forEach(function(a){a.type==="pkmsg"&&(v=!0),p.push({toJid:a.to,encTypeIndividualMixinArgs:{encType:a.type,encElementValue:a.ciphertext},encVersionFutureproofMixinArgs:{encV:parseInt(a.v,10)}})});w={appdataTo:d("WAGlobals").getMyUserJid(),toArgs:p};x={peerPeerFanout:w};y=void 0;if(!v){G.next=27;break}G.next=21;return b("regeneratorRuntime").awrap(d("WAGetCurrentUserDeviceInfoApi").getCurrentUserDeviceInfo());case 21:z=G.sent;A=z==null?void 0:z.identityKey;if(!(A==null)){G.next=26;break}o.ERROR(j());return G.abrupt("return",d("WAResultOrError").makeError("no-public-identity"));case 26:y={deviceIdentityElementValue:A};case 27:B={appdataDeviceListCheck:f==="checkPhash"?"true":"false"};C={appdataId:c,peerPeerFanoutOrPeerSingleMixinGroupArgs:x,deviceIdentityMixinArgs:y,withDeviceListCheckMixinArgs:B};G.next=31;return b("regeneratorRuntime").awrap(d("WASmaxAppdataPublishPeerRPC").sendPeerRPC(C));case 31:D=G.sent;G.t0=D.name;G.next=G.t0==="PeerResponseSuccess"?35:43;break;case 35:F=(E=D.value.deviceListStaleMixin)==null?void 0:E.phash;if(!(F!=null&&u!=null&&F!==u)){G.next=42;break}o.LOG(i(),u,F);d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.PHASH_MISMATCH,key:"appdata"});return G.abrupt("return",d("WAResultOrError").makeResult({phashMismatch:!0}));case 42:return G.abrupt("return",d("WAResultOrError").makeResult({phashMismatch:!1}));case 43:D.name;o.ERROR(h(),D.value.error);return G.abrupt("return",d("WAResultOrError").makeError("ack-failure"));case 46:case"end":return G.stop()}},null,this)}g.sendAppDataToDevicesProtocol=a}),98);
__d("MAWResendWrittenAppData",["MAWGlobals","MAWSendAppData","WAGetDevices","WALogger","WASendAppDataFanoutProtocol","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenAppData(","): too old, dropping"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["resendWrittenAppData not sending message: ",""]);i=function(){return a};return a}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("resendWrittenAppData",{code:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.appDataExternalId;yield d("WAGetDevices").fetchAndSaveDevices(new Set([d("MAWGlobals").getMyUserJid()]),"resend-written-app-data");var b=(yield d("MAWSendAppData").calculateAppDataPermittedIdentities({recipients:"all"}));b=(yield d("MAWGlobals").getDbImpls().getAppDataForResend(a,b));if(b.type!=="not_sent"){d("WALogger").LOG(i(),b.type);return}b=(yield d("WASendAppDataFanoutProtocol").sendAppDataToDevicesProtocol(b.appData,a,b.permittedIdentitiesPerDevice,"dontCheckPhash"));b.success===!1&&(yield d("MAWGlobals").getDbImpls().markAppDataSendFailed(a))});function c(b){return a.apply(this,arguments)}return c}(),stopRetryIf:{onStopRetry:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.appDataExternalId;d("WALogger").LOG(h(),a);yield d("MAWGlobals").getDbImpls().markAppDataDropped(a)});function c(b){return a.apply(this,arguments)}return c}(),timePassedSeconds:d("WATimeUtils").DAY_SECONDS}}).end();g.resendWrittenAppData=a}),98);
__d("MAWRestoreMessagesFromEchoDocuments",["MAWBridge","MAWHandleEchoMsgsRestoreApiV2","MAWUpdateClientRestoreStatusOperationType","Promise","WALogger","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Encountered unhandled exception while running job restoreMessagesFromEncryptedBackups: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Job restoreMessagesFromEncryptedBackups, thread: ",", messages count: ",""]);j=function(){return a};return a}function a(a){var c=a.hasMoreAfter,e=a.hasMoreBefore,f=a.instanceKey,g=a.isPointQuery,k=a.messages,l=a.minMsgId,m=a.optimisticMsgs,n=a.startSortKey,o=a.taskSource,p=a.threadId;a=a.traceId;var q={messageIds:[],pendingRestoreSortKeys:[]};q=d("WAResultOrError").makeResult(q);try{d("WALogger").LOG(j(),p,k.length);return d("MAWHandleEchoMsgsRestoreApiV2").handleEchoMsgsBulkRestore(p,k,g,e,c,l,a,n,f,m,o)}catch(a){d("WALogger").ERROR(i(),a)}finally{n==null&&d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"UpdateClientRestoreStatus",value:{action:d("MAWUpdateClientRestoreStatusOperationType").markCompleteClientRestoreStatus,ebPrefetch:!1,threadId:p}}]})}return(h||(h=b("Promise"))).resolve(q)}g.restoreEchoMsgs=a}),98);
__d("MAWRestoreMessagesFromEncryptedBackups",["MAWGlobals","MAWRestoreMessagesFromEchoDocuments","Promise","WAGlobals","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h;a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("decodeAndRestoreMessages",function(a){var c=a.hasMoreAfter,e=a.hasMoreBefore,f=a.instanceKey,g=a.isPointQuery,i=a.messages,j=a.minMsgId,k=a.optimisticMsgs,l=a.startSortKey,m=a.taskSource,n=a.threadId;a=a.traceId;var o={messageIds:[],pendingRestoreSortKeys:[]};o=d("WAResultOrError").makeResult(o);return!d("WAGlobals").getConfig().useEbRestoreQueue()?d("MAWRestoreMessagesFromEchoDocuments").restoreEchoMsgs({hasMoreAfter:c,hasMoreBefore:e,instanceKey:f,isPointQuery:g,messages:i,minMsgId:j,optimisticMsgs:k,startSortKey:l,taskSource:m,threadId:n,traceId:a}):(h||(h=b("Promise"))).resolve(o)}).end();g.restoreMessagesFromEncryptedBackups=a}),98);
__d("MAWRestoreProtobufMsgsForThread",["MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWIndexedDb","MAWThreadSnippetBuildTxns","MAWTransactionMode","MAWWriteMsgSideEffectTxns","MAWWriteMsgTxns","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Starting restore for protobuf msg with external id "," chatjid ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["unstoredDbMsg cannot both be missing for external id "," chat jid ",""]);i=function(){return a};return a}b=d("MAWIndexedDb").makeMsgrTransactor({groupInfo:(a=d("MAWTransactionMode")).READWRITE,messages:a.READWRITE,participants:a.READWRITE,threads:a.READWRITE},"handleProtobufMessageRestore",function(a){return function(b,c,e,f,g,k,l,m){f=f.unstoredDbMsg;var n=e.jid;if(f==null){d("WALogger").ERROR(i(),c,n);return d("MAWDexieTable").dexieResolve()}d("WALogger").LOG(h(),c,n);return j(a,c,b,f,e,g,k,l,m)}});function j(a,b,c,e,f,g,h,i,j){var k=f.chatId;return d("MAWDbMsgTxns").maybeGetMsgByExternalId(a,b,k,c).then(function(b){if(b==null){var c=babelHelpers["extends"]({},babelHelpers["extends"]({},e,{thread:f.chatId,threadJid:f.jid}));return d("MAWWriteMsgTxns").writeMsg(a,c,f,{},!0,g,h,i,j).then(function(b){return d("MAWDbThreadTxns").getThread(a,f.chatId).then(function(e){if(e.success){var f=e.value;return d("MAWDexieTable").dexieAll([d("MAWWriteMsgSideEffectTxns").updateParticipantTimestampsForMsg(a,c),d("MAWThreadSnippetBuildTxns").refreshThreadSnippet(a,f)]).then(function(){return{dbMsg:b,updatedThread:f}})}})})}})}g.handleProtobufMessageRestore=b}),98);
__d("MAWWriteReactionMsgApi",["MAWIndexedDb","MAWTransactionMode","MAWWriteReactionTxns","WAJids"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({groupInfo:(a=d("MAWTransactionMode")).READONLY,media:a.READONLY,messages:a.READONLY,participants:a.READONLY,reactions:a.READWRITE,threads:a.READWRITE},"writeReactionMsg",function(a){return function(b,c,e,f,g){g===void 0&&(g=d("WAJids").AUTHOR_ME);var h=e.groupingKey,i=e.reaction,j=e.reactToAuthor;e=e.reactToExternalId;var k={author:g,externalId:b,groupingKey:h,reaction:i,reactToAuthor:j,reactToExternalId:e,ts:f};return a.threads.get({jid:c}).then(function(b){return b==null?"missing_thread":d("MAWWriteReactionTxns").writeReaction(a,k,b)}).then(function(a){return a==="missing_thread"?{type:"missing_thread"}:{msgId:a.reactionId,protocolMsgId:{author:g,chat:c,externalId:a.externalId},type:"not_sent"}})}});g.writeReactionMsg=b}),98);
__d("MAWHandleEchoProtobufsRestoreApi",["EchoMessageMediaFieldUtils","LSMEBTaskCreationSource","MAWBridgeEventTransmitter","MAWBridgeMsg","MAWDexieTable","MAWHandleEchoMediaMsgsRestoreV2","MAWHandleEchoMsgsRestoreApiV2","MAWIndexedDb","MAWJids","MAWJobDefinitions","MAWLoadReplyMediaTxns","MAWRestoreMsgsTxns","MAWRestoreProtobufMsgsForThread","MAWTransactionMode","MAWUnstoredContentToUnstoredDbContentUtils","MAWUpdateQuotedMsgTxns","MAWWriteReactionMsgApi","MessageBackupSupplementalKeyGenerator","Promise","WAAckLevel","WAArmadilloBackupMessage.pb","WABase64","WAConsumerApplication.pb","WAGlobals","WAJids","WALogger","WAMediaTransport.pb","WAMediaUtils","WAMessageKey","WAMsgApplication.pb","WAMsgType","WAParseConsumerMessageProtocol","WAParseMessageApplication","WAStanzaUtils","WATimeUtils","decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth][web] Cannot download media - timestamp cannot be null"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["cannot support message type for protobuf restore - reverting to echo restore"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth][web] Protobuf restore initiated for "," messages. isPointRestore: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsed message application subprotocol type is not of type consumer message - unable to restore"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Message contains unparseable message application - unable to restore message"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth][web] Unable to retrieve decoded protobuf consumer application object from backup message"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth][web] Unable to decode required fields from protobuf - unable to restore msg"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth][web] Invalid attachment type, cannot restore attachment"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth][web] Unsupported media type, cannot get mimetype for attachment"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth][web] Invalid reaction text in the protobuf restore"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth][web] Failed to create db msg from protobuf"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth][web] Missing required fields, unable to create db msg from protobuf for thread jid "," and otid ",""]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth][web] text content cannot be null for msg type text - unable to restore msg"]);u=function(){return a};return a}var v=new Set(),w=new Set(),x=new Map(),y=new Map(),z=d("MAWIndexedDb").makeMsgrTransactor({chunk:(e=d("MAWTransactionMode")).READONLY,media:e.READONLY,messages:e.READWRITE,xma:e.READONLY},"associateQuotedMessagesForRestoredDbMsgs",function(a){return function(b,c){return d("MAWDexieTable").dexieAll(b.map(function(b){return d("MAWUpdateQuotedMsgTxns").associateQuotedMessage(a,c,b,!0).then(function(b){b!=null&&b.length>0&&b.forEach(function(b){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,b).then(function(a){a!=null&&d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(b,void 0,a)})})})})})).then(function(){return d("MAWDexieTable").dexieResolve()})}});function A(a,b,c){c={author:c,chat:b,externalId:a};return c}function B(a,b){var c=a.metadata;a=a.reactionData;if(c!=null&&a!=null){c=c.senderId;if(c!=null)return a.map(function(a){var c=a.ts,e=a.senderId;if(e==null)return;e=d("MAWJids").toUserJid(e);e=e===d("WAGlobals").getMyUserJid()?d("WAJids").AUTHOR_ME:e;var f=e===d("WAJids").AUTHOR_ME?d("WAAckLevel").ACK.SENT:d("WAAckLevel").ACK.RECEIVED;return E(e,b,a.reaction,f,c)})}}function C(a,b,c,e,f,g){if(a===d("WAMsgType").MSG_TYPE.TEXT)if(f==null){d("WALogger").ERROR(u());return}else{f={ack:c===d("WAJids").AUTHOR_ME?d("WAAckLevel").ACK.SENT:d("WAAckLevel").ACK.RECEIVED,forwardingScore:0,id:e,msgContent:{content:f,mentionedJids:g!=null?g.map(d("WAJids").validateUserJid).filter(Boolean):void 0},ts:b,type:d("WAMsgType").MSG_TYPE.TEXT};return f}else if(a===d("WAMsgType").MSG_TYPE.VIDEO){g={ack:c===d("WAJids").AUTHOR_ME?d("WAAckLevel").ACK.SENT:d("WAAckLevel").ACK.RECEIVED,forwardingScore:0,id:e,mediaId:void 0,ts:b,type:d("WAMsgType").MSG_TYPE.VIDEO};return g}else if(a===d("WAMsgType").MSG_TYPE.GIF){f={ack:c===d("WAJids").AUTHOR_ME?d("WAAckLevel").ACK.SENT:d("WAAckLevel").ACK.RECEIVED,forwardingScore:0,id:e,mediaId:void 0,ts:b,type:d("WAMsgType").MSG_TYPE.GIF};return f}else if(a===d("WAMsgType").MSG_TYPE.IMAGE){g={ack:c===d("WAJids").AUTHOR_ME?d("WAAckLevel").ACK.SENT:d("WAAckLevel").ACK.RECEIVED,forwardingScore:0,id:e,mediaId:void 0,ts:b,type:d("WAMsgType").MSG_TYPE.IMAGE};return g}else if(a===d("WAMsgType").MSG_TYPE.STICKER){f={ack:c===d("WAJids").AUTHOR_ME?d("WAAckLevel").ACK.SENT:d("WAAckLevel").ACK.RECEIVED,forwardingScore:0,id:e,mediaId:void 0,ts:b,type:d("WAMsgType").MSG_TYPE.STICKER};return f}else if(a===d("WAMsgType").MSG_TYPE.PTT){g={ack:c===d("WAJids").AUTHOR_ME?d("WAAckLevel").ACK.SENT:d("WAAckLevel").ACK.RECEIVED,forwardingScore:0,id:e,mediaId:void 0,ts:b,type:d("WAMsgType").MSG_TYPE.PTT};return g}}function D(a,b){var c=a.metadata,e=a.msgType;if(c!=null&&e!=null){var f,g=c.timestampMs,h=c.messageId;c=c.senderId;f=(f=a.decodedPayload)==null?void 0:f.text;if(g!=null&&typeof g==="number"&&h!=null&&c!=null){g=d("WATimeUtils").castMilliSecondsToUnixTime(g);c=d("MAWJids").toUserJid(c);var i=d("WAStanzaUtils").toStanzaId(h),j=c===d("WAGlobals").getMyUserJid()?d("WAJids").AUTHOR_ME:c,k=A(i,b,c);g=C(e,g,j,k,f,(e=a.decodedPayload)==null?void 0:e.mentionedJid);if(g==null){d("WALogger").ERROR(t(),b,i);return}j={unstoredMedia:void 0,unstoredMsg:g,unstoredQuotedMedia:void 0,unstoredXMA:void 0};k=d("MAWUnstoredContentToUnstoredDbContentUtils").unstoredContentToUnstoredDbContent(j);f=x.get(h);if(k.unstoredDbMsg!=null){a=k.unstoredDbMsg;a.author!=null&&d("WAGlobals").getMyUserJid()===a.author&&a.author!==d("WAJids").AUTHOR_SYSTEM&&(a.author=d("WAJids").AUTHOR_ME);f!=null&&(a.quoteExternalId=d("WAStanzaUtils").toStanzaId(f));e={authorJid:c,stanzaId:i,unstoredDbContent:k};return e}}}d("WALogger").ERROR(s())}function E(a,b,c,e,f){a=d("WAParseConsumerMessageProtocol").interpretAsNonSystemAuthor(a);var g=d("WAMessageKey").extractProtocolMessageId(b,a,c.key),h=c.groupingKey;c=c.text;c=d("WAParseConsumerMessageProtocol").validReactionMessageText(c);if(!c.success){d("WALogger").WARN(r());return}return{ack:e,groupingKey:h,id:{author:a,chat:b,externalId:g.externalId},reaction:c.value,reactToAuthor:g.author,reactToExternalId:g.externalId,ts:f,type:d("WAMsgType").MSG_TYPE.REACTION}}function F(a){switch(a){case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.IMAGE:return d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.IMAGE_JPEG;case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.GIF:return d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.GIF;case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.STICKER:return d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.STICKER;case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.VIDEO:return d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.AUDIO_MP4;case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.AUDIO:return d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.AUDIO_WAV;case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.XMA_IMAGE:return d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.IMAGE_JPEG;default:return null}}function G(a){switch(a){case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.IMAGE:return d("EchoMessageMediaFieldUtils").AttachmentType.IMAGE;case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.GIF:return d("EchoMessageMediaFieldUtils").AttachmentType.GIF;case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.STICKER:return d("EchoMessageMediaFieldUtils").AttachmentType.STICKER;case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.VIDEO:return d("EchoMessageMediaFieldUtils").AttachmentType.VIDEO;case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.AUDIO:return d("EchoMessageMediaFieldUtils").AttachmentType.PTT;case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.XMA_IMAGE:return d("EchoMessageMediaFieldUtils").AttachmentType.XMA;default:return null}}function H(a){var b;switch(a){case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.IMAGE:b="image/jpeg";break;case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.AUDIO:b="audio/wav";break;case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.VIDEO:b="video/mp4";break;case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.GIF:b="image/gif";break;case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.STICKER:b="image/webp";break;case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.XMA_IMAGE:b="image/jpeg";break;default:d("WALogger").ERROR(q())}return b}function I(a,b){var c,e,f,g,h,i;b=b;var j=a.ancillary;a=a.integral;c=a==null?void 0:(c=a.transport)==null?void 0:(c=c.integral)==null?void 0:c.fileSha256;e=a==null?void 0:(e=a.transport)==null?void 0:(e=e.integral)==null?void 0:e.fileEncSha256;f=a==null?void 0:(f=a.transport)==null?void 0:(f=f.integral)==null?void 0:f.mediaKey;g=(a==null?void 0:(g=a.transport)==null?void 0:(g=g.integral)==null?void 0:g.mediaKeyTimestamp)!=null?typeof (a==null?void 0:(g=a.transport)==null?void 0:g.integral.mediaKeyTimestamp)==="number"?a==null?void 0:(g=a.transport)==null?void 0:g.integral.mediaKeyTimestamp:void 0:void 0;var k=j==null?void 0:j.gifPlayback;k!=null&&k&&(b=d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.GIF);k=a==null?void 0:(k=a.transport)==null?void 0:(k=k.ancillary)==null?void 0:(k=k.thumbnail)==null?void 0:k.thumbnailHeight;h=a==null?void 0:(h=a.transport)==null?void 0:(h=h.ancillary)==null?void 0:(h=h.thumbnail)==null?void 0:h.thumbnailWidth;var l=F(b),m=G(b);if(m===null){d("WALogger").ERROR(p());return}a={attachmentObjectId:a==null?void 0:(i=a.transport)==null?void 0:(i=i.ancillary)==null?void 0:i.objectId,attachmentType:m,directPath:a==null?void 0:(i=a.transport)==null?void 0:(m=i.integral)==null?void 0:m.directPath,encryptedHash:e!=null?d("WAMediaUtils").toPlaintextHash(e):void 0,height:j==null?void 0:j.height,mediaKey:f!=null?d("WABase64").encodeB64UrlSafe(f):void 0,mediaKeyTimestamp:g,mediaPlayableDuration:j==null?void 0:j.seconds,plaintextHash:c!=null?d("WAMediaUtils").toPlaintextHash(c):void 0,width:j==null?void 0:j.width,xAttachmentType:b,xContentType:"full"};i=H(b);i!=null&&(a.mediaContentType=i);l!=null&&(a.previewContentType=l,a.previewContentHeight=k,a.previewContentWidth=h);return d("EchoMessageMediaFieldUtils").convertMediaMetadataDetailsToMediaMetadata(a)}function J(a){var b=L(a);b=b==null?void 0:(b=b.payload)==null?void 0:b.content;var c={metadata:a.metadata,reactionData:[],unknownFieldCount:a.$$unknownFieldCount},e;a=(a=a.metadata)==null?void 0:a.messageId;if(b!=null){if(b.messageText!=null){c.msgType=d("WAMsgType").MSG_TYPE.TEXT;c.decodedPayload=b.messageText;return c}else if(b.audioMessage!=null){var f;f=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").AudioTransportSpec,(f=b.audioMessage)==null?void 0:(f=f.audio)==null?void 0:f.payload);e=I(f,d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.AUDIO);c.msgType=d("WAMsgType").MSG_TYPE.PTT}else if(b.videoMessage!=null){f=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").VideoTransportSpec,(f=b.videoMessage)==null?void 0:(f=f.video)==null?void 0:f.payload);e=I(f,d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.VIDEO);e!=null&&e.xAttachmentType===d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.GIF?c.msgType=d("WAMsgType").MSG_TYPE.GIF:c.msgType=d("WAMsgType").MSG_TYPE.VIDEO}else if(b.imageMessage!=null){f=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").ImageTransportSpec,(f=b.imageMessage)==null?void 0:(f=f.image)==null?void 0:f.payload);e=I(f,d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.IMAGE);c.msgType=d("WAMsgType").MSG_TYPE.IMAGE}else if(b.stickerMessage!=null){f=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").StickerTransportSpec,(f=b.stickerMessage)==null?void 0:(b=f.sticker)==null?void 0:b.payload);e=I(f,d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.STICKER);c.msgType=d("WAMsgType").MSG_TYPE.STICKER}if(e!=null&&a!=null){y.set(d("WAStanzaUtils").toStanzaId(a),e);return c}d("WALogger").ERROR(o())}d("WALogger").ERROR(n());return void 0}function K(a){if(a.payload!=null){a=L(a);return a==null?void 0:(a=a.payload)==null?void 0:(a=a.content)==null?void 0:a.reactionMessage}}function L(a){var b;b=(b=a.metadata)==null?void 0:b.messageId;a=d("decodeProtobuf").decodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,a.payload);var c=d("WAParseMessageApplication").parseMessageApplication(a);if(c.type==="error"){d("WALogger").ERROR(m());return}if(c.subprotocolType!=="consumerMessage"){d("WALogger").ERROR(l());return}a=a.metadata;a=a==null?void 0:a.quotedMessage;a=a==null?void 0:a.stanzaId;b!=null&&a!=null&&(w.has(a)||v.add(a),x.set(b,a));return d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAConsumerApplication.pb").ConsumerApplicationSpec,c.payload)}function M(a){return a.map(function(a){var b=d("decodeProtobuf").decodeProtobuf(d("WAArmadilloBackupMessage.pb").BackupMessageSpec,a.toplevelProtobuf.decryptedProtobuf);b=J(b);var c=a.supplementalProtobufs;if(b!=null)for(var c=c,e=Array.isArray(c),f=0,c=e?c:c[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var g;if(e){if(f>=c.length)break;g=c[f++]}else{f=c.next();if(f.done)break;g=f.value}g=g;var h=g[0];g=g[1];if(!d("MessageBackupSupplementalKeyGenerator").isSupplementalProtobufAReaction(h))continue;var i=d("decodeProtobuf").decodeProtobuf(d("WAArmadilloBackupMessage.pb").BackupMessageSpec,g.decryptedProtobuf);i=K(i);h=d("MessageBackupSupplementalKeyGenerator").getSupplementalSenderId(h);i!=null&&h!=null&&b.reactionData.push({reaction:i,senderId:h,ts:d("WATimeUtils").castMilliSecondsToUnixTime(g.protobufTimestampMS)})}w.add(a.otid);return b})}function N(a,b,e,f,g){return z(a,e).then(function(){b!=null&&(v.forEach(function(a){d("MAWBridgeEventTransmitter").issuePointQueryOutsideTxn(a,b,void 0,c("LSMEBTaskCreationSource").EB_POINT_QUERY_IN_ACT,g)}),v.clear(),x.clear(),w.clear(),y.clear());if(f)return d("MAWHandleEchoMsgsRestoreApiV2").deleteMessages(a)})}function a(a,c,e,f,g,l,m,n,o,p,q){d("WALogger").LOG(k(),e.length,f);if(e.length>0){var r=q.map(function(a){return d("MAWJobDefinitions").toEncodedEchoMessage(a)}),s=c;return d("MAWHandleEchoMsgsRestoreApiV2").getThread(c).then(function(a){return a?P(a).then(function(k){if(k)return d("MAWHandleEchoMsgsRestoreApiV2").handleEchoMsgsBulkRestore(c,r,!1,g,l,m,void 0,void 0,p,void 0,void 0).then(function(){return(h||(h=b("Promise"))).resolve()});var n=a.jid;k=M(e);var o=!1;for(var q=k,t=Array.isArray(q),u=0,q=t?q:q[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var v;if(t){if(u>=q.length)break;v=q[u++]}else{u=q.next();if(u.done)break;v=u.value}v=v;if(v==null){o=!0;break}}if(o){d("WALogger").LOG(j());w.clear();return d("MAWHandleEchoMsgsRestoreApiV2").handleEchoMsgsBulkRestore(c,r,!1,g,l,m,void 0,void 0,p,void 0,void 0).then(function(){return(h||(h=b("Promise"))).resolve()})}var x=a,z=[],A=k.length;return k.reduce(function(b,c){return b.then(function(){if(c!=null){var b=D(c,n);if(b!=null)return d("MAWRestoreProtobufMsgsForThread").handleProtobufMessageRestore(b.authorJid,b.stanzaId,x,b.unstoredDbContent,g,l,f,A--).then(function(b){var e=b==null?void 0:b.updatedThread;b=b==null?void 0:b.dbMsg;e!==void 0&&(x=e);if(b!=null){z.push(b);if(y.has(b.externalId)){e=b.sortOrderMs;var g=d("WAParseConsumerMessageProtocol").interpretAsNonSystemAuthor(b.author),h=y.get(b.externalId);if(e==null)d("WALogger").ERROR(i());else if(h!=null&&b.mediaId==null){g={author:g,chatId:b.thread,echoMsg:void 0,externalId:b.externalId,isXMA:!1,mediaData:h,messageTimestamp:e,msgId:b.msgId,previewMediaData:void 0,threadJId:b.threadJid};void d("MAWHandleEchoMediaMsgsRestoreV2").downloadMediaAndWriteToMediaStore([g],a.chatId,n,f)}}}return O(c,n)})}})},(h||(h=b("Promise"))).resolve()).then(function(){return Q(z).then(function(b){return N(b.filter(Boolean),s,a.chatId,f,n)})})}):(h||(h=b("Promise"))).resolve()})}return(h||(h=b("Promise"))).resolve()}function O(a,c){var e=B(a,c);a=a.metadata;if(e!=null&&a!=null){var f=a.messageId;e.filter(Boolean).map(function(a){var b=a.ts;if(b!=null&&f!=null){var e=d("WAStanzaUtils").toStanzaId(f);return d("MAWWriteReactionMsgApi").writeReactionMsg(e,c,{groupingKey:a.groupingKey,reaction:a.reaction,reactToAuthor:a.reactToAuthor,reactToExternalId:a.reactToExternalId},b)}});return(h||(h=b("Promise"))).resolve()}}var P=d("MAWIndexedDb").makeMsgrTransactor({dyiBatch:e.READWRITE},"checkDyiInProgressTransactor",function(a){return function(b){return d("MAWRestoreMsgsTxns").checkIfBatchInProgress(a,b)}}),Q=d("MAWIndexedDb").makeMsgrTransactor({messages:e.READWRITE},"getUpdatedMsgAfterMediaDownload",function(a){return function(b){b=b.map(function(a){return a.rowId});return a.messages.bulkGet(b)}});g.associateQuotedMessagesForRestoredDbMsgsTransactor=z;g.handleProtobufsRestore=a}),98);
__d("MAWRestoreProtobufsFromEncryptedBackups",["MAWBridge","MAWGlobals","MAWHandleEchoProtobufsRestoreApi","MAWUpdateClientRestoreStatusOperationType","Promise","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Encountered unhandled exception while running job restoreProtobufsFromEncryptedBackups: ",""]);i=function(){return a};return a}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("decodeAndRestoreMessages",function(a){var c=a.echoMessages,e=a.hasMoreAfter,f=a.hasMoreBefore,g=a.instanceKey,j=a.isPointQuery,k=a.messages,l=a.minMsgId,m=a.referenceTimestamp,n=a.requestId,o=a.threadId;a=a.transportKey;try{return d("MAWHandleEchoProtobufsRestoreApi").handleProtobufsRestore(a,o,k,j,f,e,l,n,m,g,c)}catch(a){d("WALogger").ERROR(i(),a)}finally{m==null&&d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"UpdateClientRestoreStatus",value:{action:d("MAWUpdateClientRestoreStatusOperationType").markCompleteClientRestoreStatus,ebPrefetch:!1,threadId:o}}]});return(h||(h=b("Promise"))).resolve()}}).end();g.restoreProtobufsFromEncryptedBackups=a}),98);
__d("MAWRevokeMsgsApi",["MAWAckLevel","MAWBuildIncomingMsgs","MAWDbMsg","MAWDbMsgTxns","MAWDexieTable","MAWGlobals","MAWIndexedDb","MAWTransactionMode","MAWWriteRevokeMessageTxns","WAJids","WATimeUtils","justknobx"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({deletedMessages:(a=d("MAWTransactionMode")).READWRITE,groupInfo:a.READWRITE,messages:a.READWRITE,participants:a.READWRITE,reactions:a.READWRITE,threads:a.READWRITE,xma:a.READONLY},"revokeMsgs",function(a){return function(b,e){return d("MAWDexieTable").dexieAll(b.filter(function(a){return a.author===d("WAJids").AUTHOR_ME}).map(function(b){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b).then(function(c){return c==null?d("MAWDbMsgTxns").maybeGetRevokedMsgByProtocolMsgId(a,b):c}),d("MAWDexieTable").dexieResolve(b)])})).then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){var f=b[0];b=b[1];if(f==null)return;if(f.type==="Revoked"){b={author:d("WAJids").AUTHOR_ME,chat:b.chat,externalId:f.externalId};return b}var g=d("MAWGlobals").getDependencies().generateExternalId();return a.threads.get(f.thread).then(function(b){var h;if(b==null)return;h={ack:d("MAWAckLevel").ACK.clock,altIndex:void 0,author:d("WAJids").AUTHOR_ME,externalId:g,mediaId:f.mediaId,msgContent:d("MAWDbMsg").getMsgContent(f),msgId:f.msgId,originalTs:c("justknobx")._("1753")?f.ts:(h=f.serverTs)!=null?h:f.ts,quote:f.quote,reportingMeta:f.reportingMeta,revokedExternalId:f.externalId,rowId:f.rowId,sortOrderMs:f.sortOrderMs,thread:f.thread,threadJid:b.jid,ts:e,type:"Revoked",unsendMsgContentDeleteTs:d("WATimeUtils").castToUnixTime(e+d("MAWBuildIncomingMsgs").REVOKE_CONTENT_EXPIRATION_IN_SEC),xmaMessageType:f.xmaMessageType};return d("MAWDexieTable").dexieAll([d("MAWWriteRevokeMessageTxns").markExistingMsgRevoked(a,f,h,b)]).then(function(){var a={author:d("WAJids").AUTHOR_ME,chat:b.jid,externalId:g};return a})})}).filter(Boolean))})}});g.revokeMsgs=b}),98);
__d("MAWRevokeMsg",["MAWGlobals","MAWJobDefinitions","MAWRevokeMsgsApi","Promise","WAJids","WAJobOrchestratorTypes","WALogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["revokeMsg: ",""]);i=function(){return a};return a}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("revokeMsg",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){var f=a.msgIds;d("WALogger").DEV(i(),JSON.stringify(f));c=(yield d("MAWRevokeMsgsApi").revokeMsgs(f,e.jobStartTime));var g=[];a=c.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b=f[b];a!=null&&!d("WAJids").isAuthorSystem(a.author)&&(g.push({deleting:a,original:b}),yield d("MAWGlobals").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").createStartJobInfo("sendWrittenMsg",{protocolMsgId:a,referencedOriginalExternalId:b.externalId,scheduleConfig:{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},type:"revoke"})))});return function(b,c){return a.apply(this,arguments)}}());yield (h||(h=b("Promise"))).all(a);return g});return function(b,c,d){return a.apply(this,arguments)}}()).end();g.revokeMsgs=a}),98);
__d("MAWWriteEditMsgApi",["MAWIndexedDb","MAWTransactionMode","MAWWriteEditTxns"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,editMsgHistory:a.READWRITE,media:a.READONLY,messages:a.READWRITE,threads:a.READWRITE,xma:a.READONLY},"writeEditMsg",function(a){return function(b,c,e){c={args:c,externalId:b,ts:e};return d("MAWWriteEditTxns").writeEdit(a,c).then(function(a){return a})}});g.writeEditMsg=b}),98);
__d("MAWSendEditMsg",["MAWGlobals","MAWJobDefinitions","MAWWriteEditMsgApi","WAJobOrchestratorTypes","WALogger","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendEditMsg already sent a message"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendEditMsg cannot edit to a non-existent message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendEditMsg cannot send to a non-existent thread"]);j=function(){return a};return a}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("sendEditMsg",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){if(!d("MAWGlobals").getConfig().isEditMessageSendEnabled())throw c("err")("Edit message send feature is disabled.");b=(yield d("MAWWriteEditMsgApi").writeEditMsg(a.externalId,a.args,e.jobStartTime));if(!b.success){b.error==="missing_thread"?d("WALogger").ERROR(j()):b.error==="missing_msg"?d("WALogger").ERROR(i()):b.error==="already_sent"&&d("WALogger").ERROR(h());return}yield d("MAWGlobals").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").createStartJobInfo("sendWrittenMsg",{protocolMsgId:b.value.protocolMsgId,referencedOriginalExternalId:b.value.originalMsgExternalId,scheduleConfig:{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},type:"edit"}))});return function(b,c,d){return a.apply(this,arguments)}}()).end();g.sendEditMsg=a}),98);
__d("MAWGetSyncResponseBackoffInfoByJidApi",["MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({ephemeralSettings:d("MAWTransactionMode").READONLY},"getSyncResponseBackoffInfoByJid",function(a){return function(b){return a.ephemeralSettings.get({userJid:b}).then(function(a){return a==null?null:a.ephemeralSyncResponseBackoffInfo})}});g.getSyncResponseBackoffInfoByJid=a}),98);
__d("MAWSendEphemeralSettingMsg",["MAWGetSyncResponseBackoffInfoByJidApi","MAWGlobals","MAWJobDefinitions","MAWLoggerUtils","MAWMsgType","MAWWriteOutgoingMsgApi","WAJids","WAJobOrchestratorTypes","WASendMsgUtilV2","WATagsLogger","WATimeUtils","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendMsg cannot send to a non-existent thread"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendMsg already sent message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["send ephemeral setting message: chatJid ",", type ",", externalId ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["ephemeral sync response backed off"]);k=function(){return a};return a}var l=d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.Ephemeral,d("MAWLoggerUtils").Tag.SettingSync]);a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("sendEphemeralSettingMsg",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){b=a.args;var f=a.chatJid;a=a.externalId;if(b.isForSyncResponse){var g=(yield d("WAJids").switchOnMsgrChatJidType(f,{group:function(){throw c("err")("ChatJid is not supposed to be a group")},user:function(a){return d("MAWGetSyncResponseBackoffInfoByJidApi").getSyncResponseBackoffInfoByJid(a)}}));if(m(e.jobStartTime,g)){l.LOG(k());return}}g=b.isForSyncResponse?d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE;yield d("WASendMsgUtilV2").getDevicesBeforeSend(f,"SendEphemeralSettings");e=(yield d("MAWWriteOutgoingMsgApi").writeOutgoingMsg(a,f,e.jobStartTime,b,g));l.LOG(j(),f,g,a);if(e.type==="already_sent"){l.LOG(i());return}else if(e.type==="missing_thread"){l.LOG(h());return}yield d("MAWGlobals").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").createStartJobInfo("sendWrittenMsg",{protocolMsgId:e.protocolMsgId,scheduleConfig:{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},type:"message"}))});return function(b,c,d){return a.apply(this,arguments)}}()).end();function m(a,b){if(b==null)return!1;var c=b.syncResponseRetries;b=b.syncResponseSentTs;switch(c){case 1:return d("WATimeUtils").happenedWithinAt(a,b,3*60);case 2:return d("WATimeUtils").happenedWithinAt(a,b,15*60);default:return!0}}g.sendEphemeralSettingMsg=a}),98);
__d("MAWSendGroupInviteMsg",["MAWGlobals","MAWJobDefinitions","MAWMsgType","WAJobOrchestratorTypes","WALogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendGroupInviteMsg cannot send to a non-existent thread"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendGroupInviteMsg already sent message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendGroupInviteMsg for group "," to invited user ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendGroupInviteMsg failed to store a new group invite"]);k=function(){return a};return a}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("saveAndPassOff",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){b=a.args;var e=a.externalId,f=(yield d("MAWGlobals").getDbImpls().writeGroupInvite(b.groupJid,{expiration:b.expiration,inviteCode:b.inviteCode,invitedParticipantUserJid:b.invitedParticipantUserJid,inviterUserJid:b.inviterUserJid}));if(!f.success){d("WALogger").LOG(k());return}c=(yield d("MAWGlobals").getDbImpls().writeOutgoingMsg(e,b.groupJid,c.jobStartTime,babelHelpers["extends"]({},b,{groupName:(e=f.value)!=null?e:void 0}),d("MAWMsgType").MSG_TYPE.GROUP_INVITE));d("WALogger").DEV(j(),a.args.groupJid,a.args.invitedParticipantUserJid);if(c.type==="already_sent"){d("WALogger").LOG(i());return}else if(c.type==="missing_thread"){d("WALogger").LOG(h());return}yield d("MAWGlobals").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").createStartJobInfo("sendWrittenMsg",{protocolMsgId:c.protocolMsgId,scheduleConfig:{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},type:"message"}))});return function(b,c,d){return a.apply(this,arguments)}}()).end();g.sendGroupInviteMsg=a}),98);
__d("MAWStartMediaUploaQplFlow",["MAWGetStorageQplAnnotations","WAJids","WAMediaQplHelper","WAPREList","WAPREMetrics","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.chatJid,e=a.fileSize,f=a.serverMediaType;a=a.uploadEntry;var g=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MEDIA_UPLOAD,{string:{chat_type:d("WAJids").switchOnMsgrChatJidType(b,{group:function(){return"group"},user:function(){return"user"}}),jid:b,media_size:d("WAMediaQplHelper").convertIntegerSizeToStringBucket(e),media_type:f,upload_entry:a}},void 0);c("promiseDone")(d("MAWGetStorageQplAnnotations").getStorageQplAnnotations().then(function(a){g.addAnnotations(a)}));return g}g.startMediaUploaQplFlow=a}),98);
__d("WAHttpResumeCheck",["WALogger","WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["HttpResumeCheck: fail to parse request body ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["HttpResumeCheck: resume is NaN: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["HttpResumeCheck: object_id is missing"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["HttpResumeCheck: direct_path is missing"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["HttpResumeCheck: response status ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["HttpResumeCheck: fail to initiate fetch ",""]);m=function(){return a};return a}function a(a){var c,e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:g.prev=0;g.next=3;return b("regeneratorRuntime").awrap(fetch(a,{method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"text/plain"}}));case 3:c=g.sent;g.next=10;break;case 6:g.prev=6;g.t0=g["catch"](0);d("WALogger").ERROR(m(),g.t0);throw g.t0;case 10:e=c,f=e.status;d("WALogger").LOG(l(),f);g.t1=f;g.next=g.t1===200?15:g.t1===404?16:g.t1===408?17:g.t1===429?18:g.t1===507?18:19;break;case 15:return g.abrupt("return",c.json().then(function(a){var b=a.resume,c=a.direct_path;a=a.object_id;if(b==="complete"){if(c==null){d("WALogger").ERROR(k());return d("WAResultOrError").makeResult({type:"media-not-found"})}if(a==null){d("WALogger").ERROR(j());return d("WAResultOrError").makeResult({type:"media-not-found"})}return d("WAResultOrError").makeResult({type:"media-found",directPath:c,objectId:a})}c=parseInt(b,10);if(c===0)return d("WAResultOrError").makeResult({type:"media-not-found"});if(Number.isNaN(c)){d("WALogger").ERROR(i(),b);return d("WAResultOrError").makeResult({type:"media-not-found"})}return d("WAResultOrError").makeResult({type:"media-partial-found",resumeFromBytes:c})})["catch"](function(a){d("WALogger").ERROR(h(),a);return d("WAResultOrError").makeError("body-network-error")}));case 16:return g.abrupt("return",d("WAResultOrError").makeResult({type:"media-not-found"}));case 17:return g.abrupt("return",d("WAResultOrError").makeError("server-timeout"));case 18:return g.abrupt("return",d("WAResultOrError").makeError("upload-throttled"));case 19:if(!(f>=400&&f<500)){g.next=21;break}return g.abrupt("return",d("WAResultOrError").makeError("request-error"));case 21:return g.abrupt("return",d("WAResultOrError").makeError("unspecified-http-error"));case 22:case"end":return g.stop()}},null,this,[[0,6]])}g.httpResumeCheck=a}),98);
__d("WACheckCiphertextInServer",["WAHttpResumeCheck","WAMediaUrl","WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,c,e,f){return f.run(function(f,g){var h,i,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:h=d("WAMediaUrl").buildUploadUrl(a,e,c,f.domain,g,!0);k.next=3;return b("regeneratorRuntime").awrap(d("WAHttpResumeCheck").httpResumeCheck(h));case 3:i=k.sent;if(!i.success){k.next=8;break}return k.abrupt("return",d("WAResultOrError").makeResult(i));case 8:j=i.error;k.t0=j;k.next=k.t0==="server-timeout"?12:k.t0==="unspecified-http-error"?12:13;break;case 12:return k.abrupt("return",d("WAResultOrError").makeError({progressMade:!0}));case 13:return k.abrupt("return",d("WAResultOrError").makeResult(d("WAResultOrError").makeError(j)));case 14:case"end":return k.stop()}},null,this)}).then(function(a){return(a=a)!=null?a:d("WAResultOrError").makeError("max-attempts-exceeded")})}g.checkCiphertextInServer=a}),98);
__d("WACreateRetrier",["WAComms","WAGetMediaRoute","WAGlobals","WAMediaOperationsRetrier","WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,c){var e,f,g,h,i,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:c==null?void 0:c.addPoint("get_media_route_start");k.next=3;return b("regeneratorRuntime").awrap(d("WAGetMediaRoute").getMediaRoute({operation:"upload",serverMediaType:a},c));case 3:e=k.sent;c==null?void 0:c.addPoint("get_media_route_finish");if(e.success){k.next=7;break}return k.abrupt("return",e);case 7:f=e.value,g=f.selectedHost,h=f.fallbackHost,i=f.authToken;j=new(d("WAMediaOperationsRetrier").MediaOperationsRetrier)("upload",{host:{domain:g.domain,"class":g["class"]},fallbackHost:h&&{domain:h.domain,"class":h["class"]},authToken:i,timeElapsed:null},d("WAGlobals").getConfig().isMediaWaitForConnectionOnRetryEnabled()===!0?d("WAComms").waitForConnection:void 0);return k.abrupt("return",d("WAResultOrError").makeResult(j));case 10:case"end":return k.stop()}},null,this)}g.createUploadRetrier=a}),98);
__d("WAHttpRegularUploadMedia",["WAErr","WALogger","WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["HttpRegularUploadMedia: fail to parse request body ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Fetch Media HTTP status ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["HttpRegularUploadMedia: fail to initiate fetch ",""]);j=function(){return a};return a}function a(a,e){var f,g,k;return b("regeneratorRuntime").async(function(l){while(1)switch(l.prev=l.next){case 0:l.prev=0;l.next=3;return b("regeneratorRuntime").awrap(fetch(a,{method:"POST",mode:"cors",cache:"no-store",headers:{"Content-Type":"text/plain"},body:new Blob([e])}));case 3:f=l.sent;l.next=10;break;case 6:l.prev=6;l.t0=l["catch"](0);d("WALogger").ERROR(j(),l.t0);throw l.t0;case 10:g=f,k=g.status;d("WALogger").LOG(i(),k);l.t1=k;l.next=l.t1===200?15:l.t1===408?16:l.t1===413?17:l.t1===415?18:l.t1===429?19:l.t1===507?19:20;break;case 15:return l.abrupt("return",f.json().then(function(a){if(!Object.prototype.hasOwnProperty.call(a,"direct_path"))throw c("WAErr")("direct_path not available in wa upload http response");if(typeof a.direct_path!=="string")throw c("WAErr")('directPath: "'+a.direct_path+'" is not a string');if(a.object_id&&typeof a.object_id!=="string")throw c("WAErr")('objectId: "'+a.object_id+'" is not a string');if(a.handle&&typeof a.handle!=="string")throw c("WAErr")('handle: "'+a.handle+'" is not a string');a={directPath:a.direct_path,objectId:a.object_id,handle:a.handle};return d("WAResultOrError").makeResult(a)})["catch"](function(a){d("WALogger").ERROR(h(),a);return d("WAResultOrError").makeError("body-network-error")}));case 16:return l.abrupt("return",d("WAResultOrError").makeError("server-timeout"));case 17:return l.abrupt("return",d("WAResultOrError").makeError("payload-too-large"));case 18:return l.abrupt("return",d("WAResultOrError").makeError("invalid-media"));case 19:return l.abrupt("return",d("WAResultOrError").makeError("upload-throttled"));case 20:if(!(k>=400&&k<500)){l.next=22;break}return l.abrupt("return",d("WAResultOrError").makeError("request-error"));case 22:return l.abrupt("return",d("WAResultOrError").makeError("unspecified-http-error"));case 23:case"end":return l.stop()}},null,this,[[0,6]])}g.httpRegularUploadMedia=a}),98);
__d("WAEncryptAndUploadPlaintext",["WABase64","WAGlobals","WAHttpRegularUploadMedia","WAHttpResumeCheck","WALogger","WAMediaCrypto","WAMediaUrl","WAMediaUtils","WAProgressiveJpegGetPJpegDetails","WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: upload success "," ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext given up"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext error: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext error: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: start upload media to ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: error during retrier ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: Found valid progressiveJpeg details. Adding to media entry."]);n=function(){return a};return a}function a(a){var c,e,f,g,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q;return b("regeneratorRuntime").async(function(R){while(1)switch(R.prev=R.next){case 0:c=a.mediaTypeDetails,e=a.plaintextHash,f=a.plaintext,g=a.mediaKey,o=a.mediaKeyTimestamp,p=a.uploadToken,a._size,q=a.uploadRetrier,r=a.updateMediaEntry,s=a.mediaUploadQplFlow,t=a.filename,u=a.fromOffset,v=u===void 0?0:u;if(!(c.type==="preview")){R.next=11;break}R.next=4;return b("regeneratorRuntime").awrap(d("WAMediaCrypto").computeMediaKeysForPreview(g));case 4:A=R.sent;w=A.iv;x=A.cipherKey;y=A.hmacKey;z="preview";R.next=18;break;case 11:R.next=13;return b("regeneratorRuntime").awrap(d("WAMediaCrypto").computeMediaKeys(g,c.mediaType));case 13:B=R.sent,w=B.iv,x=B.cipherKey,y=B.hmacKey,z=c.mediaType;case 18:R.next=20;return b("regeneratorRuntime").awrap(d("WAMediaCrypto").encryptAndHmac(x,w,y,f,z));case 20:C=R.sent;D=C.ciphertext;E=C.ciphertextHash;F=C.sidecar;G=C.ivCiphertext;H=null;if(!(z==="image")){R.next=41;break}R.t0=b("regeneratorRuntime");R.t1=d("WAProgressiveJpegGetPJpegDetails").getProgressiveJpegDetails;R.t2=Uint8Array;R.next=32;return b("regeneratorRuntime").awrap(d("WAMediaUtils").blobToArrayBuffer(f));case 32:R.t3=R.sent;R.t4=new R.t2(R.t3);R.t5=G;R.t6=y;R.t7=R.t1(R.t4,R.t5,R.t6);R.next=39;return R.t0.awrap.call(R.t0,R.t7);case 39:I=R.sent,d("WAProgressiveJpegGetPJpegDetails").isValidProgressiveJpegDetails(I)&&d("WAGlobals").getConfig().isProgressiveJpegSendReceiveEnabled()&&(d("WALogger").LOG(n()),H=I);case 41:J={fileSha256:d("WABase64").decodeB64UrlSafe(e),fileEncSha256:E,mediaKey:g,mediaKeyTimestamp:o,serverMediaType:z,uploadToken:p,sidecar:F,filename:t,progressiveJpegDetails:H};R.next=44;return b("regeneratorRuntime").awrap(r(J));case 44:R.next=46;return b("regeneratorRuntime").awrap(q.run(function(a,c,e){var f,g,h,i,n,o;return b("regeneratorRuntime").async(function(q){while(1)switch(q.prev=q.next){case 0:f=a.domain;g=v;if(!(e>0)){q.next=19;break}q.prev=3;h=d("WAMediaUrl").buildUploadUrl(z,p,E,f,c,!0);q.next=7;return b("regeneratorRuntime").awrap(d("WAHttpResumeCheck").httpResumeCheck(h));case 7:i=q.sent;if(!i.success){q.next=14;break}n=i.value;if(!(n.type==="media-found")){q.next=13;break}s==null?void 0:s.addAnnotations({bool:{existingMediaFound:!0}});return q.abrupt("return",d("WAResultOrError").makeResult(d("WAResultOrError").makeResult({directPath:n.directPath,objectId:null,handle:null})));case 13:n.type==="media-partial-found"&&(g=n.resumeFromBytes);case 14:q.next=19;break;case 16:q.prev=16,q.t0=q["catch"](3),d("WALogger").ERROR(m(),q.t0);case 19:g>0&&g<D.byteLength?(s==null?void 0:s.addAnnotations({"int":{fromOffset:g},bool:{continuedFromOffset:!0}}),K=D.subarray(g)):K=D;o=d("WAMediaUrl").buildUploadUrl(z,p,E,f,c,!1,g);d("WALogger").LOG(l(),o);return q.abrupt("return",d("WAHttpRegularUploadMedia").httpRegularUploadMedia(o,K).then(function(a){if(a.success){s==null?void 0:s.addPoint("upload_finish",{"int":{byteLength:K.byteLength,attempt:e}});return d("WAResultOrError").makeResult(a)}else{a=a.error;d("WALogger").LOG(k(),a);switch(a){case"server-timeout":case"unspecified-http-error":return d("WAResultOrError").makeError({progressMade:!0});default:return d("WAResultOrError").makeResult(d("WAResultOrError").makeError(a))}}})["catch"](function(a){d("WALogger").ERROR(j(),a);return d("WAResultOrError").makeError({progressMade:!1})}));case 23:case"end":return q.stop()}},null,this,[[3,16]])}));case 46:L=R.sent;if(!(L==null)){R.next=51;break}d("WALogger").WARN(i());s==null?void 0:s.endFail("maxAttemptsExceeded");return R.abrupt("return",d("WAResultOrError").makeError("max-attempts-exceeded"));case 51:if(!(L.success===!1)){R.next=54;break}s==null?void 0:s.endFail(L.error);return R.abrupt("return",L);case 54:M=L.value,N=M.directPath,O=M.objectId,P=M.handle;R.next=57;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().getDownloadableThumbnailForMedia(e));case 57:Q=R.sent;J=babelHelpers["extends"]({},J,{directPath:N,downloadableThumbnail:Q,handle:P,objectId:O});R.next=61;return b("regeneratorRuntime").awrap(r(J));case 61:d("WALogger").LOG(h(),{directPath:N},{objectId:O});s==null?void 0:s.endSuccess();return R.abrupt("return",d("WAResultOrError").makeResult(J));case 64:case"end":return R.stop()}},null,this)}g.encryptAndUploadPlaintext=a}),98);
__d("WAIsMediaKeyReusable",["WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=2*d("WATimeUtils").DAY_SECONDS;function a(a){var b=Math.floor(Math.random()*d("WATimeUtils").DAY_SECONDS);return a!=null&&d("WATimeUtils").happenedWithin(a,h+b)}g.MMS_MEDIA_KEY_TTL=h;g.isMediaKeyReusable=a}),98);
__d("WAFindReusableMediaEntry",["WAGlobals","WAIsMediaKeyReusable","WAMediaUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("WAGlobals").getDbImpls().getMediaKnownEntries(a).then(function(a){if(b==null)return null;a=a.get(b);if(a==null)return null;a=d("WAMediaUtils").decodeMediaEntryData(a);var c=a.fileEncSha256,e=a.mediaKey,f=a.mediaKeyTimestamp,g=a.uploadToken;a=babelHelpers.objectWithoutPropertiesLoose(a,["fileEncSha256","mediaKey","mediaKeyTimestamp","uploadToken"]);return e!=null&&g!=null&&c!=null&&f!=null&&d("WAIsMediaKeyReusable").isMediaKeyReusable(f)?babelHelpers["extends"]({},a,{fileEncSha256:c,mediaKey:e,mediaKeyTimestamp:f,uploadToken:g}):null})}g.findReusableMediaEntryForArmadillo=a}),98);
__d("WAUploadMedia",["WABase64","WACheckCiphertextInServer","WACreateRetrier","WAEncryptAndUploadPlaintext","WAFindReusableMediaEntry","WAGlobals","WALogger","WAMediaUtils","WAResultOrError","WATimeUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: no plaintext"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: media is not on the server, start uploading"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: no plaintext"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: media is partially on the server, start uploading from byteOffset ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: media is on the server"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: resume/exist check exhausted available retries"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: async upload"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: no plaintext"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: no media entry found, need to upload media"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: fail to gather media routes"]);q=function(){return a};return a}a=function(a){var c,e,f,g,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S;return b("regeneratorRuntime").async(function(T){while(1)switch(T.prev=T.next){case 0:a.chatJid,c=a.filename,e=a.hash,f=a.mediaTypeDetails,g=a.protocolMsgId,s=a.size,t=a.uploadMediaMetric;f.type==="regular"?u=f.mediaType:u="preview";T.next=4;return b("regeneratorRuntime").awrap(d("WACreateRetrier").createUploadRetrier(u,t));case 4:v=T.sent;if(v.success){T.next=9;break}d("WALogger").WARN(q());t==null?void 0:t.endFail("failToGatherMediaRoutes");return T.abrupt("return",v);case 9:w=v.value;x=r(g,e);T.next=13;return b("regeneratorRuntime").awrap(d("WAFindReusableMediaEntry").findReusableMediaEntryForArmadillo(e,g));case 13:y=T.sent;if(!(y==null)){T.next=27;break}d("WALogger").LOG(p());z=d("WAMediaUtils").createMediaKey();A=d("WAMediaUtils").createUploadToken();B=d("WATimeUtils").unixTime();T.next=21;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().getMediaPlaintext(e));case 21:C=T.sent;if(!(C==null)){T.next=26;break}d("WALogger").ERROR(o());t==null?void 0:t.endFail("missingPlaintext");return T.abrupt("return",d("WAResultOrError").makeError("no-plaintext"));case 26:return T.abrupt("return",d("WAEncryptAndUploadPlaintext").encryptAndUploadPlaintext({_size:s,filename:c,mediaKey:z,mediaKeyTimestamp:B,mediaTypeDetails:f,mediaUploadQplFlow:t,plaintext:C,plaintextHash:e,updateMediaEntry:x,uploadRetrier:w,uploadToken:A}));case 27:D=y.directPath,E=y.downloadableThumbnail,F=y.fileEncSha256,G=y.fileSha256,H=y.mediaKey,I=y.mediaKeyTimestamp,J=y.objectId,K=y.uploadToken;L={directPath:D,downloadableThumbnail:E,fileEncSha256:F,filename:c,fileSha256:G||d("WABase64").decodeB64UrlSafe(e),mediaKey:H,mediaKeyTimestamp:I,objectId:J,serverMediaType:u,uploadToken:K};if(!(D!=null)){T.next=35;break}d("WALogger").LOG(n());T.next=33;return b("regeneratorRuntime").awrap(x(L));case 33:t==null?void 0:t.endSuccess({bool:{reused_media_entry:!0}});return T.abrupt("return",d("WAResultOrError").makeResult(L));case 35:T.next=37;return b("regeneratorRuntime").awrap(d("WACheckCiphertextInServer").checkCiphertextInServer(u,F,K,w));case 37:M=T.sent;if(M.success){T.next=42;break}d("WALogger").WARN(m());t==null?void 0:t.endFail("failToUpload");return T.abrupt("return",M);case 42:N=M.value;if(!(N.type==="media-found")){T.next=53;break}d("WALogger").LOG(l());t==null?void 0:t.addAnnotations({bool:{existingMediaFound:!0}});O=babelHelpers["extends"]({},L,{directPath:N.directPath,objectId:N.objectId});T.next=49;return b("regeneratorRuntime").awrap(x(O));case 49:t==null?void 0:t.endSuccess({bool:{reused_media_entry:!0}});return T.abrupt("return",d("WAResultOrError").makeResult(O));case 53:if(!(N.type==="media-partial-found")){T.next=64;break}d("WALogger").LOG(k(),N.resumeFromBytes);P=N.resumeFromBytes;T.next=58;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().getMediaPlaintext(e));case 58:Q=T.sent;if(!(Q==null)){T.next=63;break}d("WALogger").ERROR(j());t==null?void 0:t.endFail("missingPlaintext");return T.abrupt("return",d("WAResultOrError").makeError("no-plaintext"));case 63:return T.abrupt("return",d("WAEncryptAndUploadPlaintext").encryptAndUploadPlaintext({_size:s,filename:c,fromOffset:P,mediaKey:H,mediaKeyTimestamp:I,mediaTypeDetails:f,mediaUploadQplFlow:t,plaintext:Q,plaintextHash:e,updateMediaEntry:x,uploadRetrier:w,uploadToken:K}));case 64:d("WALogger").LOG(i());R=d("WATimeUtils").unixTime();T.next=68;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().getMediaPlaintext(e));case 68:S=T.sent;if(!(S==null)){T.next=73;break}d("WALogger").ERROR(h());t==null?void 0:t.endFail("missingPlaintext");return T.abrupt("return",d("WAResultOrError").makeError("no-plaintext"));case 73:return T.abrupt("return",d("WAEncryptAndUploadPlaintext").encryptAndUploadPlaintext({_size:s,filename:c,mediaKey:H,mediaKeyTimestamp:R,mediaTypeDetails:f,mediaUploadQplFlow:t,plaintext:S,plaintextHash:e,updateMediaEntry:x,uploadRetrier:w,uploadToken:K}));case 74:case"end":return T.stop()}},null,this)};function r(a,b){return function(c){var e=d("WAMediaUtils").encodeMediaEntryForUpload(c);if(a==null)return d("WAGlobals").getDbImpls().updateMediaEntryForOptimisticUpload(b,function(){return e},c==null?void 0:c.objectId,c==null?void 0:c.serverMediaType);else return d("WAGlobals").getDbImpls().updateMediaEntryForMsg(b,a,function(){return e},c==null?void 0:c.objectId,c==null?void 0:c.serverMediaType)}}g.uploadMedia=a}),98);
__d("MAWSendMsg",["MAWGlobals","MAWJobDefinitions","MAWMsgType","MAWODSProxy","MAWQplProxy","MAWWriteOutgoingMsgApi","Promise","WAGlobals","WAJobOrchestratorTypes","WALogger","WAOdsEnums","WASendMsgUtilV2","asyncToGeneratorRuntime","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendMsg cannot send to a non-existent thread"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendMsg already sent message"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendMsg: ",""]);k=function(){return a};return a}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("writeToDb",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){e=a.args;var g=a.chatJid;a=a.externalId;d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"received_message_in_wajob",{instanceKey:e.s2sInstanceKey});d("WAGlobals").getConfig().offlineProcessingState()!=="idle"&&d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MSG_SEND,key:"offline"});yield d("WASendMsgUtilV2").getDevicesBeforeSend(g,"sendMsg");a=(yield d("MAWWriteOutgoingMsgApi").writeOutgoingMsg(a,g,f.jobStartTime,e,d("MAWMsgType").MSG_TYPE.TEXT));d("WALogger").DEV(k(),g);if(a.type==="already_sent")d("WALogger").LOG(j()),d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"message_already_sent_to_backend",{instanceKey:e.s2sInstanceKey});else if(a.type==="missing_thread"){d("WALogger").LOG(i());d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"failed_message_missing_thread",{instanceKey:e.s2sInstanceKey});return(h||(h=b("Promise"))).reject("sendMsg sends a message to a non-existent thread")}else yield d("MAWGlobals").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").createStartJobInfo("sendWrittenMsg",{protocolMsgId:a.protocolMsgId,s2sInstanceKey:e.s2sInstanceKey,scheduleConfig:{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},type:"message"})),d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"successful_message_sent_to_backend",{instanceKey:e.s2sInstanceKey})});return function(b,c,d){return a.apply(this,arguments)}}()).end();g.sendMsg=a}),98);
__d("MAWSendRavenActionMsg",["MAWGlobals","MAWJobDefinitions","MAWMsgType","WAJobOrchestratorTypes","WALogger","WASendMsgUtilV2","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendRavenActionMsg cannot send to a non-existent thread"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendRavenActionMsg already sent message"]);i=function(){return a};return a}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("sendRavenActionMsg",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){b=a.args;var e=a.chatJid;a=a.externalId;yield d("MAWGlobals").getDbImpls().modifyRavenMsg(b.ravenProtocolMsgId);yield d("WASendMsgUtilV2").getDevicesBeforeSend(e,"sendRavenActionMsg");a=(yield d("MAWGlobals").getDbImpls().writeOutgoingMsg(a,e,c.jobStartTime,b,d("MAWMsgType").MSG_TYPE.RAVEN_ACTION));if(a.type==="already_sent"){d("WALogger").LOG(i());return}else if(a.type==="missing_thread"){d("WALogger").LOG(h());return}yield d("MAWGlobals").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").createStartJobInfo("sendWrittenMsg",{protocolMsgId:a.protocolMsgId,scheduleConfig:{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},type:"message"}))});return function(b,c,d){return a.apply(this,arguments)}}()).end();g.sendRavenActionMsg=a}),98);
__d("MAWSendReactionMsg",["MAWGlobals","MAWJobDefinitions","MAWWriteReactionMsgApi","WALogger","WASendMsgUtilV2","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendReactionMsg cannot react to a non-existent message"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendReactionMsg cannot send to a non-existent thread"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendReactionMsg already sent message"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendReactionMsg: ",""]);k=function(){return a};return a}function l(a){return a==="\u2764\ufe0f"?"\u2764":a}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("saveAndPassOff",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){b=a.args;var e=a.chatJid;a=a.externalId;d("WALogger").DEV(k(),e);var f=b.reaction,g=b.reactToProtocolMsgId;f=l(f);var m=d("MAWGlobals").getJidUtilsApi();m=m.toUserJid;m=m(b.reactToAuthor);yield d("WASendMsgUtilV2").getDevicesBeforeSend(e,"sendReactionMsg");b=(yield d("MAWWriteReactionMsgApi").writeReactionMsg(a,e,{groupingKey:f,reaction:f,reactToAuthor:m,reactToExternalId:g.externalId},c.jobStartTime));if(b.type==="already_sent"){d("WALogger").LOG(j());return}else if(b.type==="missing_thread"){d("WALogger").LOG(i());return}else if(b.type==="missing_msg"){d("WALogger").LOG(h());return}yield d("MAWGlobals").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").createStartJobInfo("sendWrittenMsg",{protocolMsgId:b.protocolMsgId,type:"reaction"}))});return function(b,c,d){return a.apply(this,arguments)}}()).end();g.sendReactionMsg=a}),98);
__d("MAWSendWrittenAppData",["MAWGlobals","MAWJobDefinitions","WALogger","WASendAppDataFanoutProtocol","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenAppData(","): too old, dropping"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenAppData not sending message: ",""]);i=function(){return a};return a}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("encryptAndSend",{code:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.appDataExternalId;var b=(yield d("MAWGlobals").getDbImpls().getAppData(a));if(b.type!=="not_sent"){d("WALogger").LOG(i(),b.type);return{type:"error"}}b=(yield d("WASendAppDataFanoutProtocol").sendAppDataToDevicesProtocol(b.appData,a,b.permittedIdentitiesPerDevice,b.sendPartial?"dontCheckPhash":"checkPhash"));if(b.success===!0){b.value.phashMismatch===!0&&(yield d("MAWGlobals").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").jobSerializers.resendWrittenAppData(a)));yield d("MAWGlobals").getDbImpls().markAppDataSent(a);return{type:"success"}}else{yield d("MAWGlobals").getDbImpls().markAppDataSendFailed(a);return{type:"error"}}});function c(b){return a.apply(this,arguments)}return c}(),stopRetryIf:{onStopRetry:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.appDataExternalId;d("WALogger").LOG(h(),a);yield d("MAWGlobals").getDbImpls().markAppDataDropped(a);return{type:"error"}});function c(b){return a.apply(this,arguments)}return c}(),timePassedSeconds:d("WATimeUtils").DAY_SECONDS}}).end();g.sendWrittenAppData=a}),98);
__d("MAWGetEditMsgForSending",["MAWAckLevel","MAWAsMessageApplication","MAWDbEditMsgHistoryTxns","MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWTransactionMode","WAJids","WALogger","WAResultOrError","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendEditMsg] Failed to get originalMsg"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendEditMsg] Failed to get thread (success:",")"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendEditMsg] Failed to get originalMsgProtocolMsgId"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendEditMsg] Failed to get edit history"]);k=function(){return a};return a}b=d("MAWIndexedDb").makeMsgrTransactor({editMsgHistory:(a=d("MAWTransactionMode")).READONLY,messages:a.READONLY,participants:a.READONLY,reactions:a.READONLY,threads:a.READONLY},"getEditMsgForSending",function(a){return function(b,e){return l(a,b,e).then(function(a){if(!a.success)return{type:a.error};a=a.value.msg;var e=d("MAWAsMessageApplication").asEditMessageApplication(a);if(d("WAJids").isAuthorSystem(a.author))throw c("err")("This cannot happen because there are no system edit");return{dbMsg:a,editOriginalExternalId:a.originalMsgExternalId,messageApplication:e,messageType:{isRevoked:!1,type:"text"},protocolMsgId:b,type:"unsent"}})}});function l(a,b,c){return d("MAWDbEditMsgHistoryTxns").getEditHistoryMsgByEditedProtocolMsgId(a,b,c).then(function(b){if(b==null){d("WALogger").ERROR(k());return d("WAResultOrError").makeError("missing_history")}else if(b.sendStatus!=null&&b.sendStatus>d("MAWAckLevel").ACK.clock)return d("WAResultOrError").makeError("sent");var c=d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.threadJid,b.originalMsgExternalId);if(c==null){d("WALogger").ERROR(j());return d("WAResultOrError").makeError("missing_msg")}return d("MAWDexieTable").dexieAll([d("MAWDbThreadTxns").getThreadByJid(a,b.threadJid),d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,c)]).then(function(a){var c=a[0];a=a[1];if(!c.success){d("WALogger").ERROR(i(),c.success);return d("WAResultOrError").makeError("missing_thread")}if(a==null){d("WALogger").ERROR(h());return d("WAResultOrError").makeError("missing_msg")}return a.ack>d("MAWAckLevel").ACK.clock?d("WAResultOrError").makeError("sent"):d("WAResultOrError").makeResult({msg:b,thread:c.value})})})}g.getEditMsgForSending=b}),98);
__d("MAWMediaType",["WAServerMediaType"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(a){case"XMA":return"xma-image";case"EphemeralScreenshotAction":case"Raven":case"RavenAction":case"EditAction":case"BumpExistingMessage":return null;default:return d("WAServerMediaType").getMediaType(a)}}g.getMediaType=a}),98);
__d("MAWSendMsgUtil",["MAWMediaType","WASendMsgUtil"],(function(a,b,c,d,e,f,g){"use strict";var h={};function a(a){var b=d("MAWMediaType").getMediaType(a);if(b!=null)return{mediaType:b,type:"media"};switch(a){case"XMA":case"Raven":case"RavenAction":case"EphemeralScreenshotAction":case"EditAction":case"BumpExistingMessage":return{isRevoked:!1,type:"text"};default:return d("WASendMsgUtil").getMessageTypeFromMsg(a)}}function b(a){return h[a]}function c(a){h[a]=!0}function e(a){delete h[a]}g.getMessageTypeFromMsg=a;g.checkS2SInstanceKeyExist=b;g.addS2SInstanceKey=c;g.removeS2SInstanceKey=e}),98);
__d("MAWGetMsgForSendingApi",["MAWAckLevel","MAWAsMessageApplication","MAWDbGroupInviteTxns","MAWDbMediaTxns","MAWDbMsg","MAWDbMsgTxns","MAWDbParticipantTxns","MAWDbThreadTxns","MAWDbUnrenderedMsgTxns","MAWDbXMATxns","MAWDexieTable","MAWIndexedDb","MAWMsgType","MAWSendMsgUtil","MAWTransactionMode","MAWXMAUtils","WAJids","WALogger","WAResultOrError","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendMsg] Failed to get XMA: isXma: ",", type: "," "]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendMsg] Failed to get thread (success:",")"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendMsg] Failed to get message"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg "," -- MAWGetMsgForSendingAPI -- Done"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg "," -- MAWGetMsgForSendingAPI -- Unrecognized type ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg "," -- MAWGetMsgForSendingAPI -- Error: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg "," -- MAWGetMsgForSendingAPI -- Entering"]);n=function(){return a};return a}b=d("MAWIndexedDb").makeMsgrTransactor({groupInvites:(a=d("MAWTransactionMode")).READONLY,media:a.READONLY,messages:a.READONLY,participants:a.READONLY,reactions:a.READONLY,threads:a.READONLY,unrenderedMessages:a.READONLY,xma:a.READONLY},"getMsgForSending",function(a){return function(b){return o(a,b).then(function(a){d("WALogger").LOG(n(),b);if(!a.success){d("WALogger").LOG(m(),b,a.error);return{type:a.error}}a=a.value;var e=a.contactsInThread,f=a.groupInvite,g=a.isReplyMsg,h=a.media,i=a.msg,j=a.thread;a=a.xmaPayload;if(!d("MAWDbMsg").NO_CONTENT_MESSAGE_TYPES_ALLOWLIST.includes(i.type)&&!d("MAWDbMsg").isContentMsg(i)){d("WALogger").LOG(l(),b,i.type);throw c("err")("We do not support message sending with "+i.type+" type")}var o=d("MAWAsMessageApplication").asMessageApplication(i,h,f,a),p=null;i.type===d("MAWMsgType").MSG_TYPE.GROUP_INVITE&&f?p={invitedParticipantUserJid:f.inviteeJid,isRevoked:!1,type:"text"}:p=d("MAWSendMsgUtil").getMessageTypeFromMsg(i.type);if(d("WAJids").isAuthorSystem(i.author))throw c("err")("A system message cannot be sent");d("WALogger").LOG(k(),b);return{contactsInThread:e,dbMsg:i,isReplyMsg:g,isXMAMsg:a!=null,media:h,messageApplication:o,messageType:p,protocolMsgId:{author:i.author,chat:j.jid,externalId:a!=null&&a.associatedMessage!=null?a.associatedMessage.externalId:i.externalId},type:"unsent"}})}});function o(a,b){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b),d("MAWDbUnrenderedMsgTxns").maybeGetUnrenderedMsgByProtocolMsgId(a,b)]).then(function(c){var e=c[0];c=c[1];var f=c.value,g=e||f;if(g==null){d("WALogger").ERROR(j());return d("WAResultOrError").makeError("missing_msg")}else if(g.ack>d("MAWAckLevel").ACK.clock)return d("WAResultOrError").makeError("sent");var k=d("MAWXMAUtils").maybeXMAMessage(e),l=g.quote!=null;return d("MAWDexieTable").dexieAll([d("MAWDbThreadTxns").getThread(a,g.thread),e?d("MAWDbMediaTxns").getAndCheckMediaFromMsg(a,e):d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult()),c.success?d("MAWDbGroupInviteTxns").getAndCheckGroupInviteFromMsg(a,c.value):d("MAWDexieTable").dexieResolve(),k?d("MAWDbXMATxns").maybeGetXMAPayloadFromProtocolMsgId(a,b):null,d("MAWDbParticipantTxns").getParticipantsInThread(a,g.threadJid).then(function(a){return a.map(function(a){return a.userJid})})]).then(function(a){var b=a[0],c=a[1],e=a[2],f=a[3];a=a[4];if(!c.success)return c;if(!b.success){d("WALogger").ERROR(i(),b.success);return d("WAResultOrError").makeError("missing_thread")}if(f!=null&&!f.success){d("WALogger").ERROR(h(),k,g.type);return d("WAResultOrError").makeError("missing_xma")}c=c.value;b=b.value;return d("WAResultOrError").makeResult({contactsInThread:a,groupInvite:e,isReplyMsg:l,media:c,msg:g,thread:b,xmaPayload:f!=null?f.value:null})})})}g.getMsgForSending=b}),98);
__d("MAWGetReactionForSending",["MAWAckLevel","MAWAsMessageApplication","MAWDbReactionsTxns","MAWDbThreadTxns","MAWIndexedDb","MAWTransactionMode","WAJids","WAResultOrError","err"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return d("MAWDbReactionsTxns").getReaction(a,b).then(function(b){if(b==null)return d("WAResultOrError").makeError("missing");else if(b.ack>d("MAWAckLevel").ACK.clock)return d("WAResultOrError").makeError("sent");return d("MAWDbThreadTxns").getThreadByJid(a,b.threadJid).then(function(a){return!a.success?d("WAResultOrError").makeError(a.error):d("WAResultOrError").makeResult({msg:b})})})}a=d("MAWIndexedDb").makeMsgrTransactor({reactions:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY},"getReactionForSending",function(a){return function(b){return h(a,b).then(function(a){if(!a.success)return{type:a.error};a=a.value.msg;var b=d("MAWAsMessageApplication").asReactionMessageApplication(a);if(d("WAJids").isAuthorSystem(a.author))throw c("err")("This cannot happen because there are no system reactions");return{chat:a.threadJid,dbMsg:a,externalId:a.externalId,messageApplication:b,messageType:{isInvisible:!0,type:"reaction"},protocolMsgId:{author:a.author,chat:a.threadJid,externalId:a.externalId},type:"unsent"}})}});g.getReactionForSending=a}),98);
__d("MAWMarkEditMsgDroppedApi",["FBLogger","MAWAckLevel","MAWBridgeMsg","MAWBridgeTypesCreators","MAWDbEditMsgHistoryTxns","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWThreadSnippetForTextMsg","MAWTransactionMode","WAGlobals","WAJids","WALogger","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] editMsgHistory updated"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] originalMsg is not a text message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] thread is null"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] newestEditedMsg is not the newest edit"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] originalMsg or editHistoryMsg is null"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] originalProtocolMsgId is null"]);m=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({editMsgHistory:d("MAWTransactionMode").READWRITE,messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE},"markEditMsgDropped",function(a){return function(b,e){var f=d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.chat,e);if(f==null){d("WALogger").ERROR(m());return d("MAWDexieTable").dexieResolve()}return d("MAWDexieTable").dexieAll([a.threads.get({jid:b.chat}),d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,f),d("MAWDbEditMsgHistoryTxns").maybeGetEditMsgHistoryFromProtocolMsgId(a,f),a.messages.where("quoteExternalId").equals(e).toArray()]).then(function(e){var f=e[0],g=e[1],m=e[2];e=e[3];var n=m.sort(function(a,b){return b.editTs-a.editTs}),o=m.find(function(a){return a.editExternalId===b.externalId}),p=n[1];if(g==null||p==null||o==null){d("WALogger").ERROR(l());return}if(o.editExternalId!==n[0].editExternalId){d("WALogger").ERROR(k());return}if(f==null){d("WALogger").ERROR(j());return}if(g.type!==d("WAMsgType").MSG_TYPE.TEXT){d("WALogger").ERROR(i());return}var q=babelHelpers["extends"]({},g,{ack:d("MAWAckLevel").ACK.sent,editCount:((n=g.editCount)!=null?n:0)-1,msgContent:p.msgContent}),r=d("WAGlobals").getMyUserJid(),s=[];n=e.find(function(a){var c;return(((c=a.quote)==null?void 0:c.content.author)===d("WAJids").AUTHOR_ME||((c=a.quote)==null?void 0:c.content.author)===r)&&a.threadJid===b.chat});if(n!=null){e=n.quote;var t=n.quoteExternalId;if(e==null)c("FBLogger")("messenger_e2ee_web").warn("[markEditMsgDropped] Failed to get the quoted content for a msg that has been quoted.",t);else{t=babelHelpers["extends"]({},n,{quote:babelHelpers["extends"]({},e,{content:babelHelpers["extends"]({},e.content,{msgContent:babelHelpers["extends"]({},q.msgContent)})})});s.push(t)}}n=[];g.editCount===1&&m.length===2&&n.push(p.editMsgHistoryId);n.push(o.editMsgHistoryId);return d("MAWDexieTable").dexieAll([a.messages.put(q),a.editMsgHistory.bulkDelete(n)]).then(function(){d("WALogger").LOG(h());d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(q)});s.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(a)})});if(f.newestMsg!=null&&f.newestMsg===g.msgId){var a=d("WAJids").userIdFromJid(d("WAGlobals").getMyUserJid()),b=c("MAWThreadSnippetForTextMsg")(q,a,d("WAJids").interpretAsGroupJid(f.jid)!=null),e=b.snippetParams;b=b.snippetType;d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({snippetParams:e,snippetSenderContactId:a,snippetType:b,threadId:f.chatId,threadJid:f.jid})})}})})}});g.markEditMsgDropped=a}),98);
__d("MAWMarkEditMsgSentApi",["ArmadilloDataTraceType","MAWAckLevel","MAWBridgeMsg","MAWBridgeTrace","MAWBridgeTraceEvent","MAWDbEditMsgHistory","MAWDbEditMsgHistoryTxns","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWLoadReplyMediaTxns","MAWTransactionMode","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] editMsgHistory updated"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] on incoming message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] editMsgHistory has already been sent"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] originalMsg or editHistoryMsg is null"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] originalProtocolMsgId is null"]);l=function(){return a};return a}b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,editMsgHistory:a.READWRITE,media:a.READONLY,messages:a.READWRITE,xma:a.READONLY},"markMsgSent",function(a){return function(b,e,f,g){var m=d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.chat,e);if(m==null){d("WALogger").ERROR(l());return d("MAWDexieTable").dexieResolve()}return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,m),d("MAWDbEditMsgHistoryTxns").maybeGetEditMsgHistoryFromProtocolMsgId(a,m)]).then(function(l){var m=l[0];l=l[1];var n=l.find(function(a){return a.editExternalId===e}),o=l.find(function(a){return a.editExternalId===b.externalId});if(m==null||n==null||(o==null?void 0:o.editExternalId)==null){d("WALogger").ERROR(k());return}if(o.sendStatus!=null&&o.sendStatus>d("MAWAckLevel").ACK.clock&&m.ack>d("MAWAckLevel").ACK.clock){d("WALogger").LOG(j());return}if(o.author!==d("WAJids").AUTHOR_ME){d("WALogger").ERROR(i());return}d("MAWIndexedDb").afterTransaction({tag:"UpdateTrace",value:d("MAWBridgeTrace").createBridgeUpdateTraceData([o.editExternalId],c("MAWBridgeTraceEvent").ReceivedSent,d("ArmadilloDataTraceType").armadilloMessageSend)});var p=[];if(l.length===2&&m.editCount===1){l=babelHelpers["extends"]({},n,{sendStatus:d("MAWAckLevel").ACK.sent});p.push(l)}n=babelHelpers["extends"]({},o,{editTs:f,sendStatus:d("MAWAckLevel").ACK.sent});p.push(n);var q=p.map(function(a){return babelHelpers["extends"]({},a,{editMsgHistoryId:d("MAWDbEditMsgHistory").convertToEditMsgHistoryId64(a.editMsgHistoryId),originalMsgId:m.msgId})}),r=babelHelpers["extends"]({},m,{ack:d("MAWAckLevel").ACK.sent});g!=null&&(r.reportingMeta=g);return d("MAWDexieTable").dexieAll([a.editMsgHistory.bulkPut(p),a.messages.put(r),d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,r)]).then(function(a){a[0];a=a[2];d("WALogger").LOG(h());d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(r,void 0,a)});d("MAWIndexedDb").afterTransaction({tag:"EditMsgHistoryAdded",value:q})})})}});g.markEditMsgSent=b}),98);
__d("MAWMarkMsgDroppedApi",["MAWAckLevel","MAWDbMsgTxns","MAWDbReactionsTxns","MAWDexieTable","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,media:a.READONLY,messages:a.READWRITE,reactions:a.READWRITE,threads:a.READWRITE,xma:a.READONLY},"markMsgDropped",function(a){return function(b){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b),d("MAWDbReactionsTxns").maybeGetReactionByProtocolMsgId(a,b)]).then(function(b){var c=b[0];b=b[1];if(c!=null)return d("MAWDbMsgTxns").updateSystemAck(a,c.msgId,d("MAWAckLevel").ACK.expired).then(function(a){return a==null?"missing":a.ack<=d("MAWAckLevel").ACK.clock?"dropped":"sent"});return b!=null?d("MAWDbReactionsTxns").deleteReaction(a,b).then(function(){return"dropped"}):"missing"})}});g.markMsgDropped=b}),98);
__d("MAWMarkMsgSentApi",["ArmadilloDataTraceType","I64","MAWAckLevel","MAWBridgeTrace","MAWBridgeTraceEvent","MAWBridgeTypesCreators","MAWCalculateBumpTimestampMs","MAWDbMsg","MAWDbMsgTxns","MAWDbThread","MAWDbThreadTxns","MAWDbUnrenderedMsgTxns","MAWDexieTable","MAWEphemeralGatingUtil","MAWEphemeralMsgTxns","MAWEphemeralSettingsTxns","MAWIndexedDb","MAWMsgType","MAWThreadSnippetBuildTxns","MAWTransactionMode","WALogger","WATimeUtils","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Thread missing from DB"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Found both regular and unrendered message with the same protocol msg ID"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Msg missing from DB"]);k=function(){return a};return a}b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,ephemeralSettings:a.READWRITE,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,threads:a.READWRITE,unrenderedMessages:a.READWRITE,xma:a.READONLY},"markMsgSent",function(a){return function(b,e,f){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b),d("MAWDbUnrenderedMsgTxns").maybeGetUnrenderedMsgByProtocolMsgId(a,b)]).then(function(g){var l=g[0];g=g[1];if(l==null&&!g.success){d("WALogger").LOG(k());return}else if(l!=null){d("MAWIndexedDb").afterTransaction({tag:"UpdateTrace",value:d("MAWBridgeTrace").createBridgeUpdateTraceData([l.externalId],c("MAWBridgeTraceEvent").ReceivedSent,d("ArmadilloDataTraceType").armadilloMessageSend)});g.success&&d("WALogger").ERROR(j());var m=l.ack<d("MAWAckLevel").ACK.sent;return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").updateSystemAck(a,l.msgId,d("MAWAckLevel").ACK.sent,e,f),d("MAWDbThreadTxns").getThread(a,l.thread)]).then(function(b){var f=b[0];b=b[1];if(!b.success){d("WALogger").ERROR(i());return}var g=b.value,j=d("WATimeUtils").castUnixTimeToMillisTime(e);b=babelHelpers["extends"]({},g,{lastReadMsgTs:j,newestMsgTs:j,threadOrder:d("MAWDbThread").craftThreadOrder(j,g.jid)});b=m?d("MAWDbThreadTxns").updateThread(a,b):d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([d("MAWEphemeralGatingUtil").isSendBasedDisappearingMessageEnabled()?d("MAWEphemeralMsgTxns").markEphemeralMessageAsSent(a,f):d("MAWEphemeralMsgTxns").maybeUpdateEphemeralMessageWhenMarkedSent(a,f,e),b]).then(function(){if(l.altIndex!==d("MAWDbMsg").SPAM_ALT_INDEX&&l.altIndex!==d("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX&&m)if(!c("gkx")("23996"))d("MAWIndexedDb").afterTransaction({tag:"ThreadBumpedServer",value:{description:"markMsgSent",isCurrentDeviceSendingMsg:!0,lastActivityTs:j,lastMsgExternalId:f?(h||(h=d("I64"))).of_string_opt(f.externalId):void 0,threadId:g.chatId,threadJid:g.jid}});else return d("MAWThreadSnippetBuildTxns").buildThreadSnippet(a,l,g).then(function(a){var b=a.snippetParams,c=a.snippetSenderContactId;a=a.snippetType;var e=l.externalId!==void 0?(h||(h=d("I64"))).of_string_opt(l.externalId):void 0;e=d("MAWCalculateBumpTimestampMs").calculateBumpTimestampMs(j,e);d("MAWIndexedDb").afterTransaction({tag:"ThreadBumpedV2",value:d("MAWBridgeTypesCreators").createBridgeBumpedThreadV2({bumpTimestampMs:e,description:"markMsgSent",isMessageAuthorMe:!0,snippetParams:b,snippetSenderContactId:c,snippetType:a,threadId:g.chatId,threadJid:g.jid})})})})})}else if(g.success){var n=g.value;return d("MAWDbUnrenderedMsgTxns").updateSystemAckForUnrenderedMsg(a,n.msgId,d("MAWAckLevel").ACK.sent).then(function(){if(n.type===d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE)return d("MAWEphemeralSettingsTxns").updateContactWhenEphemeralSettingChangeMarkedSent(a,b.chat,e)})}}).then(function(){})}});g.markMsgSent=b}),98);
__d("MAWSendWrittenMsg",["FBLogger","I64","MAWEBSwitch","MAWEBUploadTrackingUtils","MAWGetEditMsgForSending","MAWGetMsgForSendingApi","MAWGetReactionForSending","MAWGlobals","MAWMarkEditMsgDroppedApi","MAWMarkEditMsgSentApi","MAWMarkMsgDroppedApi","MAWMarkMsgSentApi","MAWMsgType","MAWSendMsgUtil","MAWSharedEbUploadQueue","MessageBackupDirectiveGenerator","WAAsMessageApplication","WAFrankingTypes","WAGenReportingMeta","WAJids","WALogger","WAMsgApplication.pb","WAPREList","WAPREMetrics","WAResultOrError","WASendMsgUtilV2","asyncToGeneratorRuntime","encodeProtobuf","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg END ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg END ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg not sending message: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg(","): drop result: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg(","): too old, dropping"]);n=function(){return a};return a}e=24*60*60;function o(a,b){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){d("WALogger").LOG(l(),a.protocolMsgId);var e=null;b.addPoint("get_msg_for_sending",{string:{type:a.type}});if(a.type==="message"||a.type==="revoke")e=(yield d("MAWGetMsgForSendingApi").getMsgForSending(a.protocolMsgId));else if(a.type==="reaction")e=(yield d("MAWGetReactionForSending").getReactionForSending(a.protocolMsgId));else if(a.type==="edit")e=(yield d("MAWGetEditMsgForSending").getEditMsgForSending(a.protocolMsgId,a.referencedOriginalExternalId));else{a.type;throw c("err")("This cannot happen because type has `message` as default argument but flow does not know that")}if(e.type!=="unsent"){d("WALogger").LOG(k(),e.type);b.endFail(e.type);return d("WAResultOrError").makeError("unknown-error")}a=e;e=a.dbMsg;var f=a.editOriginalExternalId,g=a.isReplyMsg,m=a.isXMAMsg,n=a.messageApplication,o=a.messageType;a=a.protocolMsgId;b.addPoint("message-fetched-from-db",{bool:{isEditMsg:f!=null,isReplyMsg:g,isXMAMsg:m},string:{msgType:o.type}});g={bytes:d("WAAsMessageApplication").castToMessageApplicationBytes(d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,n).readByteArray()),version:"v3"};m=(yield d("WASendMsgUtilV2").sendChatMessage({messagePayload:{frankingKey:((m=n.metadata)==null?void 0:m.frankingKey)?d("WAFrankingTypes").castToFrankingKey(new Uint8Array((m=n.metadata)==null?void 0:m.frankingKey)):null,frankingVersion:(m=n.metadata)==null?void 0:m.frankingVersion,messageBytes:g,messageType:o,protocolMsgId:a}},b));m.success===!1&&(b==null?void 0:b.addPoint("send-msg-v2-failed",{string:{errorType:m.error,msgType:e.type}}));if(m.success===!1)b.endFail(m.error),f!=null?yield d("MAWMarkEditMsgDroppedApi").markEditMsgDropped(a,f):yield d("MAWMarkMsgDroppedApi").markMsgDropped(a),d("WALogger").ERROR(j(),m.error);else{f!=null?yield r({editOriginalExternalId:f,protocolMsgId:a,reportingMeta:m.value.reportingMeta,serverTs:m.value.serverTs},b):yield s({protocolMsgId:a,reportingMeta:m.value.reportingMeta,serverTs:m.value.serverTs},b);b.endSuccess();d("WALogger").LOG(i(),m.success);if(c("MAWEBSwitch").isEnabled()&&d("MAWGlobals").getConfig().useEbUploadQueue())try{if(e!=null&&!d("WAJids").isAuthorSystem(e.author)){o=n==null?void 0:n.metadata;f=d("MessageBackupDirectiveGenerator").createMessageBackupDirectiveFromDbMsg(e);f!=null&&(d("MAWEBUploadTrackingUtils").maybeStartTrackingForUploadQueue(a,"send",0,q(e)),yield d("MAWSharedEbUploadQueue").putMsgsToEbUpload([{backupDirective:f,messageApplication:g.bytes,msgId:a,originalMsgProtocolId:f.originalMsgProtocolId.externalId!==a.externalId?f.originalMsgProtocolId:a,reportingMeta:yield d("WAGenReportingMeta").genReportingMeta(g.bytes,(o==null?void 0:o.frankingKey)?d("WAFrankingTypes").castToFrankingKey(new Uint8Array(o==null?void 0:o.frankingKey)):null,o==null?void 0:o.frankingVersion),senderId:(h||(h=d("I64"))).of_string(d("WAJids").authorToUserId(a.author,d("WAJids").extractUserId(d("MAWGlobals").getMyUserJid()))),serverTs:m.value.serverTs}]))}}catch(a){c("FBLogger")("labyrinth_web").mustfix("Failed to decode message application and add to EB upload queue")}}if(m.success===!1)throw c("err")("sendWrittenMsg error");return m});return p.apply(this,arguments)}function q(a){if(a.reactToExternalId!=null)return d("MAWMsgType").MSG_TYPE.REACTION;return a.editMsgHistoryId!=null?d("MAWMsgType").MSG_TYPE.EDIT_ACTION:a.type}f=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("encryptAndSend",{code:function(a,b,c){a.s2sInstanceKey!=null&&d("MAWSendMsgUtil").addS2SInstanceKey(a.s2sInstanceKey);b=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.SEND_MESSAGE,{bool:{afterCrash:c.afterCrash,isSenderKeyPredistriubtionEnabled:d("MAWGlobals").getConfig().isSenderKeyPredistributionEnabled()},string:{jid:a.protocolMsgId.chat}},a.s2sInstanceKey);return o(a,b)},stopRetryIf:{onStopRetry:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.protocolMsgId;d("WALogger").LOG(n(),a);var b=(yield d("MAWMarkMsgDroppedApi").markMsgDropped(a));d("WALogger").LOG(m(),a,b);return d("WAResultOrError").makeError("too-many-retries")});function c(b){return a.apply(this,arguments)}return c}(),timePassedSeconds:e}}).end();function a(a){if(a.reactToExternalId!=null)return a.reactToExternalId;if(a.originalMsgExternalId!=null)return a.originalMsgExternalId;switch(a.type){case d("MAWMsgType").MSG_TYPE.EDIT_ACTION:return a.originalMsgExternalId;case d("MAWMsgType").MSG_TYPE.REACTION:return a.reactToExternalId;default:return null}}function r(a,b){var c=a.editOriginalExternalId,e=a.protocolMsgId,f=a.reportingMeta;a=a.serverTs;return d("MAWMarkEditMsgSentApi").markEditMsgSent(e,c,a,f).then(function(){b==null?void 0:b.addPoint("mark_edit_msg_sent")})}function s(a,b){var c=a.protocolMsgId,e=a.reportingMeta;a=a.serverTs;return d("MAWMarkMsgSentApi").markMsgSent(c,a,e).then(function(){b==null?void 0:b.addPoint("mark_msg_sent")})}g.sendWrittenMsg=f;g.getTopLevelOfflineThreadingId=a}),98);
__d("MAWFetchAndEmitThreadApi",["MAWIndexedDb","MAWThreadFetchAndEmitTxns","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,editMsgHistory:a.READONLY,groupInfo:a.READWRITE,groupInvites:a.READONLY,media:a.READONLY,messages:a.READWRITE,participants:a.READWRITE,reactions:a.READONLY,threads:a.READWRITE,xma:a.READONLY},"fetchAndEmitThread",function(a){return function(b,c){c===void 0&&(c="fetchAndEmitThreadInTxn");return d("MAWThreadFetchAndEmitTxns").fetchAndEmitThread(a,b,void 0,void 0,c)}});g.fetchAndEmitThreadInTxn=b}),98);
__d("MAWGetParticipantsInThreadApi",["MAWDbParticipantTxns","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({participants:d("MAWTransactionMode").READONLY},"getParticipantsInThread",function(a){return function(b){return d("MAWDbParticipantTxns").getParticipantsInThread(a,b)}});g.getParticipantsInThreadInTxn=a}),98);
__d("MAWSendXMAShareMsg",["MAWAckLevel","MAWBridgeMsg","MAWBridgeXMA","MAWDbMsgTxns","MAWDexieTable","MAWExpiredXMACleaner","MAWFetchAndEmitThreadApi","MAWFrontendMediaUtils","MAWGetParticipantsInThreadApi","MAWGlobals","MAWIndexedDb","MAWJobDefinitions","MAWMediaManagementTxns","MAWMediaUtils","MAWMsgType","MAWMsgUtil","MAWOptimisticUploadManager","MAWQplProxy","MAWSendMediaMsg","MAWStartMediaUploaQplFlow","MAWTransactionMode","MAWVault","MAWXMAManagementTxns","MAWXMAUtils","MWQPLMarkers","Promise","WAArmadilloXMA.pb","WAJids","WAJobOrchestratorTypes","WALogger","WAMediaUtils","WAUploadMedia","asyncToGeneratorRuntime","err","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to upload media xma"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWSendXMAShareMsg - Message missing in db"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to send xma - missing thread"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWSendXMAShareMsg - Associated Message missing in db"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to send xma associated msg - missing thread"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWSendXMAShareMsg - Missing thread with jid: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWSendXMAShareMsg - XMAMessageType is null"]);o=function(){return a};return a}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("sendXMAShareMsg",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){e=function(b,c){c===void 0&&(c={}),a.args.s2sUserFlowQPLEvent!=null&&d("MAWQplProxy").sendQplPointThroughBridge(a.args.s2sUserFlowQPLEvent,b,{annotations:c,instanceKey:a.args.s2sInstanceKey})};var g=function(b,c){c===void 0&&(c={}),a.args.s2sUserFlowQPLEvent!=null&&d("MAWQplProxy").sendQPLFailThroughBridge(a.args.s2sUserFlowQPLEvent,b,c,a.args.s2sInstanceKey)};e(d("MWQPLMarkers").MESSAGE_SEND_TO_SENT.RECEIVED_MESSAGE_IN_WAJOB);var p=Boolean(a.associatedMsgContent)&&a.associatedMsgContent!=null?d("MAWVault").vault(a.associatedMsgContent):void 0,q=void 0,t=a.associatedMsgContentExternalId,u=a.args.xmaMessageType;if(u==null){d("WALogger").ERROR(o());return}yield d("MAWFetchAndEmitThreadApi").fetchAndEmitThreadInTxn(a.chatJid,"sendXMAShareMsg");var v=(yield d("MAWGlobals").getDbImpls().getThreadIdByJid(a.chatJid));if(v==null){g(d("MWQPLMarkers").MESSAGE_SEND_TO_SENT.FAILED_MISSING_THREAD_IN_DB);d("WALogger").ERROR(n(),a.chatJid);return}if(c("gkx")("23945")){var w=(yield d("MAWGetParticipantsInThreadApi").getParticipantsInThreadInTxn(a.chatJid));w=w.map(function(a){return a.userJid});yield d("MAWGlobals").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").createStartJobInfo("getDevices",{ignoreDhash:!0,reason:"send-xma-share-msg",users:new Set(w)}))}e(d("MWQPLMarkers").MESSAGE_SEND_TO_SENT.WRITING_XMA_TO_DB);var x=(yield d("MAWGlobals").getDbImpls().writeOutgoingMsg(a.xmaMsgExternalId,a.chatJid,f.jobStartTime,a.args,d("MAWMsgType").MSG_TYPE.XMA));if(p!=null&&t!=null){w=babelHelpers["extends"]({},a.args,{content:p});e(d("MWQPLMarkers").MESSAGE_SEND_TO_SENT.WRITING_MESSAGE_TO_DB);p=(yield d("MAWGlobals").getDbImpls().writeOutgoingMsg(t,a.chatJid,f.jobStartTime,w,d("MAWMsgType").MSG_TYPE.TEXT));if(p.type==="missing_thread"){g(d("MWQPLMarkers").MESSAGE_SEND_TO_SENT.FAILED_MESSAGE_MISSING_THREAD);d("WALogger").ERROR(m());return}t=(yield d("MAWGlobals").getDbImpls().getMsgIdByProtocolMsgId(p.protocolMsgId));if(!t.success){g(d("MWQPLMarkers").MESSAGE_SEND_TO_SENT.FAILED_MISSING_ASSOCIATED_MESSAGE_IN_DB);d("WALogger").ERROR(l());return}q=t.value}if(x.type==="missing_thread"){d("WALogger").ERROR(k());g(d("MWQPLMarkers").MESSAGE_SEND_TO_SENT.FAILED_MISSING_THREAD_IN_WRITING_XMA);return}f=(yield d("MAWGlobals").getDbImpls().getMsgIdByProtocolMsgId(x.protocolMsgId));if(!f.success){g(d("MWQPLMarkers").MESSAGE_SEND_TO_SENT.FAILED_MISSING_XMA_MESSAGE_IN_DB);d("WALogger").ERROR(j());return}var y=f.value;w=a.previewFile;p=a.headerFile;t=a.faviconFile;g=babelHelpers["extends"]({},a.xmaArgs,{overlayIconGlyph:(g=a.xmaArgs.overlayIconGlyph)!=null?g:d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.NONE,xmaLayoutType:(f=a.xmaArgs.xmaLayoutType)!=null?f:d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_XMA_LAYOUT_TYPE.SINGLE});f=(yield s(w,p,t,y,u,q,v,x.protocolMsgId,g,a.chatJid,a.args.offlineAttachmentId));e(d("MWQPLMarkers").MESSAGE_SEND_TO_SENT.SAVED_XMA_CONTENT_IN_DB);w=g.targetExpiringAtSec;p=d("MAWXMAUtils").isXMAExpired(!1,w);if(!p&&w!=null)d("MAWExpiredXMACleaner").addNewExpiredXMACleanerTimestamp(w);else if(p){t=(yield d("MAWGlobals").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").createStartJobInfo("sendWrittenMsg",{protocolMsgId:x.protocolMsgId,scheduleConfig:{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},type:"message"})));e(d("MWQPLMarkers").MESSAGE_SEND_TO_SENT.SUCCESSFUL_MESSAGE_SENT_TO_BACKEND,{bool:{isExpired:p}});return t}var z=d("MAWOptimisticUploadManager").getOptimisticUploadManager();u=(yield r(f,a.chatJid,x.protocolMsgId,z));e(d("MWQPLMarkers").MESSAGE_SEND_TO_SENT.SUCCESSFUL_UPLOAD_MEDIA_TO_BACKEND);q=u.filter(function(a){return!a.uploadResult.success}).length;if(q>0){d("WALogger").ERROR(i());return d("MAWMsgUtil").updateSystemAckWithTxn(y,d("MAWAckLevel").ACK.failed)}v=u.map(function(b){var c=b.uploadResult;b=b.media;return d("MAWSendMediaMsg").maybePersistMediaEntry(b.plaintextHash,y,a.chatJid,x.protocolMsgId.externalId,c==null?void 0:(c=c.value)==null?void 0:c.objectId,d("MAWMediaUtils").getServerMediaTypeFromMediaType(b.mediaType,"xma-media"))});yield (h||(h=b("Promise"))).all(v);e(d("MWQPLMarkers").MESSAGE_SEND_TO_SENT.SAVING_XMA_UPLOAD_RESULT_IN_DB);yield d("MAWGlobals").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").createStartJobInfo("sendWrittenMsg",{protocolMsgId:x.protocolMsgId,scheduleConfig:{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},type:"message"}));e(d("MWQPLMarkers").MESSAGE_SEND_TO_SENT.SUCCESSFUL_MESSAGE_SENT_TO_BACKEND);u.forEach(function(a){z["delete"](a.media.plaintextHash)})});return function(b,c,d){return a.apply(this,arguments)}}()).end();function p(a,b,c,d,e,f){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g){g=g.get(a);g=g==null?void 0:g.optimisticUploadPromise;if(g!=null)return g;g=(yield d("MAWStartMediaUploaQplFlow").startMediaUploaQplFlow({chatJid:b,fileSize:f,serverMediaType:e,uploadEntry:"sendXMAShareMsg"}));return d("WAUploadMedia").uploadMedia({chatJid:b,hash:a,mediaTypeDetails:{mediaType:e,type:"regular"},protocolMsgId:c,size:f,uploadMediaMetric:g})});return q.apply(this,arguments)}function r(a,c,e,f){a=[a.previewDbMedia,a.faviconDbMedia,a.headerDbMedia].filter(Boolean);a=a.reduce(function(a,b){a.includes(b.plaintextHash)||a.push(b);return a},[]);a=a.map(function(a){var b=d("MAWMediaUtils").getServerMediaTypeFromMediaType(a.mediaType,"xma-media");return p(a.plaintextHash,c,e,b,a.size,f).then(function(b){return{media:a,uploadResult:b}})});return(h||(h=b("Promise"))).all(a)}function s(a,b,c,d,e,f,g,h,i,j,k){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,d,e,f,g,i,j,k,l,m){a=(yield (h||(h=b("Promise"))).all([u(a),u(c),u(d)]));c=a[0];d=a[1];a=a[2];return w(e,c,d,a,f,g,i,j,k,l,m)});return t.apply(this,arguments)}function u(a){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a==null)return a;var b=a.file,e=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(b.type,!0),f=e.mediaType;e=e.serverMediaType;var g=(yield d("MAWMediaUtils").genBlobHashes(b)),h=g[0];g=g[1];if(f!=="Image")throw c("err")("Expected Image when sending XMA share");var i=(yield d("WAMediaUtils").blobToArrayBuffer(b));return{blobArrayBuffer:i,file:b,hashedPlaintextHash:g,mediaInfo:{validatedAudioInfo:null,validatedDocumentFileInfo:null,validatedImageInfo:{height:a.height,width:a.width},validatedVideoInfo:null},mediaType:f,plaintextHash:h,serverMediaType:e}});return v.apply(this,arguments)}function w(a,b,c,e,f,g,h,i,j,k,l){var m;return d("MAWIndexedDb").makeMsgrTransactor({chunk:(m=d("MAWTransactionMode")).READWRITE,media:m.READWRITE,mediaBackup:m.READWRITE,messages:m.READWRITE,unrenderedMessages:m.READWRITE,xma:m.READWRITE},"saveXMAMediaAndMetadata",function(m){return function(){var n=new Map();b!=null&&n.set(b.plaintextHash,d("MAWMediaManagementTxns").attachHashAndSaveMedia(m,i,b.blobArrayBuffer,b.plaintextHash,void 0,void 0,b.mediaType,b.mediaInfo,b.file,!0));if(c!=null){var o=n.get(c.plaintextHash);o==null&&n.set(c.plaintextHash,d("MAWMediaManagementTxns").attachHashAndSaveMedia(m,i,c.blobArrayBuffer,c.plaintextHash,void 0,void 0,c.mediaType,c.mediaInfo,c.file,!0))}if(e!=null){o=n.get(e.plaintextHash);o==null&&n.set(e.plaintextHash,d("MAWMediaManagementTxns").attachHashAndSaveMedia(m,i,e.blobArrayBuffer,e.plaintextHash,void 0,void 0,e.mediaType,e.mediaInfo,e.file,!0))}o=Array.from(n.values());return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsg(m,g),d("MAWDexieTable").dexieAll(o)]).then(function(n){var o=n[0];n=n[1];n=n.reduce(function(a,b){return a.set(b.plaintextHash,b)},new Map());var p=b!=null?n.get(b.plaintextHash):void 0,q=c!=null?n.get(c.plaintextHash):void 0,r=e!=null?n.get(e.plaintextHash):void 0,s=d("MAWDexieTable").dexieResolve();return d("MAWXMAManagementTxns").saveXMA(m,p==null?void 0:p.mediaId,q==null?void 0:q.mediaId,r==null?void 0:r.mediaId,f,a,g,i,j,l).then(function(a){d("MAWXMAUtils").isXMAStoryReply(f)&&o!=null?s=x(m,k,a,p,o):d("MAWIndexedDb").afterTransaction({tag:"NewXMA",value:d("MAWBridgeXMA").createBridgeXMA(h,p,a)});return s.then(function(){return{faviconDbMedia:r,headerDbMedia:q,previewDbMedia:p}})})})}})()}function x(a,b,e,f,g){var h=d("WAJids").interpretAsUserJid(b);if(h==null)throw c("err")("this is a flow check, participant jid can not be null");var i=e.defaultCTA;i=i==null?void 0:i.nativeUrl;h={author:h,externalId:e.externalId,mediaId:f==null?void 0:f.mediaId,sourceId:i,ts:void 0,type:d("MAWMsgType").MSG_TYPE.XMA,xmaMessageType:e.targetType};f={content:h,remoteJid:b};if(g.type!==d("MAWMsgType").MSG_TYPE.TEXT)throw c("err")("flow check, this message type is only in text type");var j=babelHelpers["extends"]({},g,{quote:f});return a.messages.put(j).then(function(){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(j)})})}g.sendXMAShareMsg=a}),98);
__d("WASmaxInGroupsIQErrorNotAcceptableMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"field");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"name");if(!b.success)return b;a=d("WASmaxParseUtils").attrString(a,"reason");return!a.success?a:d("WAResultOrError").makeResult({name:b.value,reason:a.value})}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").optionalChildWithTag(a,"field",h);if(!b.success)return b;var c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","not-acceptable");if(!c.success)return c;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",406);return!a.success?a:d("WAResultOrError").makeResult({text:c.value,code:a.value,field:b.value})}g.parseIQErrorNotAcceptableField=h;g.parseIQErrorNotAcceptableMixin=a}),98);
__d("WASmaxInGroupsSetSubjectClientErrors",["WAResultOrError","WASmaxInGroupsIQErrorBadRequestMixin","WASmaxInGroupsIQErrorFallbackClientMixin","WASmaxInGroupsIQErrorForbiddenMixin","WASmaxInGroupsIQErrorItemNotFoundMixin","WASmaxInGroupsIQErrorLockedMixin","WASmaxInGroupsIQErrorNotAcceptableMixin","WASmaxInGroupsIQErrorNotAuthorizedMixin","WASmaxInGroupsIQErrorRateOverlimitMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:b.value});var c=d("WASmaxInGroupsIQErrorItemNotFoundMixin").parseIQErrorItemNotFoundMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorItemNotFound",value:c.value});var e=d("WASmaxInGroupsIQErrorNotAuthorizedMixin").parseIQErrorNotAuthorizedMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"IQErrorNotAuthorized",value:e.value});var f=d("WASmaxInGroupsIQErrorForbiddenMixin").parseIQErrorForbiddenMixin(a);if(f.success)return d("WAResultOrError").makeResult({name:"IQErrorForbidden",value:f.value});var g=d("WASmaxInGroupsIQErrorNotAcceptableMixin").parseIQErrorNotAcceptableMixin(a);if(g.success)return d("WAResultOrError").makeResult({name:"IQErrorNotAcceptable",value:g.value});var h=d("WASmaxInGroupsIQErrorLockedMixin").parseIQErrorLockedMixin(a);if(h.success)return d("WAResultOrError").makeResult({name:"IQErrorLocked",value:h.value});var i=d("WASmaxInGroupsIQErrorRateOverlimitMixin").parseIQErrorRateOverlimitMixin(a);if(i.success)return d("WAResultOrError").makeResult({name:"IQErrorRateOverlimit",value:i.value});var j=d("WASmaxInGroupsIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(a);return j.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackClient",value:j.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorBadRequest","IQErrorItemNotFound","IQErrorNotAuthorized","IQErrorForbidden","IQErrorNotAcceptable","IQErrorLocked","IQErrorRateOverlimit","IQErrorFallbackClient"],[b,c,e,f,g,h,i,j])}g.parseSetSubjectClientErrors=a}),98);
__d("WASmaxInGroupsSetSubjectResponseClientError",["WAResultOrError","WASmaxInGroupsIQErrorResponseMixin","WASmaxInGroupsSetSubjectClientErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInGroupsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInGroupsSetSubjectClientErrors").parseSetSubjectClientErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorSetSubjectClientErrors:b.value}))}g.parseSetSubjectResponseClientError=a}),98);
__d("WASmaxInGroupsSetSubjectResponseServerError",["WASmaxInGroupsBaseServerErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInGroupsBaseServerErrorMixin").parseBaseServerErrorMixin(a,b);return!c.success?c:c}g.parseSetSubjectResponseServerError=a}),98);
__d("WASmaxInGroupsSetSubjectResponseSuccess",["WASmaxInGroupsIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInGroupsIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!c.success?c:c}g.parseSetSubjectResponseSuccess=a}),98);
__d("WASmaxOutGroupsSetSubjectChangeSubjectMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.subjectElementValue;a=d("WASmaxJsx").smax("iq",null,d("WASmaxJsx").smax("subject",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeSetSubjectChangeSubjectMixin=a}),98);
__d("WASmaxOutGroupsSetSubjectRequest",["WASmaxJsx","WASmaxOutGroupsBaseSetGroupMixin","WASmaxOutGroupsSetSubjectChangeSubjectMixin"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutGroupsSetSubjectChangeSubjectMixin").mergeSetSubjectChangeSubjectMixin(d("WASmaxOutGroupsBaseSetGroupMixin").mergeBaseSetGroupMixin(d("WASmaxJsx").smax("iq",null),a),a);return a}g.makeSetSubjectRequest=a}),98);
__d("WASmaxGroupsSetSubjectRPC",["WAComms","WASmaxInGroupsSetSubjectResponseClientError","WASmaxInGroupsSetSubjectResponseServerError","WASmaxInGroupsSetSubjectResponseSuccess","WASmaxOutGroupsSetSubjectRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:e=d("WASmaxOutGroupsSetSubjectRequest").makeSetSubjectRequest(a);j.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=j.sent;g=d("WASmaxInGroupsSetSubjectResponseSuccess").parseSetSubjectResponseSuccess(f,e);if(!g.success){j.next=7;break}return j.abrupt("return",{name:"SetSubjectResponseSuccess",value:g.value});case 7:h=d("WASmaxInGroupsSetSubjectResponseClientError").parseSetSubjectResponseClientError(f,e);if(!h.success){j.next=10;break}return j.abrupt("return",{name:"SetSubjectResponseClientError",value:h.value});case 10:i=d("WASmaxInGroupsSetSubjectResponseServerError").parseSetSubjectResponseServerError(f,e);if(!i.success){j.next=13;break}return j.abrupt("return",{name:"SetSubjectResponseServerError",value:i.value});case 13:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("SetSubject",{Success:g,ClientError:h,ServerError:i}));case 14:case"end":return j.stop()}},null,this)}g.sendSetSubjectRPC=a}),98);
__d("MAWSetGroupSubject",["MAWGlobals","WALogger","WAResultOrError","WASmaxGroupsSetSubjectRPC","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to change subject: ",""]);h=function(){return a};return a}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("sendSetSubjectRPC",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.group;a=a.subject;b=(yield d("WASmaxGroupsSetSubjectRPC").sendSetSubjectRPC({iqTo:b,subjectElementValue:a}));if(b.name==="SetSubjectResponseSuccess")return d("WAResultOrError").makeResult();b.name;d("WALogger").ERROR(h(),b.name);return d("WAResultOrError").makeError(b.name)});return function(b){return a.apply(this,arguments)}}()).end();g.setGroupSubject=a}),98);
__d("MAWUpdateBackupEntFbidForMedia",["LSDataTraceCheckPoint","LSIntEnum","MAWDbMediaTxns","MAWGlobals","MAWIndexedDb","MAWJobDefinitions","MAWMediaBackupTxns","MAWMediaManagementTxns","MAWTraceUtils","MAWTransactionMode","Promise","WAJobOrchestratorTypes","WALogger","WAMediaUtils","asyncToGeneratorRuntime","err","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Caught Error in updateBackupEntForFbid job for objectId ",": ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] media is null for deliveryObjectId provided"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Caught Error in makeMsgrTransactor while updating the media object with fbid ",": ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] backupEntFbid is empty"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] deliveryObjectId is empty"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Caught Error in updateBackupEntForFbid job for objectId ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] mediaBackup is null for deliveryObjectId provided"]);p=function(){return a};return a}var q=d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READWRITE,mediaBackup:d("MAWTransactionMode").READWRITE},"updateBackupEntFbidInMediaBackup",function(a){return function(b,c,d){return r(a,b,c,d)}});function r(a,b,e,f){return d("MAWDbMediaTxns").maybeGetMediaBackupRowFromObjectId(a,b).then(function(g){if(g==null){d("WALogger").ERROR(p());throw c("err")("mediaBackup is null for deliveryObjectId provided")}return d("MAWDbMediaTxns").maybeGetMediaFromMediaId(a,g.mediaId).then(function(c){if(c!=null){var f=d("MAWMediaManagementTxns").updateBackupFbidInMediaEntries(c,b,e);f=babelHelpers["extends"]({},c,{fbid:e,mediaEntries:f});return a.media.update(f.mediaId,f).then(function(){if(c.msgIds.length>0)return d("MAWMediaBackupTxns").linkMediaBackup(a,c.mediaId,g.msgId,b,e)})}})["catch"](function(a){d("WALogger").ERROR(o(),a),d("MAWTraceUtils").recordFailureAndFlushForTraceId(f,(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_MEDIA_BACKUP_FAILURE),[],"Caught Error in updateBackupEntForFbid job")}).then(function(){})})}function s(a,e,f){if(a==null||a.length===0){d("WALogger").ERROR(n());d("MAWTraceUtils").recordFailureAndFlushForTraceId(f,(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_MEDIA_BACKUP_FAILURE),[],"deliveryObjectId is empty");return(h||(h=b("Promise"))).reject(c("err")("deliveryObjectId is empty"))}if(e==null||e.length===0){d("WALogger").ERROR(m());d("MAWTraceUtils").recordFailureAndFlushForTraceId(f,(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_MEDIA_BACKUP_FAILURE),[],"backupEntFbid is empty");return(h||(h=b("Promise"))).reject(c("err")("backupEntFbid is empty"))}if(c("gkx")("23919"))if(a!=null&&e!=null)return q(a,e,f);else return(h||(h=b("Promise"))).resolve();else return d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READWRITE,mediaBackup:d("MAWTransactionMode").READONLY},"updateBackupEntFbid",function(b){return function(){return d("MAWDbMediaTxns").maybeGetMediaFromObjectId(b,a).then(function(g){if(g!=null){var h=d("MAWMediaManagementTxns").updateBackupFbidInMediaEntries(g,a,e);g=babelHelpers["extends"]({},g,{fbid:e,mediaEntries:h});return b.media.update(g.mediaId,g)["catch"](function(a){d("WALogger").ERROR(l(),e,a),d("MAWTraceUtils").recordFailureAndFlushForTraceId(f,(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_MEDIA_BACKUP_FAILURE),[],"Caught Error in makeMsgrTransactor while updating the media object with fbid")}).then(function(){})}else{d("WALogger").ERROR(k());throw c("err")("media is null for deliveryObjectId provided")}})["catch"](function(b){d("WALogger").ERROR(j(),a,b),d("MAWTraceUtils").recordFailureAndFlushForTraceId(f,(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_MEDIA_BACKUP_FAILURE),[],"Caught Error in updateBackupEntForFbid job")})}})()}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("writeToDb",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.backupEntFbid,c=a.deliveryObjectId;a=a.traceId;yield s(d("WAMediaUtils").stringToDeliveryObjectId(c),d("WAMediaUtils").stringToBackupEntFbid(b));yield d("MAWGlobals").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").createStartJobInfo("backupMessageWithMedia",{backupEntFbid:b,deliveryObjectId:c,scheduleConfig:{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW},traceId:a}))});return function(b){return a.apply(this,arguments)}}()).end();g.updateBackupEntFbidInMediaBackupTxn=r;g.updateBackupEntFbid=s;g.updateBackupEntFbidForMedia=a}),98);
__d("MAWUploadRetroactiveMessageBatch",["MAWGlobals","MAWUploadRetroactiveMessageBatchApi","WALogger","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["cannot upload retroactive message batch - null dbMsgArray"]);h=function(){return a};return a}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("uploadRetroactiveMessageBatch",function(a){var b=a.chatId;a=a.dbMsgArray;a!=null?c("promiseDone")(d("MAWUploadRetroactiveMessageBatchApi").uploadRetroactiveMessageBatch(b,a)):d("WALogger").ERROR(h())}).end();g.uploadRetroactiveMessageBatch=a}),98);
__d("MAWUploadRetroactiveThreadsAndMessages",["MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWEBSwitch","MAWGlobals","MAWIndexedDb","MAWJobDefinitions","MAWTransactionMode","Promise","WALogger","gkx","promiseDone","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] The user is not eligible for EB"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Retroactive backups failed - no threads containing messages to upload"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Initiating job: upload retroactive backups"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] thread.newestMsg is null - retroactive message uploads for thread "," cannot proceed"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Unknown error with retroactive uploads}"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Error with retroactive uploads, err: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] thread.newestMsg is null - retroactive message uploads for thread "," cannot proceed"]);o=function(){return a};return a}var p=50,q=200,r=new Map(),s=new Map(),t=new Map();function u(a,b,c,e){return d("MAWDbMsgTxns").getMsgsFromOffset(a,b.chatId,e,p,c,!1).then(function(c){var e;c=c.msgs;(e=r.get(b.chatId))==null?void 0:e.push(c);return c.length===p?u(a,b,!1,c[c.length-1].msgId):d("MAWDexieTable").dexieResolve()})}function v(a,b){var e=r.get(b);if(e!=null){var f=e[a];c("promiseDone")(d("MAWGlobals").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").jobSerializers.uploadRetroactiveMessageBatch(f,void 0,void 0,b)));a<e.length-1&&c("setTimeout")(function(){return v(a+1,b)},q)}}function w(a,b,e){if(e!=null)return u(a,b,!0,e).then(function(){c("setTimeout")(function(){return v(0,b.chatId)},q);return d("MAWDexieTable").dexieResolve()});else{d("WALogger").ERROR(o(),b.chatId);return d("MAWDexieTable").dexieResolve()}}function x(a){return d("MAWDbThreadTxns").getAllThreadsForUser(a,d("MAWGlobals").getMyUserJid()).then(function(a){a.forEach(function(a){r.set(a.chatId,[]),s.set(a.chatId,a),t.set(a.chatId,a.newestMsg)});return a})["catch"](function(a){a instanceof Error?d("WALogger").ERROR(n(),a):d("WALogger").ERROR(m())})}var y=d("MAWIndexedDb").makeMsgrTransactor({participants:(a=d("MAWTransactionMode")).READONLY,threads:a.READONLY},"getBackupThreads",function(a){return function(){return x(a)}});function z(a,b){return a.retroactiveBackupsState.count().then(function(c){if(c===0){var e=[];b.forEach(function(a){a.newestMsg!=null?e.push({msgId:a.newestMsg,threadId:a.chatId}):d("WALogger").ERROR(l(),a.chatId)});return a.retroactiveBackupsState.bulkAdd(e).then(function(){})}else{var f=[];return a.retroactiveBackupsState.each(function(a){f.push(a.threadId),t.set(a.threadId,a.msgId)}).then(function(){var a=[];r.forEach(function(b,c){f.includes(c)||a.push(c)});a.forEach(function(a){r["delete"](a),s["delete"](a),t["delete"](a)})})}})}var A=d("MAWIndexedDb").makeMsgrTransactor({media:a.READONLY,messages:a.READONLY,participants:a.READONLY,reactions:a.READONLY,threads:a.READONLY,xma:a.READONLY},"uploadBackupMessagesForThread",function(a){return function(){for(var b=arguments.length,c=new Array(b),d=0;d<b;d++)c[d]=arguments[d];return w.apply(void 0,[a].concat(c))}}),B=d("MAWIndexedDb").makeMsgrTransactor({retroactiveBackupsState:a.READWRITE},"writeRetroactiveBackupsState",function(a){return function(){for(var b=arguments.length,c=new Array(b),d=0;d<b;d++)c[d]=arguments[d];return z.apply(void 0,[a].concat(c))}});e=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("uploadAllThreadsAndMessages",function(){d("WALogger").LOG(k());if(c("gkx")("23914")){c("MAWEBSwitch").set(!0);return y().then(function(a){if(a!=null)return B(a).then(function(){s.forEach(function(a,b){a=s.get(b);a!=null&&c("promiseDone")(A(a,t.get(b)))})});else{d("WALogger").ERROR(j());return(h||(h=b("Promise"))).resolve()}})}else{d("WALogger").WARN(i());return(h||(h=b("Promise"))).resolve()}}).end();g.uploadRetroactiveThreadsAndMessages=e}),98);
__d("WAPushNotificationsSetup",["WADeprecatedSendIq","WADeprecatedWapParser","WAWap"],(function(a,b,c,d,e,f,g){"use strict";var h=new(c("WADeprecatedWapParser"))("pushResult",function(a){a.assertAttr("type","result")});function a(a,b,c){var e;return d("WADeprecatedSendIq").deprecatedSendIq((e=d("WAWap")).wap("iq",{id:e.generateId(),to:e.S_WHATSAPP_NET,type:"set",xmlns:"urn:xmpp:whatsapp:push"},e.wap("config",{appid:e.CUSTOM_STRING(a),deviceid:e.CUSTOM_STRING(b),platform:e.CUSTOM_STRING(c)})),h)}g.setupPushNotifications=a}),98);
__d("WASendPushNotificationConfig",["WAJobs","WALogger","WAPushNotificationsSetup","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Push notification setup failed"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendPushNotificationSetup"]);i=function(){return a};return a}a=d("WAJobs").getPersistedJobsApi().definePersistedJob().finalStep("sendPushNotificationSetup",function(a){var c,e,f,g;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:c=a.appId,e=a.deviceId,f=a.platform;d("WALogger").LOG(i());j.next=4;return b("regeneratorRuntime").awrap(d("WAPushNotificationsSetup").setupPushNotifications(c,e,f));case 4:g=j.sent,g.success||d("WALogger").ERROR(h());case 6:case"end":return j.stop()}},null,this)}).end();g.sendPushNotificationSetup=a}),98);
__d("MAWJobHandlers",["MAWAcceptGroupInvite","MAWAddGroupParticipants","MAWBackupMessageWithMedia","MAWCreateGroup","MAWCreateJobNotImplemented","MAWDeleteGroups","MAWDeleteMsgsForMe","MAWDeleteThread","MAWDemoteGroupParticipants","MAWDownloadAndHandleMedia","MAWDownloadAndRestoreMedia","MAWForwardMsg","MAWGetCurrentUserDeviceList","MAWGetSpams","MAWHandleFutureProofMsg","MAWHandleSpamMsg","MAWLeaveGroups","MAWMarkThreadAsRead","MAWPromoteGroupParticipants","MAWRemoveGroupParticipants","MAWReportUserSpam","MAWRerevokePendingStanzas","MAWResendWrittenAppData","MAWRestoreMessagesFromEncryptedBackups","MAWRestoreProtobufsFromEncryptedBackups","MAWRevokeMsg","MAWSendAppData","MAWSendEditMsg","MAWSendEphemeralSettingMsg","MAWSendGroupInviteMsg","MAWSendMediaMsg","MAWSendMsg","MAWSendRavenActionMsg","MAWSendReactionMsg","MAWSendWrittenAppData","MAWSendWrittenMsg","MAWSendXMAShareMsg","MAWSetGroupSubject","MAWUpdateBackupEntFbidForMedia","MAWUploadMessagesBackup","MAWUploadRetroactiveMessageBatch","MAWUploadRetroactiveThreadsAndMessages","MAWUploadRetryStatusUtil","WAComputeAndUploadICDCInfo","WAGenerateAndUploadPreKeys","WAGetDevices","WANotifyDeviceChange","WAQueryGroups","WARemoveDevice","WARequestPreKeyDigest","WARotateSignedPreKey","WASendPushNotificationConfig","WASyncAbProps"],(function(a,b,c,d,e,f,g){"use strict";function a(){return{acceptGroupInvite:d("MAWAcceptGroupInvite").acceptGroupInvite,addGroupParticipants:d("MAWAddGroupParticipants").addGroupParticipants,backupMessageWithMedia:d("MAWBackupMessageWithMedia").backupMessageWithMedia,computeAndUploadICDCInfo:d("WAComputeAndUploadICDCInfo").computeAndUploadICDCInfo,createGroup:d("MAWCreateGroup").createGroup,deleteGroups:d("MAWDeleteGroups").deleteGroups,deleteMsgsForMe:d("MAWDeleteMsgsForMe").deleteMsgsForMe,deleteThread:d("MAWDeleteThread").deleteThread,demoteGroupParticipants:d("MAWDemoteGroupParticipants").demoteGroupParticipants,downloadAndHandleMedia:d("MAWDownloadAndHandleMedia").downloadAndHandleMedia,downloadAndRestoreMedia:d("MAWDownloadAndRestoreMedia").downloadAndRestoreMedia,forwardMsg:d("MAWForwardMsg").forwardMsg,generateAndUploadPreKeys:d("WAGenerateAndUploadPreKeys").generateAndUploadPreKeys,getCurrentUserDeviceList:d("MAWGetCurrentUserDeviceList").getCurrentUserDeviceList,getDevices:d("WAGetDevices").getDevices,getSpams:d("MAWGetSpams").getSpams,handleFutureproofMsg:d("MAWHandleFutureProofMsg").handleFutureproofMsg,handleSpamMsg:d("MAWHandleSpamMsg").handleSpamMsg,igdReportUserSpam:[],igdSendMsg:[],leaveGroups:d("MAWLeaveGroups").leaveGroups,markThreadAsRead:d("MAWMarkThreadAsRead").markThreadAsRead,notifyDeviceChange:d("WANotifyDeviceChange").notifyDeviceChange,postBackupWriteCompletionHook:d("MAWUploadRetryStatusUtil").postBackupWriteCompletionHook,promoteGroupParticipants:d("MAWPromoteGroupParticipants").promoteGroupParticipants,queryGroups:d("WAQueryGroups").queryGroups,removeDevice:d("WARemoveDevice").removeDeviceJob,removeGroupParticipants:d("MAWRemoveGroupParticipants").removeGroupParticipants,reportUserSpam:d("MAWReportUserSpam").reportUserSpam,requestAllSyncdMissingKeys:[],requestPreKeyDigest:d("WARequestPreKeyDigest").requestPreKeyDigest,rerevokeMsgs:d("MAWRerevokePendingStanzas").rerevokeMsgs,resendWrittenAppData:d("MAWResendWrittenAppData").resendWrittenAppData,restoreMessagesFromEncryptedBackups:d("MAWRestoreMessagesFromEncryptedBackups").restoreMessagesFromEncryptedBackups,restoreProtobufsFromEncryptedBackups:d("MAWRestoreProtobufsFromEncryptedBackups").restoreProtobufsFromEncryptedBackups,revokeMsgs:d("MAWRevokeMsg").revokeMsgs,rotateSignedPreKey:d("WARotateSignedPreKey").rotateSignedPreKey,sendAppData:d("MAWSendAppData").sendAppData,sendEditMsg:d("MAWSendEditMsg").sendEditMsg,sendEphemeralSettingMsg:d("MAWSendEphemeralSettingMsg").sendEphemeralSettingMsg,sendGroupInviteMsg:d("MAWSendGroupInviteMsg").sendGroupInviteMsg,sendMediaMsg:d("MAWSendMediaMsg").sendMediaMsg,sendMsg:d("MAWSendMsg").sendMsg,sendPushNotificationSetup:d("WASendPushNotificationConfig").sendPushNotificationSetup,sendRavenActionMsg:d("MAWSendRavenActionMsg").sendRavenActionMsg,sendReactionMsg:d("MAWSendReactionMsg").sendReactionMsg,sendWrittenAppData:d("MAWSendWrittenAppData").sendWrittenAppData,sendWrittenMsg:d("MAWSendWrittenMsg").sendWrittenMsg,sendXMAShareMsg:d("MAWSendXMAShareMsg").sendXMAShareMsg,setGroupSubject:d("MAWSetGroupSubject").setGroupSubject,startInstamadilloDYI:d("MAWCreateJobNotImplemented").createNotImplementedJob("startInstamadilloDYI"),syncAbProps:d("WASyncAbProps").syncAbProps,syncdSyncAllCollections:[],updateBackupEntFbidForMedia:d("MAWUpdateBackupEntFbidForMedia").updateBackupEntFbidForMedia,uploadMessagesBackup:d("MAWUploadMessagesBackup").uploadMessagesBackup,uploadRetroactiveMessageBatch:d("MAWUploadRetroactiveMessageBatch").uploadRetroactiveMessageBatch,uploadRetroactiveThreadsAndMessages:d("MAWUploadRetroactiveThreadsAndMessages").uploadRetroactiveThreadsAndMessages}}g.getJobHandlers=a}),98);
__d("MAWPREListeners",["MAWODSProxy","MAWQplProxy","MAWSendMsgUtil","WALogger","WAMapWithDefault","WAOdsEnums","WAPREList","WAPREMetrics","qpl"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received unreachable stage value for the event"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["The QPL event of "," was processed already"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["The QPL event of "," was processed already"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["The QPL event of "," was completed or failed already"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot RESUME without instanceKey"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["The QPL event of "," was completed or failed already"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received unreachable stage value for the ODS event"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Event "," not implemented"]);o=function(){return a};return a}function a(){d("WAPREMetrics").subscribe(q)}var p=new(d("WAMapWithDefault").MapWithDefault)(function(){return new Map()});function b(a){return q(a)}function q(a){switch(a.name){case d("WAPREList").PRE_METRIC.DELETE_THREAD:s(c("qpl")._(1056845732,"691"),a);break;case d("WAPREList").PRE_METRIC.FRANKING_VALIDATION:s(c("qpl")._(25299246,"150"),a);break;case d("WAPREList").PRE_METRIC.RETRY_RECEIPTS_SENT:s(c("qpl")._(25301644,"165"),a);break;case d("WAPREList").PRE_METRIC.QUERY_GROUPS:s(c("qpl")._(741087294,"2028"),a);break;case d("WAPREList").PRE_METRIC.QUERY_GROUP:r(d("WAOdsEnums").Entity.WA_QUERY_GROUP,a);break;case d("WAPREList").PRE_METRIC.OFFLINE_RETRY:s(c("qpl")._(25309990,"124"),a);break;case d("WAPREList").PRE_METRIC.MEDIA_DOWNLOAD:s(c("qpl")._(25312150,"83"),a);break;case d("WAPREList").PRE_METRIC.MEDIA_UPLOAD:s(c("qpl")._(25313100,"131"),a);break;case d("WAPREList").PRE_METRIC.GET_DEVICES:r(d("WAOdsEnums").Entity.GET_DEVICES,a);break;case d("WAPREList").PRE_METRIC.MESSAGE_DECRYPTION:s(c("qpl")._(25306682,"11176"),a);r(d("WAOdsEnums").Entity.DECRYPTION,a);break;case d("WAPREList").PRE_METRIC.DECRYPT_MESSAGE_FINAL:s(c("qpl")._(741087294,"2028"),a);break;case d("WAPREList").PRE_METRIC.PROTOCOL_QUEUE_CONSUMER:s(c("qpl")._(1056845300,"1338"),a);break;case d("WAPREList").PRE_METRIC.MESSAGE_ENCRYPTION:s(c("qpl")._(25299294,"12933"),a);s(c("qpl")._(741087294,"2028"),a);break;case d("WAPREList").PRE_METRIC.OFFLINE_QUEUE:s(c("qpl")._(25306361,"5664"),a);break;case d("WAPREList").PRE_METRIC.SYNCD_FATAL_ERROR:s(c("qpl")._(25310891,"540"),a);break;case d("WAPREList").PRE_METRIC.SEND_MESSAGE:d("MAWSendMsgUtil").checkS2SInstanceKeyExist(a.instanceKey)?(s(c("qpl")._(25313175,"1551"),a),(a.stage==="SUCCESS"||a.stage==="FAIL")&&d("MAWSendMsgUtil").removeS2SInstanceKey(a.instanceKey)):r(d("WAOdsEnums").Entity.S2S_QPL_MISSING_INSTANCE_KEY,a);break;case d("WAPREList").PRE_METRIC.CREATE_GROUP:s(c("qpl")._(25307987,"970"),a);break;case d("WAPREList").PRE_METRIC.REMOVE_PARTICIPANTS:s(c("qpl")._(25312342,"971"),a);break;case d("WAPREList").PRE_METRIC.RECEIVE_MESSAGE:s(c("qpl")._(1056840931,"814"),a);break;case d("WAPREList").PRE_METRIC.SYNCD_CRITICAL_EVENT:s(c("qpl")._(25311142,"804"),a);break;case d("WAPREList").PRE_METRIC.SYNCD_CRITICAL_BOOTSTRAP_STAGE:s(c("qpl")._(741087294,"2028"),a);break;case d("WAPREList").PRE_METRIC.SYNCD_BOOTSTRAP_APP_STATE_DOWNLOAD:s(c("qpl")._(741087294,"2028"),a);break;case d("WAPREList").PRE_METRIC.SYNCD_DECRYPT_MUTATIONS:s(c("qpl")._(741087294,"2028"),a);break;case d("WAPREList").PRE_METRIC.SYNCD_BOOTSTRAP_DATA_APPLIED:s(c("qpl")._(741087294,"2028"),a);break;case d("WAPREList").PRE_METRIC.SYNCD:s(c("qpl")._(741087294,"2028"),a);break;case d("WAPREList").PRE_METRIC.APP_STATE_SYNC_DAILY:s(c("qpl")._(25306941,"813"),a);break;case d("WAPREList").PRE_METRIC.ICDC_ERROR:s(c("qpl")._(25313187,"948"),a);break;case d("WAPREList").PRE_METRIC.WA_DISCONNECT:r(d("WAOdsEnums").Entity.WA_DISCONNECT,a);break;case d("WAPREList").PRE_METRIC.WA_FAIL_STANZA_QUEUE_ITEM:r(d("WAOdsEnums").Entity.WA_FAIL_STANZA_QUEUE_ITEM,a);break;case d("WAPREList").PRE_METRIC.WA_JOBS_ORCHESTRATOR:s(c("qpl")._(25311870,"1004"),a);break;case d("WAPREList").PRE_METRIC.WA_JOB_MANAGER:s(c("qpl")._(25308825,"136"),a);break;case d("WAPREList").PRE_METRIC.SYNCD_KEY_ROTATION:s(c("qpl")._(25304909,"1204"),a);break;case d("WAPREList").PRE_METRIC.STANZA_QUEUE_MESSAGE_CONSUMER:break;case d("WAPREList").PRE_METRIC.DOWNLOAD_AND_DECRYPT:d("WALogger").ERROR(o(),a.name);break;case d("WAPREList").PRE_METRIC.ONE_QUEUE:s(c("qpl")._(25308201,"2007"),a);break;case d("WAPREList").PRE_METRIC.WA_NO_SIGNED_PRE_KEY:r(d("WAOdsEnums").Entity.WA_NO_SIGNED_PRE_KEY,a);break}}function r(a,b){var c;switch(b.stage){case"START":break;case"RESUME":case"POINT":break;case"SUCCESS":d("MAWODSProxy").odsBumpEntityKey({entity:a,key:(c=(c=b.annotations)==null?void 0:(c=c.string)==null?void 0:c.key)!=null?c:"success"},!0);break;case"FAIL":d("MAWODSProxy").odsBumpEntityKey({entity:a,key:b.reason},!0);break;default:d("WALogger").ERROR(n());break}}function s(a,b){var c=babelHelpers["extends"]({},b.annotations);switch(b.stage){case"START":if(p.get(a).has(b.instanceKey))return;var e=d("MAWQplProxy").startQplUserFlow(a,c);p.get(a).set(b.instanceKey,e);break;case"ANNOTATE":e=p.get(a).get(b.instanceKey);if(e==null){d("WALogger").WARN(m(),b.name);return}e.addAnnotations(c);break;case"RESUME":if(b.instanceKey==null){d("WALogger").ERROR(l());return}if(p.get(a).has(b.instanceKey))return;e=d("MAWQplProxy").startQplUserFlow(a,c,b.instanceKey);p.get(a).set(b.instanceKey,e);break;case"POINT":e=p.get(a).get(b.instanceKey);if(e==null){d("WALogger").WARN(k(),b.name);return}e.addPoint(b.reason,c);break;case"SUCCESS":e=p.get(a).get(b.instanceKey);if(e==null){d("WALogger").WARN(j(),b.name);return}e.endSuccess(c);p.get(a)["delete"](b.instanceKey);break;case"FAIL":e=p.get(a).get(b.instanceKey);if(e==null){d("WALogger").WARN(i(),b.name);return}e.endFail(b.reason,c);p.get(a)["delete"](b.instanceKey);break;default:d("WALogger").ERROR(h());break}}g.initializeWAPREMetrics=a;g.testOnly_logger=b}),98);
__d("MAWBackend",["MAWAbProps","MAWBridge","MAWCOP","MAWComms","MAWDebug","MAWDebugDefineFunctions","MAWDefinePersistedJob","MAWDeleteExpiredMsgsApi","MAWDeleteForMeMsgContentCleaner","MAWDyiBatchRestoreDataSync","MAWEbRestoreQueue","MAWEbUploadQueue","MAWEphemeralCleaner","MAWExpiredXMACleaner","MAWExternalId","MAWFTSDataSync","MAWGetWorkerStatusApi","MAWGlobals","MAWJobHandlers","MAWMailboxUploadDataSync","MAWMessageReceiveReliabilityLogger","MAWMockServerShell","MAWPREListeners","MAWPendingStanzaCleaner","MAWPersistedQueueApi","MAWRunInTransaction","MAWSentBytesCacheApi","MAWSharedEbUploadQueue","MAWSharedOfflineResumeStats","MAWSharedOfflineResumeUINotifier","MAWTaskDefinitions","MAWUnsendMsgContentCleaner","Promise","WAArrayBufferUtils","WACryptoManager","WACryptoManagerUtils","WADanglingQueue","WADebugTools","WADeviceNotificationFlushable","WADevicesState","WAErr","WAFetchAndSaveDevices","WAGetClockSkewApi","WAICDCUtils","WAJids","WAMessageLoggingPublisher","WAOfflineUtils","WAOneQueue","WAPassiveMode","WAPersistedJobManagerV2","WAProtocolQueue","WAResolvable","WAScheduleAfterOfflineResume","WASentBytesCache","WATagsLogger","WATimeUtils","asyncToGeneratorRuntime","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Worker inited"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[S406998] Invalid userJid reason: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["deviceJid: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["initWAInfra"]);l=function(){return a};return a}b("MAWDebug");var m=d("WATagsLogger").TAGS(["backend"]);function a(a,b,c,d,e){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,n){m.LOG(l());m.LOG(k(),a.deviceJid);var o=new(d("WAResolvable").Resolvable)(),p=new(d("WAResolvable").Resolvable)(),q=d("WACryptoManagerUtils").createCryptoManager(g.crypto);d("WADevicesState").initDevicesState({fetchAndSaveDevices:function(a,b,c){for(var e of a)d("MAWExternalId").isStnazaId(d("WAJids").userIdFromJid(e))&&m.ERROR(j(),b);return d("WAFetchAndSaveDevices").fetchAndSaveDevicesWithResults(new Set(a),c)}});var r=new(d("WAPersistedJobManagerV2").PersistedJobManager)({accessors:g.jobPersistenceAccessors,deprecatedJobs:{removeCurrentDevice:"NOOP"},isRestartAfterCrash:!1,listeners:{onJobFinished:function(a,b,c,e){d("MAWBridge").getBridge().fireAndForget("event","onJobFinished",{id:a,originalArgs:c,result:e,type:b},!0);return null},onJobStarted:function(){}},offlineQueueCompletePromise:p,unfinishedJobEntries:o.promise.then(function(){return g.jobPersistenceAccessors.loadAllJobs()})});d("MAWMessageReceiveReliabilityLogger").subscribeToIncomingMessageEvents(d("WAMessageLoggingPublisher").messageLoggingPublisher);var s=d("WAProtocolQueue").initProtocolQueue(d("MAWPersistedQueueApi").dexieApiForPersistedQueue()),t=new(d("WAOneQueue").WAOneQueue)({cryptoManager:q.manager,flushables:[d("WAICDCUtils").icdcFlushable,d("WADeviceNotificationFlushable").deviceNotificationFlushable,d("WAProtocolQueue").protocolQueueFlushable(s),d("WACryptoManager").cryptoManagerFlushable(q.manager)],mode:d("WAOfflineUtils").ServerRPCMode.INIT});d("MAWCOP").cop.subscribeToOfflineQueue(t,s);d("WADanglingQueue").initDanglingQueue(d("MAWPersistedQueueApi").dexieApiForPersistedQueue());d("MAWEbRestoreQueue").initEbRestoreQueue();d("MAWSharedEbUploadQueue").initEbUploadQueue();d("MAWGlobals").setGlobals({activeThreadKey:null,config:n,crypto:q,db:g.dbCallbacks,dependencies:{generateExternalId:d("MAWExternalId").generateExternalId},fbCat:d("WAArrayBufferUtils").stringToArrayBuffer(a.fbCat),hmacKey:e,jidUtils:g.jidUtils,jobResultConverter:g.jobResultConverters,myJids:{deviceJid:a.deviceJid,userJid:a.userJid},offlineResumeStats:new(d("MAWSharedOfflineResumeStats").MAWSharedOfflineResumeStats)(t,d("WAPassiveMode").passiveModeNotifier,d("MAWCOP").cop,d("WAMessageLoggingPublisher").messageLoggingPublisher),persistedJobs:{api:g.persistedJobs,manager:r},runInTransaction:d("MAWRunInTransaction").runInTransaction,waOneQueue:t});d("MAWSharedOfflineResumeUINotifier").offlineResumeUINotifier.subscribeToWAEvents(t);d("MAWSharedOfflineResumeUINotifier").offlineResumeUINotifier.subscribeToMawEvents(d("MAWCOP").cop);d("MAWSharedOfflineResumeUINotifier").offlineResumeUINotifier.subscribeToMessageEvents(d("WAMessageLoggingPublisher").messageLoggingPublisher);d("MAWEphemeralCleaner").startEphemeralCleaner({backendFns:{getNextTs:g.dbCallbacks.getNextDeletionTs,purgeEnabled:function(){return!0},removeExpired:function(){return d("MAWDeleteExpiredMsgsApi").deleteExpiredMsgs().then(function(a){return a.length>0?d("MAWDeleteExpiredMsgsApi").deleteReceipts(a).then(function(){return a.length}):a.length})}},uiFns:{getNextTs:g.dbCallbacks.getNextExpirationTs,purgeEnabled:function(){return!0},removeExpired:g.dbCallbacks.removeExpiredMsgsFromUI}});d("MAWUnsendMsgContentCleaner").startUnsendMsgContentCleaner({getNextTs:g.dbCallbacks.getNextDeleteUnsendContentTs,purgeEnabled:function(){return!0},removeExpired:g.dbCallbacks.removeExpiredUnsendMsgsContent});d("MAWDeleteForMeMsgContentCleaner").startDeleteForMeMsgContentCleaner({getNextTs:g.dbCallbacks.getNextDeleteDFMContentTs,purgeEnabled:function(){return!0},removeExpired:g.dbCallbacks.removeExpiredDFMMsgsContent});d("MAWPendingStanzaCleaner").startPendingStanzaCleaner({getNextTs:g.dbCallbacks.getNextDeletePendingStanzaTs,purgeEnabled:function(){return!0},removeExpired:g.dbCallbacks.removeExpiredPendingStanzas});d("MAWExpiredXMACleaner").startExpiredXMACleaner({getNextTs:g.dbCallbacks.getNextExpiredXMATs,purgeEnabled:function(){return!0},removeExpired:g.dbCallbacks.removeExpiredXMAMsgsContent});d("MAWDefinePersistedJob").setMsgrJobImplementations(d("MAWJobHandlers").getJobHandlers());d("WAScheduleAfterOfflineResume").scheduleAfterOfflineResume({code:function(){p.resolve();return(h||(h=b("Promise"))).resolve()},id:"task-scheduler"});d("MAWMockServerShell").isMockServerMode||c("promiseDone")(o.promise.then(function(){return d("MAWTaskDefinitions").registerTasks(p.promise)}));f.setHandlers("backend",babelHelpers["extends"]({},g.bridgeHandlers,{initMockServer:function(a){return d("MAWMockServerShell").getMockServer==null?(h||(h=b("Promise"))).reject("Mock server is not available. Make sure you use worker v2"):d("MAWMockServerShell").getMockServer().init(a)},runJobFireAndForget:function(a){return o.promise.then(function(){return r.fireAndForget(a)})},runJobWaitUntilCompleted:function(a){return o.promise.then(function(){return r.waitUntilCompleted(a)})},runJobWaitUntilPersisted:function(a){return o.promise.then(function(){return r.waitUntilPersisted(a)})},runMock:function(a){return d("MAWMockServerShell").getMockServer==null?(h||(h=b("Promise"))).reject("Mock server is not available. Make sure you use worker v2"):d("MAWMockServerShell").getMockServer().runMock(a)},setMockVariables:function(a){if(d("MAWMockServerShell").getMockServer==null)throw c("WAErr")("Mock server is not available. Make sure you use worker v2");d("MAWMockServerShell").getMockServer().setVariables(a.variables)}}));d("MAWPREListeners").initializeWAPREMetrics();c("promiseDone")(d("MAWFTSDataSync").initFTS());d("MAWMailboxUploadDataSync").initMailboxUpload();d("MAWDyiBatchRestoreDataSync").initDyiBatchUpload();s=(yield d("WAGetClockSkewApi").getClockSkew());n=s.clockSkew;d("WATimeUtils").setClockSkew(n);yield d("MAWAbProps").initAbProps();c("gkx")("23903")&&d("WADebugTools").initDebugFunctions(d("MAWDebugDefineFunctions").getAllDebugFunctions());return d("MAWComms").startComms(a.regInfo,t).then(function(){d("WASentBytesCache").initSentBytesCache(d("MAWSentBytesCacheApi").sentBytesCacheApi)}).then(function(){m.LOG(i());d("MAWGetWorkerStatusApi").updateWorkerStatus("success");return o.resolve()}).then(function(){d("MAWEbUploadQueue").listenForEbUploadQueueFlush()})});return n.apply(this,arguments)}g.startMAWBackend=a}),98);
__d("MAWSignalIndexedDb",["MAWCurrentUser","MAWErrorObject","MAWExceededStorageQuota","MAWGetWorkerStatusApi","MAWIndexedDbMetadata","MAWLowLevelApiTypes","MAWQplProxy","MAWTransactionMode","Promise","WALogger","WAWorkerGlobalScope","err","promiseDone","qex","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SignalDb initialization] upgradeneeded is triggered in another worker. This should not happen."]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[JOB] Setting up the jobs database"]);j=function(){return a};return a}var k=null,l=null,m="jobs";function n(){return c("qex")._("940")}function o(){if(k==null)throw c("err")("SignalDB IndexDB should've been initialized");return k}function p(){if(l==null)throw c("err")("SignalDB IndexDB should've been initialized");return l.then(function(){return o()})}function a(){return k!=null}var q=[function(a){a=a.target.result;a=a.createObjectStore(m,{autoIncrement:!0,keyPath:"jobId"});a.createIndex("uniqKey","uniqKey")},function(){},function(){}];function e(a){l=null;k=null;return r(a).then(function(){return k.version})}function r(a){if(l!=null)return l;if(k!=null)return(h||(h=b("Promise"))).resolve();var c=d("MAWCurrentUser").getID(),e=d("MAWIndexedDbMetadata").signalDbName(c),f=(a=(c=a)!=null?c:n())!=null?a:q.length;d("MAWGetWorkerStatusApi").setDatabaseStatus(e,d("MAWLowLevelApiTypes").DatabaseState.Initializing);d("MAWGetWorkerStatusApi").setDatabaseApi(e,"native");l=new(h||(h=b("Promise")))(function(a,b){d("WALogger").LOG(j());var c=indexedDB.open(e,f);c.onupgradeneeded=function(a){d("MAWGetWorkerStatusApi").setDatabaseStatus(e,d("MAWLowLevelApiTypes").DatabaseState.Upgrading);for(var b=0;b<q.length;b++){var c=q[b],f=b+1;s(a,f)&&c(a)}};c.onsuccess=function(b){var c=b.target.result;d("MAWGetWorkerStatusApi").setDatabaseStatus(e,d("MAWLowLevelApiTypes").DatabaseState.Open);c.onversionchange=function(){var a;d("WALogger").ERROR(i());c.close();(a=d("WAWorkerGlobalScope").workerGlobalScope.location)==null?void 0:a.reload==null?void 0:a.reload()};k=c;a()};c.onerror=function(){d("MAWGetWorkerStatusApi").setDatabaseStatus(e,d("MAWLowLevelApiTypes").DatabaseState.Error),b(c.error)}});return l}function s(a,b){var c=a.newVersion;a=a.oldVersion;return a<b&&c>=b}function t(a){return a===d("MAWTransactionMode").READWRITE?"readwrite":"readonly"}function f(a,b,e,f){var g=t(b);return function(b){return function(){for(var h=arguments.length,i=new Array(h),j=0;j<h;j++)i[j]=arguments[j];var m=f!=null?d("MAWQplProxy").startQplUserFlow(f):null,n=function f(h){return p().then(function(c){var e=function(b){b=c.transaction(a,b!=null?t(b):g,{durability:"relaxed"});d("MAWExceededStorageQuota").listenToQuotaExceededError(b);return b.objectStore(a)};return b.apply(void 0,[e].concat(i))}).then(function(a){m==null?void 0:m.endSuccess();return a})["catch"](function(b){m==null?void 0:m.endFail("job_transaction_fail");b=d("MAWErrorObject").getErrorObject(b);if((b==null?void 0:b.name)==="InvalidStateError"&&h===1){l=null;k=null;c("promiseDone")(r());return f(h-1)}throw c("unrecoverableViolation")(e+":"+a+" - Error performing transaction in signalDB transactor v2","messenger_e2ee_web",b?{error:b}:{})})};return n(1)}}}g.getSignalDbVersion=n;g.getSignalDB=o;g.isSignalDBInitted=a;g.dbMigrations=q;g.makeSignalDbIgnoringPreviousCreations=e;g.makeSignalDB=r;g.makeSignalMsgrTransactor=f}),98);
__d("MediaDownloadMediator",["asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";var g=new Map();function a(a,b){g.set(a,b)}function c(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c;yield (c=g.get(a))==null?void 0:c["continue"](b);g["delete"](a)});return h.apply(this,arguments)}f.mapDeliveryObjectIdToMediaDownloader=a;f.handleNewCDNUrlFromMI=c}),66);
__d("MAWMediaSizeCheck",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a>100*1024}f.isMinSizeForImagePreviewGeneration=a}),66);
__d("MAWOptimisticUploadMedia",["MAWFrontendMediaUtils","MAWGlobals","MAWMediaSizeCheck","MAWMediaUtils","MAWOptimisticUploadManager","MAWStartMediaUploaQplFlow","WALogger","WAMediaCrypto","WAMediaUtils","WAResultOrError","WAUploadMedia","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["optimisticUploadMedia: fileUploadResult success, setting with previewPlaintextHash"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["optimisticUploadMedia: previewUploadResult success"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["optimisticUploadMedia: preview uploading"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["optimisticUploadMedia: thumbnail_exists: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["optimisticUploadMedia: File is already being uploaded"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["optimisticUploadMedia: fileUploadResult success"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["optimisticUploadMedia: file uploading"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Expected chatJid in optimisticUploadMedia"]);o=function(){return a};return a}function p(a,b,c){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e=(yield d("MAWMediaUtils").hashBlob(a));e=d("WAMediaUtils").toPlaintextHash(e);var f=d("MAWOptimisticUploadManager").getOptimisticUploadManager();f=f.get(e);if(f!=null)return d("WAResultOrError").makeError("already_uploading");if(b==null){d("WALogger").ERROR(o());return d("WAResultOrError").makeError("missing_chat_jid")}f=c.type==="regular"?c.mediaType:"preview";var g=(yield d("MAWStartMediaUploaQplFlow").startMediaUploaQplFlow({chatJid:b,fileSize:a.size,serverMediaType:f,uploadEntry:"optimisticUploadMedia"}));b=d("WAUploadMedia").uploadMedia({chatJid:b,filename:f==="document"?a.name:void 0,hash:e,mediaTypeDetails:c,protocolMsgId:null,size:a.size,uploadMediaMetric:g});return d("WAResultOrError").makeResult({plaintextHash:e,uploadPromise:b})});return q.apply(this,arguments)}function a(a){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.file,c=a.threadId;a=a.thumbnail;var e=d("MAWOptimisticUploadManager").getOptimisticUploadManager();c=(yield d("MAWGlobals").getDbImpls().getThreadJidByChatId(c));var f=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(b.type);f=f.serverMediaType;d("WALogger").LOG(n());var g=(yield p(b,c,{mediaType:f,type:"regular"}));if(g.success===!0)d("WALogger").LOG(m()),e.set(g.value.plaintextHash,{file:b,optimisticUploadPromise:g.value.uploadPromise,previewPlaintextHash:null});else{var o=g.error;switch(o){case"already_uploading":d("WALogger").LOG(l());break;case"missing_chat_jid":break}}o=null;d("WALogger").LOG(k(),a!=null);if(a&&s(f,b.size)){d("WALogger").LOG(j());c=(yield p(a,c,{messageType:d("WAMediaCrypto").convertServerMediaTypeToPreviewMediaType(f),type:"preview"}));c.success===!0&&(d("WALogger").LOG(i()),o=c.value.plaintextHash,e.set(c.value.plaintextHash,{file:a,optimisticUploadPromise:c.value.uploadPromise}),g.success===!0&&(d("WALogger").LOG(h()),e.set(g.value.plaintextHash,{file:b,optimisticUploadPromise:g.value.uploadPromise,previewPlaintextHash:o})))}});return r.apply(this,arguments)}function s(a,b){if(a!=="image")return!0;a;return d("MAWMediaSizeCheck").isMinSizeForImagePreviewGeneration(b)}g.optimisticUploadMedia=a;g.shouldUploadPreview=s}),98);
__d("MAWLowLevelApiImpl",["MAWBulkSaveSignalDataApi","MAWCommonLowLevelApiBridgeHandlers","MAWCommonLowLevelApiDbCallbacks","MAWCommonLowLevelApiLogWrapper","MAWConvertCreateGroupResultApi","MAWDefinePersistedJob","MAWDeletePreKeyGenerationsApi","MAWGetLastPreKeyGenerationIdApi","MAWGetPreKeyGenerationsTimestampsApi","MAWJids","MAWJobPersistenceAccessorsApi","MAWLoadAllJobsApi","MAWLoadICDCApi","MAWLoadIdentitiesApi","MAWLoadLastSyncTsApi","MAWLoadLatestSignedPreKeyApi","MAWLoadOneTimePreKeyApi","MAWLoadPreKeysApi","MAWLoadSenderKeySessionApi","MAWLoadSignedPreKeyApi","MAWSaveOneTimePreKeyApi","MAWSavePreKeysGenerationApi","MAWSaveSignedPreKeyIfNewApi","MAWSessionApi"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return{bridgeHandlers:babelHelpers["extends"]({},d("MAWCommonLowLevelApiBridgeHandlers").commonBridgeHandlers),crypto:{db:d("MAWCommonLowLevelApiLogWrapper").lowLevelApiLogWrapper({bulkLoadIdentities:d("MAWLoadIdentitiesApi").bulkLoadIdentities,bulkSaveSignalData:d("MAWBulkSaveSignalDataApi").bulkSaveSignalData,deletePreKeyGenerations:d("MAWDeletePreKeyGenerationsApi").deletePreKeyGenerations,getLastPreKeyGenerationId:d("MAWGetLastPreKeyGenerationIdApi").getLastPreKeyGenerationId,getPreKeyGenerationsTimestamps:d("MAWGetPreKeyGenerationsTimestampsApi").getPreKeyGenerationsTimestamps,loadICDC:d("MAWLoadICDCApi").loadICDC,loadIdentities:d("MAWLoadIdentitiesApi").loadIdentities,loadLastSyncTs:d("MAWLoadLastSyncTsApi").loadLastSyncTs,loadLatestSignedPreKey:d("MAWLoadLatestSignedPreKeyApi").loadLatestSignedPreKey,loadOneTimePreKey:d("MAWLoadOneTimePreKeyApi").loadOneTimePreKey,loadPreKeys:d("MAWLoadPreKeysApi").loadPreKeys,loadSenderKeySession:d("MAWLoadSenderKeySessionApi").loadSenderKeySession,loadSession:d("MAWSessionApi").loadSession,loadSessions:d("MAWSessionApi").bulkLoadSession,loadSignedPreKey:d("MAWLoadSignedPreKeyApi").loadSignedPreKey,saveOneTimePreKey:d("MAWSaveOneTimePreKeyApi").saveOneTimePreKey,savePreKeysGeneration:d("MAWSavePreKeysGenerationApi").savePreKeysGeneration,saveSignedPreKeyIfNew:d("MAWSaveSignedPreKeyIfNewApi").saveSignedPreKeyIfNew}),regInfo:a},dbCallbacks:d("MAWCommonLowLevelApiDbCallbacks").dbCallbacks,jidUtils:d("MAWJids").jidUtils,jobPersistenceAccessors:d("MAWJobPersistenceAccessorsApi").getJobPersistenceAccessors(),jobResultConverters:{convertCreateGroupResult:d("MAWConvertCreateGroupResultApi").convertCreateGroupResult},loadAllJobs:d("MAWLoadAllJobsApi").loadAllJobs,persistedJobs:d("MAWDefinePersistedJob").persistedJobsApi}}g.makeLowLevelApi=a}),98);
__d("MAWMainWebWorkerConfig",["MAWBaseConfig","MAWConstants","MAWCurrentUser","MAWDeviceRegistrationTypes","MAWEphemeralConsts","MAWGK","MAWParseXMAFBConfig","MAWTransactionsConfig","WorkerUtils","getOrchestratorVersion","gkx","isStickerEnabled","isUseridAnnotationEnabled","justknobx","qex"],(function(a,b,c,d,e,f,g){"use strict";var h,i=1;a=babelHelpers["extends"]({},c("MAWBaseConfig"),{armadilloWebProcessFutureproof:function(){return c("MAWGK").armadillo_web_process_futureproof},batchSize:function(){return c("justknobx")._("1866")},defaultUnknownContactText:function(){return d("MAWConstants").FB_UNKNOWN_USER},ephemeralMaxDeletionWindowForUnseenMessage:function(){return d("MAWEphemeralConsts").ephemeralMaxDelectionWindowForUnseenMessage},getDevicesBeforeSend:function(){return c("gkx")("23971")},getSignalFutureMessagesMax:function(){return c("gkx")("4280")?c("justknobx")._("847"):2e3},handleICDCInProtocol:function(){return c("gkx")("33007")},icdcAlertTriggerFailureCounter:function(){return c("justknobx")._("1970")},icdcCooldownIntervalInMinutes:function(){return c("justknobx")._("1971")},icdcIntervalInMinutes:function(){return c("justknobx")._("1972")},isDeviceRegistrationDomainUniquenessEnabled:function(){return c("gkx")("23969")},isDocumentReceiveEnabled:function(){return!c("gkx")("23924")},isEditMessageSendEnabled:function(){return!0},isEmployee:d("MAWCurrentUser").isEmployee,isEphemeralMessagesEnabled:function(){return!0},isFrankingDropOnInvalid:function(){return c("gkx")("23973")},isFrankingDropOnMissing:function(){return c("gkx")("23974")},isFrankingEnabled:function(){return c("justknobx")._("1347")},isGifEnabled:function(){return c("justknobx")._("1147")},isICDCErrorEnabled:function(){return c("gkx")("23975")},isMediaFallbackToAlternativeHmacSaltsEnabled:function(){return c("gkx")("23976")},isMediaLoggingEnabled:function(){return c("gkx")("23970")},isMediaWaitForConnectionOnRetryEnabled:function(){return c("gkx")("23977")},isPollsFallbackExperienceEnabled:function(){return c("gkx")("23978")},isPreEstablishSessionEnabled:function(){return c("gkx")("23979")},isProgressiveJpegSendReceiveEnabled:function(){return c("gkx")("23980")},isRavenMessagesEnabled:function(){return!0},isSenderKeyPredistributionEnabled:function(){return c("gkx")("23981")},isSharedWorkerContext:function(){return(h||(h=d("WorkerUtils"))).isSharedWorkerContext()},isStickerEnabled:c("isStickerEnabled"),isUnsupportedMessagesRedesignEnabled:function(){return c("gkx")("1564")},isUseridAnnotationEnabled:c("isUseridAnnotationEnabled"),maxAppDataRecipients:function(){return d("MAWConstants").MAX_APPDATA_RECIPIENTS},maxUsersForNotifyDeviceChange:function(){return d("MAWDeviceRegistrationTypes").MAX_USERS_FOR_NOTIFY_DEVICE_CHANGE},mediaUploadRoot:function(){return"/wa-msgr/mms"},messageRetryCountLimit:function(){return d("MAWConstants").MESSAGE_RETRY_COUNT_LIMIT},orchestratorVersion:function(){return c("getOrchestratorVersion")()},productTypeForEBAttachments:"msgr",sessionDropIfTooOld:function(){return c("justknobx")._("2240")},supportedTypesVersion:function(){return c("MAWGK").armadillo_web_process_futureproof?i+1:i},supportedXMATargetTypes:function(){return d("MAWParseXMAFBConfig").FB_SUPPORTED_TARGET_TYPES},transactions:d("MAWTransactionsConfig").transactions,useCryptoManagerV2:function(){return!0},useEbUploadQueue:function(){return c("gkx")("23936")||c("qex")._("919")===!0},useLongSessionDrop:function(){return c("gkx")("1244")},useMostRecentMediaEntryForDownload:function(){return c("justknobx")._("1891")}});b=a;g["default"]=b}),98);
__d("WorkerBanzaiLazyQueueChannelWorker",["BanzaiLazyQueue","WorkerFuncChannel"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=d("WorkerFuncChannel").importChannel({queuePost:null},a,"banzai_lazyqueue_channel");c("BanzaiLazyQueue").onQueue.add(function(){h(b)});h(b)}function h(a){c("BanzaiLazyQueue").flushQueue().forEach(function(b){a.queuePost.apply(a,b)})}g.init=a}),98);
__d("WorkerSelf",["WorkerBanzaiLazyQueueChannelWorker","WorkerFuncChannel","WorkerQPLChannel"],(function(a,b,c,d,e,f,g){"use strict";function a(a){d("WorkerFuncChannel").activateChannels(a,"worker","client"),d("WorkerBanzaiLazyQueueChannelWorker").init(a),d("WorkerQPLChannel").setMessagePort(a)}g.init=a}),98);
__d("IGDLegacyTLCMainWebWorker",["MAWBackend","MAWCommonMainWebWorker","MAWLowLevelApiImpl","MAWMainWebWorkerConfig"],(function(a,b,c,d,e,f,g){"use strict";function a(a){self.Env=self.Env||{};a=new(d("MAWCommonMainWebWorker").BridgeAdaptor)((a=a)!=null?a:self,"IGDAWMainWebWorker");d("MAWCommonMainWebWorker").initWorker(a,d("MAWLowLevelApiImpl").makeLowLevelApi,c("MAWMainWebWorkerConfig"),d("MAWBackend").startMAWBackend)}g["default"]=a}),98);
__d("WorkerBootstrap",["HasteSupportData","ServerJSDefine"],(function(a,b,c,d,e,f,g){"use strict";function h(a){Object.keys(a).forEach(function(b){c("ServerJSDefine").handleDefine(b,[],a[b],-1,null)})}function a(a,c){var f,g;a.hsdp&&d("HasteSupportData").handle(a.hsdp);var i=(f=(g=a.jsmods)!=null?g:a.dynamicModules)!=null?f:{};h(i);var j=b.call(null,c);a.rds!=null&&a.rds.length>0&&e.call(null,a.rds,function(){});if(typeof j==="function"||j!==null)try{for(var k=arguments.length,l=new Array(k>2?k-2:0),m=2;m<k;m++)l[m-2]=arguments[m];j.apply(void 0,l)}catch(a){}}function f(a){a=a;if(typeof a==="function"||a!==null)try{a()}catch(a){}}g.initDynamicModules=h;g.start=a;g.startServerJS=f}),98);
__d("CurrentSharedWorker",["HasteSupportData","SharedWorkerStatusLock","WorkerBootstrap","emptyFunction","err","structuredClone"],(function(a,b,c,d,e,f,g){"use strict";var h=null,i=[],j=new Set(),k=[],l=!1,m=!1,n=null,o=!1,p=d("SharedWorkerStatusLock").getStatusLock();self.setTimeout(function(){if(!o){try{var a;(a=j.values().next().value)==null?void 0:a.postMessage({type:"self-terminate",response:{from:"bundle"}})}catch(a){v(a)}self.close()}},3e5);function q(){m=!0,n=null,h!==null&&(i.forEach(function(a){return a()}),i=[])}function r(a,c){var f=a.data;if(typeof f==="object"&&(f==null?void 0:f.type)==="execute-worker"){var g=!l;if(!l&&f.args instanceof Array){var k=f.args[0],t=k.hsdp,u=k.jsmods,v=k.dynamicModules;k=k.rds;t!=null&&d("HasteSupportData").handle(t);d("WorkerBootstrap").initDynamicModules((u=(t=u)!=null?t:v)!=null?u:{});k!=null&&k.length>0&&e.call(null,k,function(){});p.init();l=!0;n!=null&&(n(),q())}try{t=b.call(b,"SiteData");j.size>1&&c.postMessage({type:"execute-worker-imports",response:{}});c.postMessage({type:"execute-worker-ack",response:{firstInit:g,workerRevision:t.client_revision,spinMode:t.spin,spinTime:t.__spin_t}});o=!0}catch(a){c.postMessage({type:"execute-worker-ack",response:{firstInit:g,errorGettingSiteData:a.message}})}}else if(typeof f==="object"&&(f==null?void 0:f.type)==="sw-get-rev")try{v=b.call(b,"SiteData");c.postMessage({type:"sw-get-rev",response:{workerRevision:v.client_revision,spinMode:v.spin,spinTime:v.__spin_t}})}catch(a){c.postMessage({type:"sw-get-rev",response:{error:a.message}})}else if(typeof f==="object"&&(f==null?void 0:f.type)==="sw-shutdown"){u=Array.isArray(f.args)?f.args[0]:null;p.release();typeof u==="object"&&(u==null?void 0:u.upgrade)===!0?s({type:"sw-shutdown",response:{reason:"requested-upgrade",workerID:self.worker_id,isInitialized:o}}):typeof u==="object"&&typeof (u==null?void 0:u.reason)==="string"?s({type:"sw-shutdown",response:{reason:u==null?void 0:u.reason,workerID:self.worker_id,isInitialized:o}}):s({type:"sw-shutdown",response:{workerID:self.worker_id,isInitialized:o}});self.close()}else if(typeof f==="object"&&(f==null?void 0:f.type)==="sw-uptime-tracking"){t=typeof (f==null?void 0:f.args)==="object"?(k=f.args)==null?void 0:k.trackerID:null;c.postMessage({type:"sw-uptime-tracking",response:{trackerID:t}})}else typeof f==="object"&&(f==null?void 0:f.type)==="ww-hrp-init"&&j.size>1?c.postMessage({type:"ww-hrp-init",response:{}}):h!==null&&m?h(f):i.push(function(){return r(a,c)})}function a(a){var b=h==null;h=(a=a)!=null?a:c("emptyFunction");b&&m&&(i.forEach(function(a){return a()}),i=[])}function s(a,b){j.forEach(function(c){c.postMessage(a,b)})}function f(a){if(l){a();q();return}n=a}["log","error","info","debug","warn"].forEach(function(a){if(self.console[a]==null)throw c("err")('"'+a+'" is not a valid console method.');var b=self.console[a];self.console[a]=function(){for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];b.apply(void 0,e);var g=!1;try{c("structuredClone")!=null&&c("structuredClone")(e),g=!0}catch(a){}if(!g){s({type:"console",response:{method:"error",args:["DataCloneError: Failed to forward console message from web worker due to args not being serializable."]}});return}s({type:"console",response:{method:a,args:e}})}});try{var t=self.shared_worker_bootstrap_buffer==null?void 0:self.shared_worker_bootstrap_buffer();if(t!=null){var u=t.ports;t=t.messages;u==null?void 0:u.forEach(function(a){try{a.addEventListener("message",function(b){return r(b,a)}),j.add(a)}catch(a){v(a)}});t==null?void 0:t.forEach(function(a){try{r(a.e,a.port)}catch(a){v(a)}})}}catch(a){v(a)}function v(a){try{s({type:"sw-uncaught-error",e:{message:a.message,lineno:a.lineno,colno:a.colno,filename:a.filename,error:a.error}})}catch(a){}}self.addEventListener("error",function(a){if(j.size===0){k.push(a);return}v(a)});self.addEventListener("connect",function(a){var b=a.ports[0];b.postMessage({type:"connection-ack",response:{from:"bundle",workerID:self.worker_id}});b.addEventListener("message",function(a){return r(a,b)});b.start();j.add(b);k.length>0&&(k.forEach(v),k.splice(0,k.length))});g.setMessageHandler=a;g.postMessage=s;g.onInitComplete=f}),98);
__d("CurrentSharedWorkerAdapter",["CurrentSharedWorker","FBLogger"],(function(a,b,c,d,e,f,g){a=function(){function a(){}var b=a.prototype;b.addEventListener=function(a,b,e){switch(a){case"message":d("CurrentSharedWorker").setMessageHandler(function(a){return b({data:a})});break;case"error":break;default:c("FBLogger")("worker").mustfix("Unexpected message type %",a)}};b.removeEventListener=function(a,b,e){switch(a){case"message":d("CurrentSharedWorker").setMessageHandler(null);break;case"error":break;default:c("FBLogger")("worker").mustfix("Unexpected message type %",a)}};b.postMessage=function(a,b){d("CurrentSharedWorker").postMessage(a,b)};return a}();g.CurrentSharedWorkerAdapter=a}),98);
__d("CurrentWorkerMessagePort",["CurrentSharedWorkerAdapter"],(function(a,b,c,d,e,f,g){"use strict";var h=null;function a(){if(h==null)if("SharedWorkerGlobalScope"in self&&self instanceof self.SharedWorkerGlobalScope)h=new(d("CurrentSharedWorkerAdapter").CurrentSharedWorkerAdapter)();else if("DedicatedWorkerGlobalScope"in self&&self instanceof self.DedicatedWorkerGlobalScope)h=self;else throw new Error("CurrentWorkerAdapter: Unsupported worker type");return h}g.getMessagePort=a}),98);
__d("SharedWorkerBootstrap",["CurrentSharedWorker","CurrentWorkerMessagePort"],(function(a,b,c,d,e,f,g){"use strict";function a(a){h(function(){return b.call(null,a)})}function c(a){h(function(){return a})}function h(a){d("CurrentSharedWorker").onInitComplete(function(){var b=a();if(typeof b==="function"||b!==null)try{b(d("CurrentWorkerMessagePort").getMessagePort())}catch(a){}})}g.start=a;g.startServerJS=c}),98);
__d("SharedOrWebWorkerBootstrapInit",["SharedWorkerBootstrap","WorkerBootstrap"],(function(a,b,c,d,e,f){"use strict";function a(a){"SharedWorkerGlobalScope"in self&&self instanceof self.SharedWorkerGlobalScope?b("SharedWorkerBootstrap").startServerJS(a):b("WorkerBootstrap").startServerJS(a)}f.startServerJS=a}),66);